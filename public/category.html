<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê´‘ê³  í™ˆí˜ì´ì§€ - ì‹ì‚¬</title>
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    /* í•„ìš”ì‹œ ì¶”ê°€ ìŠ¤íƒ€ì¼ */
    /* ol ê¸°ë³¸ ë²ˆí˜¸ ì œê±° (JSì—ì„œ ì§ì ‘ "1. ë‚´ìš©" ë¶™ì„) */
    #rankingList {
      list-style: none;
    }
  </style>
</head>

<body class="bg-gray-50">
  <!-- í—¤ë” (ì •ì  ìë¦¬ í‘œì‹œì) -->
  <header class="bg-white shadow p-4">
    <h1 class="text-3xl font-bold">í—¤ë” ì˜ì—­</h1>
    <!-- ì‹¤ì œ header ì½˜í…ì¸ ë¥¼ ì—¬ê¸°ì— ì¶”ê°€ -->
  </header>

  <!-- ëª¨ë‹¬ (ì •ì  ìë¦¬ í‘œì‹œì) -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg p-6 max-w-lg w-full relative">
      <button id="closeModal" class="absolute top-2 right-2 text-2xl font-bold">&times;</button>
      <h3 id="modalTitle" class="text-2xl font-bold mb-4"></h3>
      <img id="modalImage" class="w-full h-48 object-cover rounded mb-4" />
      <p id="modalPhone" class="mb-2 text-lg"></p>
      <p id="modalAddress" class="mb-2 text-lg"></p>
    </div>
  </div>
  <!-- ì‹¤ì œ ëª¨ë‹¬ ì½˜í…ì¸ ë¥¼ ì—¬ê¸°ì— ì¶”ê°€ -->
  </div>

  <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ (í•˜ë‹¨ ì—¬ë°± mb-8 ì¶”ê°€) -->
  <main class="w-full max-w-screen-xl mx-auto px-4 sm:px-8 mt-8 mb-8 flex flex-col gap-6">
    <!-- (1) ìƒë‹¨: ì‘ê¸‰ì‹¤ íƒ€ì´í‹€ + ë¶ë§ˆí¬ -->
    <section>
      <!-- ì‘ê¸‰ì‹¤ ë°°ê²½/íƒ€ì´í‹€ (ì™¼ìª½ ì •ë ¬) -->
      <div class="bg-gradient-to-r from-gray-800 to-blue-500 text-white p-6 rounded-lg shadow mb-6">
        <h1 class="text-4xl sm:text-5xl font-bold mb-2">ì‹ì‚¬</h1>
        <p class="text-lg sm:text-xl">ìš°ë¦¬ë™ë„¤ ì‹ë‹¹ ì •ë³´ë¥¼ ì†Œê°œí•©ë‹ˆë‹¤</p>
      </div>

      <!-- ë¶ë§ˆí¬ ì˜ì—­ (ì™¼ìª½ ì •ë ¬) -->
      <div class="bg-white p-4 rounded-lg shadow border border-gray-300">
        <div class="bg-blue-100 p-6 rounded-lg">
          <h2 class="text-2xl font-bold mb-6">ë¶ë§ˆí¬</h2>
          <!-- ë¶ë§ˆí¬í•œ í•­ëª©ë“¤ì´ ë²„íŠ¼ í˜•íƒœë¡œ í‘œì‹œë  ì˜ì—­ -->
          <div id="bookmarkContainer" class="flex flex-wrap gap-3 justify-start">
            <!-- JSë¡œ ë™ì ìœ¼ë¡œ ì¶”ê°€ -->
          </div>
        </div>
      </div>
    </section>

    <!-- (2) í•˜ë‹¨: ì¢Œì¸¡ ê´‘ê³  ëª©ë¡ + ìš°ì¸¡ ì‚¬ì´ë“œë°” -->
    <div class="flex flex-col lg:flex-row gap-6 items-stretch">
      <!-- ì¢Œì¸¡: ê´‘ê³  ëª©ë¡ (ì‘ê¸‰ì‹¤ ê´‘ê³  12ê°œ, í˜ì´ì§€ë„¤ì´ì…˜ í¬í•¨) -->
      <section class="flex-1 border-2 border-gray-300 rounded-lg p-6">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="emergencyAdsContainer">
          <!-- JSë¡œ ê´‘ê³  ì¹´ë“œ(ìµœëŒ€ 12ê°œ) ë™ì  ìƒì„± -->
        </div>
        <!-- í˜ì´ì§€ë„¤ì´ì…˜ ì˜ì—­ -->
        <div id="pagination" class="mt-4 flex justify-center gap-4"></div>
      </section>

      <!-- ìš°ì¸¡: ì‚¬ì´ë“œë°” ì˜ì—­ -->
      <aside class="w-full lg:w-1/4 xl:w-1/5 flex flex-col gap-6 self-start">
        <!-- (A) ìš°ë¦¬ë™ë„¤ MVP ë°•ìŠ¤ -->
        <div class="bg-white shadow border border-gray-300 rounded-lg p-4">
          <h2 class="text-2xl font-extrabold text-yellow-500 mb-4 text-center">ìš°ë¦¬ë™ë„¤ ì¸ê¸°ëª…ì†Œ</h2>
          <!-- ë°°ê²½ ì´ë¯¸ì§€ + ê°•í™”ëœ ì˜¤ë²„ë ˆì´ ë° í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ -->
          <div id="mvpBox"
            class="relative bg-cover bg-center h-64 rounded-lg shadow-2xl cursor-pointer border-4 border-yellow-500"
            style="background-image: url('https://source.unsplash.com/random/1200x400/?luxury,architecture');">
            <div class="absolute inset-0 bg-gradient-to-b from-black via-transparent to-black opacity-60 rounded-lg">
            </div>
            <div class="absolute inset-0 flex items-center justify-center">
              <h2 id="mvpName" class="text-5xl font-extrabold text-white drop-shadow-2xl tracking-wider">VIP ë³‘ì›</h2>
            </div>
          </div>
        </div>

        <!-- (B) ê²€ìƒ‰ì–´ ë°•ìŠ¤: ë†’ì´ ì¡°ì • (ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì‚¬ìš©) -->
        <div class="bg-white shadow border border-gray-300 rounded-lg p-6" style="min-height: 310px;">
          <h2 class="text-2xl font-bold mb-6 text-center">ê²€ìƒ‰ì–´</h2>
          <!-- ê²€ìƒ‰ì–´ ëª©ë¡ -->
          <ol id="rankingList" class="pl-0 text-gray-700 space-y-3 text-2xl leading-snug">
            <!-- JSë¡œ 1~5ìœ„ ìˆœìœ„ ë™ì  ìƒì„± -->
          </ol>
        </div>

        <!-- (C) ë…ë¦½ ê´‘ê³  ë°•ìŠ¤ 1 -->
        <div class="mt-auto">
          <a href="https://example.com/ad1" target="_blank" class="block">
            <img src="https://source.unsplash.com/random/400x200/?advertisement" alt="ê´‘ê³ "
              class="w-full h-64 object-cover rounded shadow" />
          </a>
        </div>

        <!-- (D) ë…ë¦½ ê´‘ê³  ë°•ìŠ¤ 2 -->
        <div class="mt-auto">
          <a href="https://example.com/ad2" target="_blank" class="block">
            <img src="https://source.unsplash.com/random/400x200/?advertisement" alt="ê´‘ê³ "
              class="w-full h-64 object-cover rounded shadow" />
          </a>
        </div>
      </aside>
    </div>
  </main>

  <!-- í‘¸í„° (ì •ì  ìë¦¬ í‘œì‹œì) -->
  <footer class="bg-gray-800 text-white p-4 text-center">
    <p>í‘¸í„° ì˜ì—­ - Footer Placeholder</p>
  </footer>

  <script>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1. ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const pageSize = 12;                 // í•œ í˜ì´ì§€ 12ê°œ
    let current = 1;                  // í˜„ì¬ í˜ì´ì§€
    let adsData = [];                 // ì„œë²„ì—ì„œ ë°›ì€ ì „ì²´ ê´‘ê³ 

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2. ì„œë²„ì—ì„œ ë°ì´í„° ìˆ˜ì‹  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function fetchMealStores() {
      // â€» API ê²½ë¡œë¥¼ ì‹¤ì œ ì„œë²„ ì£¼ì†Œë¡œ ë°”ê¿” ì£¼ì„¸ìš”
      const res = await fetch('/category/ì‹ì‚¬/stores');
      if (!res.ok) throw new Error('ì‹ì‚¬ ì¹´í…Œê³ ë¦¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤');
      return await res.json();           // [{ businessName, phone, thumbnailUrl, ... }, â€¦ ]
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 3. ì¹´ë“œ ìƒì„± : ì´ë¯¸ì§€ + ìƒí˜¸ + ì „í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function createAdCard(ad) {
      console.log('thumbnailUrl:', ad.thumbnailUrl);   // ğŸ‘‰ ì‹¤ì œ ê°’ í™•ì¸ìš©

      // âœ… ì¸ë„¤ì¼ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ ì´ë¯¸ì§€ë¡œ ëŒ€ì²´
      const imgSrc = ad.thumbnailUrl
        ? `/uploads/${ad.thumbnailUrl}`   // DBê°€ íŒŒì¼ëª…ë§Œ ì¤€ë‹¤ë©´
        : '/images/no-image.png';         // í”„ë¡œì íŠ¸ì— ì¤€ë¹„ëœ ê¸°ë³¸ ì´ë¯¸ì§€

      const card = document.createElement('div');
      card.className =
        'ad-card bg-white shadow-lg rounded-lg p-4 flex flex-col border border-gray-300 hover:shadow-xl cursor-pointer transition';

      card.dataset.title = ad.businessName;
      card.dataset.phone = ad.phone;
      card.dataset.img = imgSrc;                   // âœ… ì•ˆì „í•œ ê²½ë¡œë¡œ ëŒ€ì²´
      card.dataset.address = ad.address || 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ';

      card.innerHTML = `
    <img src="${imgSrc}" alt="${ad.businessName}"
         class="h-40 w-full object-cover rounded mb-3" />
    <h3 class="text-xl font-bold text-center mb-1 truncate">${ad.businessName}</h3>
    <p  class="text-center text-gray-600">${ad.phone}</p>
  `;
      return card;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 4. í˜ì´ì§€ë³„ ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function renderPage(page) {
      const container = document.getElementById('emergencyAdsContainer');
      container.innerHTML = '';
      const start = (page - 1) * pageSize;
      const end = start + pageSize;
      adsData.slice(start, end).forEach(ad => container.appendChild(createAdCard(ad)));
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 5. í˜ì´ì§€ë„¤ì´ì…˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function renderPagination() {
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';
      const total = Math.ceil(adsData.length / pageSize);

      const makeBtn = (text, disabled, handler, extra = '') => {
        const b = document.createElement('button');
        b.textContent = text;
        b.disabled = disabled;
        b.className =
          `px-3 py-1 rounded ${extra} ${disabled ? 'bg-gray-200 opacity-40' : 'bg-gray-100 hover:bg-gray-200'}`;
        b.onclick = handler;
        return b;
      };

      pagination.appendChild(
        makeBtn('ì´ì „', current === 1, () => { current--; renderPage(current); renderPagination(); })
      );

      for (let i = 1; i <= total; i++) {
        pagination.appendChild(
          makeBtn(i, false, () => { current = i; renderPage(current); renderPagination(); },
            i === current ? 'bg-blue-500 text-white font-bold' : '')
        );
      }

      pagination.appendChild(
        makeBtn('ë‹¤ìŒ', current === total, () => { current++; renderPage(current); renderPagination(); })
      );
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 6. ëª¨ë‹¬ ì—´ê¸° í—¬í¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function openModalWithCard(card) {
      if (!window.populateModal) return console.warn('populateModal í•¨ìˆ˜ ì—†ìŒ');
      const data = {
        title: card.dataset.title,
        phone: card.dataset.phone,
        image: card.dataset.img,
        address: card.dataset.address,
        category: 'ì‹ì‚¬',
        delivery: 'ì •ë³´ ì—†ìŒ',
        hours: 'ì •ë³´ ì—†ìŒ',
        serviceItems: 'ì •ë³´ ì—†ìŒ',
        events: [],
        facilities: '',
        pets: 'ì •ë³´ ì—†ìŒ',
        parking: '',
        sliderImages: [card.dataset.img]
      };
      window.populateModal(data);                     // ëª¨ë‹¬ ì½˜í…ì¸  ì±„ìš°ê¸°
      document.getElementById('modal').classList.remove('hidden');  // ëª¨ë‹¬ ì—´ê¸°
    }

    window.populateModal = data => {
      document.getElementById('modalTitle').textContent = data.title;
      document.getElementById('modalImage').src = data.image || '/images/no-image.png';
      document.getElementById('modalPhone').textContent = `ì „í™”ë²ˆí˜¸: ${data.phone}`;
      document.getElementById('modalAddress').textContent = `ì£¼ì†Œ: ${data.address}`;
    };

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('closeModal')
        .addEventListener('click', () =>
          document.getElementById('modal').classList.add('hidden'));
    });

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 7. ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        adsData = await fetchMealStores();            // â‘  ë°ì´í„° ìˆ˜ì‹ 
        renderPage(current);                          // â‘¡ ì²« í˜ì´ì§€ ì¶œë ¥
        renderPagination();                           // â‘¢ í˜ì´ì§€ë„¤ì´ì…˜ ì¶œë ¥
      } catch (err) {
        console.error(err);
        document.getElementById('emergencyAdsContainer').innerHTML =
          '<p class="w-full text-center text-red-600">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';
      }

      /* ì¹´ë“œ í´ë¦­ ì‹œ ëª¨ë‹¬ */
      document.getElementById('emergencyAdsContainer').addEventListener('click', e => {
        const card = e.target.closest('.ad-card');
        if (card) openModalWithCard(card);
      });
    });
  </script>

</body>

</html>