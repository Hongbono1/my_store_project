<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>광고 홈페이지 - 식사</title>
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    /* 필요시 추가 스타일 */
    /* ol 기본 번호 제거 (JS에서 직접 "1. 내용" 붙임) */
    #rankingList {
      list-style: none;
    }
  </style>
</head>

<body class="bg-gray-50">
  <!-- 헤더 (정적 자리 표시자) -->
  <header class="bg-white shadow p-4">
    <h1 class="text-3xl font-bold">헤더 영역</h1>
    <!-- 실제 header 콘텐츠를 여기에 추가 -->
  </header>

  <!-- 모달 (정적 자리 표시자) -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg p-6 max-w-lg w-full relative">
      <button id="closeModal" class="absolute top-2 right-2 text-2xl font-bold">&times;</button>
      <h3 id="modalTitle" class="text-2xl font-bold mb-4"></h3>
      <img id="modalImage" class="w-full h-48 object-cover rounded mb-4" />
      <p id="modalPhone" class="mb-2 text-lg"></p>
      <p id="modalAddress" class="mb-2 text-lg"></p>
    </div>
  </div>
  <!-- 실제 모달 콘텐츠를 여기에 추가 -->
  </div>

  <!-- 메인 컨테이너 (하단 여백 mb-8 추가) -->
  <main class="w-full max-w-screen-xl mx-auto px-4 sm:px-8 mt-8 mb-8 flex flex-col gap-6">
    <!-- (1) 상단: 응급실 타이틀 + 북마크 -->
    <section>
      <!-- 응급실 배경/타이틀 (왼쪽 정렬) -->
      <div class="bg-gradient-to-r from-gray-800 to-blue-500 text-white p-6 rounded-lg shadow mb-6">
        <h1 class="text-4xl sm:text-5xl font-bold mb-2">식사</h1>
        <p class="text-lg sm:text-xl">우리동네 식당 정보를 소개합니다</p>
      </div>

      <!-- 북마크 영역 (왼쪽 정렬) -->
      <div class="bg-white p-4 rounded-lg shadow border border-gray-300">
        <div class="bg-blue-100 p-6 rounded-lg">
          <h2 class="text-2xl font-bold mb-6">북마크</h2>
          <!-- 북마크한 항목들이 버튼 형태로 표시될 영역 -->
          <div id="bookmarkContainer" class="flex flex-wrap gap-3 justify-start">
            <!-- JS로 동적으로 추가 -->
          </div>
        </div>
      </div>
    </section>

    <!-- (2) 하단: 좌측 광고 목록 + 우측 사이드바 -->
    <div class="flex flex-col lg:flex-row gap-6 items-stretch">
      <!-- 좌측: 광고 목록 (응급실 광고 12개, 페이지네이션 포함) -->
      <section class="flex-1 border-2 border-gray-300 rounded-lg p-6">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="emergencyAdsContainer">
          <!-- JS로 광고 카드(최대 12개) 동적 생성 -->
        </div>
        <!-- 페이지네이션 영역 -->
        <div id="pagination" class="mt-4 flex justify-center gap-4"></div>
      </section>

      <!-- 우측: 사이드바 영역 -->
      <aside class="w-full lg:w-1/4 xl:w-1/5 flex flex-col gap-6 self-start">
        <!-- (A) 우리동네 MVP 박스 -->
        <div class="bg-white shadow border border-gray-300 rounded-lg p-4">
          <h2 class="text-2xl font-extrabold text-yellow-500 mb-4 text-center">우리동네 인기명소</h2>
          <!-- 배경 이미지 + 강화된 오버레이 및 텍스트 스타일 -->
          <div id="mvpBox"
            class="relative bg-cover bg-center h-64 rounded-lg shadow-2xl cursor-pointer border-4 border-yellow-500"
            style="background-image: url('https://source.unsplash.com/random/1200x400/?luxury,architecture');">
            <div class="absolute inset-0 bg-gradient-to-b from-black via-transparent to-black opacity-60 rounded-lg">
            </div>
            <div class="absolute inset-0 flex items-center justify-center">
              <h2 id="mvpName" class="text-5xl font-extrabold text-white drop-shadow-2xl tracking-wider">VIP 병원</h2>
            </div>
          </div>
        </div>

        <!-- (B) 검색어 박스: 높이 조정 (인라인 스타일 사용) -->
        <div class="bg-white shadow border border-gray-300 rounded-lg p-6" style="min-height: 310px;">
          <h2 class="text-2xl font-bold mb-6 text-center">검색어</h2>
          <!-- 검색어 목록 -->
          <ol id="rankingList" class="pl-0 text-gray-700 space-y-3 text-2xl leading-snug">
            <!-- JS로 1~5위 순위 동적 생성 -->
          </ol>
        </div>

        <!-- (C) 독립 광고 박스 1 -->
        <div class="mt-auto">
          <a href="https://example.com/ad1" target="_blank" class="block">
            <img src="https://source.unsplash.com/random/400x200/?advertisement" alt="광고"
              class="w-full h-64 object-cover rounded shadow" />
          </a>
        </div>

        <!-- (D) 독립 광고 박스 2 -->
        <div class="mt-auto">
          <a href="https://example.com/ad2" target="_blank" class="block">
            <img src="https://source.unsplash.com/random/400x200/?advertisement" alt="광고"
              class="w-full h-64 object-cover rounded shadow" />
          </a>
        </div>
      </aside>
    </div>
  </main>

  <!-- 푸터 (정적 자리 표시자) -->
  <footer class="bg-gray-800 text-white p-4 text-center">
    <p>푸터 영역 - Footer Placeholder</p>
  </footer>

  <script>
    /* ───────────── 1. 설정 ───────────── */
    const pageSize = 12;                 // 한 페이지 12개
    let current = 1;                  // 현재 페이지
    let adsData = [];                 // 서버에서 받은 전체 광고

    /* ───────────── 2. 서버에서 데이터 수신 ───────────── */
    async function fetchMealStores() {
      // ※ API 경로를 실제 서버 주소로 바꿔 주세요
      const res = await fetch('/category/식사/stores');
      if (!res.ok) throw new Error('식사 카테고리 데이터를 불러오지 못했습니다');
      return await res.json();           // [{ businessName, phone, thumbnailUrl, ... }, … ]
    }

    /* ───────────── 3. 카드 생성 : 이미지 + 상호 + 전화 ───────────── */
    function createAdCard(ad) {
      console.log('thumbnailUrl:', ad.thumbnailUrl);   // 👉 실제 값 확인용

      // ✅ 썸네일이 없으면 기본 이미지로 대체
      const imgSrc = ad.thumbnailUrl
        ? `/uploads/${ad.thumbnailUrl}`   // DB가 파일명만 준다면
        : '/images/no-image.png';         // 프로젝트에 준비된 기본 이미지

      const card = document.createElement('div');
      card.className =
        'ad-card bg-white shadow-lg rounded-lg p-4 flex flex-col border border-gray-300 hover:shadow-xl cursor-pointer transition';

      card.dataset.title = ad.businessName;
      card.dataset.phone = ad.phone;
      card.dataset.img = imgSrc;                   // ✅ 안전한 경로로 대체
      card.dataset.address = ad.address || '주소 정보 없음';

      card.innerHTML = `
    <img src="${imgSrc}" alt="${ad.businessName}"
         class="h-40 w-full object-cover rounded mb-3" />
    <h3 class="text-xl font-bold text-center mb-1 truncate">${ad.businessName}</h3>
    <p  class="text-center text-gray-600">${ad.phone}</p>
  `;
      return card;
    }

    /* ───────────── 4. 페이지별 렌더링 ───────────── */
    function renderPage(page) {
      const container = document.getElementById('emergencyAdsContainer');
      container.innerHTML = '';
      const start = (page - 1) * pageSize;
      const end = start + pageSize;
      adsData.slice(start, end).forEach(ad => container.appendChild(createAdCard(ad)));
    }

    /* ───────────── 5. 페이지네이션 ───────────── */
    function renderPagination() {
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';
      const total = Math.ceil(adsData.length / pageSize);

      const makeBtn = (text, disabled, handler, extra = '') => {
        const b = document.createElement('button');
        b.textContent = text;
        b.disabled = disabled;
        b.className =
          `px-3 py-1 rounded ${extra} ${disabled ? 'bg-gray-200 opacity-40' : 'bg-gray-100 hover:bg-gray-200'}`;
        b.onclick = handler;
        return b;
      };

      pagination.appendChild(
        makeBtn('이전', current === 1, () => { current--; renderPage(current); renderPagination(); })
      );

      for (let i = 1; i <= total; i++) {
        pagination.appendChild(
          makeBtn(i, false, () => { current = i; renderPage(current); renderPagination(); },
            i === current ? 'bg-blue-500 text-white font-bold' : '')
        );
      }

      pagination.appendChild(
        makeBtn('다음', current === total, () => { current++; renderPage(current); renderPagination(); })
      );
    }

    /* ───────────── 6. 모달 열기 헬퍼 ───────────── */
    function openModalWithCard(card) {
      if (!window.populateModal) return console.warn('populateModal 함수 없음');
      const data = {
        title: card.dataset.title,
        phone: card.dataset.phone,
        image: card.dataset.img,
        address: card.dataset.address,
        category: '식사',
        delivery: '정보 없음',
        hours: '정보 없음',
        serviceItems: '정보 없음',
        events: [],
        facilities: '',
        pets: '정보 없음',
        parking: '',
        sliderImages: [card.dataset.img]
      };
      window.populateModal(data);                     // 모달 콘텐츠 채우기
      document.getElementById('modal').classList.remove('hidden');  // 모달 열기
    }

    window.populateModal = data => {
      document.getElementById('modalTitle').textContent = data.title;
      document.getElementById('modalImage').src = data.image || '/images/no-image.png';
      document.getElementById('modalPhone').textContent = `전화번호: ${data.phone}`;
      document.getElementById('modalAddress').textContent = `주소: ${data.address}`;
    };

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('closeModal')
        .addEventListener('click', () =>
          document.getElementById('modal').classList.add('hidden'));
    });

    /* ───────────── 7. 초기화 ───────────── */
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        adsData = await fetchMealStores();            // ① 데이터 수신
        renderPage(current);                          // ② 첫 페이지 출력
        renderPagination();                           // ③ 페이지네이션 출력
      } catch (err) {
        console.error(err);
        document.getElementById('emergencyAdsContainer').innerHTML =
          '<p class="w-full text-center text-red-600">데이터를 불러오지 못했습니다.</p>';
      }

      /* 카드 클릭 시 모달 */
      document.getElementById('emergencyAdsContainer').addEventListener('click', e => {
        const card = e.target.closest('.ad-card');
        if (card) openModalWithCard(card);
      });
    });
  </script>

</body>

</html>