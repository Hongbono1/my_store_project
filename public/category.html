<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>우리동네 밥집광고관</title>
  <link rel="stylesheet" href="/assets/css/tailwind.css" />
  <style>
    body {
      background: linear-gradient(120deg, #f8fafc 0%, #e9f0fa 100%);
    }

    .main-card:hover {
      box-shadow: 0 8px 32px rgba(56, 112, 255, .10);
      transform: translateY(-4px) scale(1.03);
    }

    .category-scroll {
      scrollbar-width: thin;
    }
  </style>
</head>

<body class="min-h-screen flex flex-col bg-gradient-to-br from-blue-50 via-white to-blue-100">

  <!-- 헤더 -->
  <jsp:include page="components/header.html" />

  <main class="flex-1 w-full max-w-7xl mx-auto px-2 sm:px-8 py-10">

    <!-- 1. 메인 타이틀 박스 (배경 이미지+둥근 박스+흰색 글씨+오버레이) -->
    <section class="w-full flex justify-center items-center py-8">
      <div class="relative w-full max-w-2xl rounded-3xl overflow-hidden shadow-xl">
        <img src="/uploads/images.jpg" alt="한식 상차림" class="w-full h-60 object-cover" />
        <div class="absolute inset-0 bg-black/40"></div>
        <div class="absolute inset-0 flex flex-col justify-center items-center z-10">
          <h1 class="text-4xl sm:text-5xl font-extrabold text-white mb-2 drop-shadow-lg tracking-tight">
            오늘 뭐 먹지? <span class="text-yellow-300">한식 한끼</span>
          </h1>
          <p class="text-base sm:text-xl text-white/90 font-semibold drop-shadow-sm">
            우리동네에서 맛보는 정겨운 식사, <span class="font-extrabold">"밥"</span> 카테고리 맛집을 소개합니다!
          </p>
        </div>
      </div>
    </section>

    <!-- 2. 카테고리 스크롤 버튼 (상단 고정 느낌) -->
    <section id="categorySelection" class="bg-white/80 p-4 rounded-xl shadow border border-blue-200 mt-10 mb-10">
      <div class="flex flex-wrap gap-2 justify-center category-scroll overflow-x-auto py-2">
        <button
          class="category-btn bg-blue-50 text-blue-800 font-bold px-5 py-2 rounded-full border border-blue-200 shadow hover:bg-blue-500 hover:text-white transition"
          data-category="밥">밥</button>
        <button
          class="category-btn bg-blue-50 text-blue-800 font-bold px-5 py-2 rounded-full border border-blue-200 shadow hover:bg-blue-500 hover:text-white transition"
          data-category="찌개/탕/국">찌개/탕/국</button>
        <button
          class="category-btn bg-blue-50 text-blue-800 font-bold px-5 py-2 rounded-full border border-blue-200 shadow hover:bg-blue-500 hover:text-white transition"
          data-category="고기/구이">고기/구이</button>
        <button
          class="category-btn bg-blue-50 text-blue-800 font-bold px-5 py-2 rounded-full border border-blue-200 shadow hover:bg-blue-500 hover:text-white transition"
          data-category="해물">해물</button>
        <button
          class="category-btn bg-blue-50 text-blue-800 font-bold px-5 py-2 rounded-full border border-blue-200 shadow hover:bg-blue-500 hover:text-white transition"
          data-category="족발/보쌈">족발/보쌈</button>
        <button
          class="category-btn bg-blue-50 text-blue-800 font-bold px-5 py-2 rounded-full border border-blue-200 shadow hover:bg-blue-500 hover:text-white transition"
          data-category="국밥">국밥</button>
        <button
          class="category-btn bg-blue-50 text-blue-800 font-bold px-5 py-2 rounded-full border border-blue-200 shadow hover:bg-blue-500 hover:text-white transition"
          data-category="반찬">반찬</button>
        <button
          class="category-btn bg-blue-50 text-blue-800 font-bold px-5 py-2 rounded-full border border-blue-200 shadow hover:bg-blue-500 hover:text-white transition"
          data-category="여러가지">여러가지</button>
      </div>
    </section>

    <!-- 3. 파워광고 섹션 -->
    <section id="powerAdsSection" class="mb-12">
      <h2 class="text-2xl font-extrabold text-yellow-600 mb-6">파워 광고</h2>
      <div id="powerAdsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- JS로 파워광고 카드가 들어감 (예시) -->
        <div
          class="ad-card relative bg-yellow-50 border-4 border-yellow-400 shadow-lg rounded-xl p-6 flex flex-col hover:-translate-y-1 hover:shadow-2xl transition">
          <div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 text-xs rounded">파워광고</div>
          <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=600&q=80"
            alt="대표광고" class="h-36 w-full object-cover rounded mb-4" />
          <h2 class="text-xl font-bold text-center mb-1">경복궁 한정식</h2>
          <p class="text-base text-gray-600 text-center">02-123-4567</p>
          <a href="/detail.html?id=1"
            class="mt-3 bg-blue-600 text-white font-bold py-2 rounded shadow text-center hover:bg-blue-800 block">상세보기</a>
        </div>
        <!-- 파워광고 카드 3개 더 복붙해서 예시로 추가 -->
        <div
          class="ad-card relative bg-yellow-50 border-4 border-yellow-400 shadow-lg rounded-xl p-6 flex flex-col hover:-translate-y-1 hover:shadow-2xl transition">
          <div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 text-xs rounded">파워광고</div>
          <img src="https://images.unsplash.com/photo-1519864600265-abb23847ef2c?auto=format&fit=crop&w=600&q=80"
            alt="대표광고" class="h-36 w-full object-cover rounded mb-4" />
          <h2 class="text-xl font-bold text-center mb-1">왕비집</h2>
          <p class="text-base text-gray-600 text-center">02-234-5678</p>
          <a href="/detail.html?id=2"
            class="mt-3 bg-blue-600 text-white font-bold py-2 rounded shadow text-center hover:bg-blue-800 block">상세보기</a>
        </div>
        <div
          class="ad-card relative bg-yellow-50 border-4 border-yellow-400 shadow-lg rounded-xl p-6 flex flex-col hover:-translate-y-1 hover:shadow-2xl transition">
          <div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 text-xs rounded">파워광고</div>
          <img src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?auto=format&fit=crop&w=600&q=80"
            alt="대표광고" class="h-36 w-full object-cover rounded mb-4" />
          <h2 class="text-xl font-bold text-center mb-1">함지박</h2>
          <p class="text-base text-gray-600 text-center">031-777-8888</p>
          <a href="/detail.html?id=3"
            class="mt-3 bg-blue-600 text-white font-bold py-2 rounded shadow text-center hover:bg-blue-800 block">상세보기</a>
        </div>
        <div
          class="ad-card relative bg-yellow-50 border-4 border-yellow-400 shadow-lg rounded-xl p-6 flex flex-col hover:-translate-y-1 hover:shadow-2xl transition">
          <div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 text-xs rounded">파워광고</div>
          <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=600&q=80"
            alt="대표광고" class="h-36 w-full object-cover rounded mb-4" />
          <h2 class="text-xl font-bold text-center mb-1">만복국수</h2>
          <p class="text-base text-gray-600 text-center">031-000-1111</p>
          <a href="/detail.html?id=4"
            class="mt-3 bg-blue-600 text-white font-bold py-2 rounded shadow text-center hover:bg-blue-800 block">상세보기</a>
        </div>
      </div>
    </section>

    <!-- 4. 실제 카테고리별 광고 리스트 (섹션별 렌더, 동적 연동) -->
    <section id="밥Section" class="mt-12 border-2 border-gray-200 rounded-2xl p-6 bg-white shadow">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-extrabold text-blue-900">밥</h2>
        <a href="subcategory.html?category=밥" class="more-link text-blue-600 hover:underline font-bold text-lg">+더보기</a>
      </div>
      <div id="밥Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- JS 카드 들어갈 자리 -->
      </div>
    </section>

    <!-- 5. 기타 카테고리 섹션 예시: 복붙해서 사용 가능 -->
    <section id="찌개/탕/국Section" class="mt-12 border-2 border-gray-200 rounded-2xl p-6 bg-white shadow">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-extrabold text-blue-900">찌개/탕/국</h2>
        <a href="subcategory.html?category=찌개/탕/국"
          class="more-link text-blue-600 hover:underline font-bold text-lg">+더보기</a>
      </div>
      <div id="찌개/탕/국Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>

    <!-- 고기/구이 -->
    <section id="고기/구이Section" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold">고기/구이(제육볶음)</h2>
        <div class="flex items-center space-x-6">
          <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
          <a href="subcategory.html?category=고기/구이"
            class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
        </div>
      </div>
      <div id="고기/구이Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>

    <!-- 해물로 바굴것 -->
    <section id="생선Section" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold">생선</h2>
        <div class="flex items-center space-x-6">
          <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
          <a href="subcategory.html?category=생선"
            class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
        </div>
      </div>
      <div id="생선Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>

    <!-- 족발/보쌈 -->
    <section id="족발/보쌈Section" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold">족발/보쌈</h2>
        <div class="flex items-center space-x-6">
          <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
          <a href="subcategory.html?category=족발/보쌈"
            class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
        </div>
      </div>
      <div id="족발/보쌈Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>

    <!-- 국밥 -->
    <section id="국밥Section" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold">국밥</h2>
        <div class="flex items-center space-x-6">
          <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
          <a href="subcategory.html?category=국밥"
            class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
        </div>
      </div>
      <div id="국밥Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>

    <!-- 반찬 -->
    <section id="반찬Section" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold">반찬</h2>
        <div class="flex items-center space-x-6">
          <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
          <a href="subcategory.html?category=반찬"
            class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
        </div>
      </div>
      <div id="반찬Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>

    <!-- 야식 -->
    <section id="야식ectSection" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold">야식</h2>
        <div class="flex items-center space-x-6">
          <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
          <a href="subcategory.html?category=야식"
            class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
        </div>
      </div>
      <div id="야식Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>

    <!-- 여러가지 -->
    <section id="여러가지etcSection" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold">여러가지</h2>
        <div class="flex items-center space-x-6">
          <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
          <a href="subcategory.html?category=야식"
            class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
        </div>
      </div>
      <div id="여러가지Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>
  </main>

  <!-- 푸터 (JSP 인클루드로 불러옴) -->
  <jsp:include page="components/footer.html" />


  <!-- 광고 렌더링 관련 스크립트 -->
  <script>
    // 0) 스크롤용 맵 (섹션 ID → 소제목까지 스크롤)
    const scrollMap = {
      밥: "밥Section",
      "찌개/탕/국": "찌개/탕/국Section",
      "고기/구이": "고기/구이Section",
      생선: "생선Section",
      "족발/보쌈": "족발/보쌈Section",
      국밥: "국밥Section",
      반찬: "반찬Section",
      여러가지: "여러가지etcSection"
    };

    // 1) 렌더링용 맵 (그리드 컨테이너 ID → 카드만 교체)
    const renderMap = {
      밥: "밥Container",
      "찌개/탕/국": "찌개/탕/국Container",
      "고기/구이": "고기/구이Container",
      생선: "생선Container",
      "족발/보쌈": "족발/보쌈Container",
      국밥: "국밥Container",
      반찬: "반찬Container",
      여러가지: "여러가지Container"
    };

    // 2) 서버에서 데이터 가져오기
    async function fetchStores() {
      const params = new URLSearchParams(window.location.search);
      const category = params.get("category") || "";
      const subcategory = params.get("subcategory") || "";

      let url = `/category/${encodeURIComponent(category)}/stores`;
      if (subcategory) {
        url += `?subcategory=${encodeURIComponent(subcategory)}`;
      }
      console.log("▶ fetchStores URL:", url);

      const res = await fetch(url);
      if (!res.ok) throw new Error("데이터 조회 실패");
      return await res.json();
    }

    // 3) 카드 내부 HTML 생성
    function makeCardHTML(ad, isPower) {
      return `
      ${isPower ? '<div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 text-xs rounded">파워광고</div>' : ''}
      <img src="${ad.thumb || '/assets/images/no-thumb.png'}" alt="${ad.businessName}" class="h-40 w-full object-cover rounded mb-4" />
      <h2 class="text-2xl font-bold text-center mb-2">${ad.businessName}</h2>
      <p class="text-lg text-gray-500 text-center">${ad.phone || "전화번호 없음"}</p>
      <a href="/detail.html?id=${ad.id}"
        class="mt-4 bg-blue-500 text-white py-2 px-4 rounded text-center shadow-lg hover:bg-blue-600 block">
        상세보기
      </a>
    `;
    }

    // 4) 파워 광고 카드 생성
    function createPowerAdCard(ad) {
      const box = document.createElement("div");
      box.className =
        "ad-card relative bg-yellow-50 border-4 border-yellow-400 shadow-lg rounded-lg p-6 flex flex-col transform transition duration-300 hover:-translate-y-2 hover:shadow-2xl";
      box.innerHTML = makeCardHTML(ad, true);
      return box;
    }

    // 5) 일반 광고 카드 생성
    function createAdCard(ad) {
      const box = document.createElement("div");
      box.className =
        "ad-card bg-white shadow-lg rounded-lg p-6 flex flex-col border-2 border-gray-300 transform transition duration-300 hover:-translate-y-2 hover:shadow-2xl";
      box.innerHTML = makeCardHTML(ad, false);
      return box;
    }

    // 6) 섹션에 카드 붙이기
    function renderSection(items, makeCard, containerId, limit) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      items.slice(0, limit).forEach(ad => container.appendChild(makeCard(ad)));
    }

    // 7) 페이지 초기화
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        const stores = await fetchStores();
        window.stores = stores;
        console.log("✅ stores:", stores);

        // 7-1) 소제목 유지하며 각 그리드 컨테이너에 카드 렌더링
        Object.entries(renderMap).forEach(([cat, gridId]) => {
          const items = stores.filter(ad => ad.subcategory === cat);   // ← subcategory 키로 비교
          console.log("↪", cat, "받은 개수:", items.length);
          renderSection(items, createAdCard, gridId, 8);
        });

        // 7-2) 파워 광고
        renderSection(
          stores.filter(ad => ad.powerAd),
          createPowerAdCard,
          "powerAdsContainer",
          4
        );

        // 7-3) 카테고리 버튼 스크롤 (소제목까지)
        document.querySelectorAll(".category-btn").forEach(btn => {
          btn.addEventListener("click", () => {
            const secId = scrollMap[btn.dataset.category];
            document.getElementById(secId)?.scrollIntoView({ behavior: "smooth" });
          });
        });

        // 7-4) 홈 버튼 스크롤
        document.querySelectorAll(".home-link").forEach(link => {
          link.addEventListener("click", e => {
            e.preventDefault();
            document.getElementById("categorySelection").scrollIntoView({ behavior: "smooth" });
          });
        });

      } catch (err) {
        console.error("광고 데이터 로드 실패:", err);
      }
    });
  </script>
</body>

</html>