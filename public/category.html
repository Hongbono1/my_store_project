<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>광고 홈페이지 - 식사</title>
  <link rel="stylesheet" href="/assets/css/tailwind.css" />
</head>

<body class="min-h-screen flex flex-col bg-white">
  <!-- 헤더 -->
  <div id="header"></div>

    <!-- ▣ 메인 -->
    <main class="w-full max-w-7xl mx-auto px-4 sm:px-8 py-10 flex-1">
      <!-- 타이틀 -->
      <!-- 메인 타이틀 박스 -->
      <section class="w-full flex justify-center items-center py-8">
        <div class="relative w-full max-w-2xl rounded-3xl overflow-hidden shadow-xl">
          <!-- 배경 이미지 -->
          <img src="/uploads/images.jpg" alt="한식 상차림" class="w-full h-60 object-cover opacity-95" />
          <!-- 반투명 블랙 오버레이 -->
          <div class="absolute inset-0 bg-black bg-opacity-40"></div>
          <!-- 텍스트 -->
          <div class="absolute inset-0 flex flex-col justify-center items-center z-10">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-white mb-2 drop-shadow-lg">
              밥 카테고리
            </h1>
            <p class="text-lg sm:text-xl text-white/90 font-semibold drop-shadow">
              오늘은 한식 한끼! 맛있는 동네 밥집을 소개합니다.
            </p>
          </div>
        </div>
      </section>

      <!-- 스크롤 버튼 (카테고리 선택 영역) -->
      <section id="categorySelection" class="bg-white p-4 rounded-lg shadow border border-gray-300 mt-8 mb-8">
        <div class="bg-blue-100 p-6 rounded-lg">
          <h2 class="text-2xl font-bold mb-6">스크롤 선택</h2>
          <div class="flex overflow-x-auto space-x-3 py-3">

            <!-- 식사 -->
            <button
              class="category-btn bg-white text-[#2C3E50] font-medium px-5 py-2 text-lg rounded-full border border-[#748CAB] shadow-md hover:bg-[#7F9BBF] transition"
              data-category="식사">식사</button>

            <!-- 찌개/탕 -->
            <button
              class="category-btn bg-white text-[#2C3E50] font-medium px-5 py-2 text-lg rounded-full border border-[#748CAB] shadow-md hover:bg-[#7F9BBF] transition"
              data-category="찌개/탕/국">찌개/탕/국</button>

            <!-- 고기/구이 -->
            <button
              class="category-btn bg-white text-[#2C3E50] font-medium px-5 py-2 text-lg rounded-full border border-[#748CAB] shadow-md hover:bg-[#7F9BBF] transition"
              data-category="고기/구이">고기/구이</button>

            <!-- 생선 -->
            <button
              class="category-btn bg-white text-[#2C3E50] font-medium px-5 py-2 text-lg rounded-full border border-[#748CAB] shadow-md hover:bg-[#7F9BBF] transition"
              data-category="해물">해물</button>

            <!-- 족발/보쌈 -->
            <button
              class="category-btn bg-white text-[#2C3E50] font-medium px-5 py-2 text-lg rounded-full border border-[#748CAB] shadow-md hover:bg-[#7F9BBF] transition"
              data-category="족발/보쌈">족발/보쌈</button>

            <!-- 국밥 -->
            <button
              class="category-btn bg-white text-[#2C3E50] font-medium px-5 py-2 text-lg rounded-full border border-[#748CAB] shadow-md hover:bg-[#7F9BBF] transition"
              data-category="국밥">국밥</button>

            <!-- 반찬 -->
            <button
              class="category-btn bg-white text-[#2C3E50] font-medium px-5 py-2 text-lg rounded-full border border-[#748CAB] shadow-md hover:bg-[#7F9BBF] transition"
              data-category="반찬">반찬</button>

            <!-- 여러가지 -->
            <button
              class="category-btn bg-white text-[#2C3E50] font-medium px-5 py-2 text-lg rounded-full border border-[#748CAB] shadow-md hover:bg-[#7F9BBF] transition"
              data-category="여러가지">여러가지</button>
          </div>
        </div>
      </section>

      <section id="storeList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 p-6">
        <!-- JS에서 makeCardHTML → createAdCard 로 생성된 카드가 들어갑니다 -->
      </section>

      <!-- 파워 광고 (SSR 시뮬레이션) - 4개 광고 박스 -->
      <section id="powerAdsSection" class="bg-yellow-50 border-4 border-yellow-400 shadow-lg rounded-lg p-6">
        <h2 class="text-2xl font-bold mb-4">파워 광고</h2>
        <div id="powerAdsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
          <div
            class="ad-card relative bg-yellow-50 border-4 border-yellow-400 shadow-lg rounded-lg p-6 flex flex-col transform transition duration-300 hover:-translate-y-2 hover:shadow-2xl"
            data-title="파워 광고 1" data-phone="010-1111-2222" data-category="식당"
            data-img="https://via.placeholder.com/300x200/111111" data-events="신규 할인" data-facilities="휠체어 접근 가능"
            data-parking="무료 주차">
            <div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 text-xs rounded">파워광고</div>
            <img src="https://via.placeholder.com/300x200/111111" alt="파워 광고 1"
              class="h-40 w-full object-cover rounded mb-4" />
            <h2 class="text-2xl font-bold text-center mb-2">파워 광고 1</h2>
            <h3 class="text-xl font-semibold text-center text-gray-700">식당</h3>
            <p class="text-lg text-gray-500 text-center">010-1111-2222</p>
            <a href="#"
              class="open-modal mt-4 bg-blue-500 text-white py-2 px-4 rounded text-center shadow-lg hover:bg-blue-600">바로가기</a>
          </div>
          <div
            class="ad-card relative bg-yellow-50 border-4 border-yellow-400 shadow-lg rounded-lg p-6 flex flex-col transform transition duration-300 hover:-translate-y-2 hover:shadow-2xl"
            data-title="파워 광고 2" data-phone="010-2222-3333" data-category="식당"
            data-img="https://via.placeholder.com/300x200/222222" data-events="이벤트 중" data-facilities="없음"
            data-parking="유료 주차">
            <div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 text-xs rounded">파워광고</div>
            <img src="https://via.placeholder.com/300x200/222222" alt="파워 광고 2"
              class="h-40 w-full object-cover rounded mb-4" />
            <h2 class="text-2xl font-bold text-center mb-2">파워 광고 2</h2>
            <h3 class="text-xl font-semibold text-center text-gray-700">식당</h3>
            <p class="text-lg text-gray-500 text-center">010-2222-3333</p>
            <a href="#"
              class="open-modal mt-4 bg-blue-500 text-white py-2 px-4 rounded text-center shadow-lg hover:bg-blue-600">바로가기</a>
          </div>
          <div
            class="ad-card relative bg-yellow-50 border-4 border-yellow-400 shadow-lg rounded-lg p-6 flex flex-col transform transition duration-300 hover:-translate-y-2 hover:shadow-2xl"
            data-title="파워 광고 3" data-phone="010-3333-4444" data-category="식당"
            data-img="https://via.placeholder.com/300x200/333333" data-events="시즌 할인" data-facilities="휠체어 리프트 있음"
            data-parking="무료 주차">
            <div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 text-xs rounded">파워광고</div>
            <img src="https://via.placeholder.com/300x200/333333" alt="파워 광고 3"
              class="h-40 w-full object-cover rounded mb-4" />
            <h2 class="text-2xl font-bold text-center mb-2">파워 광고 3</h2>
            <h3 class="text-xl font-semibold text-center text-gray-700">식당</h3>
            <p class="text-lg text-gray-500 text-center">010-3333-4444</p>
            <a href="#"
              class="open-modal mt-4 bg-blue-500 text-white py-2 px-4 rounded text-center shadow-lg hover:bg-blue-600">바로가기</a>
          </div>
          <div
            class="ad-card relative bg-yellow-50 border-4 border-yellow-400 shadow-lg rounded-lg p-6 flex flex-col transform transition duration-300 hover:-translate-y-2 hover:shadow-2xl"
            data-title="파워 광고 4" data-phone="010-4444-5555" data-category="식당"
            data-img="https://via.placeholder.com/300x200/444444" data-events="특가 행사" data-facilities="없음"
            data-parking="유료 주차">
            <div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 text-xs rounded">파워광고</div>
            <img src="https://via.placeholder.com/300x200/444444" alt="파워 광고 4"
              class="h-40 w-full object-cover rounded mb-4" />
            <h2 class="text-2xl font-bold text-center mb-2">파워 광고 4</h2>
            <h3 class="text-xl font-semibold text-center text-gray-700">식당</h3>
            <p class="text-lg text-gray-500 text-center">010-4444-5555</p>
            <a href="#"
              class="open-modal mt-4 bg-blue-500 text-white py-2 px-4 rounded text-center shadow-lg hover:bg-blue-600">바로가기</a>
          </div>
        </div>
      </section>

      <!-- 광고 섹션 예시 (각 카테고리별) -->
      <!-- 밥 -->
      <section id="밥Section" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold">밥</h2>
          <div class="flex items-center space-x-6">
            <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
            <a href="subcategory.html?category=밥"
              class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
          </div>
        </div>
        <div id="밥Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
      </section>

      <!-- 찌게/탕/국 -->
      <section id="찌개/탕/국Section" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold">찌게/탕/국</h2>
          <div class="flex items-center space-x-6">
            <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
            <a href="subcategory.html?category=찌개/탕/국"
              class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
          </div>
        </div>
        <div id="찌개/탕/국Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
      </section>

      <!-- 고기/구이 -->
      <section id="고기/구이Section" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold">고기/구이(제육볶음)</h2>
          <div class="flex items-center space-x-6">
            <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
            <a href="subcategory.html?category=고기/구이"
              class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
          </div>
        </div>
        <div id="고기/구이Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
      </section>

      <!-- 해물로 바굴것 -->
      <section id="생선Section" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold">생선</h2>
          <div class="flex items-center space-x-6">
            <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
            <a href="subcategory.html?category=생선"
              class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
          </div>
        </div>
        <div id="생선Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
      </section>

      <!-- 족발/보쌈 -->
      <section id="족발/보쌈Section" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold">족발/보쌈</h2>
          <div class="flex items-center space-x-6">
            <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
            <a href="subcategory.html?category=족발/보쌈"
              class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
          </div>
        </div>
        <div id="족발/보쌈Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
      </section>

      <!-- 국밥 -->
      <section id="국밥Section" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold">국밥</h2>
          <div class="flex items-center space-x-6">
            <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
            <a href="subcategory.html?category=국밥"
              class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
          </div>
        </div>
        <div id="국밥Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
      </section>

      <!-- 반찬 -->
      <section id="반찬Section" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold">반찬</h2>
          <div class="flex items-center space-x-6">
            <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
            <a href="subcategory.html?category=반찬"
              class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
          </div>
        </div>
        <div id="반찬Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
      </section>

      <!-- 야식 -->
      <section id="야식ectSection" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold">야식</h2>
          <div class="flex items-center space-x-6">
            <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
            <a href="subcategory.html?category=야식"
              class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
          </div>
        </div>
        <div id="야식Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
      </section>

      <!-- 여러가지 -->
      <section id="여러가지etcSection" class="mt-8 border-2 border-gray-300 rounded-lg p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold">여러가지</h2>
          <div class="flex items-center space-x-6">
            <a href="#" class="home-link text-blue-500 hover:underline font-bold text-lg">🏠 홈</a>
            <a href="subcategory.html?category=야식"
              class="more-link text-blue-500 hover:underline font-bold text-lg">+더보기</a>
          </div>
        </div>
        <div id="여러가지Container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
      </section>
    </main>

    <div id="footer" class="mt-16"></div>



    <script>
      fetch("/components/header.html")
        .then(res => res.text())
        .then(html => { document.getElementById("header").innerHTML = html; });
      fetch("/components/footer.html")
        .then(res => res.text())
        .then(html => { document.getElementById("footer").innerHTML = html; });

      // 0) 스크롤용 맵 (섹션 ID → 소제목까지 스크롤)
      const scrollMap = {
        밥: "밥Section",
        "찌개/탕/국": "찌개/탕/국Section",
        "고기/구이": "고기/구이Section",
        생선: "생선Section",
        "족발/보쌈": "족발/보쌈Section",
        국밥: "국밥Section",
        반찬: "반찬Section",
        여러가지: "여러가지etcSection"
      };

      // 1) 렌더링용 맵 (그리드 컨테이너 ID → 카드만 교체)
      const renderMap = {
        밥: "밥Container",
        "찌개/탕/국": "찌개/탕/국Container",
        "고기/구이": "고기/구이Container",
        생선: "생선Container",
        "족발/보쌈": "족발/보쌈Container",
        국밥: "국밥Container",
        반찬: "반찬Container",
        여러가지: "여러가지Container"
      };

      // 2) 서버에서 데이터 가져오기
      async function fetchStores() {
        const params = new URLSearchParams(window.location.search);
        const category = params.get("category") || "";
        const subcategory = params.get("subcategory") || "";

        let url = `/category/${encodeURIComponent(category)}/stores`;
        if (subcategory) {
          url += `?subcategory=${encodeURIComponent(subcategory)}`;
        }
        console.log("▶ fetchStores URL:", url);

        const res = await fetch(url);
        if (!res.ok) throw new Error("데이터 조회 실패");
        return await res.json();
      }

      // 3) 카드 내부 HTML 생성
      function makeCardHTML(ad, isPower) {
        return `
      ${isPower ? '<div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 text-xs rounded">파워광고</div>' : ''}
      <img src="${ad.thumb || '/assets/images/no-thumb.png'}" alt="${ad.businessName}" class="h-40 w-full object-cover rounded mb-4" />
      <h2 class="text-2xl font-bold text-center mb-2">${ad.businessName}</h2>
      <p class="text-lg text-gray-500 text-center">${ad.phone || "전화번호 없음"}</p>
      <a href="/detail.html?id=${ad.id}"
        class="mt-4 bg-blue-500 text-white py-2 px-4 rounded text-center shadow-lg hover:bg-blue-600 block">
        상세보기
      </a>
    `;
      }

      // 4) 파워 광고 카드 생성
      function createPowerAdCard(ad) {
        const box = document.createElement("div");
        box.className =
          "ad-card relative bg-yellow-50 border-4 border-yellow-400 shadow-lg rounded-lg p-6 flex flex-col transform transition duration-300 hover:-translate-y-2 hover:shadow-2xl";
        box.innerHTML = makeCardHTML(ad, true);
        return box;
      }

      // 5) 일반 광고 카드 생성
      function createAdCard(ad) {
        const box = document.createElement("div");
        box.className =
          "ad-card bg-white shadow-lg rounded-lg p-6 flex flex-col border-2 border-gray-300 transform transition duration-300 hover:-translate-y-2 hover:shadow-2xl";
        box.innerHTML = makeCardHTML(ad, false);
        return box;
      }

      // 6) 섹션에 카드 붙이기
      function renderSection(items, makeCard, containerId, limit) {
        const container = document.getElementById(containerId);
        container.innerHTML = "";
        items.slice(0, limit).forEach(ad => container.appendChild(makeCard(ad)));
      }

      // 7) 페이지 초기화
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          const stores = await fetchStores();
          window.stores = stores;
          console.log("✅ stores:", stores);

          // 7-1) 소제목 유지하며 각 그리드 컨테이너에 카드 렌더링
          Object.entries(renderMap).forEach(([cat, gridId]) => {
            const items = stores.filter(ad => ad.subcategory === cat);   // ← subcategory 키로 비교
            console.log("↪", cat, "받은 개수:", items.length);
            renderSection(items, createAdCard, gridId, 8);
          });

          // 7-2) 파워 광고
          renderSection(
            stores.filter(ad => ad.powerAd),
            createPowerAdCard,
            "powerAdsContainer",
            4
          );

          // 7-3) 카테고리 버튼 스크롤 (소제목까지)
          document.querySelectorAll(".category-btn").forEach(btn => {
            btn.addEventListener("click", () => {
              const secId = scrollMap[btn.dataset.category];
              document.getElementById(secId)?.scrollIntoView({ behavior: "smooth" });
            });
          });

          // 7-4) 홈 버튼 스크롤
          document.querySelectorAll(".home-link").forEach(link => {
            link.addEventListener("click", e => {
              e.preventDefault();
              document.getElementById("categorySelection").scrollIntoView({ behavior: "smooth" });
            });
          });

        } catch (err) {
          console.error("광고 데이터 로드 실패:", err);
        }
      });
    </script>
</body>

</html>