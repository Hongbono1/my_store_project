<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>우리동네 한식관</title>
  <link rel="stylesheet" href="/assets/css/tailwind.css" />
  <style>
    html {
      scroll-behavior: smooth;
    }

    body {
      background: #f5f6f8;
    }

    .best-badge {
      background: #efb309;
      color: #fff;
      font-size: 0.75rem;
      font-weight: 700;
      border-radius: 9999px;
      padding: 2px 10px;
      margin-bottom: 8px;
      display: inline-block;
      letter-spacing: 1px;
    }

    .power-badge {
      background: #ea3b3b;
      color: #fff;
      font-size: 0.75rem;
      font-weight: 700;
      border-radius: 9999px;
      padding: 2px 10px;
      margin-bottom: 8px;
      display: inline-block;
      letter-spacing: 1px;
    }
  </style>
</head>

<body class="text-gray-900 bg-gradient-to-br from-blue-50 via-white to-blue-100 min-h-screen">
  <!-- 헤더 -->
  <jsp:include page="components/header.html" />

  <!-- 상단 배너 -->
  <section class="w-full bg-white shadow-sm">
    <div class="max-w-6xl mx-auto flex flex-col md:flex-row items-center py-8 px-6 gap-6">
      <div class="flex-1">
        <h1 class="text-4xl font-serif font-extrabold text-[#8b844b] mb-2 tracking-tight">한식관</h1>
        <p class="text-sm text-gray-500 mb-2">
          우리동네 최고의 한식 식당만 모았습니다.<br>
          매일 신선하게, 정성껏 대접합니다.<br>
          오늘 한 끼, 여기서 골라보세요!
        </p>
      </div>
      <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?fit=crop&w=500&q=80" alt="배너"
        class="w-full md:w-[340px] h-[140px] md:h-[180px] object-cover rounded-xl shadow" />
    </div>
  </section>

  <main class="max-w-6xl mx-auto mt-4 flex flex-col md:flex-row gap-6 px-2 sm:px-4">
    <!-- 좌측: 이달의 BEST -->
    <aside class="md:w-56 flex-shrink-0 flex flex-col gap-6">
      <!-- 이달의 BEST (카드형/JS로 동적 생성 추천) -->
      <div id="bestOfMonthCard"></div>
    </aside>

    <!-- 메인 컨텐츠 -->
    <section class="flex-1 flex flex-col gap-10">
      <!-- BEST 식당(파워광고) -->
      <div>
        <h3 class="text-xl font-bold mb-3">BEST 식당 (파워광고)</h3>
        <div id="powerAdsContainer" class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
      </div>
      <!-- 신규등록 식당 -->
      <div>
        <h3 class="text-xl font-bold mb-3">신규등록 식당</h3>
        <div id="newStoresContainer" class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
      </div>
      <!-- 전체 식사 광고 리스트 -->
      <div>
        <h3 class="text-xl font-bold mb-3">전체 식사 광고</h3>
        <div id="storeList" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-6"></div>
      </div>
    </section>
  </main>

  <!-- 푸터 -->
  <jsp:include page="components/footer.html" />

  <script>
    // 카드 HTML 생성
    function makeCardHTML(ad, isPower) {
      return `
    ${isPower ? '<div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 text-xs rounded">파워광고</div>' : ''}
    <img src="${ad.thumb || '/assets/images/no-thumb.png'}" alt="${ad.businessName}" class="h-40 w-full object-cover rounded mb-4" />
    <h2 class="text-2xl font-bold text-center mb-2">${ad.businessName}</h2>
    <p class="text-lg text-gray-500 text-center">${ad.phone || "전화번호 없음"}</p>
    <a href="/detail.html?id=${ad.id}"
      class="mt-4 bg-blue-500 text-white py-2 px-4 rounded text-center shadow-lg hover:bg-blue-600 block">
      상세보기
    </a>
  `;
    }

    // 이달의 BEST
    function renderBestOfMonth(ad) {
      document.getElementById("bestOfMonthCard").innerHTML = `
    <div class="bg-white shadow rounded-xl p-5 flex flex-col items-center cursor-pointer hover:shadow-lg transition"
         onclick="location.href='/detail.html?id=${ad.id}'">
      <div class="best-badge mb-2">이달의 BEST</div>
      <img src="${ad.thumb || '/assets/images/no-thumb.png'}" alt="${ad.businessName}" class="w-full h-32 object-cover rounded mb-4" />
      <h2 class="text-lg font-bold text-center">${ad.businessName}</h2>
    </div>
  `;
    }

    function createPowerAdCard(ad) {
      const box = document.createElement("div");
      box.className =
        "ad-card relative bg-yellow-50 border-4 border-yellow-400 shadow-lg rounded-lg p-6 flex flex-col transform transition duration-300 hover:-translate-y-2 hover:shadow-2xl";
      box.innerHTML = makeCardHTML(ad, true);
      return box;
    }

    function createAdCard(ad) {
      const box = document.createElement("div");
      box.className =
        "ad-card bg-white shadow-lg rounded-lg p-6 flex flex-col border-2 border-gray-300 transform transition duration-300 hover:-translate-y-2 hover:shadow-2xl";
      box.innerHTML = makeCardHTML(ad, false);
      return box;
    }

    function renderSection(items, makeCard, containerId, limit) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      items.slice(0, limit).forEach(ad => container.appendChild(makeCard(ad)));
    }

    async function fetchStores() {
      // category=식사 또는 한식 등 한 곳에만 적용!
      let url = `/category/식사/stores`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("데이터 조회 실패");
      return await res.json();
    }

    // --- 페이지 초기화 ---
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        const stores = await fetchStores();
        // 이달의 BEST (bestOfMonth: true)
        const bestOfMonth = stores.find(ad => ad.bestOfMonth);
        if (bestOfMonth) renderBestOfMonth(bestOfMonth);

        // 파워광고(최대 4개)
        renderSection(
          stores.filter(ad => ad.powerAd),
          createPowerAdCard,
          "powerAdsContainer",
          4
        );

        // 신규등록(최신순, powerAd 제외, 4개)
        renderSection(
          stores.filter(ad => !ad.powerAd).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)),
          createAdCard,
          "newStoresContainer",
          4
        );

        // 전체 식사 광고(카테고리 전부, 최대 100개)
        renderSection(stores, createAdCard, "storeList", 100);

      } catch (err) {
        console.error("광고 데이터 로드 실패:", err);
      }
    });

  </script>
</body>

</html>