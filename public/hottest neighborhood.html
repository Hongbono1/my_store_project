<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>가장 핫한 우리동네(모달 연결)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50">
  <!-- Header (JSP 인클루드) -->
  <jsp:include page="components/header.html" />

  <!-- 모달 HTML (정적 인클루드) -->
  <jsp:include page="modal/modal.html" />

  <!-- 전체 컨테이너 -->
  <div class="max-w-screen-xl mx-auto px-4 sm:px-8 mt-10">
    <!-- 가장 핫한 우리동네 섹션 -->
    <section class="bg-white shadow-lg rounded-lg p-6 border-2 border-gray-300 mb-12">
      <h2 class="text-3xl font-bold mb-6 text-center text-gray-800">가장 핫한 우리동네</h2>
      <div id="hotNeighborhoodBoxes" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>

    <!-- 슬라이드 영역 -->
    <section
      class="relative w-full max-w-screen-lg mx-auto overflow-hidden border border-gray-300 rounded-lg mt-8 px-4 mb-9">
      <div id="sliderContainer" class="flex transition-transform duration-500 h-48 items-center"></div>
      <button id="prevBtn"
        class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-gray-700 text-white p-3 rounded-full hover:bg-gray-900 transition z-[9999]">
        &lt;
      </button>
      <button id="nextBtn"
        class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-gray-700 text-white p-3 rounded-full hover:bg-gray-900 transition z-[9999]">
        &gt;
      </button>
    </section>

    <!-- 추천 가게 섹션 -->
    <section class="bg-white shadow-lg rounded-lg p-6 border-2 border-gray-300">
      <h2 class="text-3xl font-bold mb-6 text-center text-gray-800">추천 가게</h2>
      <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 items-stretch">
        <!-- 좌측 이미지 박스: 만화 이미지 -->
        <div class="lg:col-span-1 flex flex-col gap-6 h-full">
          <div class="flex-1 overflow-hidden border-2 border-gray-300 rounded-lg shadow-lg">
            <img src="https://via.placeholder.com/300x400?text=만화1" alt="만화 이미지 상단"
              class="w-full h-full object-cover" />
          </div>
          <div class="flex-1 overflow-hidden border-2 border-gray-300 rounded-lg shadow-lg">
            <img src="https://via.placeholder.com/300x400?text=만화2" alt="만화 이미지 하단"
              class="w-full h-full object-cover" />
          </div>
        </div>
        <!-- 오른쪽 광고 리스트 -->
        <div id="recommendedStoreContainer" class="lg:col-span-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        </div>
      </div>
    </section>
  </div>

  <!-- Footer (JSP 인클루드) -->
  <jsp:include page="components/footer.html" />

  <!-- 모달 JS (정적 포함) -->
  <script src="modal/modal.js"></script>


  <script>
  // 1) 카드 생성 함수 (전역에 한 번만 선언)
      function createAdCard(ad) {
    const adBox = document.createElement("div");
      adBox.className =
      "ad-card bg-white shadow-lg rounded-lg p-6 flex flex-col border-2 border-gray-300 transform transition duration-300 hover:-translate-y-2 hover:shadow-2xl";
      // data-* 속성은 모달용(필요 없다면 제거)
      adBox.dataset.title = ad.businessName;
      adBox.dataset.phone = ad.phone;
      adBox.dataset.img   = ad.thumb;

      adBox.innerHTML = `
      <img src="${ad.thumb}" alt="${ad.businessName}"
        class="h-40 w-full object-cover rounded mb-4 cursor-pointer" />
      <h3 class="font-semibold text-lg mb-1 cursor-pointer">
        ${ad.businessName}
      </h3>
      <button class="go-detail mt-auto bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">
        바로가기
      </button>
      `;

    // 이미지·제목 클릭 → 상세페이지
    [adBox.querySelector("img"), adBox.querySelector("h3")].forEach(el =>
      el.addEventListener("click", () => {
        window.location.href = `/detail.html?id=${ad.id}`;
      })
      );
      // 버튼 클릭 → 상세페이지
      adBox.querySelector(".go-detail")
      .addEventListener("click", () => {
        window.location.href = `/detail.html?id=${ad.id}`;
      });

      return adBox;
  }

      // 2) API 호출 함수
      async function loadHotNeighborhood() {
    const res = await fetch("/hot/api");
      if (!res.ok) throw new Error("핫 데이터 로드 실패");
      return await res.json();  // [{id, businessName, phone, thumb}, …]
  }

  // 3) 페이지 로드 후 한 번만 실행
  document.addEventListener("DOMContentLoaded", async () => {
    // (a) 레이아웃 그대로 유지
    const container = document.getElementById("hotNeighborhoodBoxes");
      container.innerHTML = "";

      // (b) 동적 데이터 받아서 카드 뿌리기
      const ads = await loadHotNeighborhood();
    ads.forEach(ad => {
        container.appendChild(createAdCard(ad));
    });

    // (c) 슬라이더, 추천가게, 모달 연결 등
    //    … 기존에 쓰시던 renderAds(), slider init, modal binding 코드 …
  });

  </script>
</body>

</html>