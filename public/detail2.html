<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <title>상세 페이지</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 다음 우편번호 API -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js" defer></script>
    <!-- Kakao 지도 SDK -->
    <script
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&autoload=false&libraries=services"></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
    <div id="header-placeholder"></div>

    <main class="w-full max-w-[1440px] mx-auto px-4 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- 왼쪽: 이미지/지도/메뉴 -->
            <section class="flex-1 min-w-[400px] bg-white p-6 rounded-lg shadow">
                <div class="relative">
                    <img id="sliderImage" alt="가게 이미지" class="w-full h-64 object-cover rounded mb-2" />
                    <button id="prevBtn"
                        class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 text-white rounded px-3 py-1">이전</button>
                    <button id="nextBtn"
                        class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 text-white rounded px-3 py-1">다음</button>
                </div>

                <div class="mt-6 bg-gray-200 border border-gray-400 rounded-lg p-4">
                    <h2 class="text-lg font-semibold mb-2">가게 위치</h2>
                    <p id="addressText" class="text-sm text-gray-700 mb-2">주소 없음</p>
                    <div id="map" class="w-full h-40 bg-gray-300 flex items-center justify-center text-gray-700">지도 로드
                        중...</div>
                    <button onclick="openKakaoMap()"
                        class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">카카오맵으로
                        보기</button>
                </div>

                <div id="menuBox"
                    class="mt-6 bg-gray-50 border border-gray-300 rounded p-4 overflow-hidden transition-all duration-300 max-h-[13rem] hover:max-h-[2000px]">
                    <h2 class="text-lg font-bold mb-4">메뉴</h2>
                    <ul id="menuList" class="space-y-2"></ul>
                </div>
            </section>

            <!-- 오른쪽: 가게 정보 -->
            <section class="flex-1 min-w-[400px] bg-white p-6 rounded-lg shadow">
                <h2 id="businessNameHeader" class="text-3xl font-bold text-gray-800 border-b pb-3">상호명</h2>
                <p id="businessType" class="text-lg"><strong>업종:</strong></p>
                <p id="deliveryOption" class="text-lg"><strong>배달:</strong></p>
                <p id="businessHours" class="text-lg"><strong>영업시간:</strong></p>

                <div class="bg-gray-50 p-4 rounded border mt-4">
                    <h3 class="text-xl font-bold mb-2">서비스 내용</h3>
                    <p id="serviceDetails" class="text-gray-700"></p>
                </div>

                <div class="bg-gray-50 p-4 rounded border mt-4">
                    <h3 class="text-xl font-bold mb-2">이벤트</h3>
                    <ul id="eventsList" class="list-disc pl-6 space-y-1"></ul>
                </div>

                <div class="bg-gray-50 p-4 rounded border mt-4">
                    <h3 class="text-xl font-bold mb-2">추가 정보</h3>
                    <ul id="additionalInfoList" class="list-disc pl-6 space-y-1"></ul>
                </div>

                <div class="bg-gray-50 p-4 rounded border mt-4">
                    <h3 class="text-xl font-bold mb-2">연락처</h3>
                    <p id="contactPhone"></p>
                    <p id="contactHomepage"></p>
                </div>

                <div class="bg-gray-50 p-4 rounded border mt-4">
                    <h3 class="text-xl font-bold mb-2">추가 설명</h3>
                    <p id="additionalDesc" class="text-gray-700"></p>
                </div>

                <div id="cartBox" class="bg-gray-50 p-4 rounded border mt-4 hidden">
                    <h3 class="text-xl font-bold mb-2">🛒 장바구니</h3>
                    <ul id="cartList" class="space-y-2"></ul>
                    <div class="border-t mt-3 pt-3 text-right">
                        <p class="font-semibold">총합: <span id="totalPrice">0</span>원</p>
                        <button id="checkoutBtn"
                            class="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">결제하기</button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <script>

        window.addEventListener("DOMContentLoaded", () => {
            // 🔗 헤더/푸터 동적 삽입
            fetch("https://www.hongbono1.com/components/header.html")
                .then(res => res.text())
                .then(data => {
                    document.getElementById("header-placeholder").innerHTML = data;
                });

            fetch("https://www.hongbono1.com/components/footer.html")
                .then(res => res.text())
                .then(data => {
                    document.getElementById("footer-placeholder").innerHTML = data;
                });

            const baseUrl = "https://www.hongbono1.com";
            const id = new URLSearchParams(location.search).get("id") || 1;

            fetch(`${baseUrl}/store/${id}`)
                .then(res => res.json())
                .then(data => {
                    const store = data.store || data.storeInfo || {};
                    const menuData = data.menu || data.storeMenu || [];

                    // ✅ 이미지 슬라이더
                    const imageList = [store.image1, store.image2, store.image3].filter(Boolean);
                    console.log("▶ 받아온 이미지 배열:", imageList);

                    // images 배열 생성 + fallback 처리
                    const images = imageList.length
                        ? imageList.map(path => path.startsWith("http") ? path : `${baseUrl}${path}`)
                        : ["https://via.placeholder.com/600x400?text=No+Image"];
                    let idx = 0;

                    const sliderImage = document.getElementById("sliderImage");
                    const prevBtn = document.getElementById("prevBtn");
                    const nextBtn = document.getElementById("nextBtn");

                    // 초기 이미지 설정
                    sliderImage.src = images[idx];

                    prevBtn.addEventListener("click", () => {
                        idx = (idx - 1 + images.length) % images.length;
                        sliderImage.src = images[idx];
                    });
                    nextBtn.addEventListener("click", () => {
                        idx = (idx + 1) % images.length;
                        sliderImage.src = images[idx];
                    });

                    // ✅ 지도
                    document.getElementById("addressText").textContent = store.address || "";
                    kakao.maps.load(() => {
                        if (store.address && kakao.maps) {
                            const map = new kakao.maps.Map(document.getElementById("map"), {
                                center: new kakao.maps.LatLng(37.5665, 126.978),
                                level: 3
                            });

                            const geocoder = new kakao.maps.services.Geocoder();
                            geocoder.addressSearch(store.address, (result, status) => {
                                if (status === kakao.maps.services.Status.OK) {
                                    const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                                    new kakao.maps.Marker({ map, position: coords });
                                    map.setCenter(coords);
                                }
                            });
                        }

                        window.openKakaoMap = () => {
                            const addr = document.getElementById("addressText").textContent;
                            window.open(`https://map.kakao.com/?q=${encodeURIComponent(addr)}`, "_blank");
                        };
                    });

                    // 이하 가게 정보, 메뉴, 장바구니 로직은 그대로...
                })
                .catch(err => {
                    console.error("데이터 로딩 실패", err);
                });
        });


    </script>
</body>
</html>