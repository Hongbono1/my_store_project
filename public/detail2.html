<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ìƒì„¸ í˜ì´ì§€</title>
    <!-- Tailwind CSS (dev CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ API (í–¥í›„ ì£¼ì†Œ ê²€ìƒ‰ìš©) -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js" defer></script>
    <!-- Kakao ì§€ë„ SDK -->
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&libraries=services" defer></script>
  </head>
  <body class="bg-gray-100 min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-white shadow-md py-4">
      <div class="container mx-auto px-4 flex justify-between items-center">
        <h1 class="text-2xl font-bold text-gray-800">My Website</h1>
        <nav class="space-x-4">
          <a href="/" class="text-gray-600 hover:text-blue-500">Home</a>
          <a href="/list.html" class="text-gray-600 hover:text-blue-500">List</a>
          <a href="/contact.html" class="text-gray-600 hover:text-blue-500">Contact</a>
        </nav>
      </div>
    </header>

    <!-- Main -->
    <main class="container mx-auto px-4 py-8 flex-1">
      <!--
        ğŸ“± ë°˜ì‘í˜•: ì‘ì€ í™”ë©´ì—ì„œëŠ” ë‘ ì„¹ì…˜ì´ â€˜í•˜ë‚˜ì˜ ì¹´ë“œâ€™ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ í•©ì³ì§€ë„ë¡
        1) gap-0 ë¡œ ì—¬ë°± ì œê±°
        2) ì²« ì„¹ì…˜ì€ rounded-tâ€‘lg, ë‘ ë²ˆì§¸ëŠ” rounded-bâ€‘lg (large ì´ìƒì—ì„œëŠ” ì›ë˜ rounded)
      -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-0 lg:gap-8 auto-rows-max items-start"></div>
        <!-- Left -->
        <section class="bg-white p-6 rounded-t-lg lg:rounded lg:rounded-r-none shadow flex flex-col gap-6">
          <!-- Slider -->
          <div class="relative">
            <img id="sliderImage" alt="ê°€ê²Œ ì´ë¯¸ì§€" class="w-full h-64 object-cover rounded shadow mb-2" />
            <button id="prevBtn" class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 text-white rounded px-3 py-1">ì´ì „</button>
            <button id="nextBtn" class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 text-white rounded px-3 py-1">ë‹¤ìŒ</button>
          </div>

          <!-- Map -->
          <div class="bg-gray-200 border border-gray-400 rounded-lg p-4">
            <h2 class="text-lg font-semibold mb-2">ê°€ê²Œ ìœ„ì¹˜</h2>
            <p id="addressText" class="text-sm text-gray-700 mb-2">ì£¼ì†Œ ì—†ìŒ</p>
            <div id="map" class="w-full h-40 bg-gray-300 flex items-center justify-center text-gray-700">ì§€ë„ ë¡œë“œ ì¤‘...</div>
            <button onclick="openKakaoMap()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ë³´ê¸°</button>
          </div>

          <!-- Menu -->
          <div id="menuBox" class="bg-gray-50 border border-gray-300 rounded p-4 overflow-hidden transition-all duration-300 max-h-[13rem] hover:max-h-[2000px]">
            <h2 class="text-lg font-bold mb-4">ë©”ë‰´</h2>
            <ul id="menuList" class="space-y-2"></ul>
          </div>
        </section>

        <!-- Right -->
        <section class="bg-white p-6 rounded-b-lg lg:rounded lg:rounded-l-none shadow flex flex-col gap-4">
          <h2 id="businessNameHeader" class="text-3xl font-bold text-gray-800 border-b pb-3">ìƒí˜¸ëª…</h2>
          <div>
            <p id="businessType" class="text-lg"><strong>ì—…ì¢…:</strong></p>
            <p id="deliveryOption" class="text-lg"><strong>ë°°ë‹¬:</strong></p>
            <p id="businessHours" class="text-lg"><strong>ì˜ì—…ì‹œê°„:</strong></p>
          </div>

          <div class="bg-gray-50 p-4 rounded border">
            <h3 class="text-xl font-bold mb-2">ì„œë¹„ìŠ¤ ë‚´ìš©</h3>
            <p id="serviceDetails" class="text-gray-700"></p>
          </div>

          <div class="bg-gray-50 p-4 rounded border">
            <h3 class="text-xl font-bold mb-2">ì´ë²¤íŠ¸</h3>
            <ul id="eventsList" class="list-disc pl-6 space-y-1"></ul>
          </div>

          <div class="bg-gray-50 p-4 rounded border">
            <h3 class="text-xl font-bold mb-2">ì¶”ê°€ ì •ë³´</h3>
            <ul id="additionalInfoList" class="list-disc pl-6 space-y-1"></ul>
          </div>

          <!-- Contact -->
          <div class="bg-gray-50 p-4 rounded border">
            <h3 class="text-xl font-bold mb-2">ì—°ë½ì²˜</h3>
            <p id="contactPhone"></p>
            <p id="contactHomepage"></p>
          </div>

          <!-- Additional Description -->
          <div class="bg-gray-50 p-4 rounded border">
            <h3 class="text-xl font-bold mb-2">ì¶”ê°€ ì„¤ëª…</h3>
            <p id="additionalDesc" class="text-gray-700"></p>
          </div>

          <!-- Cart -->
          <div id="cartBox" class="bg-gray-50 p-4 rounded border hidden">
            <h3 class="text-xl font-bold mb-2">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</h3>
            <ul id="cartList" class="space-y-2"></ul>
            <div class="border-t mt-3 pt-3 text-right">
              <p class="font-semibold">ì´í•©: <span id="totalPrice">0</span>ì›</p>
              <button id="checkoutBtn" class="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">ê²°ì œí•˜ê¸°</button>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-200 py-4">
      <div class="container mx-auto px-4 text-center text-gray-600">Â© 2025 MyWebsite. All rights reserved.</div>
    </footer>

    <!-- Script (ê¸°ì¡´ JS ê·¸ëŒ€ë¡œ) -->
    <script>
      /* -------------------------------------------------- Slider -------------------------------------------------- */
      let images = [];
      let currentIndex = 0;
      const sliderImage = document.getElementById('sliderImage');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      prevBtn.addEventListener('click', () => {
        if (!images.length) return;
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        sliderImage.src = images[currentIndex];
      });
      nextBtn.addEventListener('click', () => {
        if (!images.length) return;
        currentIndex = (currentIndex + 1) % images.length;
        sliderImage.src = images[currentIndex];
      });

      /* -------------------------------------------------- Kakao Map -------------------------------------------------- */
      function createMap(addr) {
        if (!window.kakao || !kakao.maps) return;
        const container = document.getElementById('map');
        const map = new kakao.maps.Map(container, { center: new kakao.maps.LatLng(37.5665, 126.978), level: 3 });
        const geocoder = new kakao.maps.services.Geocoder();
        geocoder.addressSearch(addr, (result, status) => {
          if (status === kakao.maps.services.Status.OK) {
            const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
            new kakao.maps.Marker({ map, position: coords });
            map.setCenter(coords);
          } else {
            container.textContent = 'ì§€ë„ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
          }
        });
      }
      function openKakaoMap() {
        const addr = document.getElementById('addressText').textContent;
        window.open(`https://map.kakao.com/?q=${encodeURIComponent(addr)}`, '_blank');
      }

      /* -------------------------------------------------- Cart helpers -------------------------------------------------- */
      let cart = [];
      function updateCart() {
        const cartBox = document.getElementById('cartBox');
        const cartList = document.getElementById('cartList');
        const totalPriceEl = document.getElementById('totalPrice');

        cartList.innerHTML = '';
        let total = 0;
        cart.forEach((item, idx) => {
          total += item.price * item.quantity;
          const row = document.createElement('div');
          row.className = 'flex items-center justify-between border-b pb-2';
          row.innerHTML = `
            <div>
              <span class='font-semibold'>${item.name}</span>
              <span class='ml-2 text-gray-600'>${item.price.toLocaleString()}ì›</span>
            </div>
            <div class='flex items-center'>
              <button class='decrease border px-2'>-</button>
              <span class='mx-2'>${item.quantity}</span>
              <button class='increase border px-2'>+</button>
              <button class='delete border px-2 ml-2 text-red-500'>ì‚­ì œ</button>
            </div>`;
          row.querySelector('.increase').onclick = () => { item.quantity++; updateCart(); };
          row.querySelector('.decrease').onclick = () => { item.quantity--; if (item.quantity <= 0) cart.splice(idx, 1); updateCart(); };
          row.querySelector('.delete').onclick = () => { cart.splice(idx, 1); updateCart(); };
          cartList.appendChild(row);
        });
        totalPriceEl.textContent = total.toLocaleString();
        cartBox.classList.toggle('hidden', cart.length === 0);
      }

      document.getElementById('checkoutBtn').addEventListener('click', () => {
        if (cart.length === 0) return alert('ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.');
        alert(`ì´ ${document.getElementById('totalPrice').textContent}ì› ê²°ì œ ì§„í–‰`);
      });

      /* -------------------------------------------------- Fetch data -------------------------------------------------- */
      window.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id') || 1;
        const baseUrl = location.origin;

        fetch(`${baseUrl}/store/${id}`)
          .then((res) => res.json())
          .then((data) => {
            const store = data.storeInfo || data.info || data.hospital || {};
            console.log("âœ… store.images:", store.images);  
            const menuData = data.storeMenu || data.menu || [];

            document.getElementById('businessNameHeader').textContent = store.businessName;
            document.getElementById('businessType').innerHTML = `<strong>ì—…ì¢…:</strong> ${store.businessType}`;
            document.getElementById('deliveryOption').innerHTML = `<strong>ë°°ë‹¬:</strong> ${store.deliveryOption}`;
            document.getElementById('businessHours').innerHTML = `<strong>ì˜ì—…ì‹œê°„:</strong> ${store.businessHours}`;
            document.getElementById('serviceDetails').textContent = store.serviceDetails;
            document.getElementById('eventsList').innerHTML = `
              ${store.event1 ? `<li>${store.event1}</li>` : '' }
              ${store.event2 ? `<li>${store.event2}</li>` : '' }`;
            document.getElementById('additionalInfoList').innerHTML = `
              <li><strong>ì¥ì• ì¸ í¸ì˜ì‹œì„¤:</strong> ${store.facility}</li>
              <li><strong>ë°˜ë ¤ë™ë¬¼ ì¶œì…:</strong> ${store.pets}</li>
              <li><strong>ì£¼ì°¨:</strong> ${store.parking}</li>`;
            document.getElementById('contactPhone').innerHTML = `<strong>ì „í™”ë²ˆí˜¸:</strong> ${store.contactPhone}`;
            document.getElementById('contactHomepage').innerHTML = store.homepage ? `<strong>í™ˆí˜ì´ì§€:</strong> <a href='${store.homepage}' target='_blank' class='text-blue-600 underline'>${store.homepage}</a>` : '';
            document.getElementById('additionalDesc').textContent = store.additionalDesc || '';
            document.getElementById('addressText').textContent = store.address || '';

            if (Array.isArray(store.images) && store.images.length) {
              images = store.images.map((img) => img.startsWith('http') ? img : `${baseUrl}${img}` );
              currentIndex = 0;
              sliderImage.src = images[currentIndex];
            } else {
              sliderImage.src = 'https://via.placeholder.com/600x400?text=IMAGE';
            }

            const menuList = document.getElementById('menuList');
            menuList.innerHTML = '';
            if (Array.isArray(menuData) && menuData.length) {
              const categories = {};
              menuData.forEach((m) => {
                const cat = m.category || 'ê¸°íƒ€';
                if (!categories[cat]) categories[cat] = [];
                categories[cat].push(m);
              });

              Object.entries(categories).forEach(([catName, items]) => {
                const catHeader = document.createElement('li');
                catHeader.className = 'font-bold text-blue-700 pt-2';
                catHeader.textContent = catName;
                menuList.appendChild(catHeader);

                items.forEach((item) => {
                  const li = document.createElement('li');
                  li.className = 'relative group flex items-center gap-3 border-b pb-2 cursor-pointer menu-item';
                  li.dataset.name = item.menu_name || item.menuName;
                  li.dataset.price = item.menu_price || item.menuPrice;
                  li.innerHTML = `
                    <img src='${item.menu_image || item.menuImage || 'https://via.placeholder.com/80?text=NOIMAGE'}' alt='${item.menu_name}' class='w-16 h-16 object-cover rounded border'>
                    <span class='font-semibold text-gray-800'>${item.menu_name || item.menuName}</span>
                    <span class='ml-auto text-gray-600'>${Number(item.menu_price || item.menuPrice).toLocaleString()}ì›</span>
                    <div class='absolute left-0 top-full mt-1 w-max opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-white border p-2 shadow-lg z-50'>
                      <p class='text-sm text-gray-800'>${item.menu_desc || item.menuDesc || ''}</p>
                    </div>`;
                  menuList.appendChild(li);
                });
              });

              document.querySelectorAll('.menu-item').forEach((item) => {
                item.addEventListener('click', () => {
                  const name = item.dataset.name;
                  const price = parseInt(item.dataset.price, 10);
                  const found = cart.find((c) => c.name == name);
                  if (found) found.quantity++;
                  else cart.push({ name, price, quantity: 1 });
                  updateCart();
                });
              });
            } else {
              menuList.innerHTML = '<li>ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
            }

            if (store.address) createMap(store.address);
          })
          .catch((err) => {
            console.error('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨', err);
            alert('ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          });
      });
    </script>
  </body>
</html>