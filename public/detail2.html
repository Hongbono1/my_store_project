<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ìƒì„¸ í˜ì´ì§€</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ API -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js" defer></script>
  <!-- Kakao ì§€ë„ SDK -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&libraries=services" defer></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
  <div id="header-placeholder"></div>

  <main class="w-full max-w-[1440px] mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- ì™¼ìª½: ì´ë¯¸ì§€/ì§€ë„/ë©”ë‰´ -->
      <section class="flex-1 min-w-[400px] bg-white p-6 rounded-lg shadow">
        <div class="relative">
          <img id="sliderImage" alt="ê°€ê²Œ ì´ë¯¸ì§€" class="w-full h-64 object-cover rounded mb-2" />
          <button id="prevBtn" class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 text-white rounded px-3 py-1">ì´ì „</button>
          <button id="nextBtn" class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 text-white rounded px-3 py-1">ë‹¤ìŒ</button>
        </div>

        <div class="mt-6 bg-gray-200 border border-gray-400 rounded-lg p-4">
          <h2 class="text-lg font-semibold mb-2">ê°€ê²Œ ìœ„ì¹˜</h2>
          <p id="addressText" class="text-sm text-gray-700 mb-2">ì£¼ì†Œ ì—†ìŒ</p>
          <div id="map" class="w-full h-40 bg-gray-300 flex items-center justify-center text-gray-700">ì§€ë„ ë¡œë“œ ì¤‘...</div>
          <button onclick="openKakaoMap()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ë³´ê¸°</button>
        </div>

        <div id="menuBox" class="mt-6 bg-gray-50 border border-gray-300 rounded p-4 overflow-hidden transition-all duration-300 max-h-[13rem] hover:max-h-[2000px]">
          <h2 class="text-lg font-bold mb-4">ë©”ë‰´</h2>
          <ul id="menuList" class="space-y-2"></ul>
        </div>
      </section>

      <!-- ì˜¤ë¥¸ìª½: ê°€ê²Œ ì •ë³´ -->
      <section class="flex-1 min-w-[400px] bg-white p-6 rounded-lg shadow">
        <h2 id="businessNameHeader" class="text-3xl font-bold text-gray-800 border-b pb-3">ìƒí˜¸ëª…</h2>
        <p id="businessType" class="text-lg"><strong>ì—…ì¢…:</strong></p>
        <p id="deliveryOption" class="text-lg"><strong>ë°°ë‹¬:</strong></p>
        <p id="businessHours" class="text-lg"><strong>ì˜ì—…ì‹œê°„:</strong></p>

        <div class="bg-gray-50 p-4 rounded border mt-4">
          <h3 class="text-xl font-bold mb-2">ì„œë¹„ìŠ¤ ë‚´ìš©</h3>
          <p id="serviceDetails" class="text-gray-700"></p>
        </div>

        <div class="bg-gray-50 p-4 rounded border mt-4">
          <h3 class="text-xl font-bold mb-2">ì´ë²¤íŠ¸</h3>
          <ul id="eventsList" class="list-disc pl-6 space-y-1"></ul>
        </div>

        <div class="bg-gray-50 p-4 rounded border mt-4">
          <h3 class="text-xl font-bold mb-2">ì¶”ê°€ ì •ë³´</h3>
          <ul id="additionalInfoList" class="list-disc pl-6 space-y-1"></ul>
        </div>

        <div class="bg-gray-50 p-4 rounded border mt-4">
          <h3 class="text-xl font-bold mb-2">ì—°ë½ì²˜</h3>
          <p id="contactPhone"></p>
          <p id="contactHomepage"></p>
        </div>

        <div class="bg-gray-50 p-4 rounded border mt-4">
          <h3 class="text-xl font-bold mb-2">ì¶”ê°€ ì„¤ëª…</h3>
          <p id="additionalDesc" class="text-gray-700"></p>
        </div>

        <div id="cartBox" class="bg-gray-50 p-4 rounded border mt-4 hidden">
          <h3 class="text-xl font-bold mb-2">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</h3>
          <ul id="cartList" class="space-y-2"></ul>
          <div class="border-t mt-3 pt-3 text-right">
            <p class="font-semibold">ì´í•©: <span id="totalPrice">0</span>ì›</p>
            <button id="checkoutBtn" class="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">ê²°ì œí•˜ê¸°</button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <div id="footer-placeholder"></div>

  <!-- Script -->
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      fetch("https://www.hongbono1.com/components/header.html")
        .then(res => res.text())
        .then(data => {
          document.getElementById("header-placeholder").innerHTML = data;
        });

      fetch("https://www.hongbono1.com/components/footer.html")
        .then(res => res.text())
        .then(data => {
          document.getElementById("footer-placeholder").innerHTML = data;
        });

      const baseUrl = "https://www.hongbono1.com";
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get("id") || 1;

      fetch(`${baseUrl}/store/${id}`)
        .then(res => res.json())
        .then(data => {
          const store = data.storeInfo || {};
          const menuData = data.storeMenu || [];

          // ì´ë¯¸ì§€ ì²˜ë¦¬
          const imageList = [store.image1, store.image2, store.image3].filter(Boolean);
          console.log("âœ… ë°›ì•„ì˜¨ ì´ë¯¸ì§€ ë°°ì—´:", imageList);

          let images = [];
          let currentIndex = 0;

          const sliderImage = document.getElementById("sliderImage");
          const prevBtn = document.getElementById("prevBtn");
          const nextBtn = document.getElementById("nextBtn");

          if (imageList.length) {
            images = imageList.map(img => img.startsWith("http") ? img : `${baseUrl}${img}`);
            sliderImage.src = images[currentIndex];

            prevBtn.addEventListener("click", () => {
              currentIndex = (currentIndex - 1 + images.length) % images.length;
              sliderImage.src = images[currentIndex];
            });

            nextBtn.addEventListener("click", () => {
              currentIndex = (currentIndex + 1) % images.length;
              sliderImage.src = images[currentIndex];
            });
          }

          // ì§€ë„
          document.getElementById("addressText").textContent = store.address || "";
          if (store.address && window.kakao && kakao.maps) {
            const map = new kakao.maps.Map(document.getElementById("map"), {
              center: new kakao.maps.LatLng(37.5665, 126.978),
              level: 3
            });
            const geocoder = new kakao.maps.services.Geocoder();
            geocoder.addressSearch(store.address, (result, status) => {
              if (status === kakao.maps.services.Status.OK) {
                const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                new kakao.maps.Marker({ map, position: coords });
                map.setCenter(coords);
              }
            });
          }

          window.openKakaoMap = () => {
            const addr = document.getElementById("addressText").textContent;
            window.open(`https://map.kakao.com/?q=${encodeURIComponent(addr)}`, "_blank");
          };

          // ê°€ê²Œ ì •ë³´
          document.getElementById("businessNameHeader").textContent = store.businessName || "";
          document.getElementById("businessType").innerHTML = `<strong>ì—…ì¢…:</strong> ${store.businessType || ""}`;
          document.getElementById("deliveryOption").innerHTML = `<strong>ë°°ë‹¬:</strong> ${store.deliveryOption || ""}`;
          document.getElementById("businessHours").innerHTML = `<strong>ì˜ì—…ì‹œê°„:</strong> ${store.businessHours || ""}`;
          document.getElementById("serviceDetails").textContent = store.serviceDetails || "";
          document.getElementById("contactPhone").textContent = store.contactPhone || "";
          document.getElementById("contactHomepage").innerHTML = store.homepage ? `<a href="${store.homepage}" target="_blank" class="text-blue-600 underline">${store.homepage}</a>` : "";
          document.getElementById("additionalDesc").textContent = store.additionalDesc || "";

          document.getElementById("eventsList").innerHTML = `
            ${store.event1 ? `<li>${store.event1}</li>` : ""}
            ${store.event2 ? `<li>${store.event2}</li>` : ""}
          `;
          document.getElementById("additionalInfoList").innerHTML = `
            <li><strong>ì¥ì• ì¸ í¸ì˜ì‹œì„¤:</strong> ${store.facility || ""}</li>
            <li><strong>ë°˜ë ¤ë™ë¬¼ ì¶œì…:</strong> ${store.pets || ""}</li>
            <li><strong>ì£¼ì°¨:</strong> ${store.parking || ""}</li>
          `;

          // ë©”ë‰´
          const menuList = document.getElementById("menuList");
          let cart = [];

          if (menuData.length) {
            const categories = {};
            menuData.forEach(item => {
              const cat = item.category || "ê¸°íƒ€";
              if (!categories[cat]) categories[cat] = [];
              categories[cat].push(item);
            });

            Object.entries(categories).forEach(([cat, items]) => {
              const header = document.createElement("li");
              header.textContent = cat;
              header.className = "font-bold text-blue-700 pt-2";
              menuList.appendChild(header);

              items.forEach(menu => {
                const li = document.createElement("li");
                li.className = "flex items-center gap-3 border-b pb-2 cursor-pointer";
                li.innerHTML = `
                  <img src="${menu.menu_image || 'https://via.placeholder.com/80'}" class="w-16 h-16 object-cover rounded border" />
                  <span class="font-semibold text-gray-800">${menu.menu_name}</span>
                  <span class="ml-auto text-gray-600">${Number(menu.menu_price).toLocaleString()}ì›</span>
                `;
                li.addEventListener("click", () => {
                  const found = cart.find(c => c.name === menu.menu_name);
                  if (found) found.quantity++;
                  else cart.push({ name: menu.menu_name, price: Number(menu.menu_price), quantity: 1 });
                  updateCart();
                });
                menuList.appendChild(li);
              });
            });
          } else {
            menuList.innerHTML = "<li>ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";
          }

          const updateCart = () => {
            const cartBox = document.getElementById("cartBox");
            const cartList = document.getElementById("cartList");
            const totalPriceEl = document.getElementById("totalPrice");
            cartList.innerHTML = "";
            let total = 0;

            cart.forEach((item, idx) => {
              total += item.price * item.quantity;
              const row = document.createElement("li");
              row.className = "flex justify-between items-center";
              row.innerHTML = `
                <div>
                  ${item.name} (${item.price.toLocaleString()}ì›)
                </div>
                <div class="flex items-center gap-2">
                  <button class="decrease px-2 border">-</button>
                  <span>${item.quantity}</span>
                  <button class="increase px-2 border">+</button>
                  <button class="delete px-2 border text-red-500">ì‚­ì œ</button>
                </div>
              `;
              row.querySelector(".increase").onclick = () => { item.quantity++; updateCart(); };
              row.querySelector(".decrease").onclick = () => { item.quantity--; if (item.quantity <= 0) cart.splice(idx, 1); updateCart(); };
              row.querySelector(".delete").onclick = () => { cart.splice(idx, 1); updateCart(); };
              cartList.appendChild(row);
            });

            totalPriceEl.textContent = total.toLocaleString();
            cartBox.classList.toggle("hidden", cart.length === 0);
          };

          document.getElementById("checkoutBtn").addEventListener("click", () => {
            if (!cart.length) return alert("ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
            alert(`ì´ ${document.getElementById("totalPrice").textContent}ì› ê²°ì œ ì§„í–‰`);
          });
        })
        .catch((err) => {
          console.error("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨", err);
        });
    });
  </script>
</body>
</html>
