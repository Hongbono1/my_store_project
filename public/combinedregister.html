<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>통합 정보 등록</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Daum 우편번호 / Kakao 지도 -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=__KAKAO_API_KEY__&autoload=false&libraries=services"></script>
  <style>
    /* 네오모피즘+글래스+3D 효과 박스 */
    .neo-glass-3d {
      background: rgba(255, 255, 255, 0.85);
      border-radius: 2rem;
      box-shadow:
        8px 8px 32px #e5e8f0,
        -8px -8px 32px #fff,
        0 4px 32px 0 rgba(80, 130, 255, 0.07);
      backdrop-filter: blur(18px) saturate(120%);
      -webkit-backdrop-filter: blur(18px) saturate(120%);
      border: 1.5px solid rgba(180, 200, 255, 0.10);
      transition: box-shadow .23s, border-color .2s;
    }

    .neo-glass-3d:focus-within,
    .neo-glass-3d:hover {
      box-shadow:
        4px 4px 18px #dae3f6,
        -4px -4px 18px #fff,
        0 8px 48px 0 rgba(80, 130, 255, 0.10);
      border-color: #60a5fa55;
    }

    /* 3D 버튼 */
    .btn-3d {
      background: linear-gradient(90deg, #6dd5fa 0%, #2980b9 100%);
      box-shadow: 0 4px 0 #2393b3, 0 8px 18px rgba(0, 64, 128, 0.14);
      color: white;
      font-weight: 700;
      border-radius: 1.3rem;
      padding: .75rem 2.5rem;
      font-size: 1.1rem;
      border: none;
      outline: none;
      transition: all .15s cubic-bezier(.21, .82, .69, .98);
    }

    .btn-3d:active {
      box-shadow: 0 1.5px 0 #2393b3, 0 2px 6px rgba(0, 64, 128, 0.16);
      transform: translateY(2px) scale(.98);
    }

    /* 입체 입력 */
    .input-neo {
      background: #f6f9fd;
      border-radius: .8rem;
      box-shadow:
        1.5px 1.5px 6px #e4e9f2,
        -1.5px -1.5px 6px #ffffff;
      border: 1px solid #d3e4f7;
      transition: box-shadow .14s, border-color .13s;
      font-size: 1.06rem;
    }

    .input-neo:focus {
      border-color: #60a5fa;
      box-shadow:
        0 0 0 1.5px #60a5fa44,
        1.5px 1.5px 6px #e4e9f2,
        -1.5px -1.5px 6px #ffffff;
      outline: none;
    }

    /* 박스별 section title */
    .section-label {
      background: linear-gradient(90deg, #bae6fd 0%, #f0f7ff 100%);
      color: #2b445c;
      box-shadow:
        0 2px 12px 2px #f3f9ff,
        0 0px 0 #bae6fd;
      border-radius: 1.2rem 1.2rem 0 0;
      padding: 1.1rem 2.2rem .9rem 2.2rem;
      font-size: 1.16rem;
      font-weight: 800;
      letter-spacing: .05em;
      border-bottom: 2px solid #cde3fa;
      margin-bottom: 2.1rem;
      text-shadow: 0 1.5px 0 #b2e4ff38;
    }
  </style>
</head>

<body class="bg-white flex flex-col min-h-screen">
  <div id="header-placeholder"></div>
  <main class="flex-grow container mx-auto px-2 py-8">
    <div class="neo-glass-3d max-w-2xl mx-auto p-5 sm:p-8">
      <h2 class="text-3xl font-bold text-center mb-8 drop-shadow">정보 등록</h2>
      <form id="businessForm" class="space-y-7" enctype="multipart/form-data" autocomplete="off">
        <input type="hidden" id="storeId" name="storeId">

        <!-- 1. 사업자 인증 -->
        <section class="rounded-2xl p-5 bg-yellow-50/80 mb-5 shadow-inner">
          <div class="section-label">사업자 등록 인증</div>
          <div class="flex flex-col md:flex-row gap-4">
            <label class="w-36 font-medium flex items-center justify-center">사업자 번호</label>
            <div class="flex flex-nowrap items-center gap-2 w-full">
              <input id="bizNumber1" name="bizNumber1" maxlength="4" placeholder="123"
                class="w-[90px] input-neo px-2 py-2" inputmode="numeric" />
              <span>-</span>
              <input id="bizNumber2" name="bizNumber2" maxlength="2" placeholder="45"
                class="w-[60px] input-neo px-2 py-2" inputmode="numeric" />
              <span>-</span>
              <input id="bizNumber3" name="bizNumber3" maxlength="5" placeholder="67890"
                class="w-[100px] input-neo px-2 py-2" inputmode="numeric" />
              <button type="button" onclick="verifyBizNumber()" class="btn-3d ml-2">인증</button>
            </div>
          </div>
          <div class="flex flex-col md:flex-row md:items-center gap-2 mt-3">
            <label class="w-32 font-medium shrink-0" for="businessCertImage">등록증 이미지</label>
            <input type="file" id="businessCertImage" name="businessCertImage" accept="image/*,application/pdf"
              class="flex-1 input-neo px-3 py-2">
          </div>
          <p class="text-sm text-center mt-2">*사업자 등록증은 <span class="text-red-600">3개월 이내</span> 발급분만 인정</p>
          <p id="bizVerifyResult" class="text-sm text-center"></p>
        </section>

        <!-- 2. 대표 정보 -->
        <section class="rounded-2xl p-5 bg-indigo-50/80 mb-5 shadow-inner">
          <div class="section-label">대표 정보</div>
          <div class="flex flex-col md:flex-row gap-2 mb-3">
            <label class="w-32 font-medium" for="ownerName">성함</label>
            <input id="ownerName" name="ownerName" class="flex-1 input-neo px-3 py-2" required>
          </div>
          <div class="flex flex-col md:flex-row gap-2 mb-3">
            <label class="w-32 font-medium" for="birthDate">생년월일</label>
            <input type="date" id="birthDate" name="birthDate" class="flex-1 input-neo px-3 py-2" required>
          </div>
          <div class="flex flex-col md:flex-row gap-2 mb-3">
            <label class="w-32 font-medium" for="emailId">이메일</label>
            <div class="flex flex-wrap items-center gap-2 flex-1 min-w-0">
              <input id="emailId" placeholder="아이디" oninput="updateEmail()" class="flex-1 min-w-0 input-neo px-3 py-2">
              <span>@</span>
              <select id="emailDomainSelect" onchange="handleDomainChange(this)"
                class="flex-1 min-w-0 input-neo px-3 py-2">
                <option value="">선택</option>
                <option value="naver.com">naver.com</option>
                <option value="gmail.com">gmail.com</option>
                <option value="daum.net">daum.net</option>
                <option value="custom">직접입력</option>
              </select>
              <input id="customDomainInput" placeholder="도메인" oninput="updateEmail()"
                class="hidden flex-1 min-w-0 input-neo px-3 py-2">
            </div>
            <input type="hidden" id="ownerEmail" name="ownerEmail">
          </div>
          <div class="flex flex-col md:flex-row gap-2 mb-3">
            <label class="w-32 font-medium" for="ownerAddress">주소</label>
            <input id="ownerAddress" name="ownerAddress" class="flex-1 input-neo px-3 py-2">
          </div>
          <div class="flex flex-col md:flex-row gap-2">
            <label class="w-32 font-medium" for="ownerPhone">휴대폰</label>
            <input id="ownerPhone" name="ownerPhone" class="flex-1 input-neo px-3 py-2" required>
            <button type="button" id="verifyPhoneButton" class="btn-3d">인증번호 요청</button>
          </div>
          <div class="flex flex-col md:flex-row gap-2 mt-2">
            <label class="w-32 font-medium" for="phoneAuth">인증번호</label>
            <input id="phoneAuth" name="phoneAuth" class="flex-1 input-neo px-3 py-2">
          </div>
          <p id="phoneVerifyResult" class="text-sm text-center"></p>
        </section>

        <!-- 3. 카테고리/서브카테고리 선택 (동적 출력) -->
        <section class="rounded-2xl p-5 bg-gray-50/90 mb-5 shadow-inner">
          <div class="section-label">업종(카테고리) 선택</div>
          <div class="flex flex-col md:flex-row gap-2 mb-2">
            <label class="w-32 font-medium">카테고리</label>
            <select id="mainCategory" name="mainCategory" class="flex-1 input-neo px-3 py-2" required></select>
          </div>
          <div class="flex flex-col md:flex-row gap-2">
            <label class="w-32 font-medium">서브카테고리</label>
            <select id="subCategory" name="subCategory" class="flex-1 input-neo px-3 py-2" required></select>
          </div>
        </section>

        <!-- 4. 기본 정보 -->
        <section class="rounded-2xl p-5 bg-white/90 mb-5 shadow-inner">
          <div class="section-label">기본 정보</div>
          <div class="flex flex-col md:flex-row gap-2 mb-3">
            <label class="w-32 font-medium" for="businessName">상호</label>
            <input id="businessName" name="businessName" class="flex-1 input-neo px-3 py-2" required>
          </div>
          <div class="flex flex-col md:flex-row gap-2 mb-3">
            <label class="w-32 font-medium" for="deliveryOption">배달/테이크아웃</label>
            <select id="deliveryOption" name="deliveryOption" class="flex-1 input-neo px-3 py-2">
              <option value="가능">가능</option>
              <option value="불가능">불가능</option>
            </select>
          </div>
          <div class="flex flex-col md:flex-row gap-2 mb-3">
            <label class="w-32 font-medium" for="businessHours">영업시간</label>
            <input id="businessHours" name="businessHours" class="flex-1 input-neo px-3 py-2">
          </div>
        </section>

        <!-- 메뉴 입력 표시 버튼 -->
        <button type="button" id="showMenuSectionBtn" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded">
          메뉴 입력
        </button>

        <!-- 메뉴 카테고리 (드롭다운) -->
        <div id="menu-section" class="hidden mt-6"></div>
        <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3 relative hidden">
          <label class="w-32 font-medium shrink-0" for="subcategoryDisplay">메뉴 카테고리</label>

          <!-- 선택된 값 표시 -->
          <input id="subcategoryDisplay" readonly placeholder="선택"
            class="flex-1 border rounded px-3 py-2 bg-gray-100 cursor-pointer">

          <!-- 토글 버튼 -->
          <button type="button" id="subcategoryToggle" class="shrink-0 bg-gray-300 px-3 py-2 rounded">▼</button>

          <!-- 실제 서버로 보낼 값 -->
          <input type="hidden" id="businessSubcategory" name="businessSubcategory">
        </div>

        <!-- 5. 서비스 내용 -->
        <section class="rounded-2xl p-5 bg-white/90 mb-5 shadow-inner">
          <div class="section-label">서비스 내용</div>
          <textarea id="serviceDetails" name="serviceDetails" class="input-neo w-full min-h-[90px] px-3 py-2"
            placeholder="서비스·메뉴·예약 정보 등을 입력하세요."></textarea>
        </section>

        <!-- 6. 고객 이벤트 -->
        <section class="rounded-2xl p-5 bg-white/90 mb-5 shadow-inner">
          <div class="section-label">고객 이벤트</div>
          <div class="flex flex-col gap-3">
            <input id="event1" name="event1" class="input-neo px-3 py-2" placeholder="이벤트 내용 1 (예: 신규가입 쿠폰 증정)">
            <input id="event2" name="event2" class="input-neo px-3 py-2" placeholder="이벤트 내용 2 (예: 2+1 행사)">
          </div>
        </section>

        <!-- 7. 기타 정보 -->
        <section class="rounded-2xl p-5 bg-white/90 mb-5 shadow-inner">
          <div class="section-label">기타 정보</div>
          <div class="flex flex-col gap-3">
            <input id="facility" name="facility" class="input-neo px-3 py-2" placeholder="장애인 편의시설 (예: 있음/없음)">
            <input id="pets" name="pets" class="input-neo px-3 py-2" placeholder="반려동물 출입 (예: 가능/불가능)">
            <input id="parking" name="parking" class="input-neo px-3 py-2" placeholder="주차 정보 (예: 전용/유료)">
          </div>
        </section>

        <!-- 8. 연락처 -->
        <section class="rounded-2xl p-5 bg-white/90 mb-5 shadow-inner">
          <div class="section-label">연락처</div>
          <div class="flex flex-col gap-3">
            <input id="phoneNumber" name="phoneNumber" class="input-neo px-3 py-2" placeholder="대표전화 (예: 02-123-4567)">
            <input id="homepage" name="homepage" class="input-neo px-3 py-2" placeholder="홈페이지 (URL)">
            <input id="instagram" name="instagram" class="input-neo px-3 py-2" placeholder="Instagram URL">
            <input id="facebook" name="facebook" class="input-neo px-3 py-2" placeholder="Facebook URL">
          </div>
        </section>

        <!-- 9. 추가 설명 -->
        <section class="rounded-2xl p-5 bg-white/90 mb-5 shadow-inner">
          <div class="section-label">추가 설명</div>
          <textarea id="additionalDesc" name="additionalDesc" class="input-neo w-full min-h-[90px] px-3 py-2"
            placeholder="추가 설명을 입력하세요."></textarea>
        </section>


        <!-- 5. 등록 버튼 -->
        <div class="text-center space-x-4 mt-8">
          <button type="submit" class="btn-3d">입력 완료</button>
          <button type="button" onclick="updateData()"
            class="btn-3d bg-gradient-to-r from-green-400 to-green-700 hover:from-green-600 hover:to-green-900 ml-2">수정</button>
        </div>
      </form>
    </div>
  </main>
  <div id="footer-placeholder"></div>

  <script>
    // 헤더/푸터 불러오기
    fetch("/components/header.html").then(r => r.text()).then(d => (document.getElementById('header-placeholder').innerHTML = d));
    fetch("/components/footer.html").then(r => r.text()).then(d => (document.getElementById('footer-placeholder').innerHTML = d));

    // 이메일 입력 유틸
    function updateEmail() {
      const id = document.getElementById('emailId').value.trim();
      const domainSel = document.getElementById('emailDomainSelect');
      const custom = document.getElementById('customDomainInput').value.trim();
      const domain = domainSel.value === 'custom' ? custom : domainSel.value;
      document.getElementById('ownerEmail').value = domain ? `${id}@${domain}` : '';
    }
    function handleDomainChange(sel) {
      const customInp = document.getElementById('customDomainInput');
      if (sel.value === 'custom') {
        customInp.classList.remove('hidden');
        customInp.focus();
      } else {
        customInp.classList.add('hidden');
        updateEmail();
      }
    }

    // 카테고리별 서브카테고리 동적 출력
    const categoryData = {
      //"식당": ["한식", "중식", "양식", "일식", "분식", "패스트푸드", "치킨", "족발/보쌈", "피자", "야식", "디저트", "기타"],
      "병원": ["종합병원", "내과", "치과", "소아과", "정형외과", "산부인과", "한의원", "동물병원", "기타"],
      "약국": ["일반약국", "24시약국", "한약방", "기타"],
      "어린이집": ["국공립", "민간", "가정", "직장", "기타"],
      "학원": ["입시학원", "영어", "수학", "음악", "미술", "컴퓨터", "체육", "독서실", "기타"],
      "마트": ["대형마트", "중소마트", "슈퍼마켓", "시장", "기타"],
      "편의점": ["CU", "GS25", "세븐일레븐", "이마트24", "미니스톱", "기타"],
      "운동": ["헬스장", "필라테스", "요가", "태권도", "스포츠센터", "기타"],
      "미용/이발": ["미용실", "이발소", "네일", "피부관리", "왁싱", "기타"],
      "스터디/독서실": ["스터디룸", "독서실", "도서관", "기타"],
      "목욕": ["대중목욕탕", "사우나", "찜질방", "스파", "기타"],
      "세탁/옷수선": ["세탁소", "옷수선", "신발수선", "기타"],
      "숙박": ["호텔", "모텔", "게스트하우스", "펜션", "기타"],
      "중고/구제": ["중고가전", "중고가구", "중고명품", "리사이클", "기타"],
      "자동차 정비/수리등": ["카센터", "정비소", "자동차용품", "타이어", "기타"],
      "주유소": ["직영주유소", "자가주유소", "충전소", "기타"],
      "반려동물": ["애견미용", "애견호텔", "애견카페", "동물용품", "펫시터", "기타"],
      "가전제품": ["가전판매", "가전수리", "휴대폰", "PC", "기타"],
      "철물 / 자재": ["철물점", "건축자재", "인테리어자재", "기타"],
      "간판 / 광고": ["간판제작", "인쇄", "홍보물", "기타"],
      "통신 / 인터넷 / TV": ["SK", "KT", "LG", "인터넷", "IPTV", "기타"],
      "안경 / 사진 / 꽃집": ["안경점", "사진관", "꽃집", "화원", "기타"]
    };
    // 빼고 싶은 카테고리
    const excluded = ["식당", "전통시장", "공연"];
    const mainCatSel = document.getElementById("mainCategory");
    mainCatSel.innerHTML = '<option value="">카테고리 선택</option>';

    Object.keys(categoryData).forEach(key => {
      if (!excluded.includes(key)) {
        mainCatSel.innerHTML += `<option value="${key}">${key}</option>`;
      }
    });

    // [2] 메인 카테고리 선택 시 서브카테고리 변경
    mainCatSel.addEventListener("change", function () {
      const subSel = document.getElementById("subCategory");
      subSel.innerHTML = `<option value="">서브카테고리 선택</option>`;
      const val = this.value;
      if (categoryData[val]) {
        categoryData[val].forEach(c =>
          subSel.innerHTML += `<option value="${c}">${c}</option>`
        );
      }
    });

    // 사업자 인증(실서버 연동 시 별도 처리 필요)
    async function verifyBizNumber() {
      const n1 = document.getElementById('bizNumber1').value.trim();
      const n2 = document.getElementById('bizNumber2').value.trim();
      const n3 = document.getElementById('bizNumber3').value.trim();
      const biz = n1 + n2 + n3;
      const resEl = document.getElementById('bizVerifyResult');
      if (!/^\d{10}$/.test(biz)) {
        resEl.textContent = '올바른 사업자번호를 입력하세요 (총 10자리 숫자)';
        resEl.className = 'text-sm text-red-600 text-center';
        return;
      }
      try {
        const r = await fetch('/verify-biz', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ b_no: [biz] })
        });
        const d = await r.json();
        const i = d?.data?.[0];
        if (i && i.b_stt_cd === '01') {
          resEl.textContent = `✅ 인증 완료: ${i.b_no}`;
          resEl.className = 'text-sm text-green-600 text-center';
          document.getElementById('businessName').value = i.b_nm || '';
        } else {
          resEl.textContent = '❌ 등록되지 않았거나 폐업된 사업자입니다.';
          resEl.className = 'text-sm text-red-600 text-center';
        }
      } catch (err) {
        resEl.textContent = '서버 오류로 인증에 실패했습니다.';
        resEl.className = 'text-sm text-red-600 text-center';
      }
    }

    // 휴대폰 인증(예시: 실제 서비스시 외부 SMS API 연동)
    document.getElementById('verifyPhoneButton').addEventListener('click', () => {
      const phone = document.getElementById('ownerPhone').value.trim();
      const resEl = document.getElementById('phoneVerifyResult');
      if (!phone) {
        resEl.textContent = '휴대폰 번호를 입력하세요.';
        resEl.className = 'text-sm text-red-600';
        return;
      }
      // 실제 인증 API로 요청(이 예시에서는 고정 코드)
      resEl.textContent = '인증번호가 발송되었습니다. (예시: 123456)';
      resEl.className = 'text-sm text-green-600';
    });
    document.getElementById('phoneAuth').addEventListener('blur', function () {
      const code = this.value.trim();
      const resEl = document.getElementById('phoneVerifyResult');
      if (code === '123456') {
        resEl.textContent = '휴대전화 인증 성공!';
        resEl.className = 'text-sm text-green-600';
      } else if (code) {
        resEl.textContent = '인증번호가 일치하지 않습니다.';
        resEl.className = 'text-sm text-red-600';
      }
    });

    // 메뉴 입력 영역 토글
    document.getElementById('showMenuSectionBtn').onclick = function () {
      document.getElementById('menu-section').classList.remove('hidden');
      this.style.display = 'none';
    };

    let menuIdx = 0;
    function createMenuBox(idx) {
      return `
  <div class="flex flex-wrap gap-3 items-center border rounded-xl p-4 bg-blue-50 shadow" data-menu-idx="${idx}">
    <input name="menuName[]" placeholder="메뉴명" class="input-neo px-3 py-2 w-40" required>
    <input name="menuPrice[]" type="number" placeholder="가격" class="input-neo px-3 py-2 w-28" required>
    <input name="menuImage[]" type="file" accept="image/*" class="input-neo px-3 py-2 w-44">
    <button type="button" class="removeMenuBtn px-2 py-1 bg-red-400 text-white rounded">삭제</button>
  </div>
  `;
    }
    const menusContainer = document.getElementById('menus-container');
    document.getElementById('addMenuBtn').onclick = function () {
      menusContainer.insertAdjacentHTML('beforeend', createMenuBox(menuIdx++));
      bindRemoveBtns();
    };
    // 삭제버튼
    function bindRemoveBtns() {
      document.querySelectorAll('.removeMenuBtn').forEach(btn => {
        btn.onclick = function () {
          this.closest('[data-menu-idx]').remove();
        }
      });
    }

    // 폼 제출/검증 (추가 보완 가능)
    document.getElementById('businessForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        // 필수값 검증 (예시)
        const required = ["ownerName", "birthDate", "ownerEmail", "ownerPhone", "mainCategory", "subCategory", "businessName"];
        for (const k of required) {
          const v = document.getElementsByName(k)[0]?.value?.trim();
          if (!v) {
            alert("필수 정보를 모두 입력하세요!");
            return;
          }
        }
        const fd = new FormData(e.target);
        // 실제 업로드/등록 처리
        const res = await fetch('/store', { method: 'POST', body: fd });
        if (!res.ok) throw new Error('서버 에러');
        alert('등록이 완료되었습니다!');
        // location.href = ... 상세페이지로 이동 등
      } catch (err) {
        alert('에러: ' + err.message);
      }
    });
  </script>
</body>

</html>