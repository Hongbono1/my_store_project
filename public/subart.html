<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>공연/예술/축제 상세보기</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-r from-indigo-100 via-blue-50 to-blue-200 min-h-screen">
    <!-- 헤더 영역 -->
    <div id="header"></div>

    <main class="max-w-2xl mx-auto bg-white/90 p-8 mt-12 mb-20 rounded-3xl shadow-2xl border border-indigo-200">
        <!-- 이미지 및 기본정보 -->
        <div id="mainImageWrap" class="flex flex-col items-center mb-8">
            <img id="mainImg" src="/assets/images/no-thumb.png" alt="대표이미지"
                class="w-full max-w-lg rounded-xl shadow mb-4">
        </div>
        <div class="text-center mb-6">
            <h1 id="title" class="text-3xl font-extrabold text-indigo-800 mb-1">제목</h1>
            <div id="category" class="inline-block text-xs bg-indigo-100 text-indigo-600 px-3 py-1 rounded-full mb-2">
                카테고리</div>
            <p id="date" class="text-gray-700 mb-1">일정: </p>
            <p id="place" class="text-gray-700">장소: </p>
        </div>

        <!-- 상세설명 -->
        <div class="mb-4">
            <h2 class="text-lg font-bold text-indigo-700 mb-2">상세 소개</h2>
            <p id="description" class="text-gray-800 whitespace-pre-line">상세 설명이 여기에 표시됩니다.</p>
        </div>

        <!-- 추가 정보 -->
        <div id="extraInfo" class="space-y-2 mt-6">
            <!-- 주최자, 참가비, 문의 등 필요시 표시 -->
            <div id="hostWrap" class="hidden">
                <span class="font-bold">주최자: </span><span id="host"></span>
            </div>
            <div id="feeWrap" class="hidden">
                <span class="font-bold">참가비: </span><span id="fee"></span>
            </div>
            <div id="contactWrap" class="hidden">
                <span class="font-bold">문의: </span><span id="contact"></span>
            </div>
        </div>

        <!-- 지도/위치 정보 (필요시) -->
        <div id="mapWrap" class="mt-8">
            <div class="font-bold text-indigo-700 mb-2">지도</div>
            <div id="kakaoMap" class="w-full h-60 rounded-xl border"></div>
            <div class="text-xs text-gray-500 mt-1" id="mapAddress"></div>
        </div>
    </main>

    <!-- 헤더 fetch/지도/데이터 fetch 스크립트 -->
    <script>
        // 헤더 fetch (공통)
        fetch("/components/header.html")
            .then(res => res.text())
            .then(html => { document.getElementById("header").innerHTML = html; });

        // 1. URL에서 id값 추출
        function getParam(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name);
        }
        const subartId = getParam('id');
        if (!subartId) {
            alert('잘못된 접근입니다.');
            window.location.href = '/';
        }

        // 2. 서버에서 상세 데이터 가져오기
        async function loadSubartDetail() {
            try {
                // 실제 서버 API 주소로 변경
                const res = await fetch(`/subart/${subartId}`);
                if (!res.ok) throw new Error('데이터 없음');
                const data = await res.json();

                // 대표 이미지
                if (data.main_img) {
                    document.getElementById('mainImg').src = data.main_img.startsWith('http') ? data.main_img : `/uploads/${data.main_img}`;
                }
                // 제목, 카테고리, 일정, 장소
                document.getElementById('title').textContent = data.title || '-';
                document.getElementById('category').textContent = data.category || '-';
                document.getElementById('date').textContent = '일정: ' + (data.date || '-');
                document.getElementById('place').textContent = '장소: ' + (data.place || '-');
                // 상세 설명
                document.getElementById('description').textContent = data.description || '-';

                // 추가정보(주최, 참가비, 문의)
                if (data.host) {
                    document.getElementById('hostWrap').classList.remove('hidden');
                    document.getElementById('host').textContent = data.host;
                }
                if (data.fee) {
                    document.getElementById('feeWrap').classList.remove('hidden');
                    document.getElementById('fee').textContent = data.fee;
                }
                if (data.contact) {
                    document.getElementById('contactWrap').classList.remove('hidden');
                    document.getElementById('contact').textContent = data.contact;
                }

                // 지도 표시 (카카오맵)
                if (window.kakao && window.kakao.maps && data.place) {
                    kakao.maps.load(() => showKakaoMap(data.place));
                } else {
                    window.kakaoReady = () => showKakaoMap(data.place);
                }
                document.getElementById('mapAddress').textContent = data.place || '';
            } catch (err) {
                alert('상세 정보가 없습니다.');
                window.location.href = '/';
            }
        }

        // 3. 카카오맵 띄우기
        function showKakaoMap(address) {
            if (!address) return;
            const container = document.getElementById('kakaoMap');
            const mapOption = { center: new kakao.maps.LatLng(37.5665, 126.9780), level: 3 };
            const map = new kakao.maps.Map(container, mapOption);

            const geocoder = new kakao.maps.services.Geocoder();
            geocoder.addressSearch(address, (result, status) => {
                if (status === kakao.maps.services.Status.OK) {
                    const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                    map.setCenter(coords);
                    new kakao.maps.Marker({ map, position: coords });
                }
            });
        }

        // 카카오맵 SDK 동적로딩 (API_KEY 직접 입력!)
        (function () {
            if (window.kakao && window.kakao.maps) return;
            const script = document.createElement("script");
            script.src = "//dapi.kakao.com/v2/maps/sdk.js?appkey=카카오API키&autoload=false&libraries=services";
            script.onload = () => { kakao.maps.load(() => window.kakaoReady && window.kakaoReady()); };
            document.head.appendChild(script);
        })();

        // 페이지 진입시 데이터 로드
        loadSubartDetail();
    </script>
</body>

</html>