<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì •ë³´ ì…ë ¥</title>

  <!-- Tailwind ê°œë°œìš© CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ / Kakao ì§€ë„ -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script defer src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_KEY&libraries=services"></script>
</head>

<body class="bg-gray-200 flex flex-col min-h-screen">
  <!-- í—¤ë” ìë¦¬ -->
  <div id="header-placeholder"></div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë©”ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <main class="flex-grow container mx-auto px-4 py-8">
    <div class="bg-white max-w-4xl mx-auto p-6 rounded-lg shadow-lg border-2 border-gray-300">
      <h2 class="text-3xl font-bold text-center mb-6">ì •ë³´ ì…ë ¥</h2>

      <form id="businessForm" class="space-y-6" enctype="multipart/form-data">
        <input type="hidden" id="storeId" name="storeId">

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1. ì‚¬ì—…ì ë“±ë¡ ì¸ì¦ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section class="border rounded p-4 bg-yellow-50">
          <h3 class="text-xl font-semibold mb-4">ì‚¬ì—…ì ë“±ë¡ ì¸ì¦</h3>

          <div class="flex flex-col md:flex-row md:items-center gap-4">
            <label class="w-36 font-medium flex items-center justify-center text-center">
              ì‚¬ì—…ì ë²ˆí˜¸

            </label>

            <div class="flex flex-nowrap items-center gap-2 w-full overflow-x-auto">
              <input id="bizNumber1" name="bizNumber1" maxlength="4" placeholder="336"
                class="w-[150px] border rounded px-2 py-2" oninput="this.value=this.value.replace(/[^0-9]/g,'')" />
              <span class="shrink-0">-</span>

              <input id="bizNumber2" name="bizNumber2" maxlength="4" placeholder="4"
                class="w-[130px] border rounded px-2 py-2" oninput="this.value=this.value.replace(/[^0-9]/g,'')" />
              <span class="shrink-0">-</span>

              <input id="bizNumber3" name="bizNumber3" maxlength="6" placeholder="12365"
                class="w-[170px] border rounded px-2 py-2" oninput="this.value=this.value.replace(/[^0-9]/g,'')" />

              <button type="button" onclick="verifyBizNumber()"
                class="shrink-0 whitespace-nowrap bg-yellow-500 hover:bg-yellow-600 text-white font-semibold px-4 py-2 rounded">
                ì¸ì¦
              </button>
            </div>
          </div>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mt-3">
            <label class="w-32 font-medium shrink-0" for="businessCertImage">ë“±ë¡ì¦ ì´ë¯¸ì§€</label>
            <input type="file" id="businessCertImage" name="businessCertImage" accept="image/*,application/pdf"
              class="flex-1 border rounded px-3 py-2">
          </div>

          <p class="text-sm text-center mt-2">
            *ì‚¬ì—…ì ë“±ë¡ì¦ì€ <span class="text-red-600">3ê°œì›” ì´ë‚´</span> ë°œê¸‰ë¶„ë§Œ ì¸ì •
          </p>
          <p id="bizVerifyResult" class="text-sm text-center"></p>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2. ëŒ€í‘œ ì •ë³´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section class="border rounded p-4 bg-indigo-100">
          <h3 class="text-xl font-semibold mb-4">ëŒ€í‘œ ì •ë³´</h3>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="ownerName">ëŒ€í‘œì ì„±í•¨</label>
            <input id="ownerName" name="ownerName" placeholder="ì˜ˆ: í™ê¸¸ë™" class="flex-1 border rounded px-3 py-2">
          </div>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="birthDate">ìƒë…„ì›”ì¼</label>
            <input type="date" id="birthDate" name="birthDate" class="flex-1 border rounded px-3 py-2">
          </div>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="emailId">ì´ë©”ì¼</label>

            <div class="flex flex-wrap items-center gap-2 flex-1 min-w-0">
              <input id="emailId" placeholder="ì•„ì´ë””" oninput="updateEmail()"
                class="flex-1 min-w-0 border rounded px-3 py-2">
              <span class="shrink-0">@</span>

              <select id="emailDomainSelect" onchange="handleDomainChange(this)"
                class="flex-1 min-w-0 border rounded px-3 py-2">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="naver.com">naver.com</option>
                <option value="gmail.com">gmail.com</option>
                <option value="daum.net">daum.net</option>
                <option value="kakao.com">kakao.com</option>
                <option value="nate.com">nate.com</option>
                <option value="custom">ì§ì ‘ì…ë ¥</option>
              </select>

              <input id="customDomainInput" placeholder="ë„ë©”ì¸" oninput="updateEmail()"
                class="hidden flex-1 min-w-0 border rounded px-3 py-2">
            </div>

            <input type="hidden" id="ownerEmail" name="ownerEmail">
          </div>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="ownerAddress">ëŒ€í‘œ ì£¼ì†Œ</label>
            <input id="ownerAddress" name="ownerAddress" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ..."
              class="flex-1 border rounded px-3 py-2">
          </div>

          <div class="flex flex-col md:flex-row md:items-center gap-2">
            <label class="w-32 font-medium shrink-0" for="ownerPhone">í•¸ë“œí° ë²ˆí˜¸</label>
            <input id="ownerPhone" name="ownerPhone" placeholder="010â€‘1234â€‘5678"
              class="flex-1 border rounded px-3 py-2">
          </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 3. íœ´ëŒ€ì „í™” ì¸ì¦ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section class="border rounded p-4 bg-indigo-50">
          <h3 class="text-xl font-semibold mb-4">íœ´ëŒ€ì „í™” ì¸ì¦</h3>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-2">
            <label class="w-32 font-medium shrink-0" for="phoneAuth">ì¸ì¦ë²ˆí˜¸</label>
            <input id="phoneAuth" name="phoneAuth" placeholder="ì¸ì¦ë²ˆí˜¸ ì…ë ¥" class="flex-1 border rounded px-3 py-2">
            <button type="button" id="verifyPhoneButton"
              class="shrink-0 bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-4 py-2 rounded">
              ì¸ì¦ ìš”ì²­
            </button>
          </div>
          <p id="phoneVerifyResult" class="text-sm text-center"></p>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 4. ê¸°ë³¸ ì •ë³´(ê°€ê²Œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section class="border rounded p-4 bg-gray-50">
          <h3 class="text-xl font-semibold mb-4">ê¸°ë³¸ ì •ë³´</h3>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="businessName">ìƒí˜¸</label>
            <input id="businessName" name="businessName" placeholder="OO ì‹ë‹¹ â€¦" class="flex-1 border rounded px-3 py-2">
          </div>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="businessType">ì—…ì¢…</label>
            <input id="businessType" name="businessType" placeholder="ìŒì‹ì  / ì¹´í˜ â€¦"
              class="flex-1 border rounded px-3 py-2">
          </div>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="deliveryOption">ë°°ì†¡/í…Œì´í¬ì•„ì›ƒ</label>
            <select id="deliveryOption" name="deliveryOption" class="flex-1 border rounded px-3 py-2">
              <option value="ê°€ëŠ¥">ê°€ëŠ¥</option>
              <option value="ë¶ˆê°€ëŠ¥">ë¶ˆê°€ëŠ¥</option>
            </select>
          </div>

          <div class="flex flex-col md:flex-row md:items-center gap-2">
            <label class="w-32 font-medium shrink-0" for="businessHours">ì˜ì—…ì‹œê°„</label>
            <input id="businessHours" name="businessHours" placeholder="09:00 ~ 22:00"
              class="flex-1 border rounded px-3 py-2">
          </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 5. ì„œë¹„ìŠ¤ ë‚´ìš© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section class="border rounded p-4 bg-gray-50">
          <h3 class="text-xl font-semibold mb-4">ì„œë¹„ìŠ¤ ë‚´ìš©</h3>
          <textarea id="serviceDetails" name="serviceDetails" class="w-full border rounded px-3 py-2" rows="4"
            placeholder="ì„œë¹„ìŠ¤Â·ë©”ë‰´Â·ì˜ˆì•½ ì •ë³´ â€¦"></textarea>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 6. ê³ ê° ì´ë²¤íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section class="border rounded p-4 bg-gray-50">
          <h3 class="text-xl font-semibold mb-4">ê³ ê° ì´ë²¤íŠ¸</h3>
          <div class="mb-3">
            <label class="block font-medium mb-1" for="event1">ì´ë²¤íŠ¸ ë‚´ìš©Â 1</label>
            <input id="event1" name="event1" placeholder="ì´ë²¤íŠ¸ ë‚´ìš© 1" class="w-full border rounded px-3 py-2">
          </div>
          <div>
            <label class="block font-medium mb-1" for="event2">ì´ë²¤íŠ¸ ë‚´ìš©Â 2</label>
            <input id="event2" name="event2" placeholder="ì´ë²¤íŠ¸ ë‚´ìš© 2" class="w-full border rounded px-3 py-2">
          </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 7. ê¸°íƒ€ ì •ë³´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section class="border rounded p-4 bg-gray-50">
          <h3 class="text-xl font-semibold mb-4">ê¸°íƒ€ ì •ë³´</h3>
          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="facility">ì¥ì• ì¸ í¸ì˜ì‹œì„¤</label>
            <input id="facility" name="facility" placeholder="ìˆìŒ / ì—†ìŒ â€¦" class="flex-1 border rounded px-3 py-2">
          </div>
          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="pets">ë°˜ë ¤ë™ë¬¼ ì¶œì…</label>
            <input id="pets" name="pets" placeholder="ê°€ëŠ¥(ì†Œí˜•ê²¬) / ë¶ˆê°€ëŠ¥ â€¦" class="flex-1 border rounded px-3 py-2">
          </div>
          <div class="flex flex-col md:flex-row md:items-center gap-2">
            <label class="w-32 font-medium shrink-0" for="parking">ì£¼ì°¨ ì •ë³´</label>
            <input id="parking" name="parking" placeholder="ì „ìš© / ìœ ë£Œ â€¦" class="flex-1 border rounded px-3 py-2">
          </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 8. ë©”ë‰´ ë“±ë¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section class="bg-white p-4 rounded shadow">
          <h3 class="text-xl font-semibold mb-2">STEPÂ 5. ë©”ë‰´ ë“±ë¡</h3>

          <!-- ì¹´í…Œê³ ë¦¬ ì…ë ¥ -->
          <div class="flex items-center gap-2 mb-4">
            <input id="categoryInput" placeholder="ì¹´í…Œê³ ë¦¬ëª… (ì˜ˆ: ëˆê°€ìŠ¤)" class="flex-1 border rounded px-3 py-2">
            <button type="button" onclick="addCategory()"
              class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
              êµ¬ë¶„ í’ˆëª©
            </button>
          </div>

          <!-- í’ˆëª© ì…ë ¥ ì•ˆë‚´ -->
          <div class="border rounded p-4 bg-gray-50">
            <h4 class="text-lg font-semibold mb-4">í’ˆëª© ì…ë ¥ (ì¹´í…Œê³ ë¦¬ë³„ ìµœëŒ€ 50ê°œ)</h4>
            <div id="menuContainer" class="space-y-6"></div>
          </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 9. ì—°ë½ì²˜(ê°€ê²Œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section class="border rounded p-4 bg-gray-50">
          <h3 class="text-xl font-semibold mb-4">ì—°ë½ì²˜</h3>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="phoneNumber">ëŒ€í‘œì „í™”</label>
            <input id="phoneNumber" name="phoneNumber" placeholder="02â€‘123â€‘4567"
              class="flex-1 border rounded px-3 py-2">
          </div>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="homepage">í™ˆí˜ì´ì§€</label>
            <input id="homepage" name="homepage" placeholder="URL" class="flex-1 border rounded px-3 py-2">
          </div>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="instagram">ì¸ìŠ¤íƒ€ê·¸ë¨</label>
            <input id="instagram" name="instagram" placeholder="Instagram URL" class="flex-1 border rounded px-3 py-2">
          </div>

          <div class="flex flex-col md:flex-row md:items-center gap-2">
            <label class="w-32 font-medium shrink-0" for="facebook">í˜ì´ìŠ¤ë¶</label>
            <input id="facebook" name="facebook" placeholder="Facebook URL" class="flex-1 border rounded px-3 py-2">
          </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 10. ì¶”ê°€ ì„¤ëª… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section class="border rounded p-4 bg-gray-50">
          <h3 class="text-xl font-semibold mb-4">ì¶”ê°€ ì„¤ëª…</h3>
          <textarea id="additionalDesc" name="additionalDesc" class="w-full border rounded px-3 py-2" rows="4"
            placeholder="ì¶”ê°€ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 11. ì´ë¯¸ì§€(ëŒ€í‘œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section class="border rounded p-4 bg-gray-50">
          <h3 class="text-xl font-semibold mb-4">ì´ë¯¸ì§€ ë“±ë¡ (ìµœëŒ€ 3ì¥)</h3>
          <input type="file" id="imagesInput" name="images[]" multiple accept="image/*"
            class="block w-full mb-3 file:mr-4 file:py-2 file:px-4 file:rounded file:bg-blue-100 file:text-blue-700 hover:file:bg-blue-200">
          <div id="imagesPreview" class="flex gap-3"></div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 12. ì£¼ì†Œ ì…ë ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section class="border rounded p-4 bg-gray-50">
          <h3 class="text-xl font-semibold mb-4">ì£¼ì†Œ ì…ë ¥</h3>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="postalCode">ìš°í¸ë²ˆí˜¸</label>
            <input id="postalCode" name="postalCode" placeholder="ìš°í¸ë²ˆí˜¸" readonly
              class="flex-1 border rounded px-3 py-2">
            <button type="button" onclick="openDaumPostcode()"
              class="shrink-0 bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded">
              ì£¼ì†Œ ì°¾ê¸°
            </button>
          </div>

          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
            <label class="w-32 font-medium shrink-0" for="roadAddress">ë„ë¡œëª… ì£¼ì†Œ</label>
            <input id="roadAddress" name="roadAddress" placeholder="ë„ë¡œëª… ì£¼ì†Œ" readonly
              class="flex-1 border rounded px-3 py-2">
          </div>

          <div class="flex flex-col md:flex-row md:items-center gap-2">
            <label class="w-32 font-medium shrink-0" for="detailAddress">ìƒì„¸ ì£¼ì†Œ</label>
            <input id="detailAddress" name="detailAddress" placeholder="ìƒì„¸ ì£¼ì†Œ" class="flex-1 border rounded px-3 py-2">
          </div>

          <div id="map" class="w-full h-64 border border-gray-300 rounded mt-4"></div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 13. ë²„íŠ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="text-center space-x-4">
          <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold px-6 py-2 rounded">ì…ë ¥
            ì™„ë£Œ</button>
          <button type="button" onclick="updateData()"
            class="bg-green-500 hover:bg-green-600 text-white font-bold px-6 py-2 rounded">ìˆ˜ì •</button>
        </div>
      </form>
    </div>
  </main>

  <!-- í‘¸í„° -->
  <div id="footer-placeholder"></div>

  <!-- âœ… ë©”ë‰´ ë“±ë¡Â·ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ê¹Œì§€ í¬í•¨í•œ í†µí•© JavaScript -->
  <script>
    // âœ… í—¤ë” ë¶ˆëŸ¬ì˜¤ê¸°
    fetch("/components/header.html")
      .then(res => res.text())
      .then(data => {
        document.getElementById("header-placeholder").innerHTML = data;
      });

    // âœ… í‘¸í„° ë¶ˆëŸ¬ì˜¤ê¸°
    fetch("/components/footer.html")
      .then(res => res.text())
      .then(data => {
        const footer = document.createElement("footer");
        footer.innerHTML = data;
        document.body.appendChild(footer);
      });

    /* ----------------------------------------------------
       ê³µí†µ ì´ë©”ì¼ ìœ í‹¸
    ---------------------------------------------------- */
    function updateEmail() {
      const id = document.getElementById('emailId').value.trim();
      const domainSel = document.getElementById('emailDomainSelect');
      const custom = document.getElementById('customDomainInput').value.trim();
      const domain = domainSel.value === 'custom' ? custom : domainSel.value;
      document.getElementById('ownerEmail').value = domain ? `${id}@${domain}` : '';
    }
    function handleDomainChange(sel) {
      const customInp = document.getElementById('customDomainInput');
      if (sel.value === 'custom') {
        customInp.classList.remove('hidden');
        customInp.focus();
      } else {
        customInp.classList.add('hidden');
        updateEmail();
      }
    }

    /* ----------------------------------------------------
       ì…ë ¥ê°’ ìˆì„ ë•Œ ë°°ê²½ìƒ‰ ë³€ê²½
    ---------------------------------------------------- */
    document.addEventListener('DOMContentLoaded', () => {
      const inputs = document.querySelectorAll(
        "input[type='text'], input[type='email'], input[type='date'], input[type='tel'], select, textarea"
      );

      inputs.forEach((input) => {
        input.addEventListener('input', () => {
          if (input.value.trim()) input.classList.add('bg-blue-50');
          else input.classList.remove('bg-blue-50');
        });

        /* ì´ˆê¸°ê°’ì´ ìˆì„ ë•Œë„ ì¦‰ì‹œ ë°˜ì˜ */
        input.dispatchEvent(new Event('input'));
      });
    });

    /* ----------------------------------------------------
       ì¸ë„¤ì¼ ì´ë¯¸ì§€ 3ì¥ ë¯¸ë¦¬ë³´ê¸°
    ---------------------------------------------------- */
    const imagesInput = document.getElementById('imagesInput');
    const imagesPreview = document.getElementById('imagesPreview');
    imagesInput.addEventListener('change', () => {
      imagesPreview.innerHTML = '';
      Array.from(imagesInput.files).slice(0, 3).forEach((file) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.className = 'w-32 h-20 object-cover border border-gray-300 rounded';
          imagesPreview.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    });

    /* ----------------------------------------------------
       ì£¼ì†Œ ê²€ìƒ‰ + Kakao ì§€ë„
    ---------------------------------------------------- */
    function openDaumPostcode() {
      new daum.Postcode({
        oncomplete: (data) => {
          document.getElementById('postalCode').value = data.zonecode;
          document.getElementById('roadAddress').value = data.roadAddress;
          updateMap(data.roadAddress);
          document.getElementById('detailAddress').focus();
        }
      }).open({ autoClose: true });
    }

    let map, marker;
    function updateMap(addr) {
      const mapEl = document.getElementById('map');
      if (!map) {
        map = new kakao.maps.Map(mapEl, {
          center: new kakao.maps.LatLng(37.5665, 126.978),
          level: 3
        });
      }
      const geocoder = new kakao.maps.services.Geocoder();
      geocoder.addressSearch(addr, (res, status) => {
        if (status === kakao.maps.services.Status.OK) {
          const coords = new kakao.maps.LatLng(res[0].y, res[0].x);
          map.setCenter(coords);
          if (marker) marker.setPosition(coords);
          else marker = new kakao.maps.Marker({ map, position: coords });
        }
      });
    }
    document.getElementById('detailAddress').addEventListener('blur', () => {
      const base = document.getElementById('roadAddress').value.trim();
      const detail = document.getElementById('detailAddress').value.trim();
      if (base || detail) updateMap(`${base} ${detail}`);
    });

    /* ----------------------------------------------------
       ê°€ê²© ì…ë ¥ ì„¸ ìë¦¬ ì½¤ë§ˆ
    ---------------------------------------------------- */
    function formatCurrency(inp) {
      let v = inp.value.replace(/[^0-9.]/g, '');
      const p = v.split('.');
      if (p.length > 2) v = p[0] + '.' + p.slice(1).join('');
      let int = p[0] || '';
      let dec = p[1] || '';
      if (!int && !dec) { inp.value = ''; return; }
      if (dec.length > 2) dec = dec.slice(0, 2);
      int = int.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      inp.value = dec ? `${int}.${dec}` : int;
    }

    /* ----------------------------------------------------
       ë©”ë‰´ Â· ì¹´í…Œê³ ë¦¬ ê´€ë¦¬
    ---------------------------------------------------- */
    let totalMenuCount = 0;
    const MAX_MENUS = 50;

    /* ì¹´í…Œê³ ë¦¬(êµ¬ë¶„) ì¶”ê°€ */
    function addCategory() {
      const catName = document.getElementById('categoryInput').value.trim();
      if (!catName) { alert('ì¹´í…Œê³ ë¦¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }

      const menuContainer = document.getElementById('menuContainer');
      const catId = `cat-${Date.now()}`;

      const catBlock = document.createElement('div');
      catBlock.className = 'border border-gray-300 p-4 rounded bg-gray-50';
      catBlock.dataset.category = catName;

      catBlock.innerHTML = `
        <div class="flex justify-between items-center mb-3">
          <h4 class="text-lg font-bold">${catName}</h4>
          <button type="button"
                  onclick="removeCategory(this)"
                  class="text-red-500 text-sm bg-white border border-red-400 px-2 py-1 rounded hover:bg-red-50">
            ì¹´í…Œê³ ë¦¬ ì‚­ì œ
          </button>
        </div>
        <input type="hidden" name="category[]" value="${catName}">
        <div id="${catId}" class="space-y-2"></div>
        <button type="button"
                class="mt-2 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded"
                onclick="addMenu('${catId}', '${catName}')">
          + ë©”ë‰´ ì¶”ê°€
        </button>
      `;
      menuContainer.appendChild(catBlock);
      document.getElementById('categoryInput').value = '';

      /* ê¸°ë³¸ ë©”ë‰´ 1ê°œ ìë™ ì¶”ê°€ */
      addMenu(catId, catName);
    }

    /* í’ˆëª©(ë©”ë‰´) ì¶”ê°€ : íŒŒì¼ì„ íƒ â†’ ë©”ë‰´ëª… â†’ ê°€ê²© */
    function addMenu(catContainerId, catName) {
      if (totalMenuCount >= MAX_MENUS) {
        alert('ë©”ë‰´ëŠ” ìµœëŒ€ 50ê°œê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        return;
      }
      totalMenuCount++;

      const cont = document.getElementById(catContainerId);
      const row = document.createElement('div');
      row.className = 'flex items-center gap-2';

      row.innerHTML = `
       <div class="w-full border border-gray-300 rounded-lg p-4 mb-4 bg-white">

       <input type="hidden" name="menuCategory[]" value="\${catName}">

       <!-- ìœ—ì¤„: íŒŒì¼/ì´ë¦„/ê°€ê²©/ì‚­ì œ -->
       <div class="flex flex-wrap items-center gap-2 mb-2">
         <input type="file"  name="menuImage[]" accept="image/*"
                class="w-1/3 border border-gray-300 rounded px-2 py-1">
         <input type="text"  name="menuName[]" placeholder="ë©”ë‰´ëª…"
                class="flex-1 border border-gray-300 rounded px-2 py-1">
         <input type="text"  name="menuPrice[]" placeholder="ê°€ê²©"
                class="w-32 border border-gray-300 rounded px-2 py-1"
                oninput="formatCurrency(this)">
         <button type="button"
                onclick="removeMenu(this)"
                class="text-red-500 text-lg">ğŸ—‘ï¸</button>
       </div>

      <!-- ì„¤ëª…: ì™„ì „ ì•„ë˜ì— ë¶„ë¦¬ëœ ì¤„ë¡œ -->
      <div>
        <input type="text" name="menuDesc[]" placeholder="ë©”ë‰´ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
               class="w-full border border-gray-300 rounded px-3 py-2" />
      </div>

    </div>
  `;


      cont.appendChild(row);
    }

    function removeMenu(btn) {
      btn.parentElement.remove();
      totalMenuCount--;
    }
    function removeCategory(btn) {
      const block = btn.closest('div.border');
      const menus = block.querySelectorAll('input[name="menuName[]"]').length;
      totalMenuCount -= menus;
      block.remove();
    }

    /* ----------------------------------------------------
       ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸ ì¸ì¦ ( /verify-biz )
    ---------------------------------------------------- */
    async function verifyBizNumber() {
      const n1 = document.getElementById('bizNumber1').value.trim();
      const n2 = document.getElementById('bizNumber2').value.trim();
      const n3 = document.getElementById('bizNumber3').value.trim();
      const biz = n1 + n2 + n3;

      const resEl = document.getElementById('bizVerifyResult');
      const nameInp = document.getElementById('businessName');

      if (!/^\d{10}$/.test(biz)) {
        resEl.textContent = 'ì˜¬ë°”ë¥¸ ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì´ 10ìë¦¬ ìˆ«ì)';
        resEl.className = 'text-sm text-red-600';
        return;
      }

      try {
        const r = await fetch('/verify-biz', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ b_no: [biz] })
        });
        const d = await r.json();
        const i = d?.data?.[0];

        if (i && i.b_stt_cd === '01') {
          resEl.textContent = `âœ… ì¸ì¦ ì™„ë£Œ: ${i.b_no}`;
          resEl.className = 'text-sm text-green-600 text-center';
          nameInp.value = i.b_nm || '';
          if (!i.b_nm) nameInp.placeholder = 'ìë™ì…ë ¥ ì‹¤íŒ¨ - ìƒí˜¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”';
        } else {
          resEl.textContent = 'âŒ ë“±ë¡ë˜ì§€ ì•Šì•˜ê±°ë‚˜ íì—…ëœ ì‚¬ì—…ìì…ë‹ˆë‹¤.';
          resEl.className = 'text-sm text-red-600 text-center';
        }
      } catch (err) {
        console.error(err);
        resEl.textContent = 'ì„œë²„ ì˜¤ë¥˜ë¡œ ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
        resEl.className = 'text-sm text-red-600 text-center';
      }
    }

    /* ----------------------------------------------------
       íœ´ëŒ€ì „í™” ì¸ì¦ (í…ŒìŠ¤íŠ¸)
    ---------------------------------------------------- */
    document.getElementById('verifyPhoneButton').addEventListener('click', () => {
      const phone = document.getElementById('ownerPhone').value.trim();
      const resEl = document.getElementById('phoneVerifyResult');
      if (!phone) {
        resEl.textContent = 'í•¸ë“œí° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        resEl.className = 'text-sm text-red-600';
        return;
      }
      resEl.textContent = 'ì¸ì¦ë²ˆí˜¸ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. (í…ŒìŠ¤íŠ¸ ì½”ë“œ: 123456)';
      resEl.className = 'text-sm text-green-600';
    });
    document.getElementById('phoneAuth').addEventListener('blur', function () {
      const code = this.value.trim();
      const resEl = document.getElementById('phoneVerifyResult');
      if (code === '123456') {
        resEl.textContent = 'íœ´ëŒ€ì „í™” ì¸ì¦ ì„±ê³µ.';
        resEl.className = 'text-sm text-green-600';
      } else {
        resEl.textContent = 'ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
        resEl.className = 'text-sm text-red-600';
      }
    });

    /* ----------------------------------------------------
       í—¤ë” / í‘¸í„° í¬í•¨
    ---------------------------------------------------- */
    fetch('/components/header.html')
      .then(r => r.text())
      .then(d => (document.getElementById('header-placeholder').innerHTML = d));
    fetch('/components/footer.html')
      .then(r => r.text())
      .then(d => (document.getElementById('footer-placeholder').innerHTML = d));

    /* ----------------------------------------------------
       í¼ ì œì¶œ (ë“±ë¡)
    ---------------------------------------------------- */
    const form = document.getElementById('businessForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        const fd = new FormData(form);

        /* ì‚¬ì—…ìë²ˆí˜¸ ë³‘í•© */
        const biz =
          document.getElementById('bizNumber1').value.trim() +
          document.getElementById('bizNumber2').value.trim() +
          document.getElementById('bizNumber3').value.trim();
        fd.append('bizNumber', biz);

        /* ê°€ê²© ì½¤ë§ˆ ì œê±° */
        const priceInputs = form.querySelectorAll('input[name="menuPrice[]"]');
        fd.delete('menuPrice[]');
        priceInputs.forEach(i => fd.append('menuPrice[]', i.value.replace(/,/g, '')));

        /* ì´ë©”ì¼ í™•ì • */
        fd.delete('ownerEmail');
        fd.append('ownerEmail', document.getElementById('ownerEmail').value);

        const res = await fetch('/store', { method: 'POST', body: fd });
        if (!res.ok) throw new Error('ì„œë²„ ì‘ë‹µ ì—ëŸ¬');
        const result = await res.json();
        alert('ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        window.location.href = `detail.html?id=${result.storeId}`;
      } catch (err) {
        console.error(err);
        alert('ë°ì´í„° ì „ì†¡ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!');
      }
    });

    /* ----------------------------------------------------
       ìˆ˜ì • ë¡œì§
    ---------------------------------------------------- */
    async function updateData() {
      const storeId = document.getElementById('storeId').value;
      if (!storeId) {
        alert('ìˆ˜ì •í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë“±ë¡ì„ ì§„í–‰í•˜ì„¸ìš”.');
        return;
      }
      try {
        const fd = new FormData(form);
        const priceInputs = form.querySelectorAll('input[name="menuPrice[]"]');
        fd.delete('menuPrice[]');
        priceInputs.forEach(i => fd.append('menuPrice[]', i.value.replace(/,/g, '')));

        const res = await fetch(`/store/${storeId}`, { method: 'PUT', body: fd });
        if (!res.ok) throw new Error('ì„œë²„ ì‘ë‹µ ì—ëŸ¬ (ìˆ˜ì •)');
        alert('ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        window.location.href = `detail.html?id=${storeId}`;
      } catch (err) {
        console.error(err);
        alert('ë°ì´í„° ìˆ˜ì • ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!');
      }
    }
  </script>