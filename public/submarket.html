<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>전통시장 상세</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 min-h-screen">

    <div id="header-container"></div>

    <main class="max-w-6xl mx-auto my-12 px-4">
        <div id="market-detail" class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <!-- 각 칼럼(영역)이 여기서 JS로 채워집니다 -->
        </div>
    </main>

    <div id="footer-container"></div>

    <script>
        // 헤더/푸터 포함
        ['header', 'footer'].forEach(n => {
            fetch(`/components/${n}.html`).then(r => r.text()).then(h => {
                document.getElementById(`${n}-container`).innerHTML = h;
            });
        });

        // 이미지 경로 보정
        function toUrl(path) {
            if (!path) return "";
            return path.startsWith("/uploads/") ? path : "/uploads/" + path;
        }

        // id값 가져오기
        const id = new URLSearchParams(location.search).get('id');
        if (!id) {
            document.getElementById('market-detail').innerHTML =
                '<div class="col-span-4"><p class="text-red-500">ID가 없습니다.</p></div>';
            throw new Error('no id');
        }

        fetch(`/market/${id}`)
            .then(r => r.json())
            .then(d => {
                if (d.success === false) { throw new Error(d.error || '조회 실패'); }
                // 1번 칼럼: 대표사진 + 상호명
                const col1 = `
          <div class="bg-white rounded-2xl shadow p-4 flex flex-col items-center">
            ${d.main_img ? `<img src="${toUrl(d.main_img)}" class="w-full h-40 object-cover rounded-lg mb-4" alt="대표이미지">` : ''}
            <h1 class="text-xl font-bold text-indigo-700 mb-2">${d.market_name}</h1>
          </div>
        `;
                // 2번 칼럼: 설명/운영자 한마디
                const col2 = `
          <div class="bg-yellow-50 rounded-2xl shadow p-4">
            <h2 class="text-lg font-semibold mb-2 text-gray-800">운영자 한마디</h2>
            <p class="whitespace-pre-line">${d.free_pr || "소개글이 없습니다."}</p>
          </div>
        `;
                // 3번 칼럼: 질문/답변
                const col3 = `
          <div class="bg-green-50 rounded-2xl shadow p-4">
            <h2 class="text-lg font-semibold mb-2 text-gray-800">질문 & 답변</h2>
            <p class="text-gray-500">현재 QA 데이터 컬럼이 없어 별도 저장되지 않았습니다.</p>
          </div>
        `;
                // 4번 칼럼: 기타 정보
                const col4 = `
          <div class="bg-purple-50 rounded-2xl shadow p-4">
            <h2 class="text-lg font-semibold mb-2 text-gray-800">시장 정보</h2>
            <ul class="space-y-1 text-sm">
              <li><b>주소:</b> ${d.address}</li>
              ${d.phone ? `<li><b>전화:</b> ${d.phone}</li>` : ''}
              <li><b>운영시간:</b> ${d.opening_hours}</li>
              <li><b>주요 품목·특산물:</b> ${d.main_products}</li>
              ${d.event_info ? `<li><b>이벤트/축제:</b> ${d.event_info}</li>` : ''}
              ${d.facilities ? `<li><b>편의 시설:</b> ${d.facilities}</li>` : ''}
              <li><b>주차장:</b> ${d.parking_available}</li>
              ${d.parking_img ? `<li><img src="${toUrl(d.parking_img)}" class="w-full rounded mt-2" alt="주차장"></li>` : ''}
              ${d.transport_info ? `<li><b>대중교통 안내:</b> ${d.transport_info}</li>` : ''}
              ${d.transport_img ? `<li><img src="${toUrl(d.transport_img)}" class="w-full rounded mt-2" alt="약도"></li>` : ''}
            </ul>
          </div>
        `;
                document.getElementById('market-detail').innerHTML =
                    col1 + col2 + col3 + col4;
            })
            .catch(err => {
                console.error(err);
                document.getElementById('market-detail').innerHTML =
                    '<div class="col-span-4"><p class="text-red-500">데이터를 불러오는 중 오류가 발생했습니다.</p></div>';
            });
    </script>
</body>

</html>