<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>우리동네 전통시장</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .bg-gradient-overlay {
      background: linear-gradient(120deg, rgba(29,78,216,0.6) 0%, rgba(236,72,153,0.45) 100%);
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">

  <div id="header-container"></div>

  <!-- 대표사진 + 상호명 + 슬로건 -->
  <section id="top-section" class="relative h-[320px] md:h-[400px] flex items-end mb-0">
    <div id="main-image-box" class="absolute inset-0 rounded-b-3xl overflow-hidden">
      <img id="main-img" src="" alt="대표이미지" class="w-full h-full object-cover"/>
      <div class="absolute inset-0 bg-gradient-overlay"></div>
    </div>
    <div class="relative z-10 px-6 pb-8 w-full">
      <h1 id="market-name" class="text-3xl md:text-4xl font-extrabold text-white drop-shadow-lg mb-1">상호명</h1>
      <p id="main-products" class="text-lg text-white/90 font-medium drop-shadow-md">주요 품목</p>
    </div>
  </section>

  <main class="max-w-3xl mx-auto px-4">

    <!-- 운영자 한마디/히스토리(Quote카드) -->
    <section class="mt-10 mb-6">
      <div class="bg-white rounded-2xl shadow-xl p-6 border-l-8 border-indigo-400 flex items-start gap-4">
        <svg class="w-8 h-8 text-indigo-400 shrink-0" fill="none" viewBox="0 0 24 24"><path d="M8.625 17A4.125 4.125 0 0 1 4.5 12.875v-.75A8.625 8.625 0 0 1 13.125 3.5h.375a1.125 1.125 0 0 1 1.125 1.125V8A1.125 1.125 0 0 1 13.5 9.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V7.25A2.25 2.25 0 0 1 12.375 5h.375a6.375 6.375 0 0 1 6.375 6.375v1.125A7.5 7.5 0 0 1 8.625 17Z" fill="currentColor"/></svg>
        <blockquote id="free-pr" class="text-gray-800 text-lg leading-relaxed italic">항상 곁에 있는 우리시장 놀러오세요</blockquote>
      </div>
    </section>

    <!-- Q&A(질문/답변), Bubble 카드 슬라이드/리스트 -->
    <section class="mb-8">
      <h2 class="text-2xl font-bold text-indigo-700 mb-4">질문 & 답변</h2>
      <div id="qa-list" class="flex flex-col gap-4">
        <!-- Q&A 카드(버블 스타일) JS로 채움 -->
      </div>
    </section>

    <!-- 주요 정보/시설/이벤트/주차 등 카드 그리드 -->
    <section class="mb-8">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div class="bg-white shadow rounded-xl p-5 flex flex-col items-start">
          <span class="text-gray-500 text-sm mb-1">주소</span>
          <span id="address" class="font-semibold"></span>
        </div>
        <div class="bg-white shadow rounded-xl p-5 flex flex-col items-start">
          <span class="text-gray-500 text-sm mb-1">운영시간</span>
          <span id="opening-hours" class="font-semibold"></span>
        </div>
        <div class="bg-white shadow rounded-xl p-5 flex flex-col items-start">
          <span class="text-gray-500 text-sm mb-1">주차장</span>
          <span id="parking-available" class="font-semibold"></span>
        </div>
        <div class="bg-white shadow rounded-xl p-5 flex flex-col items-start">
          <span class="text-gray-500 text-sm mb-1">편의시설</span>
          <span id="facilities" class="font-semibold"></span>
        </div>
        <div class="bg-white shadow rounded-xl p-5 flex flex-col items-start">
          <span class="text-gray-500 text-sm mb-1">이벤트</span>
          <span id="event-info" class="font-semibold"></span>
        </div>
        <div class="bg-white shadow rounded-xl p-5 flex flex-col items-start">
          <span class="text-gray-500 text-sm mb-1">대중교통</span>
          <span id="transport-info" class="font-semibold"></span>
        </div>
      </div>
    </section>

    <!-- 지도/주차/약도/시장사진 등(옵셔널) -->
    <section class="mb-10">
      <div class="flex flex-col md:flex-row gap-6">
        <div class="flex-1 bg-white rounded-xl shadow p-4">
          <div class="mb-2 text-sm text-gray-500">주차장/시장사진</div>
          <img id="parking-img" src="" class="w-full h-40 object-cover rounded-lg" alt="주차장" style="display:none;">
        </div>
        <div class="flex-1 bg-white rounded-xl shadow p-4">
          <div class="mb-2 text-sm text-gray-500">약도</div>
          <img id="transport-img" src="" class="w-full h-40 object-cover rounded-lg" alt="약도" style="display:none;">
        </div>
      </div>
    </section>

  </main>
  <div id="footer-container"></div>

  <script>
    // 헤더/푸터
    ['header', 'footer'].forEach(n => {
      fetch(`/components/${n}.html`).then(r => r.text()).then(h => {
        document.getElementById(`${n}-container`).innerHTML = h;
      });
    });

    // 이미지 경로 보정
    function toUrl(path) {
      if (!path) return "";
      return path.startsWith("/uploads/") ? path : "/uploads/" + path;
    }

    // 쿼리에서 id 추출
    const id = new URLSearchParams(location.search).get('id');
    if (!id) {
      document.body.innerHTML = '<div class="max-w-xl mx-auto mt-20 text-center text-2xl text-red-600">ID가 없습니다.</div>';
      throw new Error('no id');
    }

    fetch(`/market/${id}`)
      .then(r => r.json())
      .then(d => {
        // 대표사진/상호명/품목
        if (d.main_img) document.getElementById('main-img').src = toUrl(d.main_img);
        document.getElementById('market-name').textContent = d.market_name || "-";
        document.getElementById('main-products').textContent = d.main_products || "";

        // 운영자 한마디(quote)
        document.getElementById('free-pr').textContent = d.free_pr || "소개글이 없습니다.";

        // Q&A 포럼형 카드
        let qas = d.qa_list || [
          { q: "이 시장만의 특별한 점은?", a: "" },
          { q: "운영자가 직접 추천하는 품목은?", a: "" },
          { q: "가족 단위 방문에 적합한가요?", a: "" }
        ];
        let qaHtml = qas.map((qa, i) => `
          <div class="flex gap-3 items-start">
            <div class="bg-indigo-500 text-white rounded-full px-4 py-2 font-bold shadow">Q${i+1}</div>
            <div>
              <div class="font-semibold text-indigo-700 mb-1">${qa.q}</div>
              <div class="bg-white rounded-xl px-4 py-2 shadow min-w-[160px]">${qa.a ? qa.a : "<span class='text-gray-400'>답변 준비중</span>"}</div>
            </div>
          </div>
        `).join("");
        document.getElementById('qa-list').innerHTML = qaHtml;

        // 주요 정보
        document.getElementById('address').textContent = d.address || "-";
        document.getElementById('opening-hours').textContent = d.opening_hours || "-";
        document.getElementById('parking-available').textContent = d.parking_available || "-";
        document.getElementById('facilities').textContent = d.facilities || "-";
        document.getElementById('event-info').textContent = d.event_info || "-";
        document.getElementById('transport-info').textContent = d.transport_info || "-";

        // 주차장사진/약도
        if (d.parking_img) {
          document.getElementById('parking-img').src = toUrl(d.parking_img);
          document.getElementById('parking-img').style.display = "";
        }
        if (d.transport_img) {
          document.getElementById('transport-img').src = toUrl(d.transport_img);
          document.getElementById('transport-img').style.display = "";
        }
      })
      .catch(err => {
        document.body.innerHTML = `<div class="max-w-xl mx-auto mt-20 text-center text-2xl text-red-600">데이터를 불러오는 중 오류가 발생했습니다.</div>`;
        console.error(err);
      });
  </script>
</body>
</html>
