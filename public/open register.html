<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤í”ˆì˜ˆì • ë“±ë¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=de8ed0205bb623fdc8358ceb3c518d29&libraries=services"></script>
</head>

<body class="bg-gray-50">

    <!-- íƒ€ì´í‹€ + ë“±ë¡ ë²„íŠ¼ (flex) -->
    <div class="max-w-3xl mx-auto px-4 mt-10">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-3xl font-bold text-gray-800">ì˜¤í”ˆì˜ˆì •</h2>
            <button id="toggleFormBtn"
                class="bg-blue-600 text-white font-bold px-5 py-2 rounded-lg shadow hover:bg-blue-700 transition">
                ë“±ë¡
            </button>
        </div>

        <!-- ë“±ë¡ í¼ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
        <section id="openFormSection" class="hidden mb-8">
            <form id="openForm" class="bg-white border-2 border-gray-200 p-6 rounded-lg flex flex-col gap-4">
                <!-- ìƒí˜¸ëª… -->
                <div>
                    <label class="block font-medium mb-1">ìƒí˜¸ëª… <span class="text-red-500">*</span></label>
                    <input name="name" type="text" class="w-full border rounded px-3 py-2" required>
                </div>
                <!-- ì˜¤í”ˆì¼ -->
                <div>
                    <label class="block font-medium mb-1">ì˜¤í”ˆì¼ <span class="text-red-500">*</span></label>
                    <input name="openDate" type="date" class="w-full border rounded px-3 py-2" required>
                </div>
                <!-- ì—…ì¢…(ì¹´í…Œê³ ë¦¬) -->
                <div>
                    <label class="block font-medium mb-1">ì—…ì¢…(ì¹´í…Œê³ ë¦¬)</label>
                    <input name="category" type="text" class="w-full border rounded px-3 py-2">
                </div>
                <!-- ì „í™”ë²ˆí˜¸ -->
                <div>
                    <label class="block font-medium mb-1">ì „í™”ë²ˆí˜¸ <span class="text-red-500">*</span></label>
                    <input name="phone" type="text" class="w-full border rounded px-3 py-2" required>
                </div>
                <!-- ì„¤ëª… -->
                <div>
                    <label class="block font-medium mb-1">ì„¤ëª…</label>
                    <textarea name="desc" class="w-full border rounded px-3 py-2"></textarea>
                </div>
                <!-- ì£¼ì†Œ -->
                <!-- ì£¼ì†Œ + ì£¼ì†Œê²€ìƒ‰ ë²„íŠ¼ -->
                <div>
                    <label class="block font-medium mb-1">ì£¼ì†Œ</label>
                    <div class="flex gap-2">
                        <input id="address" name="addr" type="text" class="w-full border rounded px-3 py-2" readonly>
                        <button type="button" onclick="searchAddress()"
                            class="px-3 py-2 bg-blue-500 text-white rounded">ê²€ìƒ‰</button>
                    </div>
                </div>
                <!-- ì§€ë„ ë¯¸ë¦¬ë³´ê¸° -->
                <div id="map" class="rounded my-4" style="width:100%;height:240px;"></div>
                <!-- (í•„ìš”í•˜ë©´) ì¢Œí‘œ hidden input -->
                <input type="hidden" id="lat" name="lat">
                <input type="hidden" id="lng" name="lng">
                <!-- ëŒ€í‘œ ì´ë¯¸ì§€ -->
                <div>
                    <label class="block font-medium mb-1">ëŒ€í‘œ ì´ë¯¸ì§€</label>
                    <input name="img" type="file" accept="image/*" class="w-full border rounded px-3 py-2">
                </div>

                <button type="submit"
                    class="mt-3 py-2 rounded bg-blue-600 text-white font-bold hover:bg-blue-700 shadow">ë“±ë¡</button>
            </form>
        </section>
    </div>

    <!-- ë“±ë¡ëœ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ -->
    <div id="cardList" class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-10"></div>

    <script>
        // (1) ë“±ë¡ í¼ show/hide
        document.getElementById('toggleFormBtn').onclick = function () {
            document.getElementById('openFormSection').classList.toggle('hidden');
        };

        // (2) ë“±ë¡ ì¹´ë“œ ë°ì´í„° (ë©”ëª¨ë¦¬ ì„ì‹œ)
        const cards = [];

        // (3) í¼ ì œì¶œ ì´ë²¤íŠ¸
        document.getElementById('openForm').onsubmit = async function (e) {
            e.preventDefault();
            const fd = new FormData(this);

            // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì²˜ë¦¬
            let imgURL = '';
            const file = fd.get('img');
            if (file && file.size) {
                imgURL = await new Promise(res => {
                    const reader = new FileReader();
                    reader.onload = e => res(e.target.result);
                    reader.readAsDataURL(file);
                });
            }

            // ì¹´ë“œ ë°ì´í„° ìƒì„±
            const card = {
                name: fd.get('name') || '',
                category: fd.get('category') || '',
                desc: fd.get('desc') || '',
                addr: fd.get('addr') || '',
                img: imgURL
            };
            cards.unshift(card); // ìµœì‹ ìˆœ
            this.reset();
            renderCards();
            document.getElementById('openFormSection').classList.add('hidden'); // ë“±ë¡ í›„ í¼ ë‹«ê¸°
        };

        // (4) ì¹´ë“œë¦¬ìŠ¤íŠ¸ ì¶œë ¥ í•¨ìˆ˜
        function renderCards() {
            const list = document.getElementById('cardList');
            if (!cards.length) {
                list.innerHTML = `<div class="text-gray-400 py-12 text-center">ë“±ë¡ëœ ì˜¤í”ˆì˜ˆì • ê°€ê²Œê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                return;
            }
            list.innerHTML = cards.map(card => `
        <div class="bg-white border-2 border-gray-300 shadow-lg rounded-lg p-6 flex flex-col transform transition hover:-translate-y-1 hover:shadow-2xl">
          <div>
            <img src="${card.img || 'https://placehold.co/400x200?text=No+Image'}"
              class="w-full h-44 object-cover rounded mb-4 border" alt="ëŒ€í‘œ ì´ë¯¸ì§€">
          </div>
          <h3 class="text-xl font-bold mb-2">${card.name}</h3>
          <div class="text-sm text-blue-700 font-semibold mb-1">${card.category}</div>
          <div class="text-gray-700 text-sm mb-2">${card.desc}</div>
          <div class="text-gray-500 text-xs flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 12.414a4 4 0 10-5.657 5.657l4.243 4.243a2 2 0 002.828 0l4.243-4.243a8 8 0 10-11.314-11.314 8 8 0 0011.314 11.314z" />
            </svg> 
            ${card.addr}
          </div>
        </div>
      `).join('');
        }
        renderCards(); // ìµœì´ˆ í˜¸ì¶œ

        // ğŸ“¦ ì£¼ì†Œê²€ìƒ‰(ë‹¤ìŒ) + ì¹´ì¹´ì˜¤ ì§€ë„ ì—°ë™

        let map, marker;

        function searchAddress() {
            new daum.Postcode({
                oncomplete: function (data) {
                    document.getElementById('address').value = data.address;
                    updateMapByAddress(data.address);
                }
            }).open();
        }

        window.onload = function () {
            const mapContainer = document.getElementById('map');
            if (!mapContainer) return;
            map = new kakao.maps.Map(mapContainer, {
                center: new kakao.maps.LatLng(37.5665, 126.9780),
                level: 3
            });
            marker = new kakao.maps.Marker({ map: map });
        };

        function updateMapByAddress(address) {
            const geocoder = new kakao.maps.services.Geocoder();
            geocoder.addressSearch(address, function (result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    const lat = result[0].y;
                    const lng = result[0].x;
                    const loc = new kakao.maps.LatLng(lat, lng);
                    map.setCenter(loc);
                    marker.setPosition(loc);
                    document.getElementById('lat').value = lat;
                    document.getElementById('lng').value = lng;
                }
            });
        }

        // ì§€ë„ ë¦¬ì…‹(ë“±ë¡ í›„)
        function resetMap() {
            map.setCenter(new kakao.maps.LatLng(37.5665, 126.9780));
            marker.setPosition(new kakao.maps.LatLng(37.5665, 126.9780));
            document.getElementById('lat').value = '';
            document.getElementById('lng').value = '';
            document.getElementById('address').value = '';
        }
    </script>
</body>

</html>