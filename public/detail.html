<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê°€ê²Œ ìƒì„¸ Â· 3-ì„¹ì…˜ ë ˆì´ì•„ì›ƒ</title>

    <!-- Tailwind -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />

    <!-- ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ API (ë‚˜ì¤‘ì— ì£¼ì†Œ ê²€ìƒ‰ìš©) -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js" defer></script>

</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
    <!-- â”€â”€ (í—¤ë”) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="header-placeholder"></div>

    <!-- â”€â”€ ë©”ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <main class="container mx-auto px-4 py-8 flex-1">
        <div class="flex flex-col lg:flex-row gap-6">

            <!-- â–£ 1. ì™¼ìª½ : ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” + ì§€ë„ -->
            <section class="flex-1 bg-white p-6 rounded shadow flex flex-col gap-6">
                <!-- ğŸ”¹ ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” + ì¸ë„¤ì¼ -->
                <div class="relative">
                    <div id="sliderWrapper" class="w-full h-64 overflow-hidden relative rounded shadow">
                        <div id="sliderImages" class="flex transition-transform duration-500 ease-in-out h-full"></div>
                    </div>

                    <!-- ë°©í–¥ ë²„íŠ¼ - ë¶ˆíˆ¬ëª…Â·ë¼ìš´ë“œ ê°œì„  -->
                    <button id="prevBtn"
                        class="absolute left-2 top-1/2 -translate-y-1/2 bg-black text-white rounded-full px-3 py-1 opacity-70 hover:opacity-100 z-10">â€¹</button>
                    <button id="nextBtn"
                        class="absolute right-2 top-1/2 -translate-y-1/2 bg-black text-white rounded-full px-3 py-1 opacity-70 hover:opacity-100 z-10">â€º</button>

                    <!-- ğŸ”¹ ì¸ë„¤ì¼ ì»¨í…Œì´ë„ˆ -->
                    <div id="thumbBox" class="flex gap-2 justify-center mt-3"></div>
                </div>


                <!-- ì§€ë„ -->
                <div class="bg-gray-50 border rounded-lg p-4 flex-1">
                    <h2 class="text-lg font-semibold mb-2">ê°€ê²Œ ìœ„ì¹˜</h2>
                    <p id="addressText" class="text-sm text-gray-700 mb-2"></p>
                    <div id="map" class="w-full h-40 bg-gray-200 flex items-center justify-center text-gray-600">
                        ì§€ë„ ë¡œë“œ ì¤‘â€¦
                    </div>
                </div>
            </section>

            <!-- â–£ 2. ê°€ìš´ë° : ìƒí˜¸Â·ì •ë³´Â·ì„¤ëª… -->
            <section class="flex-1 bg-white p-6 rounded shadow flex flex-col gap-4">
                <h2 id="businessNameHeader" class="text-3xl font-bold text-center border-b pb-3"></h2>

                <div class="bg-gray-50 p-4 rounded border">
                    <h3 class="text-xl font-bold mb-2">ê¸°ë³¸ ì •ë³´</h3>
                    <p id="businessType" class="text-xl"></p>
                    <p id="deliveryOption" class="text-xl"></p>
                    <p id="businessHours" class="text-xl"></p>
                </div>

                <div class="bg-gray-50 p-4 rounded border">
                    <h3 class="text-xl font-bold mb-2">ì„œë¹„ìŠ¤ ë‚´ìš©</h3>
                    <p id="serviceDetails" class="text-gray-700"></p>
                </div>

                <div class="bg-gray-50 p-4 rounded border">
                    <h3 class="text-xl font-bold mb-2">ì´ë²¤íŠ¸</h3>
                    <ul id="eventsList" class="list-disc pl-6 space-y-1"></ul>
                </div>

                <div class="bg-gray-50 p-4 rounded border">
                    <h3 class="text-xl font-bold mb-2">ê¸°íƒ€ ì •ë³´</h3>
                    <ul id="infoEtcList" class="list-disc pl-6 space-y-1"></ul>
                </div>

                <div class="bg-gray-50 p-4 rounded border">
                    <h3 class="text-xl font-bold mb-2">ì¶”ê°€ ì •ë³´</h3>
                    <ul id="additionalInfoList" class="list-disc pl-6 space-y-1"></ul>
                </div>

                <div class="bg-gray-50 p-4 rounded border">
                    <h3 class="text-xl font-bold mb-2 border-b pb-1">ì—°ë½ì²˜</h3>
                    <p id="contactPhone" class="text-gray-700"></p>
                    <p id="contactHomepage" class="text-gray-700"></p>
                    <p id="contactInstagram" class="text-gray-700"></p>
                    <p id="contactFacebook" class="text-gray-700"></p>
                </div>

                <div class="bg-gray-50 p-4 rounded border">
                    <h3 class="text-xl font-bold mb-2 border-b pb-1">ì¶”ê°€ ì„¤ëª…</h3>
                    <p id="additionalDesc" class="text-gray-700"></p>
                </div>
            </section>

            <!-- â–£ 3. ì˜¤ë¥¸ìª½ : ë©”ë‰´ + ì¥ë°”êµ¬ë‹ˆ(ìƒì‹œ í‘œì‹œ) -->
            <section class="w-full lg:w-1/3 flex flex-col gap-4">
                <div id="menuBox" class="bg-white border rounded p-4 shadow overflow-y-auto"
                    style="max-height: 1000px;">
                    <h2 class="text-2xl font-bold border-b border-gray-300 pb-2 mb-4 text-center">ë©”ë‰´</h2>
                    <div id="menuList" class="flex flex-col gap-4"></div>
                </div>

                <!-- ì¥ë°”êµ¬ë‹ˆ -->
                <div id="cartBox" class="bg-white border rounded p-4 shadow">
                    <h3 class="text-xl font-bold mb-2">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</h3>
                    <ul id="cartList" class="space-y-2 max-h-60 overflow-auto"></ul>
                    <div class="border-t mt-3 pt-3 text-right">
                        <p class="font-semibold">ì´í•©: <span id="totalPrice">0</span>ì›</p>
                        <button id="checkoutBtn"
                            class="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded">
                            ê²°ì œí•˜ê¸°
                        </button>
                    </div>
                </div>
            </section>

        </div><!-- //flex -->
    </main>

    <!-- â”€â”€ (í‘¸í„°) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="footer-placeholder"></div>

    <script type="module">
        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 0. ê³µí†µ í—¬í¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        const $ = (id) => document.getElementById(id);
        const params = new URLSearchParams(location.search);
        const storeId = params.get("id") || 1;

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1. í—¤ë” Â· í‘¸í„° ì‚½ì… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        window.addEventListener("DOMContentLoaded", () => {
            fetch("/components/header.html")
                .then(r => r.text())
                .then(html => { $("header-placeholder").innerHTML = html; });

            fetch("/components/footer.html")
                .then(r => r.text())
                .then(html => { $("footer-placeholder").innerHTML = html; });
        });

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2. Kakao SDK ë™ì  ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function loadKakaoSdk() {
            console.log("ğŸ“¦ Kakao SDK ë¡œë”© ì‹œì‘");
            return fetch("/kakao-key")
                .then(r => r.json())
                .then(({ key }) => new Promise((resolve, reject) => {
                    if (!key) {
                        console.error("âŒ Kakao key not found");
                        return reject("Kakao key not found");
                    }

                    const s = document.createElement("script");
                    s.src = `https://dapi.kakao.com/v2/maps/sdk.js?appkey=${key}&autoload=false&libraries=services,clusterer`;
                    s.defer = true;

                    s.onload = () => {
                        console.log("âœ… Kakao SDK script ë¡œë“œ ì™„ë£Œ");
                        kakao.maps.load(() => {
                            console.log("âœ… kakao.maps.load ì‹¤í–‰ ì™„ë£Œ");
                            resolve();
                        });
                    };

                    s.onerror = () => {
                        console.error("âŒ Kakao SDK script ë¡œë”© ì‹¤íŒ¨");
                        reject("Kakao SDK load error");
                    };

                    document.head.appendChild(s);
                }));
        }

        /* âœ… initMap í•¨ìˆ˜ ì¶”ê°€ ------------------------------ */
        async function initMap(storeAddress, storeName = "") {
            try {
                await loadKakaoSdk();

                const geocoder = new kakao.maps.services.Geocoder();
                geocoder.addressSearch(storeAddress, (result, status) => {
                    if (status !== kakao.maps.services.Status.OK) {
                        console.warn("âŒ ì£¼ì†Œ ê²€ìƒ‰ ì‹¤íŒ¨:", status);
                        return;
                    }

                    const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                    const map = new kakao.maps.Map(document.getElementById("map"), {
                        center: coords,
                        level: 3
                    });

                    // ë§ˆì»¤ ì¶”ê°€
                    const marker = new kakao.maps.Marker({
                        map,
                        position: coords
                    });

                    // ì¸í¬ìœˆë„ìš°
                    if (storeName) {
                        const iwContent = `<div style="padding:5px 10px;font-size:13px;">${storeName}</div>`;
                        const infowindow = new kakao.maps.InfoWindow({
                            content: iwContent
                        });
                        infowindow.open(map, marker);
                    }
                });

            } catch (error) {
                console.error("ğŸ›‘ initMap() ì˜¤ë¥˜:", error);
            }
        }


        const slider = {                // ğŸ”¹ ì¸ë„¤ì¼ ê¸°ëŠ¥ í¬í•¨
            imgs: [],
            idx: 0,

            init(arr) {
                this.imgs = arr.length
                    ? arr
                    : ["/images/no-image.png"];
                $("sliderImages").innerHTML = this.imgs
                    .map(u => `<img src="${u}" class="w-full h-64 flex-shrink-0 object-cover" />`)
                    .join("");
                this.renderThumbs();
                this.update();
                $("prevBtn").onclick = () => this.move(-1);
                $("nextBtn").onclick = () => this.move(1);
            },

            renderThumbs() {
                const box = $("thumbBox"); box.innerHTML = "";
                this.imgs.forEach((src, i) => {
                    const t = document.createElement("img");
                    t.src = src;
                    t.className = "w-16 h-16 object-cover rounded cursor-pointer border hover:opacity-80";
                    t.onclick = () => { this.idx = i; this.update(); };
                    box.appendChild(t);
                });
            },

            move(step) {
                this.idx = (this.idx + step + this.imgs.length) % this.imgs.length;
                this.update();
            },

            update() {
                $("sliderImages").style.transform = `translateX(${-this.idx * 100}%)`;
                [...$("thumbBox").children].forEach((el, i) => {
                    el.classList.toggle("ring-2", i === this.idx);
                    el.classList.toggle("ring-blue-500", i === this.idx);
                });
            }
        };

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 4. ì¥ë°”êµ¬ë‹ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1) ì „ì—­ ì¹´íŠ¸ ë°°ì—´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        const cart = [];

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2) ê°™ì€ ë©”ë‰´ í•©ì‚° ë¡œì§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function addToCart(item) {
            const found = cart.find(c => c.menuName === item.menuName);
            if (found) {
                found.quantity += item.quantity;          // ì´ë¯¸ ìˆìœ¼ë©´ ìˆ˜ëŸ‰ ì¦ê°€
            } else {
                cart.push({ ...item });                   // ì—†ìœ¼ë©´ ìƒˆ í•­ëª©
            }
            renderCart();
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 3) ì¥ë°”êµ¬ë‹ˆ ë Œë” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function renderCart() {
            const ul = $("cartList");
            ul.innerHTML = "";

            let sum = 0;

            cart.forEach((item, index) => {
                const price = Number(item.menuPrice) || 0;
                const qty = Number(item.quantity) || 1;
                const total = price * qty;
                sum += total;

                const li = document.createElement("li");
                li.className = "flex justify-between items-center text-lg py-2";

                li.innerHTML = `
                  <span>${item.menuName} Ã— ${qty}</span>
                  <span class="text-xl font-bold">${total.toLocaleString()}ì›</span>
                  <button class="removeBtn bg-red-100 text-red-600 px-2 py-1 rounded text-sm ml-2"
                          data-index="${index}">
                    ì‚­ì œ
                  </button>
                `;
                ul.appendChild(li);
            });

            /* í•­ëª© ì‚­ì œ */
            ul.querySelectorAll(".removeBtn").forEach(btn => {
                btn.onclick = () => {
                    const idx = btn.dataset.index;
                    cart.splice(idx, 1);
                    renderCart();
                };
            });

            $("totalPrice").className = "text-xl font-bold";
            $("totalPrice").textContent = sum.toLocaleString();
        }

        /* ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ í—¬í¼ */
        const setList = (wrapId, arr = []) => {
            const ul = $(wrapId); ul.innerHTML = "";
            arr.forEach(t => {
                const li = document.createElement("li");
                li.textContent = t;
                ul.appendChild(li);
            });
        };

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 5. ë©”ì¸ ì‹¤í–‰ (async IIFE) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        (async () => {
            try {
                /* 5-1 Kakao SDK ë¨¼ì € ì¤€ë¹„ */
                await loadKakaoSdk();

                /* 5-2 ê°€ê²Œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° */
                const res = await fetch(`/store/${storeId}`);
                if (!res.ok) throw new Error("Store API error");
                const { store, menu = [] } = await res.json();
                window.menuDebug = menu;

                /* 5-3 ìŠ¬ë¼ì´ë” Â· ê¸°ë³¸ ì •ë³´ */
                slider.init(store.images || []);
                console.log("â–¶ store", store);

                $("businessNameHeader").textContent = store.businessName ?? "ìƒí˜¸ëª… ì—†ìŒ";
                $("businessType").innerHTML = `<strong>ì—…ì¢…:</strong> ${store.businessType ?? ""}`;
                $("deliveryOption").innerHTML = `<strong>ë°°ë‹¬:</strong> ${store.deliveryOption ?? ""}`;
                $("businessHours").innerHTML = `<strong>ì˜ì—…ì‹œê°„:</strong> ${store.businessHours ?? ""}`;
                $("serviceDetails").textContent = store.serviceDetails ?? "";
                $("serviceDetails").classList.add("text-lg", "text-gray-800");

                /* ê³ ê° ì´ë²¤íŠ¸ */
                setList("eventsList", store.events);  // ê·¸ëŒ€ë¡œ ì‚¬ìš©

                /* â”€â”€ â€˜ì¶”ê°€ ì •ë³´(ê¸°íƒ€)â€™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
                const infoList = $("infoEtcList");    // â† ë°”ë€ ID
                if (infoList) {
                    infoList.innerHTML = `
                      <li>ì¥ì• ì¸ í¸ì˜ì‹œì„¤: ${store.facility ?? "ì •ë³´ ì—†ìŒ"}</li>
                      <li>ë°˜ë ¤ë™ë¬¼ ì¶œì…:   ${store.pets ?? "ì •ë³´ ì—†ìŒ"}</li>
                      <li>ì£¼ì°¨ ì •ë³´:       ${store.parking ?? "ì •ë³´ ì—†ìŒ"}</li>
                    `;
                }

                /* â”€â”€ ì—°ë½ì²˜ Â· í™ˆí˜ì´ì§€ Â· SNS Â· ì¶”ê°€ ì„¤ëª… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
                if ($("contactPhone"))
                    $("contactPhone").textContent = store.contactPhone ?? "";

                // í™ˆí˜ì´ì§€
                if ($("contactHomepage")) {
                    $("contactHomepage").innerHTML = store.homepage
                        ? `<strong>í™ˆí˜ì´ì§€:</strong> <a href="${store.homepage}" class="text-blue-600 underline" target="_blank">${store.homepage}</a>`
                        : "";
                }

                // ì¸ìŠ¤íƒ€ê·¸ë¨
                if ($("contactInstagram")) {
                    $("contactInstagram").innerHTML = store.instagram
                        ? `<strong>ì¸ìŠ¤íƒ€ê·¸ë¨:</strong> <a href="${store.instagram}" class="text-blue-600 underline" target="_blank">${store.instagram}</a>`
                        : "";
                }

                // í˜ì´ìŠ¤ë¶
                if ($("contactFacebook")) {
                    $("contactFacebook").innerHTML = store.facebook
                        ? `<strong>í˜ì´ìŠ¤ë¶:</strong> <a href="${store.facebook}" class="text-blue-600 underline" target="_blank">${store.facebook}</a>`
                        : "";
                }

                /* ì¶”ê°€ ì„¤ëª… */
                if ($("additionalDesc"))
                    $("additionalDesc").textContent = store.additionalDesc ?? "";

                const menuList = $("menuList");
                menuList.innerHTML = "";
                menuList.className = "flex flex-col gap-4 max-h-[600px] overflow-y-auto";

                // ê·¸ë£¹í™”
                const menuByCategory = {};
                menu.forEach(it => {
                    const raw = it.category ?? it.menu_category ?? it.cat ?? '';
                    const category = raw.replace(/\u3000/g, '').trim() || 'ê¸°íƒ€';

                    if (!menuByCategory[category]) menuByCategory[category] = [];
                    menuByCategory[category].push(it);
                });

                // ì¶œë ¥
                Object.entries(menuByCategory).forEach(([category, items]) => {
                    // ğŸ”¹ ê·¸ë£¹ ë¬¶ìŒ ì»¨í…Œì´ë„ˆ
                    const group = document.createElement("div");

                    // ğŸ”¹ ì¹´í…Œê³ ë¦¬ ì œëª©
                    const title = document.createElement("h3");
                    title.textContent = "ğŸ± " + category;
                    title.className = "text-xl font-bold mt-6 mb-2 text-gray-800"; // â† ë³´ì´ì§€ ì•ŠëŠ” ë¬¸ì œ ë°©ì§€
                    group.appendChild(title);

                    items.forEach(it => {
                        const box = document.createElement("div");
                        // â‘  ì¹´ë“œ ë°”ê¹¥ ë°•ìŠ¤
                        box.className =
                            "flex items-center gap-4 p-4 bg-white rounded-lg shadow-sm border";

                        // â‘¡ ì¹´ë“œ ë‚´ë¶€ HTML
                        box.innerHTML = `
                          <img src="${it.menuImageUrl || '/images/no-thumb.png'}"
                               class="w-24 h-24 object-cover rounded-md" />

                          <div class="flex-1 flex flex-col justify-center">
                            <div class="text-xl font-bold mb-0.5">${it.menuName}</div>
                            <div class="text-lg font-bold text-gray-700">${Number(it.menuPrice).toLocaleString()}ì›</div>
                          </div>

                          <div class="flex flex-col items-center justify-center gap-1 shrink-0">
                            <div class="flex items-center gap-1">
                              <button class="decrease px-2 py-1 bg-gray-200 rounded">ï¼</button>
                              <span  class="quantity w-6 text-center">1</span>
                              <button class="increase px-2 py-1 bg-gray-200 rounded">ï¼‹</button>
                            </div>
                            <button class="addBtn px-3 py-1 bg-blue-600 text-white text-sm rounded">ë‹´ê¸°</button>
                          </div>
                        `;

                        console.log("âœ… ì¶œë ¥ëœ ì¹´í…Œê³ ë¦¬:", category, "â†’", items.length, "ê°œ");

                        // ìˆ˜ëŸ‰ ì¡°ì ˆ
                        let qty = 1;
                        const qtySpan = box.querySelector(".quantity");
                        box.querySelector(".decrease").onclick = () => {
                            if (qty > 1) qtySpan.textContent = --qty;
                        };
                        box.querySelector(".increase").onclick = () => {
                            qtySpan.textContent = ++qty;
                        };
                        box.querySelector(".addBtn").onclick = () => {
                            addToCart({ ...it, quantity: qty });
                        };

                        group.appendChild(box);
                    });

                    menuList.appendChild(group); // âœ… ê·¸ë£¹ì„ í†µì§¸ë¡œ ì¶”ê°€
                });


                /* 5-5 Kakao ì§€ë„ í‘œì‹œ (ê¸°ì¡´ ì§€ì˜¤ì½”ë”© ë¸”ë¡) */
                const geocoder = new kakao.maps.services.Geocoder();
                geocoder.addressSearch(store.address, (result, status) => {
                    console.log("ğŸ“ì£¼ì†Œ:", store.address);       // ì£¼ì†Œ í™•ì¸
                    console.log("ğŸ—ºï¸ì§€ì˜¤ì½”ë”© ê²°ê³¼:", result);     // ì¢Œí‘œ ê²°ê³¼ ë°°ì—´
                    console.log("ğŸ“¡ìƒíƒœ ì½”ë“œ:", status);         // ì‘ë‹µ ìƒíƒœ ì½”ë“œ

                    if (status !== kakao.maps.services.Status.OK) {
                        console.warn("âŒ ì§€ì˜¤ì½”ë”© ì‹¤íŒ¨: ìƒíƒœ =", status);
                        return;
                    }

                    const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                    const map = new kakao.maps.Map($("map"), { center: coords, level: 3 });
                    new kakao.maps.Marker({ map, position: coords });
                    new kakao.maps.InfoWindow({
                        map, position: coords,
                        content: `<div style="padding:5px">${store.businessName}</div>`
                    });
                    $("addressText").textContent = store.address;
                });

                // âœ… ì£¼ì†Œ ì •ì œ
                function cleanAddress(fullAddress) {
                    let cleaned = fullAddress.replace(/^\d{5}\s*/, "");   // ì•ìë¦¬ ìš°í¸ë²ˆí˜¸ ì œê±°
                    cleaned = cleaned.replace(/\s+\d+$/, "");             // ëìë¦¬ ìƒì„¸ì£¼ì†Œ ì œê±°
                    return cleaned.trim();
                }

                const mapAddress = cleanAddress(store.address);
                initMap(mapAddress, store.businessName);

                /* âœ… initMap ë³„ë„ í˜¸ì¶œ ì¶”ê°€ (í•¨ìˆ˜ ì´ë™ ìš”êµ¬ ë°˜ì˜) */
                initMap(store.address, store.businessName);

            } catch (err) {
                console.error("ë¡œë“œ ì˜¤ë¥˜:", err);
                // ì—ëŸ¬ ë°œìƒ ì‹œ ìŠ¬ë¼ì´ë”ì— ê¸°ë³¸ ì´ë¯¸ì§€ ì‚½ì…
                const sliderImages = $("sliderImages");
                if (sliderImages) {
                    sliderImages.innerHTML = `
                      <img src="/images/no-image.png"
                           class="w-full h-64 flex-shrink-0 object-cover" />
                 `;
                }
            }
        })();
    </script>

</body>

</html>