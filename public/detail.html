<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í™ê¸¸ë™ë™ë¬¼ë³‘ì› ìƒì„¸ í˜ì´ì§€</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1DA1F2',
            secondary: '#657786'
          }
        }
      }
    };
  </script>
  
  <!-- ì¹´ì¹´ì˜¤ ì§€ë„ API -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js" defer></script>
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_APP_KEY&libraries=services" defer></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
  <!-- í—¤ë” -->
  <header class="bg-white shadow-md py-4">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-gray-800">My Website</h1>
      <nav class="space-x-4">
        <a href="#" class="text-gray-600 hover:text-primary">Home</a>
        <a href="#" class="text-gray-600 hover:text-primary">List</a>
        <a href="#" class="text-gray-600 hover:text-primary">Contact</a>
      </nav>
    </div>
  </header>
  
  <!-- ë©”ì¸ -->
  <main class="container mx-auto px-4 py-8 flex-1">
    <!-- ì¢Œìš° ì„¹ì…˜ (gridì— h-full, items-stretch ì ìš©) -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-full items-stretch">
      <!-- ì™¼ìª½ ì„¹ì…˜ -->
      <section class="bg-white p-6 rounded shadow flex flex-col gap-6 h-full">
        <!-- ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” -->
        <div class="relative">
          <!-- ê¸°ë³¸ ë”ë¯¸ ì´ë¯¸ì§€ ëŒ€ì‹  fetch í›„ ë™ì  ì—…ë°ì´íŠ¸ -->
          <img id="sliderImage" src="https://via.placeholder.com/600x400?text=IMAGE1" alt="ê°€ê²Œ ì´ë¯¸ì§€" class="w-full h-64 object-cover rounded shadow mb-2">
          <button id="prevBtn" class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white rounded px-3 py-1">ì´ì „</button>
          <button id="nextBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white rounded px-3 py-1">ë‹¤ìŒ</button>
        </div>
        
        <!-- ì§€ë„ -->
        <div class="bg-gray-200 border border-gray-400 rounded-lg p-4">
          <h2 class="text-lg font-semibold mb-2">ê°€ê²Œ ìœ„ì¹˜</h2>
          <!-- ì£¼ì†ŒëŠ” fetch í›„ ì—…ë°ì´íŠ¸ -->
          <p id="addressText" class="text-sm text-gray-700 mb-2">ì£¼ì†Œ ì—†ìŒ</p>
          <div id="map" class="w-full h-40 bg-gray-300 flex items-center justify-center text-gray-700">
            ì§€ë„ ë¡œë“œ ì¤‘...
          </div>
          <button onclick="openKakaoMap()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ë³´ê¸°</button>
        </div>
        
        <!-- ë©”ë‰´ ë°•ìŠ¤ -->
        <div id="menuBox" class="bg-gray-50 border border-gray-300 rounded p-4 overflow-hidden transition-all duration-300 max-h-[13rem] hover:max-h-[2000px]">
          <h2 class="text-lg font-bold mb-4">ë©”ë‰´</h2>
          <!-- ë©”ë‰´ í•­ëª©ë“¤ì€ fetch í›„ ë™ì  ìƒì„± -->
          <ul id="menuList" class="space-y-2"></ul>
        </div>
      </section>
      
      <!-- ì˜¤ë¥¸ìª½ ì„¹ì…˜ (ê¸°ì¡´ í‹€ ê·¸ëŒ€ë¡œ; fetch í›„ ê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸) -->
      <section class="bg-white p-6 rounded shadow flex flex-col gap-4 h-full">
        <!-- ê°€ê²Œëª…ì€ fetch í›„ ì—…ë°ì´íŠ¸ -->
        <h2 id="businessNameHeader" class="text-3xl font-bold text-gray-800 border-b pb-3">ìƒí˜¸ëª…</h2>
        <div>
          <p id="businessType" class="text-lg"><strong>ì—…ì¢…:</strong> </p>
          <p id="deliveryOption" class="text-lg"><strong>ë°°ë‹¬:</strong> </p>
          <p id="businessHours" class="text-lg"><strong>ì˜ì—…ì‹œê°„:</strong> </p>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì„œë¹„ìŠ¤ ë‚´ìš©</h3>
          <p id="serviceDetails" class="text-gray-700"></p>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì´ë²¤íŠ¸</h3>
          <ul id="eventsList" class="list-disc pl-6 space-y-1"></ul>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì¶”ê°€ ì •ë³´</h3>
          <ul id="additionalInfoList" class="list-disc pl-6 space-y-1"></ul>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì—°ë½ì²˜</h3>
          <p id="contactPhone"></p>
          <p id="contactHomepage"></p>
          <!-- ì¸ìŠ¤íƒ€ê·¸ë¨, í˜ì´ìŠ¤ë¶ ì¶”ê°€ ê°€ëŠ¥ -->
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì¶”ê°€ ì„¤ëª…</h3>
          <p id="additionalDesc" class="text-gray-700"></p>
        </div>
      </section>
    </div>
  </main>
  
  <!-- í‘¸í„° -->
  <footer class="bg-gray-200 py-4">
    <div class="container mx-auto px-4 text-center text-gray-600">
      Â© 2025 MyWebsite. All rights reserved.
    </div>
  </footer>
  
  <!-- ê³ ì •í˜• ì¥ë°”êµ¬ë‹ˆ/ê²°ì œì°½ (í™”ë©´ ìš°ì¸¡ í•˜ë‹¨ì— fixed) -->
  <div id="cartBox" class="fixed bottom-4 right-4 bg-white shadow-lg rounded-lg border border-gray-300 w-80 max-h-96 overflow-y-auto p-4 hidden z-50">
    <h3 class="text-xl font-bold mb-2">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</h3>
    <ul id="cartList" class="space-y-2"></ul>
    <div class="border-t mt-3 pt-3 text-right">
      <p class="font-semibold">ì´í•©: <span id="totalPrice">0</span>ì›</p>
      <button id="checkoutBtn" class="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">ê²°ì œí•˜ê¸°</button>
    </div>
  </div>
  
  <!-- ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // =============================
    // 1. ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” (ê¸°ë³¸ ë”ë¯¸ -> ì„œë²„ ì—…ë°ì´íŠ¸ ì‹œ êµì²´)
    let images = [
      "https://via.placeholder.com/600x400?text=IMAGE1",
      "https://via.placeholder.com/600x400?text=IMAGE2",
      "https://via.placeholder.com/600x400?text=IMAGE3"
    ];
    let currentIndex = 0;
    const sliderImage = document.getElementById("sliderImage");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    prevBtn.addEventListener("click", () => {
      currentIndex = (currentIndex - 1 + images.length) % images.length;
      sliderImage.src = images[currentIndex];
    });
    nextBtn.addEventListener("click", () => {
      currentIndex = (currentIndex + 1) % images.length;
      sliderImage.src = images[currentIndex];
    });
    
    // =============================
    // 2. ì¹´ì¹´ì˜¤ë§µ: ì£¼ì†Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì§€ë„ í‘œì‹œ & "ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ë³´ê¸°" ë²„íŠ¼
    function openKakaoMap() {
      const addr = document.getElementById("addressText").textContent;
      const url = `https://map.kakao.com/?q=${encodeURIComponent(addr)}`;
      window.open(url, "_blank");
    }
    
    window.addEventListener("DOMContentLoaded", () => {
      // =============================
      // 3. ì„œë²„ì—ì„œ ë™ì  ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get("id") || 1; // id ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ 1
      const baseUrl = location.hostname === "localhost" 
                      ? "http://localhost:3000" 
                      : "https://port-0-my-store-project-new-m9aoa4x2ff58c5d7.sel4.cloudtype.app";
      
      fetch(`${baseUrl}/store/${id}`)
        .then(res => res.json())
        .then(data => {
          // ì„œë²„ì—ì„œ ë°˜í™˜ëœ ë°ì´í„° êµ¬ì¡°: { hospital: { ... }, menu: [ ... ] }
          const hospital = data.hospital;
          const menuData = data.menu;
          
          // 3-1. ì˜¤ë¥¸ìª½ ì„¹ì…˜ (ê°€ê²Œ ì •ë³´) ë™ì  ì—…ë°ì´íŠ¸
          document.getElementById("businessNameHeader").textContent = hospital.businessName;
          document.getElementById("businessType").innerHTML = `<strong>ì—…ì¢…:</strong> ${hospital.businessType}`;
          document.getElementById("deliveryOption").innerHTML = `<strong>ë°°ë‹¬:</strong> ${hospital.deliveryOption}`;
          document.getElementById("businessHours").innerHTML = `<strong>ì˜ì—…ì‹œê°„:</strong> ${hospital.businessHours}`;
          document.getElementById("serviceDetails").textContent = hospital.serviceDetails;
          document.getElementById("eventsList").innerHTML = `
            <li>${hospital.event1}</li>
            <li>${hospital.event2}</li>
          `;
          document.getElementById("additionalInfoList").innerHTML = `
            <li><strong>ì¥ì• ì¸ í¸ì˜ì‹œì„¤:</strong> ${hospital.facility}</li>
            <li><strong>ë°˜ë ¤ë™ë¬¼ ì¶œì…:</strong> ${hospital.pets}</li>
            <li><strong>ì£¼ì°¨:</strong> ${hospital.parking}</li>
          `;
          document.getElementById("contactPhone").innerHTML = `<strong>ì „í™”ë²ˆí˜¸:</strong> ${hospital.contactPhone}`;
          document.getElementById("contactHomepage").innerHTML = `<strong>í™ˆí˜ì´ì§€:</strong> <a href="${hospital.homepage}" target="_blank" class="text-blue-600 underline">${hospital.homepage}</a>`;
          document.getElementById("additionalDesc").textContent = hospital.additionalDesc;
          
          // 3-2. ì™¼ìª½ ì„¹ì…˜ - ì§€ë„ ì£¼ì†Œ ì—…ë°ì´íŠ¸ ë° ì§€ë„ ì¬í‘œì‹œ
          document.getElementById("addressText").textContent = hospital.address;
          const mapContainer = document.getElementById("map");
          const mapOption = {
            center: new kakao.maps.LatLng(37.5665, 126.9780),
            level: 3
          };
          const map = new kakao.maps.Map(mapContainer, mapOption);
          const geocoder = new kakao.maps.services.Geocoder();
          geocoder.addressSearch(hospital.address, (result, status) => {
            if (status === kakao.maps.services.Status.OK) {
              const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
              new kakao.maps.Marker({ map: map, position: coords });
              map.setCenter(coords);
            }
          });
          
          // 3-3. ì™¼ìª½ ì„¹ì…˜ - ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” ì—…ë°ì´íŠ¸ (ì„œë²„ì—ì„œ ì´ë¯¸ì§€ 3ì¥ì´ ìˆë‹¤ê³  ê°€ì •)
          if (hospital.images && Array.isArray(hospital.images) && hospital.images.length > 0) {
            images = hospital.images;
            currentIndex = 0;
            sliderImage.src = images[0];
          }
          
          // 3-4. ì™¼ìª½ ì„¹ì…˜ - ë©”ë‰´ ë™ì  ìƒì„± (ì„œë²„ì—ì„œ ë©”ë‰´ ë°ì´í„° ì‚¬ìš©; ì˜ˆ: 3ê°œ ë©”ë‰´)
          const menuList = document.getElementById("menuList");
          menuList.innerHTML = "";
          if (menuData && Array.isArray(menuData) && menuData.length > 0) {
            menuData.forEach((item) => {
              const li = document.createElement("li");
              li.className = "relative group flex items-center gap-3 border-b pb-2 cursor-pointer menu-item";
              li.dataset.name = item.menuName;
              li.dataset.price = item.menuPrice;
              li.innerHTML = `
                <img src="${item.menuImageUrl || 'https://via.placeholder.com/80?text=NOIMAGE'}" 
                     alt="${item.menuName}" class="w-16 h-16 object-cover rounded border">
                <span class="font-semibold text-gray-800">${item.menuName}</span>
                <span class="ml-auto text-gray-600">${Number(item.menuPrice).toLocaleString()}ì›</span>
                <div class="absolute left-0 top-full mt-1 w-max opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-white border p-2 shadow-lg z-50">
                  <p class="text-sm text-gray-800">${item.menuName} ì¶”ê°€ ì„¤ëª…</p>
                </div>
              `;
              menuList.appendChild(li);
            });
            // ë©”ë‰´ ë™ì  ìƒì„± í›„ ì´ë²¤íŠ¸ ë°”ì¸ë”©
            bindMenuItemEvents();
          } else {
            menuList.innerHTML = "<li>ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";
          }
        })
        .catch(err => {
          console.error("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨", err);
          alert("ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        });
    });
    
    // =============================
    // 4. ë©”ë‰´ í•­ëª© í´ë¦­ ì‹œ ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ (ê³ ì •í˜• ê²°ì œì°½)
    let cart = [];
    function bindMenuItemEvents() {
      document.querySelectorAll('.menu-item').forEach(item => {
        item.addEventListener('click', () => {
          const name = item.dataset.name;
          const price = parseInt(item.dataset.price, 10);
          const found = cart.find(i => i.name === name);
          if (found) {
            found.quantity++;
          } else {
            cart.push({ name, price, quantity: 1 });
          }
          updateCart();
        });
      });
    }
    
    function updateCart() {
      const cartList = document.getElementById("cartList");
      const totalPriceEl = document.getElementById("totalPrice");
      cartList.innerHTML = "";
      let total = 0;
      cart.forEach((item, idx) => {
        total += item.price * item.quantity;
        const div = document.createElement("div");
        div.className = "flex items-center justify-between border-b pb-2";
        div.innerHTML = `
          <div>
            <span class="font-semibold">${item.name}</span>
            <span class="ml-2 text-gray-600">${item.price}ì›</span>
          </div>
          <div class="flex items-center">
            <button class="decrease border px-2">-</button>
            <span class="mx-2">${item.quantity}</span>
            <button class="increase border px-2">+</button>
            <button class="delete border px-2 ml-2 text-red-500">ì‚­ì œ</button>
          </div>
        `;
        div.querySelector(".increase").onclick = () => {
          item.quantity++;
          updateCart();
        };
        div.querySelector(".decrease").onclick = () => {
          item.quantity--;
          if (item.quantity <= 0) cart.splice(idx, 1);
          updateCart();
        };
        div.querySelector(".delete").onclick = () => {
          cart.splice(idx, 1);
          updateCart();
        };
        cartList.appendChild(div);
      });
      totalPriceEl.textContent = total.toLocaleString();
      const cartBox = document.getElementById("cartBox");
      cartBox.classList.toggle("hidden", cart.length === 0);
    }
    
    document.getElementById("checkoutBtn").addEventListener("click", () => {
      if (cart.length === 0) return alert("ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.");
      alert(`ì´ ${document.getElementById("totalPrice").textContent}ì› ê²°ì œ ì§„í–‰`);
    });
    
  </script>
</body>
</html>
