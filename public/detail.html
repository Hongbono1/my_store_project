<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ìƒì„¸ í˜ì´ì§€</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ API (ë‚˜ì¤‘ì— ì—°ë™ ì˜ˆì •) -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js" defer></script>
  <!-- ì¹´ì¹´ì˜¤ ì§€ë„ API (ì‹¤ì œ ì•± í‚¤ë¡œ êµì²´ í•„ìš”) -->
  <script
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&libraries=services"
    defer
  ></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
  <div id="header-placeholder"></div>

  <!-- ë©”ì¸ -->
  <main class="container mx-auto px-4 py-8 flex-1">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-full items-stretch">
      <!-- ì™¼ìª½ ì„¹ì…˜ -->
      <section class="bg-white p-6 rounded shadow flex flex-col gap-6 h-full">
        <!-- ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” -->
        <div class="relative">
          <img id="sliderImage" alt="ê°€ê²Œ ì´ë¯¸ì§€" class="w-full h-64 object-cover rounded shadow mb-2" />
          <button
            id="prevBtn"
            class="absolute left-2 top-1/2 -translate-y-1/2 bg-black bg-opacity-50 text-white rounded px-3 py-1"
          >
            ì´ì „
          </button>
          <button
            id="nextBtn"
            class="absolute right-2 top-1/2 -translate-y-1/2 bg-black bg-opacity-50 text-white rounded px-3 py-1"
          >
            ë‹¤ìŒ
          </button>
        </div>

        <!-- ì§€ë„ ì˜ì—­ -->
        <div class="bg-gray-200 border border-gray-400 rounded-lg p-4">
          <h2 class="text-lg font-semibold mb-2">ê°€ê²Œ ìœ„ì¹˜</h2>
          <p id="addressText" class="text-sm text-gray-700 mb-2">ì£¼ì†Œ ì—†ìŒ</p>
          <div id="map" class="w-full h-40 bg-gray-300 flex items-center justify-center text-gray-700">
            ì§€ë„ ë¡œë“œ ì¤‘...
          </div>
          <button id="openKakaoBtn" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">
            ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ë³´ê¸°
          </button>
        </div>

        <!-- ë©”ë‰´ ë°•ìŠ¤ -->
        <div
          id="menuBox"
          class="bg-gray-50 border border-gray-300 rounded p-4 overflow-hidden transition-all duration-300 max-h-[13rem] hover:max-h-[2000px]"
        >
          <h2 class="text-lg font-bold mb-4">ë©”ë‰´</h2>
          <ul id="menuList" class="space-y-2"></ul>
        </div>
      </section>

      <!-- ì˜¤ë¥¸ìª½ ì„¹ì…˜ -->
      <section class="bg-white p-6 rounded shadow flex flex-col gap-4 h-full">
        <h2 id="businessNameHeader" class="text-3xl font-bold text-gray-800 border-b pb-3">ìƒí˜¸ëª…</h2>
        <div>
          <p id="businessType" class="text-lg"><strong>ì—…ì¢…:</strong></p>
          <p id="deliveryOption" class="text-lg"><strong>ë°°ë‹¬:</strong></p>
          <p id="businessHours" class="text-lg"><strong>ì˜ì—…ì‹œê°„:</strong></p>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì„œë¹„ìŠ¤ ë‚´ìš©</h3>
          <p id="serviceDetails" class="text-gray-700"></p>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì´ë²¤íŠ¸</h3>
          <ul id="eventsList" class="list-disc pl-6 space-y-1"></ul>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì¶”ê°€ ì •ë³´</h3>
          <ul id="additionalInfoList" class="list-disc pl-6 space-y-1"></ul>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì—°ë½ì²˜</h3>
          <p id="contactPhone"></p>
          <p id="contactHomepage"></p>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì¶”ê°€ ì„¤ëª…</h3>
          <p id="additionalDesc" class="text-gray-700"></p>
        </div>
        <div id="cartBox" class="bg-gray-50 p-4 rounded border hidden">
          <h3 class="text-xl font-bold mb-2">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</h3>
          <ul id="cartList" class="space-y-2"></ul>
          <div class="border-t mt-3 pt-3 text-right">
            <p class="font-semibold">ì´í•©: <span id="totalPrice">0</span>ì›</p>
            <button
              id="checkoutBtn"
              class="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded"
            >
              ê²°ì œí•˜ê¸°
            </button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <div id="footer-placeholder"></div>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      // í—¤ë”/í‘¸í„° ë¡œë”©
      fetch("https://www.hongbono1.com/components/header.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("header-placeholder").innerHTML = html;
        });

      fetch("https://www.hongbono1.com/components/footer.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("footer-placeholder").innerHTML = html;
        });

      // ê³µí†µ ë³€ìˆ˜
      let images = [];
      let currentIndex = 0;
      let cart = [];

      const sliderImage = document.getElementById("sliderImage");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const openKakaoBtn = document.getElementById("openKakaoBtn");

      // ìŠ¬ë¼ì´ë” ë²„íŠ¼
      prevBtn.addEventListener("click", () => {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        sliderImage.src = images[currentIndex];
      });
      nextBtn.addEventListener("click", () => {
        currentIndex = (currentIndex + 1) % images.length;
        sliderImage.src = images[currentIndex];
      });

      // ì¹´ì¹´ì˜¤ë§µ ìƒˆ ì°½
      openKakaoBtn.addEventListener("click", () => {
        const addr = document.getElementById("addressText").textContent || "";
        window.open(`https://map.kakao.com/?q=${encodeURIComponent(addr)}`, "_blank");
      });

      // ë°ì´í„° ë¡œë“œ
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id") || 1;
      const baseUrl = "https://www.hongbono1.com";

      fetch(`${baseUrl}/store/${id}`)
        .then((res) => res.json())
        .then(({ store, menu }) => {
          if (!store) {
            alert("ê°€ê²Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            return;
          }

          // 1) ê°€ê²Œ ì •ë³´ ë Œë”ë§
          document.getElementById("businessNameHeader").textContent =
            store.businessName || "";
          document.getElementById("businessType").innerHTML = `<strong>ì—…ì¢…:</strong> ${
            store.businessType || ""
          }`;
          document.getElementById("deliveryOption").innerHTML = `<strong>ë°°ë‹¬:</strong> ${
            store.deliveryOption || ""
          }`;
          document.getElementById("businessHours").innerHTML = `<strong>ì˜ì—…ì‹œê°„:</strong> ${
            store.businessHours || ""
          }`;
          document.getElementById("serviceDetails").textContent =
            store.serviceDetails || "";
          document.getElementById("additionalDesc").textContent =
            store.additionalDesc || "";
          document.getElementById("contactPhone").textContent = store.phone || "";
          document.getElementById("contactHomepage").textContent =
            store.homepage || "";
          document.getElementById("addressText").textContent = store.address || "";

          // ì§€ë„ ë Œë”ë§
          kakao.maps.load(() => {
            const container = document.getElementById("map");
            const map = new kakao.maps.Map(container, {
              center: new kakao.maps.LatLng(37.5665, 126.978),
              level: 3,
            });
            const geocoder = new kakao.maps.services.Geocoder();
            geocoder.addressSearch(store.address, (result, status) => {
              if (status === kakao.maps.services.Status.OK) {
                const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                new kakao.maps.Marker({ map, position: coords });
                map.setCenter(coords);
              }
            });
          });

          // 2) ì´ë¯¸ì§€ ì„¸íŒ…
          images =
            Array.isArray(store.images) && store.images.length
              ? store.images.map((src) =>
                  src.startsWith("http") ? src : `${baseUrl}${src}`
                )
              : ["https://via.placeholder.com/600x400?text=NO+IMAGE"];
          currentIndex = 0;
          sliderImage.src = images[currentIndex];

          // 3) ë©”ë‰´ ë Œë”ë§
          const menuList = document.getElementById("menuList");
          menuList.innerHTML = "";
          if (!Array.isArray(menu) || !menu.length) {
            menuList.innerHTML = "<li>ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";
          } else {
            const byCat = {};
            menu.forEach((m) => {
              const cat = m.category || "ê¸°íƒ€";
              (byCat[cat] = byCat[cat] || []).push(m);
            });
            Object.entries(byCat).forEach(([cat, items]) => {
              const h = document.createElement("li");
              h.className = "font-bold text-blue-600 pt-4";
              h.textContent = cat;
              menuList.appendChild(h);
              items.forEach((item) => {
                const li = document.createElement("li");
                li.className = "relative group flex items-center gap-3 border-b pb-2 cursor-pointer";
                li.dataset.name = item.menuName;
                li.dataset.price = item.menuPrice;
                li.innerHTML = `
                  <img src="${item.menuImageUrl ||
                    "https://via.placeholder.com/80?text=NOIMAGE"}"
                       alt="${item.menuName}"
                       class="w-16 h-16 object-cover rounded border">
                  <span class="font-semibold text-gray-800">${item.menuName}</span>
                  <span class="ml-auto text-gray-600">${Number(item.menuPrice).toLocaleString()}ì›</span>
                `;
                li.addEventListener("click", () => {
                  const found = cart.find((c) => c.name === item.menuName);
                  if (found) found.quantity++;
                  else cart.push({ name: item.menuName, price: +item.menuPrice, quantity: 1 });
                  updateCart();
                });
                menuList.appendChild(li);
              });
            });
          }

          function updateCart() {
            const cartBox = document.getElementById("cartBox");
            const cartListEl = document.getElementById("cartList");
            const totalEl = document.getElementById("totalPrice");
            cartListEl.innerHTML = "";
            let total = 0;
            cart.forEach((c, i) => {
              total += c.price * c.quantity;
              const div = document.createElement("div");
              div.className = "flex items-center justify-between border-b pb-2";
              div.innerHTML = `
                <div>
                  <span class="font-semibold">${c.name}</span>
                  <span class="ml-2 text-gray-600">${c.price.toLocaleString()}ì›</span>
                </div>
                <div class="flex items-center">
                  <button data-idx="${i}" data-op="-" class="border px-2">-</button>
                  <span class="mx-2">${c.quantity}</span>
                  <button data-idx="${i}" data-op="+" class="border px-2">+</button>
                  <button data-idx="${i}" data-op="del" class="border px-2 ml-2 text-red-500">ì‚­ì œ</button>
                </div>
              `;
              cartListEl.appendChild(div);
            });
            cartListEl.querySelectorAll("button").forEach((btn) => {
              btn.addEventListener("click", () => {
                const i = +btn.dataset.idx, op = btn.dataset.op;
                if (op === "+") cart[i].quantity++;
                else if (op === "-") {
                  cart[i].quantity--;
                  if (cart[i].quantity < 1) cart.splice(i, 1);
                } else cart.splice(i, 1);
                updateCart();
              });
            });
            totalEl.textContent = total.toLocaleString();
            cartBox.classList.toggle("hidden", cart.length === 0);
          }

          document.getElementById("checkoutBtn").addEventListener("click", () => {
            if (!cart.length) return alert("ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.");
            alert(`ì´ ${document.getElementById("totalPrice").textContent}ì› ê²°ì œ ì§„í–‰`);
          });
        })
        .catch((err) => {
          console.error("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨", err);
          alert("ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        });
    });
  </script>
</body>
</html>
