<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>가게 상세 · 3분할 레이아웃</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
    <!-- (헤더) -->
    <div id="header-placeholder"></div>

    <!-- 3단 하단 고정 메인 -->
    <main class="flex flex-1 w-full min-h-0">
        <!-- ▣ 1. 왼쪽 : 이미지, 지도, 위치, 광고 -->
        <section class="w-1/4 min-w-[260px] bg-blue-100 flex flex-col p-6 h-full">
            <div class="flex flex-col items-center gap-4 flex-1 overflow-y-auto">
                <!-- 이미지 슬라이더 -->
                <div class="w-full">
                    <div class="text-lg font-bold text-center mb-2">가게 이미지</div>
                    <div class="relative w-full rounded-2xl overflow-hidden mb-4 shadow">
                        <div id="sliderWrapper" class="w-full h-60 relative">
                            <div id="sliderImages" class="flex transition-transform duration-500 ease-in-out h-full">
                            </div>
                            <button id="prevBtn"
                                class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/70 text-white rounded-full px-3 py-1 opacity-80 hover:opacity-100 z-10">‹</button>
                            <button id="nextBtn"
                                class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/70 text-white rounded-full px-3 py-1 opacity-80 hover:opacity-100 z-10">›</button>
                        </div>
                        <div id="thumbBox" class="flex gap-2 justify-center mt-3"></div>
                    </div>
                </div>
                <!-- 지도 + 위치 -->
                <div class="w-full bg-white/90 rounded-xl p-4 text-blue-900 shadow mb-4">
                    <div class="font-semibold mb-2">가게 위치</div>
                    <div id="addressText" class="mb-2 text-base"></div>
                    <div id="map" class="w-full h-40 rounded border"></div>
                </div>
                <!-- 광고 박스 2개 (지도 아래) -->
                <div class="flex flex-col gap-4 w-full">
                    <a href="https://ad-link1.com" target="_blank"
                        class="block w-full bg-gray-200 rounded-2xl shadow overflow-hidden">
                        <img src="/images/ad-1.jpg" alt="광고 1"
                            class="w-full h-32 object-cover hover:scale-105 transition-transform">
                    </a>
                    <a href="https://ad-link2.com" target="_blank"
                        class="block w-full bg-gray-200 rounded-2xl shadow overflow-hidden">
                        <img src="/images/ad-2.jpg" alt="광고 2"
                            class="w-full h-32 object-cover hover:scale-105 transition-transform">
                    </a>
                </div>
            </div>
        </section>

        <!-- ▣ 2. 중앙 : 가게 정보, 서비스, 이벤트, 연락처 등 -->
        <section class="flex-1 bg-white rounded-3xl shadow-2xl px-6 py-8 flex flex-col min-h-0 h-full">
            <div class="flex-1 overflow-y-auto">
                <h1 id="businessNameHeader" class="text-3xl md:text-4xl font-extrabold text-center mb-6"></h1>
                <div class="bg-blue-50 p-4 rounded-xl border text-blue-900 mb-4">
                    <div id="businessType" class="text-lg"></div>
                    <div id="businessCategory" class="text-lg"></div>
                    <div id="deliveryOption" class="text-lg"></div>
                    <div id="businessHours" class="text-lg"></div>
                </div>
                <div class="bg-blue-50 p-4 rounded-xl border mb-4">
                    <div class="text-lg font-semibold mb-2">서비스 내용</div>
                    <div id="serviceDetails" class="text-gray-900"></div>
                </div>
                <div class="bg-blue-50 p-4 rounded-xl border mb-4">
                    <div class="text-lg font-semibold mb-2">이벤트</div>
                    <ul id="eventsList" class="list-disc pl-6 text-lg text-gray-900 leading-relaxed"></ul>
                </div>
                <div class="bg-blue-50 p-4 rounded-xl border mb-4">
                    <div class="text-lg font-semibold mb-2">기타 정보</div>
                    <ul id="infoEtcList" class="list-disc pl-6 text-lg text-gray-900 leading-relaxed"></ul>
                </div>
                <div class="bg-blue-50 p-4 rounded-xl border mb-4">
                    <div class="text-lg font-semibold mb-2">추가 정보</div>
                    <ul id="additionalInfoList" class="list-disc pl-6 text-lg text-gray-900 leading-relaxed"></ul>
                </div>
                <div class="bg-blue-50 p-4 rounded-xl border mb-4">
                    <div class="text-lg font-semibold mb-2 border-b pb-1">연락처</div>
                    <div id="contactPhone" class="text-lg"></div>
                    <div id="contactHomepage" class="text-lg"></div>
                    <div id="contactInstagram" class="text-lg"></div>
                    <div id="contactFacebook" class="text-lg"></div>
                </div>
            </div>
        </section>

        <!-- ▣ 3. 오른쪽 : 메뉴, 장바구니 -->
        <section class="w-1/4 min-w-[260px] bg-yellow-50 rounded-3xl shadow-2xl px-6 py-8 flex flex-col h-full min-h-0">
            <div class="flex-1 overflow-y-auto">
                <h2 class="text-2xl font-bold text-yellow-900 mb-4 text-center">메뉴</h2>
                <div id="menuList" class="flex flex-col gap-4 divide-y pr-2 mb-8"></div>
                <!-- 장바구니 -->
                <div id="cartBox" class="bg-white rounded-xl shadow p-6 mt-6">
                    <div class="font-bold mb-2">장바구니</div>
                    <ul id="cartItems" class="space-y-2 text-base"></ul>
                    <div class="flex justify-between items-center mt-4">
                        <span class="font-bold text-gray-800">합계:</span>
                        <span id="cartTotal" class="text-2xl font-bold text-blue-700">0원</span>
                    </div>
                    <button
                        class="mt-4 w-full bg-blue-700 text-white py-2 rounded hover:bg-blue-800 font-bold">결제하기</button>
                </div>
            </div>
        </section>
    </main>

    <!-- 푸터 -->
    <footer class="w-full h-2 bg-black"></footer>

    <!-- 이미지 모달 -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="relative">
            <img id="modalImage" class="w-[600px] h-[400px] object-contain rounded shadow-xl" />
            <button id="closeModal"
                class="absolute -top-4 -right-4 bg-white text-black rounded-full text-3xl w-10 h-10 flex items-center justify-center z-60 hover:bg-gray-200">
                ×
            </button>
        </div>
    </div>

    <script type="module">
        const $ = id => document.getElementById(id);
        // 헤더/푸터 동적 삽입
        window.addEventListener("DOMContentLoaded", () => {
            fetch("/components/header.html").then(r => r.text()).then(html => { $("header-placeholder").innerHTML = html; });
        });

        // ==== 이미지 슬라이더 ====
        const slider = {
            imgs: [],
            idx: 0,
            init(arr) {
                this.imgs = (arr || []).filter(src => typeof src === "string" && (src.startsWith("http") || src.startsWith("/"))).map(src => src.trim());
                if (!this.imgs.length) this.imgs = ["/no-image.png"];
                $("sliderImages").innerHTML = this.imgs.map((u, i) => `
          <img src="${u}" data-index="${i}" class="w-full h-full object-cover flex-shrink-0 cursor-pointer" onclick="showModalImage('${u}')"/>
        `).join('');
                $("sliderImages").onclick = (e) => {
                    if (e.target.tagName === "IMG") {
                        this.idx = Number(e.target.dataset.index);
                        this.update();
                        openModal(this.imgs[this.idx]);
                    }
                };
                this.renderThumbs();
                this.update();
                $("prevBtn").onclick = () => this.move(-1);
                $("nextBtn").onclick = () => this.move(1);
            },
            renderThumbs() {
                const box = $("thumbBox");
                box.innerHTML = "";
                this.imgs.forEach((src, i) => {
                    if (!src.startsWith("http") && !src.startsWith("/")) return;
                    const t = document.createElement("img");
                    t.setAttribute("src", src);
                    t.setAttribute("alt", `이미지 ${i + 1}`);
                    t.className = "w-12 h-12 object-cover rounded cursor-pointer border hover:opacity-80";
                    t.addEventListener("click", () => {
                        this.idx = i;
                        this.update();
                        openModal(src);
                    });
                    box.appendChild(t);
                });
            },
            move(step) {
                this.idx = (this.idx + step + this.imgs.length) % this.imgs.length;
                this.update();
            },
            update() {
                $("sliderImages").style.transform = `translateX(${-this.idx * 100}%)`;
                [...$("thumbBox").children].forEach((el, i) => {
                    el.classList.toggle("ring-2", i === this.idx);
                    el.classList.toggle("ring-blue-300", i === this.idx);
                });
            }
        };
        // 모달
        window.showModalImage = function (src) { $("modalImage").src = src; $("imageModal").classList.remove("hidden"); };
        function openModal(src) { $("modalImage").src = src; $("imageModal").classList.remove("hidden"); }
        function closeModal() { $("imageModal").classList.add("hidden"); }
        $("closeModal").onclick = closeModal;
        $("imageModal").onclick = e => { if (e.target === $("imageModal")) closeModal(); };

        // ==== 데이터/지도 바인딩(간략 예시) ====
        // 실제 서비스에선 fetch(`/store/${id}`) 등으로 대체!
        const dummy = {
            images: ["/images/store-1.jpg", "/images/store-2.jpg"],
            address: "경기 평택시 현덕면 관관리 306-1",
            businessName: "홍길동동물병원",
            category: "동물병원",
            businessType: "의료",
            deliveryOption: "없음",
            businessHours: "09:00~18:00",
            serviceDetails: "진료/수술/예방접종",
            event1: "신규 고객 할인",
            event2: "리뷰 작성시 사은품 증정",
            facility: "없음",
            pets: "불가",
            parking: "무료주차",
            homepage: "https://example.com",
            instagram: "https://insta.com/store",
            facebook: "https://facebook.com/store"
        };
        const menus = [
            { menuName: "진료", menuPrice: 20000, menu_image: "/images/menu-1.jpg", category: "진료" },
            { menuName: "수술", menuPrice: 70000, menu_image: "/images/menu-2.jpg", category: "수술" }
        ];

        // 슬라이더/주소 바인딩
        slider.init(dummy.images || []);
        $("businessNameHeader").textContent = dummy.businessName;
        $("businessCategory").innerHTML = `<strong>구분:</strong> ${dummy.category}`;
        $("businessType").innerHTML = `<strong>업종:</strong> ${dummy.businessType}`;
        $("deliveryOption").innerHTML = `<strong>배달:</strong> ${dummy.deliveryOption}`;
        $("businessHours").innerHTML = `<strong>영업시간:</strong> ${dummy.businessHours}`;
        $("serviceDetails").textContent = dummy.serviceDetails;
        $("addressText").textContent = "📍 " + dummy.address;
        $("eventsList").innerHTML = `<li>${dummy.event1}</li><li>${dummy.event2}</li>`;
        $("infoEtcList").innerHTML = `
      <li>장애인 편의시설: ${dummy.facility}</li>
      <li>반려동물 출입:   ${dummy.pets}</li>
      <li>주차 정보:       ${dummy.parking}</li>
    `;
        $("additionalInfoList").innerHTML = `<li>서비스 내용: ${dummy.serviceDetails}</li>`;
        $("contactPhone").textContent = "031-123-4567";
        $("contactHomepage").innerHTML = `<a href="${dummy.homepage}" class="text-blue-600 underline" target="_blank">${dummy.homepage}</a>`;
        $("contactInstagram").innerHTML = `<a href="${dummy.instagram}" class="text-blue-600 underline" target="_blank">${dummy.instagram}</a>`;
        $("contactFacebook").innerHTML = `<a href="${dummy.facebook}" class="text-blue-600 underline" target="_blank">${dummy.facebook}</a>`;

        // 메뉴/장바구니
        const cart = [];
        function addToCart(item) {
            const found = cart.find(c => c.menuName === item.menuName);
            if (found) found.quantity += item.quantity;
            else cart.push({ ...item });
            renderCart();
        }
        function renderCart() {
            const ul = $("cartItems"); if (!ul) return;
            ul.innerHTML = "";
            let sum = 0;
            cart.forEach((item, index) => {
                const price = Number(item.menuPrice) || 0;
                const qty = Number(item.quantity) || 1;
                const total = price * qty;
                sum += total;
                const li = document.createElement("li");
                li.className = "flex justify-between items-center text-lg py-2";
                li.innerHTML = `
          <span>${item.menuName} × ${qty}</span>
          <span class="text-xl font-bold">${total.toLocaleString()}원</span>
          <button class="removeBtn bg-red-100 text-red-600 px-2 py-1 rounded text-sm ml-2" data-index="${index}">삭제</button>
        `;
                ul.appendChild(li);
            });
            ul.querySelectorAll(".removeBtn").forEach(btn => {
                btn.onclick = () => {
                    const idx = btn.dataset.index;
                    cart.splice(idx, 1);
                    renderCart();
                };
            });
            $("cartTotal").textContent = sum.toLocaleString();
        }
        // 메뉴 바인딩
        const menuList = $("menuList");
        menuList.innerHTML = "";
        menus.forEach(it => {
            const box = document.createElement("div");
            box.className = "flex items-center gap-4 p-4 bg-white rounded-lg shadow-sm border";
            box.innerHTML = `
        <img src="${it.menu_image ? it.menu_image : '/assets/images/no-thumb.png'}"
          class="w-20 h-20 object-cover rounded-md"/>
        <div class="flex-1 flex flex-col justify-center">
          <div class="text-lg font-bold mb-1 truncate">${it.menuName}</div>
          <div class="text-base font-medium text-gray-700">${Number(it.menuPrice).toLocaleString()}원</div>
        </div>
        <div class="flex flex-col items-center justify-center gap-1 shrink-0">
          <div class="flex items-center gap-1">
            <button class="decrease px-2 py-1 bg-gray-200 rounded">－</button>
            <span class="quantity w-6 text-center">1</span>
            <button class="increase px-2 py-1 bg-gray-200 rounded">＋</button>
          </div>
          <button class="addBtn px-3 py-1 bg-blue-600 text-white text-sm rounded">담기</button>
        </div>
      `;
            let qty = 1;
            const qtySpan = box.querySelector(".quantity");
            box.querySelector(".decrease").onclick = () => { if (qty > 1) qtySpan.textContent = --qty; };
            box.querySelector(".increase").onclick = () => { qtySpan.textContent = ++qty; };
            box.querySelector(".addBtn").onclick = () => { addToCart({ ...it, quantity: qty }); };
            menuList.appendChild(box);
        });

        // 지도
        (() => {
            try {
                const fullAddress = store.address;
                const cleanedAddress = cleanAddress(fullAddress);
                $("addressText").textContent = `📍 ${cleanedAddress}`;
                initMap(cleanedAddress, store.businessName);
                window.kakaoReady = () => {
                    kakao.maps.load(() => {
                        initMap(cleanedAddress, store.businessName);
                    });
                };
                if (window.kakao && window.kakao.maps) {
                    kakao.maps.load(() => {
                        initMap(cleanedAddress, store.businessName);
                    });
                } else if (window.kakaoReady) {
                    window.kakaoReady();
                }
                function cleanAddress(fullAddress) {
                    const parts = fullAddress.replace(/^\d{5}\s*/, "").split(/\s+/);
                    return parts.filter((_, i) => i < 3).join(" ");
                }
            } catch (err) {
                const sliderImages = $("sliderImages");
                if (sliderImages) {
                    sliderImages.innerHTML = `<img src="/images/no-image.png" class="w-full h-64 flex-shrink-0 object-cover"/>`;
                }
            }
        })();

        function syncSections() {
            const secs = document.querySelectorAll('main > section');
            if (secs.length < 3) return;
            const [left, center, right] = secs;
            const h = left.getBoundingClientRect().height;
            [center, right].forEach(sec => {
                sec.style.maxHeight = h + 'px';
                sec.style.overflowY = 'auto';
            });
        }
        window.addEventListener('DOMContentLoaded', syncSections);
        window.addEventListener('resize', syncSections);

    </script>

</body>

</html>