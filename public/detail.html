<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <title>ìƒì„¸ í˜ì´ì§€</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ API (ë‚˜ì¤‘ì— ì—°ë™ ì˜ˆì •) -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js" defer></script>
  <!-- ì¹´ì¹´ì˜¤ ì§€ë„ API (ì‹¤ì œ ì•± í‚¤ë¡œ êµì²´ í•„ìš”) -->
  <script
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&autoload=false&libraries=services"></script>

</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
  <div id="header-placeholder"></div>

  <!-- ë©”ì¸ -->
  <main class="container mx-auto px-4 py-8 flex-1">
    <div class="flex flex-col lg:flex-row gap-8 h-full">
      <!-- ì™¼ìª½ ì„¹ì…˜ -->
      <section class="bg-white p-6 rounded shadow flex flex-col gap-6 w-full lg:w-1/2">
        <!-- ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” -->
        <div class="relative">
          <img id="sliderImage" alt="ê°€ê²Œ ì´ë¯¸ì§€" class="w-full h-64 object-cover rounded shadow mb-2" />
          <button id="prevBtn"
            class="absolute left-2 top-1/2 -translate-y-1/2 bg-black bg-opacity-50 text-white rounded px-3 py-1">
            ì´ì „
          </button>
          <button id="nextBtn"
            class="absolute right-2 top-1/2 -translate-y-1/2 bg-black bg-opacity-50 text-white rounded px-3 py-1">
            ë‹¤ìŒ
          </button>
        </div>

        <!-- ì§€ë„ ì˜ì—­ -->
        <div class="bg-gray-200 border border-gray-400 rounded-lg p-4">
          <h2 class="text-lg font-semibold mb-2">ê°€ê²Œ ìœ„ì¹˜</h2>
          <p id="addressText" class="text-sm text-gray-700 mb-2">ì£¼ì†Œ ì—†ìŒ</p>
          <div id="map" class="w-full h-40 bg-gray-300 flex items-center justify-center text-gray-700">
            ì§€ë„ ë¡œë“œ ì¤‘...
          </div>
        </div>

        <!-- ë©”ë‰´ ë°•ìŠ¤ -->
        <div id="menuBox"
          class="bg-gray-50 border border-gray-300 rounded p-4 overflow-hidden transition-all duration-300 max-h-[13rem] hover:max-h-[2000px]">
          <h2 class="text-lg font-bold mb-4">ë©”ë‰´</h2>
          <ul id="menuList" class="space-y-2"></ul>
        </div>
      </section>
      <section class="bg-white p-6 rounded shadow flex flex-col gap-4 w-full lg:w-1/2">
        <h2 id="businessNameHeader" class="text-3xl font-bold text-gray-800 border-b pb-3">ìƒí˜¸ëª…</h2>
        <div>
          <p id="businessType" class="text-lg"><strong>ì—…ì¢…:</strong></p>
          <p id="deliveryOption" class="text-lg"><strong>ë°°ë‹¬:</strong></p>
          <p id="businessHours" class="text-lg"><strong>ì˜ì—…ì‹œê°„:</strong></p>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì„œë¹„ìŠ¤ ë‚´ìš©</h3>
          <p id="serviceDetails" class="text-gray-700"></p>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì´ë²¤íŠ¸</h3>
          <ul id="eventsList" class="list-disc pl-6 space-y-1"></ul>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì¶”ê°€ ì •ë³´</h3>
          <ul id="additionalInfoList" class="list-disc pl-6 space-y-1"></ul>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì—°ë½ì²˜</h3>
          <p id="contactPhone"></p>
          <p id="contactHomepage"></p>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <h3 class="text-xl font-bold mb-2">ì¶”ê°€ ì„¤ëª…</h3>
          <p id="additionalDesc" class="text-gray-700"></p>
        </div>
        <div id="cartBox" class="bg-gray-50 p-4 rounded border hidden">
          <h3 class="text-xl font-bold mb-2">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</h3>
          <ul id="cartList" class="space-y-2"></ul>
          <div class="border-t mt-3 pt-3 text-right">
            <p class="font-semibold">ì´í•©: <span id="totalPrice">0</span>ì›</p>
            <button id="checkoutBtn" class="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">
              ê²°ì œí•˜ê¸°
            </button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <div id="footer-placeholder"></div>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id") || 1;

      fetch(`https://www.hongbono1.com/store/${id}`)
        .then(res => res.json())
        .then(data => {
          const store = data.store;

          // âœ… ì´ë¯¸ì§€ ë°°ì—´ ì¤€ë¹„
          const images = Array.isArray(store.images) && store.images.length > 0
            ? store.images
            : ["https://via.placeholder.com/600x400?text=NO+IMAGE"];

          const sliderImage = document.getElementById("sliderImage");
          const prevBtn = document.getElementById("prevBtn");
          const nextBtn = document.getElementById("nextBtn");

          let currentIndex = 0;

          function showImage(index) {
            sliderImage.src = images[index];
          }

          prevBtn.addEventListener("click", () => {
            currentIndex = (currentIndex - 1 + images.length) % images.length;
            showImage(currentIndex);
          });

          nextBtn.addEventListener("click", () => {
            currentIndex = (currentIndex + 1) % images.length;
            showImage(currentIndex);
          });

          showImage(currentIndex);
        })
        .catch(err => {
          console.error("ì´ë¯¸ì§€ ë¡œë”© ì˜¤ë¥˜", err);
          document.getElementById("sliderImage").src = "https://via.placeholder.com/600x400?text=NO+IMAGE";
        });
      });

      // ì¹´ì¹´ì˜¤ ì§€ë„ APIê°€ ì¤€ë¹„ë˜ë©´
      kakao.maps.load(() => {
        const geocoder = new kakao.maps.services.Geocoder();

        const address = store.address; // ì„œë²„ë¡œë¶€í„° ë°›ì•„ì˜¨ ì£¼ì†Œ

        geocoder.addressSearch(address, (result, status) => {
          if (status === kakao.maps.services.Status.OK) {
            const coords = new kakao.maps.LatLng(result[0].y, result[0].x);

            const mapContainer = document.getElementById('map');
            const mapOption = {
              center: coords,
              level: 3,
            };

            const map = new kakao.maps.Map(mapContainer, mapOption);

            const marker = new kakao.maps.Marker({
              map: map,
              position: coords
            });

            const infowindow = new kakao.maps.InfoWindow({
              content: `<div style="padding:5px;">${store.businessName}</div>`
            });
            infowindow.open(map, marker);
          }
        });
      });
  </script>