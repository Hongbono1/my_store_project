<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>정보 입력 (Neo/Glass/3D)</title>

    <script>
        window.tailwind = window.tailwind || {};
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { primary: "#1e3a8a", accent: "#22c55e" },
                    fontFamily: {
                        sans: ["Inter", "Noto Sans KR", "Apple SD Gothic Neo", "ui-sans-serif", "system-ui"]
                    }
                }
            }
        };
    </script>

    <!-- Tailwind (배포용: /assets/css/tailwind.css 사용 유지) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Daum 우편번호 / Kakao 지도 -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&autoload=false&libraries=services"></script>

    <style>
        /* ─────────────────────────────────────────────────────────────
       Neumorphism + Glass + subtle 3D
    ───────────────────────────────────────────────────────────── */
        body {
            background: radial-gradient(1200px 800px at 10% 10%, #eef3ff 0%, #f7f9ff 35%, #f9fbff 55%, #ffffff 100%);
        }

        .neo-shell {
            background: rgba(255, 255, 255, .65);
            backdrop-filter: blur(8px);
            border-radius: 2rem;
            border: 1px solid rgba(255, 255, 255, .7);
            box-shadow: 16px 16px 40px rgba(32, 58, 102, .08), -8px -8px 32px rgba(255, 255, 255, .9), inset 0 1px 0 rgba(255, 255, 255, .65);
        }

        .neo-section {
            background: rgba(255, 255, 255, .92);
            border-radius: 1.25rem;
            border: 1px solid rgba(255, 255, 255, .75);
            box-shadow: 8px 8px 24px rgba(0, 0, 0, .06), -6px -6px 18px rgba(255, 255, 255, .9), inset 0 1px 0 rgba(255, 255, 255, .65);
            transition: transform .15s ease, box-shadow .2s ease, background .2s ease;
        }

        .neo-section:hover {
            transform: translateY(-1px);
            box-shadow: 12px 12px 28px rgba(0, 0, 0, .08), -8px -8px 20px rgba(255, 255, 255, .95), inset 0 1px 0 rgba(255, 255, 255, .7);
        }

        .neo-input {
            background: linear-gradient(180deg, #fff, #f6f8ff);
            border: 1px solid rgba(131, 151, 255, .35);
            border-radius: .875rem;
            box-shadow: 4px 4px 14px rgba(0, 61, 255, .06), -3px -3px 10px rgba(255, 255, 255, .95), inset 0 1px 0 rgba(255, 255, 255, .85);
            transition: box-shadow .15s ease, background .15s ease;
        }

        .neo-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(80, 129, 255, .15), 4px 4px 14px rgba(0, 61, 255, .08), inset 0 1px 0 rgba(255, 255, 255, .9);
            background: linear-gradient(180deg, #fff, #eef3ff);
        }

        .neo-btn {
            background: linear-gradient(180deg, #fff, #eef2ff);
            border: 1px solid rgba(96, 122, 255, .35);
            border-radius: .875rem;
            box-shadow: 6px 6px 18px rgba(0, 61, 255, .08), -4px -4px 14px rgba(255, 255, 255, .9), inset 0 1px 0 rgba(255, 255, 255, .85);
            color: #1e3a8a;
            font-weight: 700;
            transition: transform .12s ease, box-shadow .12s ease;
        }

        .neo-btn:hover {
            transform: translateY(-1px);
            box-shadow: 8px 8px 22px rgba(0, 61, 255, .12), -5px -5px 16px rgba(255, 255, 255, .95), inset 0 1px 0 rgba(255, 255, 255, .9);
        }

        .neo-danger {
            border: 1px solid rgba(255, 59, 59, .35);
            color: #991b1b;
        }

        .hint {
            color: #5b6b8c;
        }

        /* 사업자번호 입력 3칸 */
        #bizRow {
            overflow-x: visible !important;
            flex-wrap: wrap;
        }

        /*
        #biz1 {
            width: 7ch !important;
            padding: .45rem .5rem !important;
            font-size: .95rem;
        }

        #biz2 {
            width: 5ch !important;
            padding: .45rem .5rem !important;
            font-size: .95rem;
        }

        #biz3 {
            width: 9ch !important;
            padding: .45rem .5rem !important;
            font-size: .95rem;
        }
        */

        #bizRow .neo-btn {
            margin-top: .5rem;
        }

        .mnu-file {
            width: 9rem;
            padding: .4rem .5rem;
            font-size: .875rem;
        }

        input.mnu-file[type="file"] {
            width: 9rem;
            padding: .4rem .5rem;
            font-size: .875rem;
            text-align: center;
        }

        input.mnu-file[type="file"]::file-selector-button {
            padding: .4rem .6rem;
            border: 1px solid rgba(96, 122, 255, .35);
            border-radius: .5rem;
            background: linear-gradient(180deg, #fff, #eef2ff);
            cursor: pointer;
        }

        .mnu-cell-center {
            justify-self: center;
        }
    </style>
</head>

<body class="flex flex-col min-h-screen">
    <!-- 헤더 -->
    <div id="header-placeholder"></div>

    <!-- 메인 -->
    <main class="flex-grow container mx-auto px-4 py-10">
        <div class="neo-shell max-w-2xl mx-auto p-5 sm:p-8">
            <h2 class="text-3xl md:text-4xl font-extrabold text-center text-blue-900 tracking-tight">정보 입력</h2>
            <p class="text-center mt-2 hint">사업자 인증부터 메뉴 등록, 지도까지 한 번에 등록할 수 있습니다.</p>

            <!-- ✅ 단일 form (가게정보 + 메뉴) -->
            <form id="storeForm" class="mt-8 space-y-6" enctype="multipart/form-data" method="POST">
                <input type="hidden" id="storeId" name="storeId" />
                <input type="hidden" id="bizVerified" name="bizVerified" value="N">
                <input type="hidden" id="bizNumber" name="bizNumber" value="">

                <!-- ① 사업자 등록 인증 (Tailwind-only) -->
                <!-- ① 사업자 등록 인증 -->
                <section class="neo-section p-5">
                    <h3 class="text-xl font-bold text-blue-900 mb-4">① 사업자 등록 인증</h3>

                    <!-- 공통 2열: 라벨 / 입력 -->
                    <div class="grid grid-cols-1 md:grid-cols-[9rem_1fr] gap-3 items-center">

                        <!-- 사업자 번호 -->
                        <label class="text-blue-900 font-medium md:text-right">사업자 번호</label>
                        <div class="flex items-center gap-2">
                            <!-- 입력칸 묶음은 flex-1 로 확장 → 버튼은 자동으로 우측 끝으로 이동 -->
                            <div class="flex items-center gap-2 flex-1">
                                <input id="biz1" class="neo-input h-12 w-[10ch] px-3 text-center" placeholder="123"
                                    inputmode="numeric" />
                                <span class="text-slate-500">-</span>
                                <input id="biz2" class="neo-input h-12 w-[7ch] px-3 text-center" placeholder="45"
                                    inputmode="numeric" />
                                <span class="text-slate-500">-</span>
                                <input id="biz3" class="neo-input h-12 w-[12ch] px-3 text-center" placeholder="67890"
                                    inputmode="numeric" />
                            </div>
                            <!-- 등록증 파일 입력의 오른쪽 끝에 맞춰 정렬됨 -->
                            <button id="btnVerifyBiz" type="button" class="neo-btn h-12 px-5 shrink-0 ml-2">인증</button>
                        </div>

                        <!-- 등록증 이미지 -->
                        <label for="businessCertImage" class="text-blue-900 font-medium md:text-right">등록증 이미지</label>
                        <input id="businessCertImage" name="businessCertImage" type="file"
                            accept="image/*,application/pdf" class="neo-input h-12 w-full px-3
             file:mr-3 file:px-4 file:py-2 file:rounded
             file:border file:border-blue-200 file:bg-blue-50" />
                    </div>

                    <p class="text-sm text-center mt-2">
                        * 등록증은 <span class="text-red-600 font-semibold">3개월 이내 발급분</span>만 인정
                    </p>
                    <p id="bizVerifyResult" class="text-sm text-center mt-1"></p>
                </section>

                <!-- 2) 대표 정보 -->
                <section class="neo-section p-5">
                    <h3 class="text-xl font-bold text-blue-900 mb-4">② 대표 정보</h3>

                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="ownerName">대표자
                            성함</label>
                        <input id="ownerName" name="ownerName" placeholder="예: 홍길동" class="neo-input flex-1 px-3 py-2">
                    </div>

                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="birthDate">생년월일</label>
                        <input type="date" id="birthDate" name="birthDate" class="neo-input flex-1 px-3 py-2">
                    </div>

                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0">이메일</label>
                        <div class="flex flex-wrap items-center gap-2 flex-1 min-w-0">
                            <input id="emailId" placeholder="아이디" class="neo-input flex-1 min-w-0 px-3 py-2">
                            <span class="shrink-0">@</span>
                            <select id="emailDomainSelect" class="neo-input flex-1 min-w-0 px-3 py-2">
                                <option value="">선택하세요</option>
                                <option value="naver.com">naver.com</option>
                                <option value="gmail.com">gmail.com</option>
                                <option value="daum.net">daum.net</option>
                                <option value="kakao.com">kakao.com</option>
                                <option value="nate.com">nate.com</option>
                                <option value="custom">직접입력</option>
                            </select>
                            <input id="customDomainInput" placeholder="도메인"
                                class="hidden neo-input flex-1 min-w-0 px-3 py-2">
                        </div>
                        <input type="hidden" id="ownerEmail" name="ownerEmail">
                    </div>

                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="ownerAddress">대표
                            주소</label>
                        <input id="ownerAddress" name="ownerAddress" placeholder="예: 서울시 …"
                            class="neo-input flex-1 px-3 py-2">
                    </div>

                    <div class="flex flex-col md:flex-row md:items-center gap-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="ownerPhone">핸드폰
                            번호</label>
                        <input id="ownerPhone" name="ownerPhone" placeholder="010-1234-5678"
                            class="neo-input flex-1 px-3 py-2">
                    </div>
                </section>

                <!-- 3) 휴대전화 인증 -->
                <section class="neo-section p-5">
                    <h3 class="text-xl font-bold text-blue-900 mb-4">③ 휴대전화 인증</h3>
                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-2">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="phoneAuth">인증번호</label>
                        <input id="phoneAuth" name="phoneAuth" placeholder="인증번호 입력" class="neo-input flex-1 px-3 py-2">
                        <button type="button" id="verifyPhoneButton" class="neo-btn px-4 py-2">인증 요청</button>
                    </div>
                    <p id="phoneVerifyResult" class="text-sm text-center"></p>
                </section>

                <!-- 4) 기본 정보 -->
                <section class="neo-section p-5">
                    <h3 class="text-xl font-bold text-blue-900 mb-4">④ 기본 정보</h3>

                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="businessName">상호</label>
                        <input id="businessName" name="businessName" placeholder="OO 식당 …"
                            class="neo-input flex-1 px-3 py-2">
                    </div>

                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3 relative">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0">업종</label>
                        <div class="flex items-center gap-2 relative flex-1">
                            <input name="businessType" placeholder="예: 음식점, 카페, 숙박 등"
                                class="neo-input flex-1 px-3 py-2" />
                            <button id="helpBtn" type="button" onclick="toggleTip(event)"
                                class="neo-btn shrink-0 px-3 py-2 rounded-full !font-bold">?</button>
                            <div id="tipBox" class="fixed w-64 p-4 neo-section text-sm z-20 hidden"
                                style="left:0; top:0;">
                                <strong class="block mb-2 text-blue-700">업종 예시</strong>
                                식당, 병원, 약국, 어린이집, 학원, 마트<br>
                                편의점, 운동, 미용, 이발, 세탁, 옷수선<br>
                                스터디룸, 독서실, 목욕, 숙박, 중고, 구제<br>
                                자동차 정비, 주유소, 반려동물, 가전제품<br>
                                철물, 자재, 간판, 광고, 통신, 인터넷, TV<br>
                                안경, 사진, 꽃집 등 업에 관련된 종목 기입
                            </div>
                        </div>
                    </div>

                    <!-- 업종 구분 -->
                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3 relative">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0"
                            for="businessType">업종구분</label>
                        <input id="businessCategoryDisplay" readonly placeholder="선택"
                            class="neo-input flex-1 px-3 py-2 bg-gray-100 cursor-pointer">
                        <button type="button" id="categoryToggle" class="neo-btn px-3 py-2 shrink-0">▼</button>
                        <ul id="categoryList" class="absolute left-36 top-full mt-1 w-60 neo-section hidden z-50">
                            <li data-value="한식" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">한식</li>
                            <li data-value="양식" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">양식</li>
                            <li data-value="중식" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">중식</li>
                            <li data-value="일식" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">일식</li>
                            <li data-value="패스트푸드" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">패스트푸드</li>
                            <li data-value="치킨" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">치킨</li>
                            <li data-value="카페" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">카페</li>
                            <li data-value="스트리트푸드" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">스트리트푸드
                            </li>
                            <li data-value="분식" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">분식</li>
                            <li data-value="기타" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">기타</li>
                        </ul>
                        <input type="hidden" id="businessCategory" name="businessCategory">
                    </div>

                    <!-- 한식 세부 카테고리 -->
                    <div id="subcatRow" class="flex flex-col md:flex-row md:items-center gap-3 mb-3 relative hidden">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="subcategoryDisplay">한식
                            카테고리</label>
                        <input id="subcategoryDisplay" readonly placeholder="선택"
                            class="neo-input flex-1 px-3 py-2 bg-gray-100 cursor-pointer">
                        <button type="button" id="subcategoryToggle" class="neo-btn px-3 py-2 shrink-0">▼</button>
                        <ul id="subcategoryList" class="absolute left-36 top-full mt-1 w-60 neo-section hidden z-10">
                            <li data-value="밥류" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">밥 (비빔밥/덮밥/백반)
                            </li>
                            <li data-value="찌개/탕" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">찌개/탕</li>
                            <li data-value="고기/구이" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">고기/구이
                                (제육볶음)</li>
                            <li data-value="생선" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">생선</li>
                            <li data-value="족발/보쌈" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">족발/보쌈</li>
                            <li data-value="국밥" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">국밥</li>
                            <li data-value="반찬" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">반찬</li>
                            <li data-value="기타" class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">기타</li>
                        </ul>
                        <input type="hidden" id="businessSubcategory" name="businessSubcategory">
                    </div>

                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0"
                            for="businessHours">영업시간</label>
                        <input id="businessHours" name="businessHours" placeholder="09:00 ~ 22:00"
                            class="neo-input flex-1 px-3 py-2">
                    </div>

                    <div id="deliveryRow" class="flex flex-col md:flex-row md:items-center gap-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0 leading-tight">배달 여부</label>
                        <div class="flex-1">
                            <select id="deliveryOption" name="deliveryOption" class="neo-input w-full px-3 py-2 h-12"
                                required>
                                <option value="" disabled selected>선택하세요</option>
                                <option value="가능">가능</option>
                                <option value="불가">불가</option>
                                <option value="일부 가능">일부 가능</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- 5) 서비스 내용 -->
                <section class="neo-section p-5">
                    <h3 class="text-xl font-bold text-blue-900 mb-3">⑤ 서비스 내용</h3>
                    <textarea id="serviceDetails" name="serviceDetails" rows="4" placeholder="서비스·메뉴·예약 정보 …"
                        class="neo-input w-full px-3 py-2"></textarea>
                </section>

                <!-- 6) 고객 이벤트 -->
                <section class="neo-section p-5">
                    <h3 class="text-xl font-bold text-blue-900 mb-4">⑥ 고객 이벤트</h3>
                    <div class="mb-3">
                        <label class="block font-medium text-blue-900 mb-1" for="event1">이벤트 내용 1</label>
                        <input id="event1" name="event1" placeholder="이벤트 내용 1" class="neo-input w-full px-3 py-2">
                    </div>
                    <div>
                        <label class="block font-medium text-blue-900 mb-1" for="event2">이벤트 내용 2</label>
                        <input id="event2" name="event2" placeholder="이벤트 내용 2" class="neo-input w-full px-3 py-2">
                    </div>
                </section>

                <!-- 7) 기타 정보 -->
                <section class="neo-section p-5">
                    <h3 class="text-xl font-bold text-blue-900 mb-4">⑦ 기타 정보</h3>
                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="facility">장애인
                            편의시설</label>
                        <input id="facility" name="facilities" placeholder="와이파이, 주차, 포장 가능"
                            class="neo-input flex-1 px-3 py-2">
                    </div>
                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="pets">반려동물 출입</label>
                        <select id="pets" name="petsAllowed" class="neo-input flex-1 px-3 py-2">
                            <option value="">선택</option>
                            <option value="true">가능</option>
                            <option value="false">불가</option>
                        </select>
                    </div>
                    <div class="flex flex-col md:flex-row md:items-center gap-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="parking">주차 정보</label>
                        <input id="parking" name="parking" placeholder="전용 / 유료 …" class="neo-input flex-1 px-3 py-2">
                    </div>
                </section>

                <!-- ⑧ 메뉴 등록 (단순 폼) -->
                <section class="neo-section p-5" id="mnu-section">
                    <h3 class="text-xl font-bold text-blue-900 mb-4">⑧ 메뉴 등록 (카테고리 → 품목)</h3>

                    <!-- ✅ 새 카테고리 입력/추가 UI (여기에 추가) -->
                    <div class="flex flex-col sm:flex-row items-center gap-2 mb-3">
                        <input id="newCatInput" type="text" placeholder="새 카테고리 이름 (예: 세트메뉴)"
                            class="neo-input px-3 py-2 w-full sm:flex-1">
                        <button type="button" id="btnAddCat" class="neo-btn px-4 py-2 shrink-0">카테고리 추가</button>
                    </div>

                    <!-- 카테고리별 품목 리스트 패널 -->
                    <div id="menuCategoryPanels" class="space-y-6"></div>

                    <!-- ✅ 하단 컨트롤 바 -->
                    <div class="mt-5 pt-3 border-t flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                        <div class="text-sm hint">
                            현재 카테고리: <span id="currentCatText" class="font-semibold text-blue-900">선택 전</span>
                        </div>
                        <div class="flex flex-wrap items-center gap-2">
                            <!-- 새 카테고리 입력 -->
                            <input id="newCatInput2" type="text" placeholder="새 카테고리" class="neo-input px-3 py-2 w-40">
                            <button type="button" id="btnAddCat2" class="neo-btn px-3 py-2 text-sm">추가</button>

                            <!-- 품목 추가 -->
                            <button type="button" id="btnAddItem" class="neo-btn px-3 py-2 text-sm" disabled>품목
                                추가</button>
                        </div>
                    </div>

                    <!-- 품목 행 템플릿 -->
                    <template id="menuRowTmpl">
                        <div class="grid grid-cols-1 md:grid-cols-[auto_minmax(0,2fr)_minmax(0,1fr)_auto]
                                    gap-3 items-start border rounded-lg p-3 bg-white overflow-hidden">
                            <input type="file" name="menuImage[]" accept="image/*"
                                class="neo-input mnu-file mnu-cell-center shrink-0 w-28 md:w-36" />
                            <input type="text" name="menuName[]" placeholder="메뉴명" class="neo-input px-3 py-2 min-w-0"
                                required />
                            <input type="text" name="menuPrice[]" placeholder="가격(숫자)"
                                class="neo-input px-3 py-2 min-w-0" inputmode="numeric" />
                            <button type="button" class="neo-btn neo-danger px-3 py-2 btn-remove shrink-0">삭제</button>

                            <textarea name="menuDesc[]" placeholder="설명(선택)" rows="2"
                                class="neo-input px-3 py-2 md:col-span-4 min-w-0"></textarea>

                            <input type="hidden" name="menuCategory[]" class="menu-cat-hidden" value="">
                        </div>
                    </template>

                </section>

                <!-- 9) 연락처 -->
                <section class="neo-section p-5">
                    <h3 class="text-xl font-bold text-blue-900 mb-4">⑨ 연락처</h3>
                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0"
                            for="phoneNumber">대표전화</label>
                        <input id="phoneNumber" name="phone" placeholder="02-123-4567"
                            class="neo-input flex-1 px-3 py-2">
                    </div>
                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="homepage">홈페이지</label>
                        <input id="homepage" name="homepage" placeholder="URL" class="neo-input flex-1 px-3 py-2">
                    </div>
                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="instagram">인스타그램</label>
                        <input id="instagram" name="instagram" placeholder="Instagram URL"
                            class="neo-input flex-1 px-3 py-2">
                    </div>
                    <div class="flex flex-col md:flex-row md:items-center gap-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="facebook">페이스북</label>
                        <input id="facebook" name="facebook" placeholder="Facebook URL"
                            class="neo-input flex-1 px-3 py-2">
                    </div>
                </section>

                <!-- 10) 추가 설명 -->
                <section class="neo-section p-5">
                    <h3 class="text-xl font-bold text-blue-900 mb-3">⑩ 추가 설명</h3>
                    <textarea id="additionalDesc" name="additionalDesc" rows="4" placeholder="추가 설명을 입력하세요."
                        class="neo-input w-full px-3 py-2"></textarea>
                </section>

                <!-- ⑪ 이미지 (최대 3장) -->
                <section class="neo-section p-5">
                    <h3 class="text-xl font-bold text-blue-900 mb-4">⑪ 이미지 (최대 3장)</h3>
                    <input type="file" id="imagesInput" name="storeImages" multiple accept="image/*"
                        class="neo-input block w-full mb-3 px-3 py-2 file:mr-4 file:py-2 file:px-4 file:rounded file:bg-blue-100 file:text-blue-700 hover:file:bg-blue-200" />
                    <div id="imagesPreview" class="flex gap-3"></div>
                </section>

                <!-- 12) 주소 입력 + 지도 -->
                <section class="neo-section p-5">
                    <h3 class="text-xl font-bold text-blue-900 mb-4">⑫ 주소 입력</h3>
                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="postalCode">우편번호</label>
                        <div class="flex-1 grid grid-cols-1 md:grid-cols-[1fr_auto_auto] gap-2 min-w-0">
                            <input id="postalCode" name="postalCode" placeholder="우편번호" readonly
                                class="neo-input w-full h-12 px-4">
                            <button type="button" onclick="openDaumPostcode()" class="neo-btn h-12 px-4 md:col-auto">주소
                                찾기</button>
                            <button type="button" onclick="clearAddress()"
                                class="neo-btn neo-danger h-12 px-4 md:col-auto">주소 삭제</button>
                        </div>
                    </div>

                    <div class="flex flex-col md:flex-row md:items-center gap-3 mb-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="roadAddress">도로명
                            주소</label>
                        <input id="roadAddress" name="roadAddress" placeholder="도로명 주소" readonly
                            class="neo-input flex-1 px-3 py-2">
                    </div>

                    <div class="flex flex-col md:flex-row md:items-center gap-3">
                        <label class="w-36 font-medium text-blue-900 text-center shrink-0" for="detailAddress">상세
                            주소</label>
                        <input id="detailAddress" name="detailAddress" placeholder="상세 주소"
                            class="neo-input flex-1 px-3 py-2">
                    </div>

                    <div id="map" class="w-full h-64 border border-blue-100 rounded-xl mt-4 neo-section"></div>
                </section>

                <!-- 버튼 -->
                <div class="text-center space-x-4 pt-2">
                    <button type="submit" class="neo-btn px-6 py-2">입력 완료</button>
                    <button type="button" onclick="updateData()" class="neo-btn px-6 py-2">수정</button>
                </div>
            </form>
        </div>

        <!-- 등록 완료 모달 -->
        <div id="successModal" class="fixed inset-0 hidden z-[9999]">
            <div class="absolute inset-0 bg-black/40"></div>
            <div class="absolute inset-0 flex items-center justify-center p-4">
                <div class="neo-section w-full max-w-md p-6 text-center">
                    <h4 class="text-xl font-bold text-blue-900 mb-2">등록이 완료되었습니다</h4>
                    <p id="successText" class="text-slate-600 mb-5">잠시 후 상세 페이지로 이동합니다.</p>
                    <button id="successOk" type="button" class="neo-btn px-6 py-2">확인</button>
                </div>
            </div>
        </div>

        <!-- Prev / Next FAB -->
        <div id="page-nav-fab" class="fixed inset-0 pointer-events-none z-40">
            <button id="fab-prev"
                class="hidden md:flex items-center justify-center pointer-events-auto w-12 h-12 md:w-14 md:h-14 rounded-full bg-white/80 backdrop-blur border border-white/60 shadow-lg text-gray-700 hover:shadow-xl hover:bg-white absolute left-2 md:left-6 top-1/2 -translate-y-1/2"
                aria-label="이전 페이지">
                <span class="text-2xl md:text-3xl leading-none">←</span>
            </button>
            <button id="fab-next"
                class="hidden md:flex items-center justify-center pointer-events-auto w-12 h-12 md:w-14 md:h-14 rounded-full bg-white/80 backdrop-blur border border-white/60 shadow-lg text-gray-700 hover:shadow-xl hover:bg-white absolute right-2 md:right-6 top-1/2 -translate-y-1/2"
                aria-label="다음 페이지">
                <span class="text-2xl md:text-3xl leading-none">→</span>
            </button>
            <div id="page-nav-mobile"
                class="fixed bottom-5 left-0 right-0 flex justify-between px-4 md:hidden pointer-events-auto">
                <button id="fab-prev-sm"
                    class="w-11 h-11 rounded-full bg-white/90 backdrop-blur border border-white/60 shadow-lg text-gray-700">←</button>
                <button id="fab-next-sm"
                    class="w-11 h-11 rounded-full bg-white/90 backdrop-blur border border-white/60 shadow-lg text-gray-700">→</button>
            </div>
        </div>

        <!-- 플로팅 품목 추가 버튼 -->
        <button id="fabAddItem" type="button" title="품목 추가 (Ctrl+Enter)"
            class="fixed bottom-6 right-6 w-14 h-14 rounded-full shadow-xl text-2xl leading-none bg-blue-600 text-white z-[2147483647]">＋</button>
    </main>

    <!-- 푸터 -->
    <div id="footer-placeholder"></div>

    <!-- SCRIPT -->
    <script>
        /* =========================================================
           기본 상수 / 상태
        ========================================================= */
        const API = { REGISTER: "/store", VERIFY_BIZ: "/verify-biz" };
        const state = { map: null, mapMarker: null, mapGeocoder: null };

        /* =========================================================
           유틸
        ========================================================= */
        const qs = (sel, el = document) => el.querySelector(sel);
        const qsa = (sel, el = document) => Array.from(el.querySelectorAll(sel));
        const onlyDigits = s => String(s || "").replace(/[^\d]/g, "");
        const formatPriceView = v => (v ? onlyDigits(v).replace(/\B(?=(\d{3})+(?!\d))/g, ",") : "");

        /* ==== 사업자번호 3칸 입력 UX ==== */
        function getBizNumberParts() {
            const d = s => (s || "").replace(/[^\d]/g, "");
            const b1 = d(qs("#biz1")?.value), b2 = d(qs("#biz2")?.value), b3 = d(qs("#biz3")?.value);
            return { b1, b2, b3, full: (b1 || "") + (b2 || "") + (b3 || "") };
        }
        function initBizInputs() {
            const i1 = qs("#biz1"), i2 = qs("#biz2"), i3 = qs("#biz3"), out = qs("#bizVerifyResult");
            const d = s => (s || "").replace(/[^\d]/g, "");
            const jump = (from, to, max) => {
                from?.addEventListener("input", () => {
                    from.value = d(from.value).slice(0, max);
                    if (from.value.length === max) to?.focus();
                    if (out) out.textContent = "";
                });
                from?.addEventListener("keydown", e => { if (e.key === "Backspace" && from.value.length === 0) to?.focus(); });
                from?.addEventListener("focus", () => from.select());
            };
            if (i1 && i2 && i3) {
                jump(i1, i2, 3); jump(i2, i3, 2);
                i3.addEventListener("input", () => { i3.value = d(i3.value).slice(0, 5); if (out) out.textContent = ""; });
                i1.addEventListener("paste", e => {
                    const t = (e.clipboardData || window.clipboardData).getData("text") || "";
                    const dd = t.replace(/[^\d]/g, "");
                    if (dd.length === 10) {
                        e.preventDefault();
                        i1.value = dd.slice(0, 3); i2.value = dd.slice(3, 5); i3.value = dd.slice(5); i3.focus();
                        if (out) out.textContent = "";
                    }
                });
            }
        }

        /* =========================================================
           헤더/푸터 포함
        ========================================================= */
        async function includePartials() {
            try {
                const header = await fetch("/components/header.html").then(r => r.ok ? r.text() : "");
                const footer = await fetch("/components/footer.html").then(r => r.ok ? r.text() : "");
                if (header) qs("#header-placeholder")?.replaceChildren(document.createRange().createContextualFragment(header));
                if (footer) qs("#footer-placeholder")?.replaceChildren(document.createRange().createContextualFragment(footer));
            } catch { }
        }

        /* =========================================================
           사업자번호 인증
        ========================================================= */
        async function verifyBiz() {
            const out = qs("#bizVerifyResult");
            const btn = qs("#btnVerifyBiz");
            const bizVerified = qs("#bizVerified");
            const bizNumber = qs("#bizNumber");
            const nameInput = qs("#businessName");

            const { b1, b2, b3, full } = getBizNumberParts();
            if (out) { out.textContent = ""; out.className = "text-sm text-center"; }

            if (b1.length !== 3 || b2.length !== 2 || b3.length !== 5) {
                if (out) { out.textContent = "사업자번호 형식이 올바르지 않습니다."; out.classList.add("text-red-600"); }
                if (bizVerified) bizVerified.value = "N";
                return;
            }

            btn && (btn.disabled = true);
            if (out) { out.textContent = "인증 조회 중…"; out.className = "text-sm text-slate-600 text-center"; }

            try {
                const res = await fetch(API.VERIFY_BIZ, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ b_no: [full] })
                });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();

                const rec = Array.isArray(data?.data) ? data.data[0] : null;
                const isActive =
                    (rec?.b_stt_cd === "01") ||
                    (typeof rec?.b_stt === "string" && rec.b_stt.trim() === "계속사업자") ||
                    (data?.ok === true && (data?.valid === true || data?.status === "OK"));

                if (isActive) {
                    if (bizVerified) bizVerified.value = "Y";
                    if (bizNumber) bizNumber.value = full;
                    const bizName = (rec?.b_nm || rec?.biz_name || "").trim();
                    if (bizName && nameInput && !nameInput.value.trim()) nameInput.value = bizName;
                    if (out) { out.textContent = "인증 완료: 계속사업자 상태입니다."; out.className = "text-sm text-green-700 text-center"; }
                } else {
                    if (bizVerified) bizVerified.value = "N";
                    if (out) { out.textContent = "인증 실패 또는 상태 확인 불가 (서버 응답 포맷 확인 필요)"; out.className = "text-sm text-red-600 text-center"; }
                }
            } catch (e) {
                if (bizVerified) bizVerified.value = "N";
                if (out) { out.textContent = "인증 API 미연동 또는 응답 실패 (나중에 연동)"; out.className = "text-sm text-orange-600 text-center"; }
            } finally {
                btn && (btn.disabled = false);
            }
        }

        /* =========================================================
           이메일 도메인 처리
        ========================================================= */
        function updateEmail() {
            const idPart = qs("#emailId")?.value.trim() || "";
            const sel = qs("#emailDomainSelect")?.value || "";
            const custom = qs("#customDomainInput");
            const dom = sel === "custom" ? (custom?.value.trim() || "") : sel;
            const full = (idPart && dom) ? `${idPart}@${dom}` : "";
            const hidden = qs("#ownerEmail");
            if (hidden) hidden.value = full;
        }
        function handleDomainChange(el) {
            const custom = qs("#customDomainInput");
            if (el.value === "custom") { custom?.classList.remove("hidden"); custom?.focus(); }
            else { custom?.classList.add("hidden"); if (custom) custom.value = ""; }
            updateEmail();
        }

        /* =========================================================
           카테고리/서브카테고리 드롭다운
        ========================================================= */
        function initCategoryDropdowns() {
            const display = qs("#businessCategoryDisplay");
            const list = qs("#categoryList");
            const hidden = qs("#businessCategory");
            const btn = qs("#categoryToggle");

            // ▼ 버튼 토글
            btn?.addEventListener("click", () => list.classList.toggle("hidden"));
            // ✅ 입력창 클릭도 토글
            display?.addEventListener("click", () => list.classList.toggle("hidden"));

            // 항목 선택
            list?.querySelectorAll("li").forEach(li => {
                li.addEventListener("click", () => {
                    hidden.value = li.dataset.value;
                    display.value = li.dataset.value;
                    list.classList.add("hidden");

                    const subWrap = qs("#subcatRow");
                    if (li.dataset.value === "한식") subWrap?.classList.remove("hidden");
                    else {
                        subWrap?.classList.add("hidden");
                        qs("#subcategoryDisplay") && (qs("#subcategoryDisplay").value = "");
                        qs("#businessSubcategory") && (qs("#businessSubcategory").value = "");
                    }
                });
                // 서브카테고리 토글/선택
                const subDisplay = qs("#subcategoryDisplay");
                const subList = qs("#subcategoryList");
                const subHidden = qs("#businessSubcategory");
                const subBtn = qs("#subcategoryToggle");

                subBtn?.addEventListener("click", () => subList.classList.toggle("hidden"));
                subDisplay?.addEventListener("click", () => subList.classList.toggle("hidden"));

                /* ✅ 여기 추가: 서브카테고리 항목 클릭 시 값 세팅 */
                subList?.addEventListener("click", (e) => {
                    const li = e.target.closest("li[data-value]");
                    if (!li) return;
                    subHidden.value = li.dataset.value;                 // 폼 전송용 hidden
                    subDisplay.value = li.textContent.trim();           // 화면 표시
                    subList.classList.add("hidden");
                });

                /* 바깥 클릭 시 닫기 */
                document.addEventListener("click", (e) => {
                    if (list && !list.contains(e.target) && e.target !== btn && e.target !== display) list.classList.add("hidden");
                    if (subList && !subList.contains(e.target) && e.target !== subBtn && e.target !== subDisplay) subList.classList.add("hidden");
                });
            });

            // 서브카테고리 토글/선택
            const subDisplay = qs("#subcategoryDisplay");
            const subList = qs("#subcategoryList");
            const subHidden = qs("#businessSubcategory");
            const subBtn = qs("#subcategoryToggle");

            subBtn?.addEventListener("click", () => subList.classList.toggle("hidden"));
            subDisplay?.addEventListener("click", () => subList.classList.toggle("hidden"));

            // 바깥 클릭 시 닫기
            document.addEventListener("click", (e) => {
                if (list && !list.contains(e.target) && e.target !== btn && e.target !== display) list.classList.add("hidden");
                if (subList && !subList.contains(e.target) && e.target !== subBtn && e.target !== subDisplay) subList.classList.add("hidden");
            });

        }

        /* =========================================================
           우편번호/카카오 지도
        ========================================================= */
        function openDaumPostcode() {
            new daum.Postcode({
                oncomplete: function (data) {
                    qs("#postalCode").value = data.zonecode || "";
                    qs("#roadAddress").value = data.roadAddress || data.address || "";
                    updateMapByAddress(qs("#roadAddress").value);
                }
            }).open({
                left: (window.screen.width / 2) - (500 / 2),   // 가로 중앙 (팝업 너비 500px 가정)
                top: (window.screen.height / 2) - (600 / 2)    // 세로 중앙 (팝업 높이 600px 가정)
            });
        }
        window.openDaumPostcode = openDaumPostcode;

        function clearAddress() {
            qs("#postalCode").value = ""; qs("#roadAddress").value = ""; qs("#detailAddress").value = "";
            if (state.map && state.mapMarker) { state.mapMarker.setMap(null); state.mapMarker = null; }
        }
        window.clearAddress = clearAddress;

        function initKakaoMap() {
            if (!window.kakao || !window.kakao.maps) return;
            window.kakao.maps.load(function () {
                const container = qs("#map");
                const center = new kakao.maps.LatLng(37.5665, 126.9780);
                state.map = new kakao.maps.Map(container, { center, level: 5 });
                state.mapGeocoder = new kakao.maps.services.Geocoder();
            });
        }
        function updateMapByAddress(addr) {
            if (!addr || !state.mapGeocoder) return;
            state.mapGeocoder.addressSearch(addr, function (result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                    state.map.setCenter(coords);
                    if (state.mapMarker) state.mapMarker.setMap(null);
                    state.mapMarker = new kakao.maps.Marker({ map: state.map, position: coords });
                }
            });
        }

        /* =========================================================
           이미지 미리보기
        ========================================================= */
        function initImagePreview() {
            const input = qs("#imagesInput");
            const preview = qs("#imagesPreview");
            input?.addEventListener("change", () => {
                if (!preview) return;
                preview.innerHTML = "";
                const files = Array.from(input.files || []).slice(0, 3);
                files.forEach(file => {
                    const url = URL.createObjectURL(file);
                    const img = document.createElement("img");
                    img.src = url; img.className = "w-24 h-24 object-cover rounded-lg border";
                    preview.appendChild(img);
                });
            });
        }

        /* =========================================================
           도움말 토글 (업종 예시)
        ========================================================= */
        function toggleTip(ev) {
            const tip = qs("#tipBox");
            if (!tip) return;
            if (tip.classList.contains("hidden")) {
                const rect = ev.currentTarget.getBoundingClientRect();
                tip.style.left = `${rect.left}px`;
                tip.style.top = `${rect.bottom + 6 + window.scrollY}px`;
                tip.classList.remove("hidden");
            } else tip.classList.add("hidden");
        }
        window.toggleTip = toggleTip;

        /* =========================================================
           임시 수정 버튼
        ========================================================= */
        function updateData() { alert("수정 기능은 추후 구현 예정입니다."); }
        window.updateData = updateData;

        /* =========================================================
           전화 인증 (목업)
        ========================================================= */
        function initPhoneAuth() {
            const btn = qs("#verifyPhoneButton");
            const out = qs("#phoneVerifyResult");
            btn?.addEventListener("click", () => {
                if (!out) return;
                out.textContent = "인증요청 전송(목업) - 실제 연동은 추후 적용";
                out.className = "text-sm text-blue-700 text-center";
            });
        }

        /* =========================================================
           FAB/Prev-Next/플로팅 Add
        ========================================================= */
        function initFABS() {
            const prev = qs("#fab-prev"), next = qs("#fab-next");
            const prevSm = qs("#fab-prev-sm"), nextSm = qs("#fab-next-sm");
            [prev, prevSm].forEach(b => b && (b.onclick = () => window.history.back()));
            [next, nextSm].forEach(b => b && (b.onclick = () => window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" })));
        }

        // ============================
        // 메뉴 카테고리 → 품목 모듈 (정리본)
        // ============================

        // 전역 상태
        const menuState = { currentCategory: "", panels: new Map(), opened: new Set(), panelsWrap: null };

        function initMenuModule() {
            const panelsWrap = qs('#menuCategoryPanels');
            const addBtn = qs('#btnAddItem');
            const addCatBtn = qs('#btnAddCat');
            const newCatInput = qs('#newCatInput');
            const addCatBtn2 = qs('#btnAddCat2');
            const newCatInput2 = qs('#newCatInput2');

            menuState.panelsWrap = panelsWrap;

            // 상단 카테고리 추가 버튼
            addCatBtn?.addEventListener('click', () => {
                const name = (newCatInput?.value || "").trim();
                if (!name) return alert('카테고리 이름을 입력하세요.');
                if (menuState.panels.has(name)) { alert('이미 존재하는 카테고리입니다.'); showCategory(name); return; }
                addCategory(name);
                newCatInput.value = "";
                showCategory(name);
            });
            newCatInput?.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); addCatBtn?.click(); } });

            // 하단 카테고리 추가 버튼
            addCatBtn2?.addEventListener('click', () => {
                const name = (newCatInput2?.value || "").trim();
                if (!name) return alert('카테고리 이름을 입력하세요.');
                if (menuState.panels.has(name)) { alert('이미 존재하는 카테고리입니다.'); showCategory(name); return; }
                addCategory(name);
                newCatInput2.value = "";
                showCategory(name);
            });
            newCatInput2?.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); addCatBtn2?.click(); } });

            // 품목 추가 버튼
            addBtn?.addEventListener('click', () => {
                if (!menuState.currentCategory) return alert('카테고리를 먼저 선택하세요.');
                addMenuRowTo(menuState.currentCategory);
            });
        }

        // ==== 보조 함수들은 initMenuModule 바깥에 위치 ====
        function addCategory(cat) {
            const panelsWrap = menuState.panelsWrap;
            const panel = document.createElement('div');
            panel.dataset.panel = cat;
            panel.className = "hidden neo-section p-4";
            panel.innerHTML = `
      <div class="flex items-center justify-between mb-3">
        <h4 class="text-lg font-semibold text-blue-900">${cat}</h4>
        <button type="button" class="neo-btn neo-danger px-3 py-1 text-xs cat-delete" data-cat="${cat}">
          카테고리 삭제
        </button>
      </div>
      <div class="space-y-4" data-cat-list="${cat}"></div>
    `;
            panelsWrap.appendChild(panel);
            menuState.panels.set(cat, panel);

            // 삭제 이벤트
            panel.querySelector('.cat-delete').addEventListener('click', () => deleteCategory(cat));
        }

        function showCategory(cat) {
            menuState.currentCategory = cat;
            const addBtn = qs('#btnAddItem');
            const currentTxt = qs('#currentCatText');
            const panel = menuState.panels.get(cat);

            if (!cat || !panel) {
                if (addBtn) addBtn.disabled = true;
                if (currentTxt) currentTxt.textContent = '선택 전';
                return;
            }

            // 모든 패널 토글
            menuState.panels.forEach((p, name) => {
                p.classList.toggle('hidden', name !== cat);
                p.classList.toggle('ring-2', name === cat);
                p.classList.toggle('ring-blue-300', name === cat);
            });

            if (addBtn) addBtn.disabled = false;
            if (currentTxt) currentTxt.textContent = cat;
            panel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function deleteCategory(cat) {
            const panel = menuState.panels.get(cat);
            if (!panel) return;

            const list = panel.querySelector(`[data-cat-list="${cat}"]`);
            const count = list ? list.children.length : 0;
            if (!confirm(`‘${cat}’ 카테고리${count ? ` (품목 ${count}개 포함)` : ""}를 삭제할까요?`)) return;

            panel.remove();
            menuState.panels.delete(cat);

            if (menuState.currentCategory === cat) {
                menuState.currentCategory = '';
                qs('#btnAddItem').disabled = true;
                qs('#currentCatText').textContent = '선택 전';
            }
        }

        function addMenuRowTo(cat) {
            const tmpl = qs('#menuRowTmpl');
            const node = tmpl.content.cloneNode(true);
            const row = node.querySelector('.grid');

            // 가격 숫자만
            const price = node.querySelector('input[name="menuPrice[]"]');
            price.addEventListener('input', (e) => { e.target.value = onlyDigits(e.target.value); });

            // 삭제 버튼
            node.querySelector('.btn-remove').addEventListener('click', () => row.remove());

            // 카테고리 주입
            node.querySelector('.menu-cat-hidden').value = cat;

            // 추가 + 포커스
            const list = qs(`[data-cat-list="${cat}"]`);
            list.appendChild(node);
            row.scrollIntoView({ behavior: 'smooth', block: 'center' });
            row.querySelector('input[name="menuName[]"]')?.focus();
        }


        function showCategory(cat) {
            menuState.currentCategory = cat;

            const addBtn = qs('#btnAddItem');
            const currentTxt = qs('#currentCatText');
            const panel = menuState.panels.get(cat);

            if (!cat || !panel) {
                if (addBtn) addBtn.disabled = true;
                if (currentTxt) currentTxt.textContent = '선택 전';
                return;
            }

            // ✅ 처음 펼칠 때만: 선택 순서 보장을 위해 맨 아래로 재배치
            if (!panel.dataset.opened) {
                panel.dataset.opened = '1';
                menuState.opened.add(cat);
                menuState.panelsWrap.appendChild(panel);
            }

            panel.classList.remove('hidden');
            if (addBtn) addBtn.disabled = false;
            if (currentTxt) currentTxt.textContent = cat;

            // 선택 표시(옵션)
            menuState.panels.forEach((p, name) => {
                p.classList.toggle('ring-2', name === cat);
                p.classList.toggle('ring-blue-300', name === cat);
            });

            panel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function deleteCategory(cat) {
            const panel = menuState.panels.get(cat);
            if (!panel) return;

            const list = panel.querySelector(`[data-cat-list="${cat}"]`);
            const count = list ? list.children.length : 0;
            const ok = confirm(`‘${cat}’ 카테고리${count ? ` (품목 ${count}개 포함)` : ""}를 삭제할까요?\n입력된 품목들도 같이 삭제됩니다.`);
            if (!ok) return;

            if (list) list.innerHTML = '';
            panel.classList.add('hidden');

            // 선택 순서 관리 초기화
            panel.removeAttribute('data-opened');
            if (menuState.opened) menuState.opened.delete(cat);

            if (menuState.currentCategory === cat) {
                menuState.currentCategory = '';
                const addBtn = qs('#btnAddItem'); if (addBtn) addBtn.disabled = true;
                const currentTxt = qs('#currentCatText'); if (currentTxt) currentTxt.textContent = '선택 전';

            }
        }

        function addMenuRowTo(cat) {
            const tmpl = qs('#menuRowTmpl');
            const node = tmpl.content.cloneNode(true);
            const row = node.querySelector('.grid');

            // 가격 숫자만
            const price = node.querySelector('input[name="menuPrice[]"]');
            price.addEventListener('input', (e) => { e.target.value = onlyDigits(e.target.value); });

            // 품목행 삭제
            node.querySelector('.btn-remove').addEventListener('click', () => row.remove());

            // 카테고리 주입
            node.querySelector('.menu-cat-hidden').value = cat;

            // 추가 + 포커스/스크롤
            const list = qs(`[data-cat-list="${cat}"]`);
            list.appendChild(node);
            const lastRow = list.lastElementChild;
            lastRow?.scrollIntoView({ behavior: 'smooth', block: 'center' });
            lastRow?.querySelector('input[name="menuName[]"]')?.focus();
        }

        // 이벤트 바인딩 (한 벌만)
        function bindEvents() {
            qs("#btnVerifyBiz")?.addEventListener("click", verifyBiz);
            qs("#emailId")?.addEventListener("input", updateEmail);
            qs("#customDomainInput")?.addEventListener("input", updateEmail);
            qs("#emailDomainSelect")?.addEventListener("change", (e) => handleDomainChange(e.target));
            qs("#storeForm")?.addEventListener("submit", onSubmitSimple);
        }

        async function onSubmitSimple(e) {
            e.preventDefault();

            const businessName = qs("#businessName")?.value.trim();
            const roadAddress = qs("#roadAddress")?.value.trim();
            if (!businessName || !roadAddress) {
                alert("상호와 도로명 주소는 필수입니다.");
                return;
            }

            const hasAnyMenu = qsa('input[name="menuName[]"]').some(i => i.value.trim() !== "");
            if (!hasAnyMenu) { alert("메뉴를 최소 1개 이상 입력해 주세요."); return; }

            // 숫자만 남기기 (기존 로직 유지)
            qsa('input[name="menuPrice[]"]').forEach(i => { i.value = onlyDigits(i.value); });

            // 디버그: 제출 전 입력 개수/요약
            const menuNames = qsa('input[name="menuName[]"]').map(i => i.value.trim()).filter(Boolean);
            const menuPrices = qsa('input[name="menuPrice[]"]').map(i => i.value.trim()).filter(Boolean);
            const menuCats = qsa('input[name="menuCategory[]"]').map(i => i.value.trim()).filter(Boolean);
            const menuImageInputs = qsa('input[name="menuImage[]"]');
            const menuImageCount = menuImageInputs.reduce((n, el) => n + (el.files?.length || 0), 0);

            const fd = new FormData(qs('#storeForm'));

            // 💡 FormData 내용 요약 로거 (파일은 이름/크기만)
            (function logFormDataSummary() {
                const summary = {};
                for (const [k, v] of fd.entries()) {
                    if (v instanceof File) {
                        (summary[k] ||= []).push({ name: v.name, size: v.size, type: v.type });
                    } else {
                        (summary[k] ||= []).push(String(v));
                    }
                }
                console.groupCollapsed('[REGISTER] FormData summary');
                console.log('menuNames:', menuNames.length, menuNames);
                console.log('menuPrices:', menuPrices.length, menuPrices);
                console.log('menuCategories:', menuCats.length, menuCats);
                console.log('menuImage files total:', menuImageCount);
                console.dir(summary);
                console.groupEnd();
            })();

            try {
                const res = await fetch(API.REGISTER, {
                    method: 'POST',
                    body: fd,
                    // 헤더는 넣지 마세요: Content-Type은 브라우저가 boundary 포함해 자동 지정
                });

                // 🔍 응답 메타/헤더/본문(스니펫)까지 로그
                const meta = {
                    ok: res.ok,
                    status: res.status,
                    statusText: res.statusText,
                    url: res.url
                };
                const headers = Object.fromEntries(res.headers.entries());
                const raw = await res.text(); // 본문 선확보 (JSON이 아니어도 확인 가능)
                const rawSnippet = raw?.slice(0, 2000); // 너무 길면 잘라서

                console.groupCollapsed('[REGISTER] Response debug');
                console.log('meta:', meta);
                console.log('headers:', headers);
                console.log('body(raw):', rawSnippet);
                console.groupEnd();

                if (!res.ok) {
                    // 서버가 에러 메시지를 텍스트로 내려주면 그대로 띄움
                    throw new Error(`HTTP ${res.status}${rawSnippet ? `: ${rawSnippet}` : ''}`);
                }

                // OK이면 JSON 파싱 시도
                let data = {};
                try {
                    data = raw ? JSON.parse(raw) : {};
                } catch (e) {
                    console.warn('[REGISTER] JSON parse 실패, raw 사용:', e);
                    data = {};
                }

                if (!data?.ok || !data?.id) throw new Error("등록 응답에 id가 없습니다.");

                // 성공 처리
                const modal = qs("#successModal");
                const okBtn = qs("#successOk");
                const goDetail = () =>
                    location.href = `/ndetail.html?id=${encodeURIComponent(data.id)}&type=food`;
                if (modal) {
                    modal.classList.remove("hidden");
                    if (okBtn) okBtn.onclick = goDetail;
                    setTimeout(goDetail, 1200);
                } else {
                    alert("등록 완료!"); goDetail();
                }

            } catch (err) {
                console.error('[REGISTER] 실패:', err);
                alert("등록 실패: " + (err?.message || "unknown"));
            }
        }

        function init() {
            includePartials();
            bindEvents();
            initCategoryDropdowns();
            initImagePreview();
            initPhoneAuth();
            initFABS();
            initBizInputs();
            initMenuModule();
            bindPriceFormatters();

            if (window.kakao?.maps?.load) {
                initKakaoMap();
            } else {
                const iv = setInterval(() => {
                    if (window.kakao?.maps?.load) { clearInterval(iv); initKakaoMap(); }
                }, 200);
                setTimeout(() => clearInterval(iv), 5000);
            }
        }

        document.addEventListener("DOMContentLoaded", init);

        // ===== 가격 입력 포맷 =====
        function bindPriceFormatters() {
            document.addEventListener('input', (e) => {
                const el = e.target.closest('input[name="menuPrice[]"]');
                if (!el) return;
                const right = el.value.length - (el.selectionEnd ?? el.value.length);
                el.value = formatPriceView(el.value);
                const pos = Math.max(0, el.value.length - right);
                requestAnimationFrame(() => el.setSelectionRange(pos, pos));
            });

            document.addEventListener('paste', (e) => {
                const el = e.target.closest('input[name="menuPrice[]"]');
                if (!el) return;
                e.preventDefault();
                const text = (e.clipboardData || window.clipboardData).getData('text');
                el.value = formatPriceView(onlyDigits(text));
            });
        }
    </script>
</body>

</html>