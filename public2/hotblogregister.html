<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™ë³´ ë¸”ë¡œê·¸ ì‘ì„±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden {
            display: none;
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800">

    <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-xl border mt-10 mb-20 p-8">
        <h1 class="text-3xl font-bold text-center mb-8 text-blue-700">âœï¸ í™ë³´ ë¸”ë¡œê·¸ ì‘ì„±</h1>

        <!-- ì‘ì„± ë°©ì‹ ì„ íƒ -->
        <div class="mb-6 space-x-4 flex justify-center">
            <label><input type="radio" name="qa_mode" value="theme" checked> ì˜¤ëŠ˜ì˜ í…Œë§ˆ ì¶”ì²œ</label>
            <label><input type="radio" name="qa_mode" value="random"> ì˜¤ëŠ˜ì˜ ëœë¤ ì¶”ì²œ</label>
            <label><input type="radio" name="qa_mode" value="self"> ë‚´ê°€ ë¬»ê³  ë‚´ê°€ ë‹µí•˜ëŠ” ë°©ì‹</label>
        </div>

        <!-- ë‚´ê°€ ë¬»ê³  ë‚´ê°€ ë‹µí•˜ëŠ” ë°©ì‹ â†’ ì¶”ê°€ ì„ íƒë€ -->
        <div id="selfSubOptions" class="hidden mb-6">
            <div class="border rounded-lg p-4 bg-gray-50 shadow text-center">
                <p class="font-bold mb-3 text-lg">ğŸ“Œ ì–´ë””ì— ì˜¬ë¦¬ì‹¤ê±´ê°€ìš”?</p>
                <div class="flex justify-center space-x-6">
                    <label class="flex items-center space-x-2">
                        <input type="radio" name="selfTarget" value="theme" checked>
                        <span>ì˜¤ëŠ˜ì˜ í…Œë§ˆ ì¶”ì²œ</span>
                    </label>
                    <label class="flex items-center space-x-2">
                        <input type="radio" name="selfTarget" value="random">
                        <span>ì˜¤ëŠ˜ì˜ ëœë¤ ì¶”ì²œ</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- ê³µí†µ í¼ -->
        <form id="blogForm" enctype="multipart/form-data" class="space-y-6 bg-white p-6 rounded shadow">
            <!-- ì œëª© -->
            <div>
                <label class="block mb-2 font-semibold">ì œëª©</label>
                <input type="text" name="title" class="w-full border rounded p-2" required>
            </div>

            <!-- ëŒ€í‘œ ì´ë¯¸ì§€ + ê°€ê²Œ ì •ë³´ (ì„¸ë¡œ ë°°ì¹˜) -->
            <div class="space-y-4">
                <!-- ëŒ€í‘œ ì´ë¯¸ì§€ -->
                <div>
                    <label class="block mb-2 font-semibold">ëŒ€í‘œ ì´ë¯¸ì§€ (1ì¥)</label>
                    <input type="file" name="coverImage" accept="image/*" class="w-full border rounded p-2" required>
                    <p class="text-xs text-gray-500 mt-1">í•œ ì¥ë§Œ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                </div>

                <!-- ê°€ê²Œëª… -->
                <div>
                    <label class="block mb-2 font-semibold">ê°€ê²Œëª…</label>
                    <input type="text" name="store_name" class="w-full border rounded p-2" required>
                </div>

                <!-- ì—…ì¢… -->
                <div>
                    <label class="block mb-2 font-semibold">ì—…ì¢…</label>
                    <input type="text" name="category" class="w-full border rounded p-2" placeholder="ì˜ˆ: ì¹´í˜, í•œì‹, ë¯¸ìš©ì‹¤"
                        required>
                </div>

                <!-- ì „í™”ë²ˆí˜¸ -->
                <div>
                    <label class="block mb-2 font-semibold">ì „í™”ë²ˆí˜¸</label>
                    <input type="text" name="phone" class="w-full border rounded p-2" placeholder="ì˜ˆ: 02-123-4567">
                </div>

                <!-- í™ˆí˜ì´ì§€ URL -->
                <div>
                    <label class="block mb-2 font-semibold">í™ˆí˜ì´ì§€ URL</label>
                    <input type="url" name="url" class="w-full border rounded p-2"
                        placeholder="ì˜ˆ: https://www.mystore.com">
                </div>

            </div>

            <!-- ì§ˆë¬¸/ë‹µë³€ ì˜ì—­ -->
            <div id="qaSection" class="space-y-4"></div>

            <!-- ì €ì¥ ë²„íŠ¼ -->
            <div class="flex justify-center mb-6">
                <button form="blogForm" type="submit"
                    class="bg-blue-600 text-white px-8 py-2 rounded-lg shadow hover:bg-blue-700">
                    ì €ì¥í•˜ê¸°
                </button>
            </div>
        </form>
    </div>

    <script>
        /* ===== ì§ˆë¬¸ ì„¸íŠ¸ ===== */
        const themeQuestions = [
            "ì˜¤ëŠ˜ì˜ í…Œë§ˆì™€ ê°€ê²Œê°€ ì˜ ë§ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
            "ì´ í…Œë§ˆì™€ ì–´ìš¸ë¦¬ëŠ” ëŒ€í‘œ ë©”ë‰´(ë˜ëŠ” ì„œë¹„ìŠ¤)ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
            "ê³„ì ˆÂ·ë‚ ì”¨Â·ìƒí™©ê³¼ ì˜ ì–´ìš¸ë¦¬ëŠ” ë¶€ë¶„ì€ ë¬´ì—‡ì¸ê°€ìš”?",
            "ì´ í…Œë§ˆì—ì„œ ì†ë‹˜ë“¤ì´ ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ì ì€ ë¬´ì—‡ì¸ê°€ìš”?",
            "í…Œë§ˆì™€ ê´€ë ¨ëœ íŠ¹ë³„ ì´ë²¤íŠ¸ë‚˜ í˜œíƒì´ ìˆë‚˜ìš”?",
            "í…Œë§ˆì™€ ì–´ìš¸ë¦¬ëŠ” ê³µê°„(ë¶„ìœ„ê¸°/ì¸í…Œë¦¬ì–´)ì´ ìˆë‹¤ë©´ ì†Œê°œí•´ì£¼ì„¸ìš”.",
            "ì†ë‹˜ë“¤ì—ê²Œ ì´ í…Œë§ˆë¥¼ ê¼­ ì¶”ì²œí•˜ê³  ì‹¶ì€ ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
            "ì‚¬ì¥ë‹˜ì´ ìƒê°í•˜ëŠ” â€˜ì˜¤ëŠ˜ì˜ í…Œë§ˆâ€™ì™€ ê°€ê²Œì˜ í•µì‹¬ ë§¤ë ¥ì€ ë¬´ì—‡ì¸ê°€ìš”?"
        ];

        const randomQuestions = [
            "ê°€ê²Œì˜ ëŒ€í‘œ ë©”ë‰´(ë˜ëŠ” ì„œë¹„ìŠ¤)ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
            "ë‹¨ê³¨ì†ë‹˜ë“¤ì´ ê°€ì¥ ë§ì´ ì°¾ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
            "ì²˜ìŒ ë°©ë¬¸í•˜ëŠ” ì†ë‹˜ë“¤ì—ê²Œ ê¼­ ì¶”ì²œí•˜ê³  ì‹¶ì€ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?",
            "ê°€ê²Œ ìš´ì˜ì— ìˆì–´ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê°€ì¹˜ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
            "ìš°ë¦¬ ê°€ê²Œë§Œì˜ íŠ¹ë³„í•œ ì„œë¹„ìŠ¤ë‚˜ ìë‘ê±°ë¦¬ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
            "ì†ë‹˜ë“¤ì—ê²Œ ê°€ì¥ ë§ì´ ë“£ëŠ” ì¹­ì°¬ì€ ë¬´ì—‡ì¸ê°€ìš”?",
            "ì•ìœ¼ë¡œ ì†ë‹˜ë“¤ì—ê²Œ ì–´ë–¤ ê°€ê²Œë¡œ ê¸°ì–µë˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?",
            "ì‚¬ì¥ë‹˜ì´ ìƒê°í•˜ëŠ” ìš°ë¦¬ ê°€ê²Œì˜ ê°€ì¥ í° ë§¤ë ¥ì€ ë¬´ì—‡ì¸ê°€ìš”?"
        ];

        const qaSection = document.getElementById("qaSection");
        const modeRadios = document.querySelectorAll("input[name='mode']");

        /* ===== ìš´ì˜ìí˜• ì§ˆë¬¸ ì¹´ë“œ ìƒì„± ===== */
        function makeQaCards(list, type) {
            return list.map((q, i) => `
        <div class="border rounded-xl p-4 shadow bg-gray-50 mb-4">
          <label class="block font-bold mb-1">Q${i + 1}. ${q}</label>
          <textarea name="${type}_q${i + 1}_answer" rows="3" maxlength="300"
                    class="w-full border rounded px-3 py-2 mb-2"
                    placeholder="ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"></textarea>
          <label class="block font-bold mb-1">ì‚¬ì§„ (ì„ íƒ)</label>
          <input type="file" name="${type}_q${i + 1}_image" accept="image/*"
                 class="border rounded px-3 py-2 w-full">
        </div>
      `).join('');
        }

        modeRadios.forEach(radio => {
            radio.addEventListener("change", () => {
                if (radio.value === "self") {
                    selfSubOptions.classList.remove("hidden");
                } else {
                    selfSubOptions.classList.add("hidden");
                }
                setMode(radio.value);
            });
        });

        function setMode(mode) {
            if (mode === "theme") {
                qaSection.innerHTML = makeQaCards(themeQuestions, "theme");
            } else if (mode === "random") {
                qaSection.innerHTML = makeQaCards(randomQuestions, "random");
            } else if (mode === "self") {
                // ê¸°ë³¸ ìê°€í˜• Q/A UI
                customQaList = [{ question: "", answer: "" }];
                renderCustomQa();
            }
        }

        /* ===== ì—…ì£¼ ìê°€í˜• ê´€ë¦¬ ===== */
        let customQaList = [{ question: "", answer: "" }];

        function renderCustomQa() {
            qaSection.innerHTML = customQaList.map((item, i) => `
        <div class="border rounded-xl p-4 shadow bg-gray-50 mb-4 relative">
          <label class="block font-bold mb-1">ì§ˆë¬¸ ${i + 1}</label>
          <input type="text" name="custom_q${i + 1}_question"
                 class="w-full border rounded px-3 py-2 mb-2"
                 maxlength="100" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”" required
                 value="${item.question}">
          <label class="block font-bold mb-1">ë‹µë³€</label>
          <textarea name="custom_q${i + 1}_answer" rows="3" maxlength="500"
                    class="w-full border rounded px-3 py-2 mb-2"
                    placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”" required>${item.answer}</textarea>
          <label class="block font-bold mb-1">ì‚¬ì§„ (ì„ íƒ)</label>
          <input type="file" name="custom_q${i + 1}_image" accept="image/*"
                 class="border rounded px-3 py-2 w-full">
          ${i > 0 ? `<button type="button" onclick="removeCustomQa(${i})"
                     class="absolute top-2 right-2 text-red-400 hover:text-red-600 text-2xl font-bold">Ã—</button>` : ""}
        </div>
      `).join('') + `
        <div class="flex justify-center mt-4">
          <button type="button" onclick="addCustomQa()"
            class="bg-green-500 text-white px-4 py-2 rounded shadow hover:bg-green-600">+ ì§ˆë¬¸/ë‹µë³€ ì¶”ê°€</button>
        </div>
      `;
        }

        window.addCustomQa = function () {
            if (customQaList.length >= 8) return alert("ìµœëŒ€ 8ê°œê¹Œì§€ë§Œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!");
            customQaList.push({ question: "", answer: "" });
            renderCustomQa();
        };

        window.removeCustomQa = function (i) {
            customQaList.splice(i, 1);
            renderCustomQa();
        };

        /* ===== ëª¨ë“œ í† ê¸€ ===== */
        function setMode(mode) {
            if (mode === "theme") {
                qaSection.innerHTML = makeQaCards(themeQuestions, "theme");
            } else if (mode === "random") {
                qaSection.innerHTML = makeQaCards(randomQuestions, "random");
            } else if (mode === "self") {
                customQaList = [{ question: "", answer: "" }];
                renderCustomQa();
            }
        }

        modeRadios.forEach(radio => {
            radio.addEventListener("change", () => setMode(radio.value));
        });

        // ê¸°ë³¸: í…Œë§ˆ ëª¨ë“œ
        setMode("theme");

        /* ===== í¼ ì œì¶œ ===== */
        /* ===== í¼ ì œì¶œ ===== */
        document.getElementById("blogForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);

            // qa_mode ê°’ í™•ì¸
            const mode = formData.get("qa_mode");
            if (mode === "self") {
                const selfTarget = formData.get("selfTarget");
                formData.append("target", selfTarget);
            } else {
                formData.append("target", mode);
            }

            try {
                const res = await fetch("/api/hotblog/register", {
                    method: "POST",
                    body: formData
                });
                const data = await res.json();
                if (data.success) {
                    alert("ë“±ë¡ ì™„ë£Œ!");
                    location.href = `/hotblogdetail.html?id=${data.id}`;
                } else {
                    alert("ë“±ë¡ ì‹¤íŒ¨: " + (data.error || "ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”"));
                }
            } catch (err) {
                alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
            }
        });

    </script>
</body>

</html>