<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>핫 서브카테고리 | MALL HANKOOK</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

    body {
      font-family: 'Pretendard', sans-serif;
      background: radial-gradient(80% 120% at 50% -20%, #f3f4f6, #ffffff);
      color: #111827;
    }

    /* ======= Design System (Neomorphism + Glassmorphism Hybrid) ======= */
    .neo-card {
      background: #fff;
      border-radius: 1.25rem;
      box-shadow:
        8px 8px 16px rgba(0, 0, 0, 0.08),
        -8px -8px 16px rgba(255, 255, 255, 0.9);
      transition: all .3s ease;
    }

    .neo-card:hover {
      transform: translateY(-4px);
      box-shadow:
        10px 10px 25px rgba(0, 0, 0, 0.12),
        -6px -6px 16px rgba(255, 255, 255, 0.8);
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(14px);
      border-radius: 1.25rem;
      transition: all .3s ease;
    }

    .glass-card:hover {
      background: rgba(255, 255, 255, 0.55);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .neo-btn {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: #fff;
      border-radius: 0.75rem;
      padding: 0.6rem 1.4rem;
      font-weight: 500;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
      transition: all .25s ease;
    }

    .neo-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(99, 102, 241, 0.45);
    }

    .glass-btn {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.4);
      color: #111827;
      backdrop-filter: blur(8px);
      border-radius: 0.75rem;
      padding: 0.6rem 1.4rem;
      transition: all .25s ease;
    }

    .glass-btn:hover {
      background: rgba(255, 255, 255, 0.35);
      color: #000;
    }

    /* ✅ Cross-browser Gradient Text */
    .text-gradient {
      background: linear-gradient(90deg, #60a5fa, #a78bfa, #f472b6);
      background-size: 200%;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      color: transparent;
      animation: glowshift 6s linear infinite;
    }

    @keyframes glowshift {
      0% {
        background-position: 0% center;
      }

      100% {
        background-position: 200% center;
      }
    }

    /* ✅ Apple-style Filter Bar */
    .sticky-filter {
      position: sticky;
      top: 0;
      z-index: 40;
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.8);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .filter-btn {
      font-size: 0.875rem;
      padding: 0.375rem 1rem;
      border-radius: 9999px;
      background: #fff;
      border: 1px solid #e5e7eb;
      transition: all .2s ease;
    }

    .filter-btn:hover {
      background: #f3f4f6;
    }

    .filter-btn.active {
      background: #111827;
      color: #fff;
    }

    .fade-in {
      animation: fadeIn 0.6s ease both;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body class="min-h-screen">
  <!-- Header -->
  <div id="header"></div>

  <!-- Hero -->
  <section class="text-center py-12 fade-in">
    <h1 class="text-4xl font-bold mb-2 text-gradient">🔥 핫 서브카테고리</h1>
    <p class="text-gray-500 text-sm">네오+글래스 하이브리드 감성으로 한눈에 모아보기</p>
  </section>

  <!-- ✅ Filter Bar -->
  <div class="sticky-filter">
    <div class="max-w-7xl mx-auto px-6 py-3 flex flex-wrap justify-between items-center gap-3">
      <!-- 카테고리 버튼 -->
      <div class="flex flex-wrap gap-2">
        <button class="filter-btn active" data-cat="all">전체</button>
        <button class="filter-btn" data-cat="food">맛집</button>
        <button class="filter-btn" data-cat="beauty">뷰티</button>
        <button class="filter-btn" data-cat="life">생활</button>
        <button class="filter-btn" data-cat="event">이벤트</button>
      </div>

      <!-- 검색창 & 정렬 -->
      <div class="flex gap-2 items-center">
        <input type="search" id="searchInput" placeholder="검색..."
          class="border border-gray-200 rounded-full px-3 py-1.5 text-sm focus:ring-1 focus:ring-gray-300 bg-white" />
        <select id="sortSelect"
          class="border border-gray-200 rounded-full px-3 py-1.5 text-sm bg-white focus:ring-1 focus:ring-gray-300">
          <option value="trending">인기순</option>
          <option value="latest">최신순</option>
          <option value="rating">평점순</option>
        </select>
      </div>
    </div>
  </div>

  <!-- ✅ Grid Section -->
  <main class="max-w-7xl mx-auto px-6 py-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 fade-in"
    id="grid"></main>

  <!-- Footer -->
  <div id="footer"></div>

  <script>
  // API 기본 경로: Live Server(5500)로 열면 백엔드(3000)로 프록시
  const API_BASE = (location.port === "5500" || location.port === "5501") ? "http://localhost:3000" : "";

  function escapeHtml(s) {
    return String(s ?? "").replace(/[&<>"']/g, c =>
      ({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[c])
    );
  }

  function ensureGrid() {
    let grid = document.getElementById("grid");
    if (!grid) {
      const main = document.querySelector("main") || document.body;
      grid = document.createElement("div");
      grid.id = "grid";
      grid.className = "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 max-w-5xl mx-auto p-4";
      main.appendChild(grid);
    }
    return grid;
  }

  function mapBlogToCard(b) {
    return {
      id: b.id ?? b.blog_id ?? "",
      title: b.title || b.store_name || "제목 없음",
      store: b.store_name || b.store || "",
      category: b.category || b.qa_mode || "",
      img: b.cover_image || b.img || "/uploads/no-image.png",
      desc: (b.summary || b.desc || "") + "",
      rating: (b.rating ?? (3.5 + Math.random()*1.5)).toString().slice(0,3)
    };
  }

  function renderGrid(list) {
    const grid = ensureGrid();
    if (!Array.isArray(list) || !list.length) {
      grid.innerHTML = `<div class="col-span-full text-center text-gray-500 p-8">표시할 항목이 없습니다.</div>`;
      return;
    }
    grid.innerHTML = list.map(item => {
      const c = mapBlogToCard(item);
      return `
        <article class="bg-white rounded shadow overflow-hidden">
          <a href="${API_BASE || ''}/hotblogdetail.html?id=${encodeURIComponent(c.id)}" class="block">
            <div class="h-44 bg-gray-100 overflow-hidden">
              <img src="${escapeHtml(c.img)}" alt="${escapeHtml(c.title)}" class="w-full h-full object-cover">
            </div>
          </a>
          <div class="p-3">
            <h3 class="font-semibold text-lg">${escapeHtml(c.title)}</h3>
            <p class="text-sm text-gray-600">${escapeHtml(c.store)}</p>
            <p class="mt-2 text-sm text-gray-700 line-clamp-2">${escapeHtml(c.desc)}</p>
            <div class="mt-3 flex justify-between items-center text-xs text-gray-500">
              <span>${escapeHtml(c.category)}</span>
              <span>⭐ ${escapeHtml(c.rating)}</span>
            </div>
          </div>
        </article>`;
    }).join("");
  }

  async function fetchHotListByCategory(category) {
    const q = category ? `?category=${encodeURIComponent(category)}` : "";
    const endpoints = [
      `${API_BASE}/api/hotsubcategory${q}`,
      `${API_BASE}/api/hotblogs${q}`,
      `${API_BASE}/api/hotblog/list${q}`,
      `${API_BASE}/api/hotblog?limit=50${category ? `&category=${encodeURIComponent(category)}` : ""}`
    ];
    for (const ep of endpoints) {
      try {
        const res = await fetch(ep, { cache: "no-store" });
        if (!res.ok) continue;
        const j = await res.json();
        if (Array.isArray(j)) return j;
        if (Array.isArray(j.blogs)) return j.blogs;
        if (Array.isArray(j.data)) return j.data;
        if (j.success && Array.isArray(j.blogs)) return j.blogs;
        if (j.success && j.blog) return [j.blog];
        if (j.blog && Array.isArray(j.blog)) return j.blog;
      } catch (e) {
        // 다음 endpoint로 계속 시도
      }
    }
    return null;
  }

  (async function initSubcategory() {
    // 헤더/푸터 로드 (API_BASE 필요할 수 있음)
    try {
      const headerHtml = await fetch(`${API_BASE || ""}/components/header.html`).then(r => r.ok ? r.text() : "<div></div>").catch(()=>"<div></div>");
      document.getElementById("header")?.replaceWith(Object.assign(document.createElement("div"), { id: "header", innerHTML: headerHtml }));
    } catch {}
    try {
      const footerHtml = await fetch(`${API_BASE || ""}/components/footer.html`).then(r => r.ok ? r.text() : "<div></div>").catch(()=>"<div></div>");
      document.getElementById("footer")?.replaceWith(Object.assign(document.createElement("div"), { id: "footer", innerHTML: footerHtml }));
    } catch {}

    const params = new URLSearchParams(location.search);
    const category = params.get("category") || params.get("qa_mode") || "";
    if (category) {
      document.title = `서브카테고리: ${category}`;
    }

    const list = await fetchHotListByCategory(category);
    if (list && list.length) {
      renderGrid(list);
    } else {
      // API 실패 시 빈 목록 또는 개발용 데모 표시
      renderGrid([]);
    }
  })();
  </script>
</body>

</html>