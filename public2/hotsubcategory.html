<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í•« ì„œë¸Œì¹´í…Œê³ ë¦¬ | MALL HANKOOK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        body {
            font-family: 'Pretendard', sans-serif;
            background: radial-gradient(80% 120% at 50% -20%, #f3f4f6, #ffffff);
            color: #111827;
        }

        /* ======= Design System (Neomorphism + Glassmorphism Hybrid) ======= */
        .neo-card {
            background: #fff;
            border-radius: 1.25rem;
            box-shadow:
                8px 8px 16px rgba(0, 0, 0, 0.08),
                -8px -8px 16px rgba(255, 255, 255, 0.9);
            transition: all .3s ease;
        }

        .neo-card:hover {
            transform: translateY(-4px);
            box-shadow:
                10px 10px 25px rgba(0, 0, 0, 0.12),
                -6px -6px 16px rgba(255, 255, 255, 0.8);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(14px);
            border-radius: 1.25rem;
            transition: all .3s ease;
        }

        .glass-card:hover {
            background: rgba(255, 255, 255, 0.55);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .neo-btn {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: #fff;
            border-radius: 0.75rem;
            padding: 0.6rem 1.4rem;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            transition: all .25s ease;
        }

        .neo-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.45);
        }

        .glass-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: #111827;
            backdrop-filter: blur(8px);
            border-radius: 0.75rem;
            padding: 0.6rem 1.4rem;
            transition: all .25s ease;
        }

        .glass-btn:hover {
            background: rgba(255, 255, 255, 0.35);
            color: #000;
        }

        /* âœ… Gradient Text */
        .text-gradient {
            background: linear-gradient(90deg, #60a5fa, #a78bfa, #f472b6);
            background-size: 200%;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            animation: glowshift 6s linear infinite;
        }

        @keyframes glowshift {
            0% {
                background-position: 0% center;
            }

            100% {
                background-position: 200% center;
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* âœ… ì¹´ë“œ ì•ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” ì¹´í…Œê³ ë¦¬ íƒœê·¸ */
        .category-chip {
            display: inline-flex;
            align-items: center;
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            background: #eff6ff;
            color: #1d4ed8;
            border: 1px solid #bfdbfe;
            cursor: pointer;
            transition: all .2s ease;
        }

        .category-chip:hover {
            background: #dbeafe;
        }
    </style>
</head>

<body class="min-h-screen">
    <!-- Header -->
    <div id="header"></div>

    <!-- Hero -->
    <section class="text-center py-12 fade-in">
        <h1 class="text-4xl font-bold mb-2 text-gradient">ğŸ”¥ í•« ì„œë¸Œì¹´í…Œê³ ë¦¬</h1>
        <p class="text-gray-500 text-sm">í•«ë¸”ë¡œê·¸ ì¹´ë“œë“¤ì„ í•œëˆˆì— ëª¨ì•„ë³´ê³ , í•„ìš”í•  ë•Œë§Œ ë¶„ë¥˜ë¡œ ì°¾ì•„ë³´ê¸°</p>
    </section>

    <!-- ğŸ” ìƒë‹¨ ê²€ìƒ‰/ì •ë ¬ ë°” (ì¹´í…Œê³ ë¦¬ íƒ­ ì œê±°) -->
    <section class="max-w-7xl mx-auto px-6 mb-4">
        <div class="flex flex-wrap justify-end items-center gap-2">
            <input type="search" id="searchInput" placeholder="ì œëª©/ë‚´ìš© ê²€ìƒ‰..."
                class="border border-gray-200 rounded-full px-3 py-1.5 text-sm focus:ring-1 focus:ring-gray-300 bg-white" />
            <select id="sortSelect"
                class="border border-gray-200 rounded-full px-3 py-1.5 text-sm bg-white focus:ring-1 focus:ring-gray-300">
                <option value="trending">ì¸ê¸°ìˆœ</option>
                <option value="latest">ìµœì‹ ìˆœ</option>
                <option value="rating">í‰ì ìˆœ</option>
            </select>
        </div>
    </section>

    <!-- âœ… Grid Section -->
    <main
        class="max-w-7xl mx-auto px-6 py-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 fade-in"
        id="grid"></main>

    <!-- Footer -->
    <div id="footer"></div>

    <script>
        const grid = document.getElementById("grid");
        const searchInput = document.getElementById("searchInput");
        const sortSelect = document.getElementById("sortSelect");

        let allData = [];        // ì„œë²„ì—ì„œ ë°›ì€ ì „ì²´ ë°ì´í„°
        let filteredData = [];   // í˜„ì¬ í•„í„°/ê²€ìƒ‰ì´ ì ìš©ëœ ë°ì´í„°
        let currentPage = 1;
        const perPage = 12;
        let currentCategory = null; // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ (ì—†ìœ¼ë©´ null)
        let currentSearch = "";     // ê²€ìƒ‰ì–´

        /* âœ… ì„œë²„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° */
        async function loadHotSubData() {
            try {
                const res = await fetch("/api/hotsubcategory");
                const json = await res.json();
                console.log("ğŸ”¥ ì„œë²„ ì‘ë‹µ:", json);

                if (!json.ok || !Array.isArray(json.data)) {
                    throw new Error("ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜");
                }

                allData = json.data;

                // URL ì¿¼ë¦¬ì—ì„œ category=... ê°€ ìˆìœ¼ë©´ í•´ë‹¹ ë¶„ë¥˜ë¡œ ì‹œì‘
                const params = new URLSearchParams(window.location.search);
                const catParam = params.get("category");
                currentCategory = catParam && catParam !== "all" ? catParam : null;

                applyFilters();
            } catch (err) {
                console.error("âŒ [loadHotSubData ì˜¤ë¥˜]:", err);
                grid.innerHTML = `
          <p class="text-gray-500 text-center col-span-full py-10">
            ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.
          </p>`;
            }
        }

        /* âœ… í˜„ì¬ ìƒíƒœ(ì¹´í…Œê³ ë¦¬/ê²€ìƒ‰/ì •ë ¬)ì— ë§ê²Œ filteredData êµ¬ì„± */
        function applyFilters() {
            filteredData = Array.isArray(allData) ? [...allData] : [];

            // 1) ì¹´í…Œê³ ë¦¬ í•„í„° (ì œëª© ì•„ë˜ íƒœê·¸/ë””í…Œì¼ í˜ì´ì§€ì—ì„œ ì„ íƒ)
            if (currentCategory) {
                filteredData = filteredData.filter(
                    item => item.category === currentCategory
                );
            }

            // 2) ê²€ìƒ‰ì–´ í•„í„° (ì œëª©/ì„¤ëª…)
            if (currentSearch.trim() !== "") {
                const q = currentSearch.trim().toLowerCase();
                filteredData = filteredData.filter(item =>
                    (item.title || "").toLowerCase().includes(q) ||
                    (item.description || "").toLowerCase().includes(q)
                );
            }

            // 3) ì •ë ¬ (ê°„ë‹¨í•œ ë²„ì „)
            const sort = sortSelect?.value || "trending";
            if (sort === "rating") {
                filteredData.sort((a, b) =>
                    (parseFloat(b.rating) || 0) - (parseFloat(a.rating) || 0)
                );
            } else if (sort === "latest") {
                filteredData.sort((a, b) => {
                    const ad = new Date(a.created_at || a.createdAt || 0).getTime();
                    const bd = new Date(b.created_at || b.createdAt || 0).getTime();
                    return bd - ad;
                });
            }
            // trending ì€ ì¼ë‹¨ ì„œë²„ì—ì„œ ë‚´ë ¤ì˜¤ëŠ” ìˆœì„œë¥¼ ì¡´ì¤‘

            currentPage = 1;
            renderGrid();
            renderPagination();
        }

        /* âœ… ì¹´ë“œ ë Œë”ë§ */
        function renderGrid() {
            if (!filteredData.length) {
                grid.innerHTML = `
        <p class="text-gray-500 text-center col-span-full py-10">
          í‘œì‹œí•  í•«ë¸”ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.
        </p>`;
                const existing = document.getElementById("pagination");
                if (existing) existing.remove();
                return;
            }

            const start = (currentPage - 1) * perPage;
            const end = start + perPage;
            const pageData = filteredData.slice(start, end);

            grid.innerHTML = pageData.map(item => {
                const category = item.category || "";
                const categoryLabelMap = {
                    food: "ë§›ì§‘",
                    beauty: "ë·°í‹°",
                    life: "ìƒí™œ",
                    event: "ì´ë²¤íŠ¸"
                };
                const categoryLabel = categoryLabelMap[category] || category || "ê¸°íƒ€";

                return `
        <article class="neo-card overflow-hidden fade-in">
          <div class="relative aspect-[4/3] overflow-hidden">
            <img src="${item.thumbnail_url || '/uploads/default.jpg'}" 
                 alt="${item.title || ''}" 
                 class="w-full h-full object-cover transition-transform duration-500 hover:scale-105">
            <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent"></div>
            <div class="absolute bottom-3 left-3 text-white">
              <h3 class="font-semibold">${item.title || ''}</h3>
              <div class="mt-1">
                ${category
                        ? `<button class="category-chip" data-cat="${category}"># ${categoryLabel}</button>`
                        : ""}
              </div>
            </div>
          </div>

          <div class="p-4">
            <p class="text-sm text-gray-600 line-clamp-2 mb-2">
              ${item.description || ''}
            </p>

            <div class="flex justify-between items-center text-xs text-gray-500">
              <span>${categoryLabel}</span>
              <span>â­ ${item.rating || '4.0'}</span>
            </div>

            <div class="mt-4 flex gap-2">
              <a href="/hotblogdetail.html?id=${item.id}" class="neo-btn flex-1 text-center">
                ìì„¸íˆ ë³´ê¸°
              </a>
              <button class="glass-btn flex-1" data-id="${item.id}">
                ê´€ë ¨ ëª©ë¡
              </button>
            </div>
          </div>
        </article>
      `;
            }).join('');

            attachCategoryChipEvents();
        }

        /* âœ… í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§ */
        function renderPagination() {
            const totalPages = Math.ceil(filteredData.length / perPage);
            const existing = document.getElementById("pagination");
            if (existing) existing.remove();

            if (totalPages <= 1) return;

            const paginationContainer = document.createElement("div");
            paginationContainer.id = "pagination";
            paginationContainer.className = "flex justify-center gap-2 mt-10";

            paginationContainer.innerHTML = Array.from({ length: totalPages }, (_, i) => `
        <button
          class="px-3 py-1.5 rounded-lg border text-sm font-medium
                 ${i + 1 === currentPage
                    ? 'bg-indigo-600 text-white border-indigo-600'
                    : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-100'}"
          data-page="${i + 1}">
          ${i + 1}
        </button>
      `).join("");

            grid.insertAdjacentElement("afterend", paginationContainer);

            paginationContainer.querySelectorAll("button[data-page]").forEach(btn => {
                btn.addEventListener("click", () => {
                    const p = Number(btn.dataset.page);
                    if (!Number.isNaN(p)) {
                        currentPage = p;
                        renderGrid();
                        renderPagination();
                        window.scrollTo({ top: 0, behavior: "smooth" });
                    }
                });
            });
        }

        /* âœ… ì¹´ë“œ ì•ˆì˜ ì¹´í…Œê³ ë¦¬ íƒœê·¸ í´ë¦­ â†’ í•´ë‹¹ ë¶„ë¥˜ë§Œ ë³´ê¸° */
        function attachCategoryChipEvents() {
            document.querySelectorAll(".category-chip").forEach(btn => {
                btn.addEventListener("click", () => {
                    const cat = btn.dataset.cat;
                    currentCategory = cat || null;
                    currentSearch = "";
                    if (searchInput) searchInput.value = "";
                    applyFilters();
                });
            });
        }

        /* ğŸ” ê²€ìƒ‰ ì´ë²¤íŠ¸ */
        if (searchInput) {
            searchInput.addEventListener("input", (e) => {
                currentSearch = e.target.value;
                applyFilters();
            });
        }

        /* ğŸ” ì •ë ¬ ì´ë²¤íŠ¸ */
        if (sortSelect) {
            sortSelect.addEventListener("change", () => {
                applyFilters();
            });
        }

        /* âœ… Header/Footer ë¶ˆëŸ¬ì˜¤ê¸° */
        Promise.all([
            fetch('/components/header.html').then(r => r.text()),
            fetch('/components/footer.html').then(r => r.text())
        ]).then(([h, f]) => {
            document.getElementById('header').innerHTML = h;
            document.getElementById('footer').innerHTML = f;
        });

        /* âœ… ì‹¤í–‰ */
        loadHotSubData();
    </script>
</body>

</html>