<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>핫 서브카테고리 | MALL HANKOOK</title>
  <meta name="description" content="핫 디테일을 한눈에 모아보는 핫 서브카테고리 페이지" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ===== Neo + Glass base ===== */
    .neo-shell {
      background: radial-gradient(1200px 600px at 10% -10%, rgba(255,255,255,0.7), transparent 60%),
                  radial-gradient(1200px 600px at 110% 10%, rgba(96,165,250,0.18), transparent 60%),
                  linear-gradient(180deg, rgba(255,255,255,0.65), rgba(255,255,255,0.45));
      backdrop-filter: blur(8px);
    }
    .neo-card {
      background: rgba(255,255,255,0.65);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.6);
      box-shadow:
        8px 8px 24px rgba(0,0,0,0.12),
        -6px -6px 20px rgba(255,255,255,0.9),
        inset 0 1px 0 rgba(255,255,255,0.6);
    }
    .neo-btn {
      box-shadow:
        6px 6px 16px rgba(0,0,0,0.15),
        -4px -4px 12px rgba(255,255,255,0.8),
        inset 0 1px 0 rgba(255,255,255,0.4);
    }
    .neo-btn:active {
      transform: translateY(1px);
      box-shadow:
        3px 3px 10px rgba(0,0,0,0.18),
        -2px -2px 10px rgba(255,255,255,0.85),
        inset 0 2px 6px rgba(0,0,0,0.08);
    }
    .chip {
      @apply inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm border transition;
      background: rgba(255,255,255,0.7);
      border-color: rgba(0,0,0,0.06);
      box-shadow:
        4px 4px 12px rgba(0,0,0,0.08),
        -3px -3px 10px rgba(255,255,255,0.9);
    }
    .chip-active {
      @apply font-semibold;
      background: linear-gradient(135deg, rgba(96,165,250,0.25), rgba(139,92,246,0.25));
      border-color: rgba(96,165,250,0.35);
    }
    .badge {
      @apply text-[11px] px-2 py-0.5 rounded-full border;
      background: rgba(0,0,0,0.04);
      border-color: rgba(0,0,0,0.06);
    }
    /* 이미지 스켈레톤 */
    .img-skel {
      background: linear-gradient(90deg, rgba(0,0,0,0.06) 25%, rgba(0,0,0,0.09) 37%, rgba(0,0,0,0.06) 63%);
      background-size: 400% 100%;
      animation: shimmer 1.3s infinite;
    }
    @keyframes shimmer {
      0% { background-position: 100% 0 }
      100% { background-position: 0 0 }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 text-gray-800">
  <!-- Header -->
  <div id="header"></div>

  <!-- Hero -->
  <section class="neo-shell">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10">
      <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
        <div>
          <h1 class="text-3xl md:text-4xl font-extrabold bg-gradient-to-r from-sky-500 to-violet-600 bg-clip-text text-transparent drop-shadow">
            핫 서브카테고리
          </h1>
          <p class="mt-2 text-gray-600">
            핫 디테일 콘텐츠를 카테고리·서브카테고리별로 모아서 한눈에!
          </p>
        </div>

        <div class="flex gap-2">
          <a href="/subcategory.html"
             class="neo-btn inline-flex items-center gap-2 rounded-xl px-4 py-2 bg-white/70 border border-white/70 hover:bg-white transition">
            <span>상위 페이지</span>
          </a>
          <a id="ownerManageBtn"
             href="/owner.html"
             class="neo-btn inline-flex items-center gap-2 rounded-xl px-4 py-2 bg-white/70 border border-white/70 hover:bg-white transition">
            <span>오너 관리</span>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Filters -->
  <section>
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
      <!-- 1) 카테고리 -->
      <div class="flex flex-wrap gap-2 items-center">
        <span class="text-sm text-gray-500">카테고리</span>
        <div id="catChips" class="flex flex-wrap gap-2"></div>
      </div>

      <!-- 2) 서브카테고리 -->
      <div class="mt-4">
        <div class="flex items-center justify-between">
          <span class="text-sm text-gray-500">서브카테고리</span>
          <button id="resetBtn" class="chip hover:scale-[1.02] active:scale-[0.99]">
            초기화
          </button>
        </div>
        <div id="subChips" class="mt-2 flex gap-2 overflow-x-auto pb-2"></div>
      </div>

      <!-- 3) 검색 & 정렬 -->
      <div class="mt-5 grid grid-cols-1 md:grid-cols-3 gap-3">
        <div class="md:col-span-2">
          <label class="sr-only" for="searchInput">검색</label>
          <div class="neo-card rounded-2xl p-2 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 opacity-70" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="1.5" d="m21 21-4.3-4.3m1.3-4.7a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"/></svg>
            <input id="searchInput" type="search" placeholder="가게명, 키워드 검색"
                   class="w-full bg-transparent outline-none placeholder:text-gray-400"/>
            <button id="searchBtn" class="neo-btn px-3 py-2 rounded-xl bg-white/80 border">검색</button>
          </div>
        </div>

        <div class="">
          <div class="neo-card rounded-2xl p-2 flex items-center justify-between">
            <label class="text-sm text-gray-500 pl-2">정렬</label>
            <select id="sortSelect" class="bg-transparent outline-none px-3 py-2 rounded-xl">
              <option value="trending">인기순</option>
              <option value="latest">최신순</option>
              <option value="rating">평점순</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Results -->
  <section class="pb-12">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <!-- 카운트 -->
      <div class="flex items-center justify-between">
        <p id="countText" class="text-sm text-gray-500">총 0건</p>
        <div id="activeFilters" class="flex flex-wrap gap-2"></div>
      </div>

      <!-- 카드 그리드 -->
      <div id="grid" class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"></div>

      <!-- 페이지네이션 -->
      <div id="pagination" class="mt-8 flex items-center justify-center gap-2"></div>
    </div>
  </section>

  <!-- Footer -->
  <div id="footer"></div>

  <script>
    /* =========================
       데이터 소스 설정
       api: 서버 연동 모드 (예: GET /hotdetail/list?category=... )
       demo: 데모(로컬 샘플)
    ==========================*/
    const DATA_SOURCE_MODE = "demo"; // "api" 로 바꾸면 서버 연동
    const PAGE_SIZE = 12;

    // 카테고리/서브카테고리 프리셋 (필요 시 서버에서 내려받는 구조로 변경 가능)
    const CATEGORY_PRESETS = {
      "all": ["전체"],
      "food": ["전체","한식","중식","일식","양식","분식","카페/디저트","야식","치킨","피자","족발/보쌈","술집"],
      "beauty": ["전체","헤어","네일","피부관리","바디케어","메이크업"],
      "life": ["전체","병원","약국","세탁","청소","이사","펫케어"],
      "event": ["전체","할인","쿠폰","시즌","신메뉴","한정","오픈"]
    };

    // 데모 데이터
    const DEMO = Array.from({length: 48}, (_,i)=>({
      id: 1000+i,
      title: `핫 디테일 ${i+1}`,
      store_name: ["하늘식당","도쿄우동","밤비네일","루미에르헤어","강남동물병원"][i%5],
      category: ["food","beauty","life","event"][i%4],
      subcategory: (i%4===0? ["한식","분식","카페/디저트"][i%3] :
                    i%4===1? ["헤어","네일","피부관리"][i%3] :
                    i%4===2? ["병원","약국","펫케어"][i%3] :
                             ["신메뉴","시즌","할인"][i%3]),
      qa_mode: ["theme","random","self"][i%3],
      rating: (3 + (i%30)/10).toFixed(1),
      created_at: new Date(Date.now()- i*86400000).toISOString(),
      cover: `https://picsum.photos/seed/hot${i}/600/400`,
      excerpt: "매장의 핫한 소식과 이벤트를 빠르게 만나보세요. 인기 메뉴와 추천 포인트를 요약합니다."
    }));

    /* ========= 유틸 ========== */
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const qs = new URLSearchParams(location.search);

    function getQuery() {
      return {
        category: qs.get("category") || "all",
        sub: qs.get("sub") || "전체",
        q: qs.get("q") || "",
        sort: qs.get("sort") || "trending",
        page: Math.max(1, parseInt(qs.get("page") || "1", 10))
      };
    }
    function setQuery(next) {
      const cur = getQuery();
      const merged = {...cur, ...next};
      const nextQs = new URLSearchParams(merged);
      history.replaceState(null, "", `?${nextQs.toString()}`);
      return merged;
    }
    function fmtDate(iso) {
      const d = new Date(iso);
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return `${y}.${m}.${day}`;
    }

    /* ====== 헤더/푸터 로드 ====== */
    async function loadHeaderFooter() {
      try {
        const [h, f] = await Promise.all([
          fetch("/components/header.html").then(r=>r.text()),
          fetch("/components/footer.html").then(r=>r.text())
        ]);
        $("#header").innerHTML = h;
        $("#footer").innerHTML = f;
      } catch(e) {
        console.warn("header/footer 로드 실패", e);
      }
    }

    /* ====== 필터 렌더링 ====== */
    function renderCategoryChips(curCat) {
      const cats = Object.keys(CATEGORY_PRESETS);
      $("#catChips").innerHTML = cats.map(cat=>{
        const active = cat===curCat ? "chip-active" : "";
        const label = cat==="all" ? "전체" :
                      cat==="food" ? "맛집" :
                      cat==="beauty" ? "뷰티" :
                      cat==="life" ? "생활" :
                      cat==="event" ? "이벤트" : cat;
        return `<button class="chip ${active}" data-cat="${cat}">${label}</button>`;
      }).join("");
      $("#catChips").querySelectorAll("button").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const next = setQuery({category: btn.dataset.cat, sub: "전체", page: 1});
          hydrate(next);
        });
      });
    }
    function renderSubcategoryChips(curCat, curSub) {
      const subs = CATEGORY_PRESETS[curCat] || ["전체"];
      $("#subChips").innerHTML = subs.map(s=>{
        const active = s===curSub ? "chip-active" : "";
        return `<button class="chip ${active}" data-sub="${s}">${s}</button>`;
      }).join("");
      $("#subChips").querySelectorAll("button").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const next = setQuery({sub: btn.dataset.sub, page: 1});
          hydrate(next);
        });
      });
    }
    function renderActiveFilters(q) {
      const chips = [];
      if (q.category && q.category!=="all") {
        const label = q.category==="food"?"맛집":q.category==="beauty"?"뷰티":q.category==="life"?"생활":q.category==="event"?"이벤트":q.category;
        chips.push(`<span class="chip">${label}</span>`);
      }
      if (q.sub && q.sub!=="전체") chips.push(`<span class="chip">${q.sub}</span>`);
      if (q.q) chips.push(`<span class="chip">"${q.q}"</span>`);
      if (q.sort) {
        const map = {trending:"인기순", latest:"최신순", rating:"평점순"};
        chips.push(`<span class="chip">${map[q.sort]||q.sort}</span>`);
      }
      $("#activeFilters").innerHTML = chips.join("");
    }

    /* ====== 데이터 로딩 ====== */
    async function fetchData(q) {
      if (DATA_SOURCE_MODE === "api") {
        const url = new URL("/hotdetail/list", location.origin);
        url.searchParams.set("category", q.category);
        url.searchParams.set("sub", q.sub);
        url.searchParams.set("q", q.q);
        url.searchParams.set("sort", q.sort);
        url.searchParams.set("page", q.page);
        url.searchParams.set("size", PAGE_SIZE);
        const res = await fetch(url);
        if (!res.ok) throw new Error("API 오류");
        const json = await res.json(); // { ok, total, items: [...] }
        return json;
      } else {
        // DEMO 필터/정렬/페이지네이션
        let items = DEMO.slice();
        if (q.category!=="all") items = items.filter(x=>x.category===q.category);
        if (q.sub && q.sub!=="전체") items = items.filter(x=>x.subcategory===q.sub);
        if (q.q) {
          const needle = q.q.toLowerCase();
          items = items.filter(x =>
            x.title.toLowerCase().includes(needle) ||
            x.store_name.toLowerCase().includes(needle) ||
            x.excerpt.toLowerCase().includes(needle)
          );
        }
        if (q.sort==="latest") items.sort((a,b)=> new Date(b.created_at)-new Date(a.created_at));
        else if (q.sort==="rating") items.sort((a,b)=> parseFloat(b.rating)-parseFloat(a.rating));
        else items.sort((a,b)=> (b.id%13) - (a.id%13)); // trending 임시
        const total = items.length;
        const start = (q.page-1)*PAGE_SIZE;
        const pageItems = items.slice(start, start+PAGE_SIZE);
        return { ok:true, total, items: pageItems };
      }
    }

    /* ====== 카드/페이지네이션 렌더 ====== */
    function cardTpl(item) {
      const qaColor = item.qa_mode==="theme" ? "bg-sky-100 border-sky-200" :
                      item.qa_mode==="random" ? "bg-violet-100 border-violet-200" :
                      "bg-emerald-100 border-emerald-200";
      const qaLabel = item.qa_mode==="theme" ? "테마" : item.qa_mode==="random" ? "랜덤" : "셀프";
      const catLabel = item.category==="food"?"맛집":item.category==="beauty"?"뷰티":item.category==="life"?"생활":item.category==="event"?"이벤트":item.category;
      const href = `/hotdetail.html?id=${item.id}`; // 개별 핫 디테일 페이지로 이동
      return `
        <article class="neo-card rounded-2xl overflow-hidden hover:-translate-y-0.5 transition">
          <a href="${href}" class="block">
            <div class="relative aspect-[4/3] overflow-hidden">
              <div class="img-skel absolute inset-0"></div>
              <img src="${item.cover}" alt="${item.title}" loading="lazy"
                   class="h-full w-full object-cover"
                   onload="this.previousElementSibling.remove()"/>
              <div class="absolute top-3 left-3 flex gap-2">
                <span class="badge ${qaColor}">${qaLabel}</span>
                <span class="badge">${catLabel}</span>
                <span class="badge">${item.subcategory}</span>
              </div>
            </div>
          </a>
          <div class="p-4">
            <div class="flex items-center justify-between gap-3">
              <h3 class="font-semibold text-base line-clamp-1">${item.title}</h3>
              <span class="text-sm">⭐ ${item.rating}</span>
            </div>
            <p class="mt-1 text-sm text-gray-600 line-clamp-2">${item.excerpt}</p>
            <div class="mt-3 flex items-center justify-between text-xs text-gray-500">
              <span class="line-clamp-1">${item.store_name}</span>
              <time>${fmtDate(item.created_at)}</time>
            </div>
            <div class="mt-4 flex gap-2">
              <a href="${href}" class="neo-btn inline-flex justify-center items-center px-3 py-2 rounded-xl bg-white/80 border hover:bg-white">
                자세히 보기
              </a>
              <button class="neo-btn px-3 py-2 rounded-xl bg-white/80 border hover:bg-white"
                      onclick="location.href='/subcategory.html?category=${encodeURIComponent(item.category)}&sub=${encodeURIComponent(item.subcategory)}'">
                관련 목록
              </button>
            </div>
          </div>
        </article>
      `;
    }

    function renderGrid(items) {
      const grid = $("#grid");
      if (!items.length) {
        grid.innerHTML = `
          <div class="neo-card rounded-2xl p-8 col-span-full text-center">
            검색 결과가 없습니다.
          </div>`;
        return;
      }
      grid.innerHTML = items.map(cardTpl).join("");
    }

    function renderCount(total, q) {
      $("#countText").textContent = `총 ${total.toLocaleString()}건`;
      renderActiveFilters(q);
    }

    function renderPagination(total, q) {
      const maxPage = Math.max(1, Math.ceil(total / PAGE_SIZE));
      const cur = q.page;
      const pag = $("#pagination");
      const btn = (label, page, active=false, disabled=false) => `
        <button ${disabled?'disabled':''}
          class="neo-btn px-3 py-2 rounded-xl bg-white/80 border hover:bg-white ${active?'font-bold':''} ${disabled?'opacity-50':''}"
          data-page="${page}">${label}</button>`;

      const pages = [];
      pages.push(btn("«", 1, false, cur===1));
      pages.push(btn("‹", Math.max(1, cur-1), false, cur===1));

      const windowSize = 2;
      const start = Math.max(1, cur - windowSize);
      const end = Math.min(maxPage, cur + windowSize);
      for (let p = start; p <= end; p++) pages.push(btn(String(p), p, p===cur));

      pages.push(btn("›", Math.min(maxPage, cur+1), false, cur===maxPage));
      pages.push(btn("»", maxPage, false, cur===maxPage));

      pag.innerHTML = pages.join("");
      pag.querySelectorAll("button[data-page]").forEach(b=>{
        b.addEventListener("click", ()=>{
          const n = Number(b.dataset.page);
          const next = setQuery({page: n});
          hydrate(next);
          window.scrollTo({top:0, behavior:"smooth"});
        });
      });
    }

    /* ====== 이벤트 바인딩 ====== */
    function bindControls(q) {
      $("#resetBtn").addEventListener("click", ()=>{
        const next = setQuery({category:"all", sub:"전체", q:"", sort:"trending", page:1});
        $("#searchInput").value = "";
        $("#sortSelect").value = "trending";
        hydrate(next);
      });
      $("#searchInput").value = q.q || "";
      $("#searchBtn").addEventListener("click", ()=>{
        const next = setQuery({q: $("#searchInput").value.trim(), page:1});
        hydrate(next);
      });
      $("#searchInput").addEventListener("keydown", (e)=>{
        if (e.key==="Enter") $("#searchBtn").click();
      });
      $("#sortSelect").value = q.sort || "trending";
      $("#sortSelect").addEventListener("change", ()=>{
        const next = setQuery({sort: $("#sortSelect").value, page:1});
        hydrate(next);
      });
    }

    /* ====== 하이드레이트(초기/갱신) ====== */
    async function hydrate(q = getQuery()) {
      renderCategoryChips(q.category);
      renderSubcategoryChips(q.category, q.sub);
      bindControls(q);

      // 스켈레톤
      $("#grid").innerHTML = Array.from({length: 8}).map(()=>`
        <div class="neo-card rounded-2xl overflow-hidden">
          <div class="img-skel aspect-[4/3]"></div>
          <div class="p-4 space-y-2">
            <div class="h-5 img-skel rounded"></div>
            <div class="h-4 img-skel rounded w-2/3"></div>
            <div class="h-4 img-skel rounded w-1/2"></div>
          </div>
        </div>
      `).join("");

      try {
        const { ok, total, items } = await fetchData(q);
        if (!ok) throw new Error("데이터 로드 실패");
        renderCount(total, q);
        renderGrid(items);
        renderPagination(total, q);
      } catch(e) {
        console.error(e);
        $("#grid").innerHTML = `
          <div class="neo-card rounded-2xl p-8 col-span-full text-center text-rose-600">
            데이터를 불러오는 중 문제가 발생했습니다.
          </div>`;
      }
    }

    /* ====== 부트 ====== */
    (async function boot(){
      await loadHeaderFooter();
      hydrate(getQuery());
    })();
  </script>
</body>
</html>
