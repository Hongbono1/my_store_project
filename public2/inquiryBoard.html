<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë¬¸ì˜ ê²Œì‹œíŒ | MALL HANKOOK</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- âœ… Mall Hankook í‘œì¤€: ìºì‹œ ë°©ì§€ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="version" content="inquiryBoard-v1.0" />

    <style>
        body {
            font-family: Pretendard, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: radial-gradient(circle at top left, #e0f2fe, #f9fafb, #ede9fe);
            min-height: 100vh;
        }

        .neo-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(16px);
            border-radius: 1.5rem;
            box-shadow:
                10px 10px 30px rgba(15, 23, 42, 0.18),
                -6px -6px 16px rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.7);
        }

        .neo-chip {
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.8);
            box-shadow:
                4px 4px 10px rgba(15, 23, 42, 0.12),
                -3px -3px 6px rgba(255, 255, 255, 0.9);
        }

        .row-hover {
            transition: background-color 0.18s ease, transform 0.12s ease;
        }

        .row-hover:hover {
            background-color: rgba(239, 246, 255, 0.9);
            transform: translateY(-1px);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
        }

        @media (max-width: 768px) {
            .table-wrapper {
                box-shadow: none;
                background: transparent;
            }
        }
    </style>
</head>

<body>
    <div id="header"></div>

    <main class="max-w-5xl mx-auto px-4 py-10 md:py-16">
        <!-- ìƒë‹¨ í—¤ë” ì˜ì—­ -->
        <section class="mb-8 md:mb-10">
            <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
                <div>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-slate-800 tracking-tight">
                        ë¬¸ì˜ ê²Œì‹œíŒ
                    </h1>
                    <p class="mt-2 text-sm md:text-base text-slate-500">
                        ì„œë¹„ìŠ¤ ì´ìš© ì¤‘ ê¶ê¸ˆí•˜ì‹  ì ì´ë‚˜ ê°œì„  ìš”ì²­ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.
                        <br class="hidden md:block" />
                        ë“±ë¡í•˜ì‹  ë¬¸ì˜ëŠ” ìš´ì˜ìê°€ í™•ì¸ í›„ ìˆœì°¨ì ìœ¼ë¡œ ë‹µë³€ë“œë¦½ë‹ˆë‹¤.
                    </p>
                </div>

                <div class="flex items-center gap-3">
                    <button type="button" onclick="goToRegister()"
                        class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-xl text-sm md:text-base font-semibold text-white bg-indigo-600 hover:bg-indigo-700 shadow-md shadow-indigo-200 transition">
                        <span>âœï¸ ë¬¸ì˜ ì‘ì„±í•˜ê¸°</span>
                    </button>
                </div>
            </div>

            <!-- ìš”ì•½ / ìƒíƒœ ë±ƒì§€ -->
            <div class="mt-5 flex flex-wrap items-center gap-3 text-xs md:text-sm">
                <div class="neo-chip flex items-center gap-2 px-3 py-1.5 text-slate-700">
                    <span class="status-dot bg-emerald-500"></span>
                    <span id="summaryTotal">ì´ 0ê±´ ë¬¸ì˜</span>
                </div>
                <div class="neo-chip flex items-center gap-2 px-3 py-1.5 text-slate-700">
                    <span class="status-dot bg-indigo-500"></span>
                    <span id="summaryAnswered">ë‹µë³€ ì™„ë£Œ 0ê±´</span>
                </div>
                <div class="neo-chip flex items-center gap-2 px-3 py-1.5 text-slate-700">
                    <span class="status-dot bg-slate-400"></span>
                    <span id="summaryPending">ê²€í†  ì¤‘ 0ê±´</span>
                </div>
            </div>
        </section>

        <!-- ê²€ìƒ‰ / ì •ë ¬ ë°” (ê°„ë‹¨ ë²„ì „) -->
        <section class="mb-4">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-3">
                <div class="relative w-full md:w-72">
                    <input id="searchInput" type="text" placeholder="ì œëª© ë˜ëŠ” ì‘ì„±ì ê²€ìƒ‰"
                        class="w-full rounded-xl border border-slate-200 bg-white/80 px-4 py-2.5 text-sm text-slate-700 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-transparent" />
                    <span class="absolute right-3 top-2.5 text-slate-400 text-sm">ğŸ”</span>
                </div>
                <div class="flex items-center gap-2 text-xs md:text-sm text-slate-500">
                    <span>ì •ë ¬: </span>
                    <button type="button"
                        class="px-3 py-1.5 rounded-full border border-indigo-200 bg-indigo-50 text-indigo-700 text-xs"
                        disabled>
                        ìµœì‹  ìˆœ
                    </button>
                </div>
            </div>
        </section>

        <!-- ë¦¬ìŠ¤íŠ¸ ì˜ì—­ -->
        <section class="neo-card table-wrapper p-4 md:p-6">
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm text-left text-slate-700">
                    <thead class="text-xs uppercase text-slate-400 border-b border-slate-100">
                        <tr>
                            <th scope="col" class="px-3 py-3 text-center w-16">ë²ˆí˜¸</th>
                            <th scope="col" class="px-3 py-3">ì œëª©</th>
                            <th scope="col" class="px-3 py-3 text-center w-28">ì‘ì„±ì</th>
                            <th scope="col" class="px-3 py-3 text-center w-40">ë“±ë¡ì¼</th>
                            <th scope="col" class="px-3 py-3 text-center w-28">ì²¨ë¶€</th>
                            <th scope="col" class="px-3 py-3 text-center w-28">ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody id="inquiryListBody" class="divide-y divide-slate-100">
                        <!-- JSë¡œ ë Œë”ë§ -->
                    </tbody>
                </table>
            </div>

            <!-- ë¹ˆ ë¦¬ìŠ¤íŠ¸ ì•ˆë‚´ -->
            <div id="emptyState" class="hidden py-10 text-center text-slate-400 text-sm">
                ì•„ì§ ë“±ë¡ëœ ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.
                <br class="hidden md:block" />
                <button type="button" onclick="goToRegister()"
                    class="mt-4 inline-flex items-center justify-center gap-2 px-4 py-2 rounded-full border border-dashed border-indigo-300 bg-indigo-50 text-indigo-700 text-xs font-semibold">
                    âœï¸ ì²« ë¬¸ì˜ ë‚¨ê¸°ê¸°
                </button>
            </div>

            <!-- ì—ëŸ¬ ì•ˆë‚´ -->
            <div id="errorState"
                class="hidden mt-6 p-4 rounded-xl bg-red-50 border border-red-200 text-xs md:text-sm text-red-700">
                <div class="font-semibold mb-1">âŒ ë¬¸ì˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>
                <div id="errorMessage" class="mb-2"></div>
                <button type="button" onclick="reloadList()"
                    class="mt-1 inline-flex items-center justify-center gap-1 px-3 py-1.5 rounded-full bg-red-600 text-white text-xs font-semibold">
                    ğŸ”„ ë‹¤ì‹œ ì‹œë„
                </button>
            </div>
        </section>
    </main>

    <div id="footer"></div>

    <script>
        const API_BASE = "/api/inquiryBoard"; // ì„œë²„ì—ì„œ /api/inquiryBoard, /api/inquiry ë‘˜ ë‹¤ ê°™ì€ ë¼ìš°í„° ì—°ê²°ë¨

        // âœ… í—¤ë”/í‘¸í„° ë¡œë”©
        async function loadComponents() {
            try {
                const headerRes = await fetch("/components/header.html");
                if (headerRes.ok) {
                    document.getElementById("header").innerHTML = await headerRes.text();
                }
            } catch (e) {
                console.warn("Header ë¡œë“œ ì‹¤íŒ¨:", e.message);
            }

            try {
                const footerRes = await fetch("/components/footer.html");
                if (footerRes.ok) {
                    document.getElementById("footer").innerHTML = await footerRes.text();
                }
            } catch (e) {
                console.warn("Footer ë¡œë“œ ì‹¤íŒ¨:", e.message);
            }
        }

        // âœ… ë¬¸ì˜ ì‘ì„± í˜ì´ì§€ë¡œ ì´ë™
        function goToRegister() {
            window.location.href = "/inquiryregister.html";
        }

        // âœ… ë¬¸ì˜ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™ (íŒŒì¼ëª…: inquiryDetail.html ê¸°ì¤€)
        function goToDetail(id) {
            if (!id) return;
            window.location.href = `/inquiryDetail.html?id=${encodeURIComponent(id)}`;
        }

        // âœ… ë¦¬ìŠ¤íŠ¸ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
        function reloadList() {
            loadInquiryList();
        }

        // âœ… ë‚ ì§œ í¬ë§·
        function formatDate(iso) {
            if (!iso) return "-";
            try {
                const d = new Date(iso);
                if (Number.isNaN(d.getTime())) return "-";
                return d.toLocaleString("ko-KR", {
                    year: "numeric",
                    month: "2-digit",
                    day: "2-digit",
                    hour: "2-digit",
                    minute: "2-digit",
                });
            } catch {
                return "-";
            }
        }

        // âœ… ìƒíƒœ ë±ƒì§€ ë Œë”ë§
        function renderStatus(hasAnswer) {
            if (hasAnswer) {
                return `
          <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs font-semibold">
            <span class="status-dot bg-emerald-500"></span>
            ë‹µë³€ì™„ë£Œ
          </span>
        `;
            }
            return `
        <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-slate-50 text-slate-600 text-xs font-semibold">
          <span class="status-dot bg-slate-400"></span>
          ê²€í† ì¤‘
        </span>
      `;
        }

        // âœ… ì²¨ë¶€íŒŒì¼ í‘œì‹œ
        function renderFileCount(count) {
            const c = Number.isFinite(count) ? count : 0;
            if (c <= 0) {
                return `<span class="text-xs text-slate-400">-</span>`;
            }
            return `
        <span class="inline-flex items-center justify-center gap-1 px-2.5 py-1 rounded-full bg-indigo-50 text-indigo-700 text-xs font-semibold">
          ğŸ“ ${c}ê°œ
        </span>
      `;
        }

        // âœ… ë¬¸ì˜ ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° + ë Œë”ë§
        async function loadInquiryList() {
            const tbody = document.getElementById("inquiryListBody");
            const emptyState = document.getElementById("emptyState");
            const errorState = document.getElementById("errorState");
            const errorMessage = document.getElementById("errorMessage");

            tbody.innerHTML = "";
            emptyState.classList.add("hidden");
            errorState.classList.add("hidden");
            errorMessage.textContent = "";

            try {
                console.log("ğŸ“¡ GET", API_BASE);
                const res = await fetch(API_BASE, { method: "GET" });

                console.log("ğŸ“¥ ì‘ë‹µ ìƒíƒœ:", res.status, res.statusText);
                if (!res.ok) {
                    const text = await res.text();
                    console.error("âŒ ì—ëŸ¬ ì‘ë‹µ:", text);
                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                }

                const data = await res.json();
                console.log("ğŸ“‹ ë¬¸ì˜ ë¦¬ìŠ¤íŠ¸ ì‘ë‹µ:", data);

                const list = Array.isArray(data) ? data : (data.data || []);

                if (!Array.isArray(list) || list.length === 0) {
                    emptyState.classList.remove("hidden");
                    // ìš”ì•½ë„ 0ìœ¼ë¡œ ì´ˆê¸°í™”
                    updateSummary([]);
                    return;
                }

                // ê²€ìƒ‰ í•„í„°ë§ì„ ìœ„í•´ ì›ë³¸ ë³´ê´€
                window.__INQUIRY_BOARD_LIST__ = list.slice();
                renderList(list);
                updateSummary(list);

            } catch (err) {
                console.error("âŒ ë¬¸ì˜ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:", err);
                errorMessage.textContent = err.message || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ì…ë‹ˆë‹¤.";
                errorState.classList.remove("hidden");
                updateSummary([]);
            }
        }

        // âœ… ì‹¤ì œ í…Œì´ë¸” ë Œë”ë§
        function renderList(list) {
            const tbody = document.getElementById("inquiryListBody");
            tbody.innerHTML = "";

            list.forEach((item, index) => {
                const id = item.id;
                const title = item.title || "(ì œëª© ì—†ìŒ)";
                const userName = item.user_name || "-";
                const createdAt = formatDate(item.created_at);
                const hasAnswer = !!item.has_answer;
                const fileCount = Number.isFinite(item.file_count) ? item.file_count : 0;

                const displayNo = item.id ?? (index + 1);

                const tr = document.createElement("tr");
                tr.className = "cursor-pointer row-hover";
                tr.onclick = () => goToDetail(id);

                tr.innerHTML = `
          <td class="px-3 py-3 text-center align-middle text-xs text-slate-400">${displayNo}</td>
          <td class="px-3 py-3 align-middle">
            <div class="flex flex-col gap-0.5">
              <span class="text-sm font-semibold text-slate-800 line-clamp-1">${title}</span>
              <span class="text-xs text-slate-400 md:hidden">${createdAt}</span>
            </div>
          </td>
          <td class="px-3 py-3 text-center align-middle text-xs text-slate-500">
            ${userName}
          </td>
          <td class="px-3 py-3 text-center align-middle text-xs text-slate-500 hidden md:table-cell">
            ${createdAt}
          </td>
          <td class="px-3 py-3 text-center align-middle">
            ${renderFileCount(fileCount)}
          </td>
          <td class="px-3 py-3 text-center align-middle">
            ${renderStatus(hasAnswer)}
          </td>
        `;

                tbody.appendChild(tr);
            });
        }

        // âœ… ìƒë‹¨ ìš”ì•½ ë±ƒì§€ ì—…ë°ì´íŠ¸
        function updateSummary(list) {
            const total = Array.isArray(list) ? list.length : 0;
            const answered = Array.isArray(list)
                ? list.filter((i) => !!i.has_answer).length
                : 0;
            const pending = total - answered;

            document.getElementById("summaryTotal").textContent = `ì´ ${total}ê±´ ë¬¸ì˜`;
            document.getElementById("summaryAnswered").textContent = `ë‹µë³€ ì™„ë£Œ ${answered}ê±´`;
            document.getElementById("summaryPending").textContent = `ê²€í†  ì¤‘ ${pending}ê±´`;
        }

        // âœ… ê²€ìƒ‰ ê¸°ëŠ¥
        function setupSearch() {
            const input = document.getElementById("searchInput");
            if (!input) return;

            input.addEventListener("input", () => {
                const keyword = input.value.trim().toLowerCase();
                const original = window.__INQUIRY_BOARD_LIST__ || [];

                if (!keyword) {
                    renderList(original);
                    updateSummary(original);
                    return;
                }

                const filtered = original.filter((item) => {
                    const t = (item.title || "").toLowerCase();
                    const u = (item.user_name || "").toLowerCase();
                    return t.includes(keyword) || u.includes(keyword);
                });

                renderList(filtered);
                updateSummary(filtered);
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
            loadComponents();
            setupSearch();
            loadInquiryList();
        });

        function renderInquiryList(data) {
            const container = document.getElementById("inquiryListContainer");
            
            if (!container) {
                console.error("âŒ inquiryListContainer ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            if (!Array.isArray(data) || data.length === 0) {
                container.innerHTML = `
                    <div class="neo-card p-8 text-center">
                        <div class="text-slate-400 mb-4">
                            <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold text-slate-700 mb-2">ë“±ë¡ëœ ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p class="text-sm text-slate-500 mb-6">ì²« ë²ˆì§¸ ë¬¸ì˜ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</p>
                        <a href="/inquiryWrite.html" 
                           class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-indigo-500 to-sky-500 text-white rounded-xl font-semibold hover:from-indigo-600 hover:to-sky-600 transition-all shadow-lg shadow-indigo-500/30">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                            </svg>
                            ë¬¸ì˜ ë“±ë¡í•˜ê¸°
                        </a>
                    </div>
                `;
                return;
            }

            // Mall Hankook í‘œì¤€: ëª©ë¡ ë Œë”ë§
            container.innerHTML = data.map(item => {
                const createdAt = item.created_at 
                    ? new Date(item.created_at).toLocaleDateString("ko-KR", {
                        year: "numeric",
                        month: "2-digit",
                        day: "2-digit"
                      })
                    : "-";

                // ë‹µë³€ ìƒíƒœ ë±ƒì§€
                const statusBadge = item.has_answer
                    ? `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-200">
                         âœ… ë‹µë³€ì™„ë£Œ
                       </span>`
                    : `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-50 text-amber-700 border border-amber-200">
                         â³ ë‹µë³€ëŒ€ê¸°
                       </span>`;

                // ì²¨ë¶€ íŒŒì¼ ì•„ì´ì½˜
                const fileIcon = item.file_count > 0
                    ? `<span class="inline-flex items-center gap-1 text-xs text-slate-500">
                         <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                 d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                         </svg>
                         ${item.file_count}
                       </span>`
                    : "";

                // âœ… í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
                return `
                    <div class="neo-card p-5 hover:shadow-xl transition-all duration-300 cursor-pointer group" 
                         onclick="location.href='/inquiryDetail.html?id=${item.id}'">
                    <div class="flex items-start justify-between gap-4 mb-3">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-50 text-indigo-700 border border-indigo-200">
                                    ${item.inquiry_type || 'ì¼ë°˜ ë¬¸ì˜'}
                                </span>
                                ${statusBadge}
                            </div>
                            <h3 class="text-base font-semibold text-slate-900 mb-1 group-hover:text-indigo-600 transition-colors truncate">
                                ${item.title || '(ì œëª© ì—†ìŒ)'}
                            </h3>
                            <div class="flex items-center gap-3 text-xs text-slate-500">
                                <span>ì‘ì„±ì: ${item.writer_name || 'ìµëª…'}</span>
                                <span>â€¢</span>
                                <span>${createdAt}</span>
                                ${fileIcon}
                            </div>
                        </div>
                        <div class="flex-shrink-0">
                            <svg class="w-5 h-5 text-slate-400 group-hover:text-indigo-600 group-hover:translate-x-1 transition-all" 
                                 fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                        </div>
                    </div>
                </div>
                `;
            }).join("");

            console.log(`âœ… ${data.length}ê°œì˜ ë¬¸ì˜ ë Œë”ë§ ì™„ë£Œ`);
        }
    </script>
</body>

</html>