<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì˜¤í”ˆì˜ˆì • ë“±ë¡ | MALL HANKOOK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&autoload=false&libraries=services"></script>
    <style>
        body {
            font-family: Pretendard, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #f8fafc, #e0e7ff);
            color: #111827;
            min-height: 100vh
        }

        .neo-card {
            background: rgba(255, 255, 255, .65);
            backdrop-filter: blur(14px);
            border: 1px solid rgba(255, 255, 255, .45);
            border-radius: 1.25rem;
            box-shadow: 8px 8px 24px rgba(0, 0, 0, .07)
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: .5rem;
            padding: .75rem;
            border: 1px solid #e5e7eb;
            border-radius: .75rem;
            background: rgba(255, 255, 255, .6)
        }

        .tbtn {
            padding: .5rem .75rem;
            border-radius: .6rem;
            border: 1px solid #e5e7eb;
            background: #fff;
            box-shadow: 0 1px 2px rgba(0, 0, 0, .04);
            font-weight: 600
        }

        .tbtn:hover {
            background: #f3f4f6
        }

        .editor {
            min-height: 320px;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: .75rem;
            background: #fff
        }

        .editor:focus {
            outline: 3px solid rgba(59, 130, 246, .25)
        }

        .img-thumb {
            max-width: 100%;
            height: auto;
            border-radius: .75rem;
            box-shadow: 0 6px 18px rgba(0, 0, 0, .08)
        }

        .gradient-text {
            background: linear-gradient(90deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent
        }
    </style>
</head>

<body class="flex flex-col items-center py-10">
    <!-- Header(ì˜µì…˜) -->
    <div id="header-container" class="w-full"></div>

    <main class="w-full max-w-3xl p-8 neo-card mt-10">
        <h1 class="text-3xl font-extrabold text-center mb-8 gradient-text">ì˜¤í”ˆ ë§¤ì¥ ë“±ë¡</h1>

        <form id="openForm" class="space-y-6" enctype="multipart/form-data">
            <!-- ê¸°ë³¸ ì •ë³´ -->
            <div>
                <label class="block font-semibold mb-1">ìƒí˜¸ëª…</label>
                <input name="store_name" type="text" required
                    class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400" />
            </div>

            <div>
                <label class="block font-semibold mb-1">ì˜¤í”ˆì¼</label>
                <input name="open_date" type="date" required
                    class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400" />
            </div>

            <div>
                <label class="block font-semibold mb-1">ì—…ì¢…(ì¹´í…Œê³ ë¦¬)</label>
                <input name="category" type="text" placeholder="ì˜ˆ: í•œì‹, ì¹´í˜, ë³‘ì› ë“±"
                    class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400" />
            </div>

            <div>
                <label class="block font-semibold mb-1">ì „í™”ë²ˆí˜¸</label>
                <input name="phone" type="text" required placeholder="010-0000-0000"
                    class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400" />
            </div>

            <!-- ì£¼ì†Œ -->
            <div>
                <label class="block font-semibold mb-1">ì£¼ì†Œ</label>
                <div class="flex gap-2">
                    <input id="address" name="address" type="text" readonly
                        class="flex-1 border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400" />
                    <button type="button" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                        onclick="searchAddress()">ê²€ìƒ‰</button>
                </div>
            </div>

            <!-- ìƒì„¸ ì£¼ì†Œ -->
            <div>
                <label class="block font-semibold mb-1">ìƒì„¸ ì£¼ì†Œ</label>
                <input id="detailAddress" name="detail_address" type="text" placeholder="ì˜ˆ: 2ì¸µ, 203í˜¸"
                    class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400" />
            </div>

            <!-- ì§€ë„ (ì°¸ê³ ìš©) -->
            <div class="flex justify-center">
                <div id="map" class="rounded border border-gray-300 my-4 shadow-sm"
                    style="width:100%; min-width:180px; height:260px; max-width:480px;"></div>
            </div>

            <!-- ëŒ€í‘œ ì´ë¯¸ì§€ í•œ ì¥ -->
            <div>
                <label class="block font-semibold mb-1">ëŒ€í‘œ ì´ë¯¸ì§€</label>
                <input name="img" type="file" accept="image/*" class="w-full border rounded px-3 py-2 text-gray-700" />
                <p class="text-xs text-gray-500 mt-1">í•œ ì¥ë§Œ ì—…ë¡œë“œí•©ë‹ˆë‹¤.</p>
            </div>

            <!-- ğŸ”¹ ìì²´ ë¸”ë¡œê·¸í˜• ì—ë””í„° -->
            <div>
                <label class="block font-semibold mb-2">ì„¤ëª… (ì‚¬ì§„ í¬í•¨, ì‰¬ìš´ í¸ì§‘)</label>

                <!-- íˆ´ë°” -->
                <div class="toolbar mb-3">
                    <button class="tbtn" type="button" onclick="fmt('bold')">êµµê²Œ</button>
                    <button class="tbtn" type="button" onclick="fmt('underline')">ë°‘ì¤„</button>

                    <select id="fontSizeSelect" class="tbtn" onchange="setFontSize(this.value)">
                        <option value="">ê¸€ì í¬ê¸°</option>
                        <option value="16px">ì‘ê²Œ</option>
                        <option value="18px">ë³´í†µ</option>
                        <option value="22px">í¬ê²Œ</option>
                        <option value="28px">ì œëª©</option>
                    </select>

                    <button class="tbtn" type="button" onclick="insertHR()">êµ¬ë¶„ì„ </button>
                    <button class="tbtn" type="button" onclick="fmt('insertUnorderedList')">ê¸€ë¨¸ë¦¬ê¸°í˜¸</button>

                    <button class="tbtn" type="button" onclick="triggerImagePick()">ì‚¬ì§„ ë„£ê¸°</button>
                    <input id="hiddenImage" type="file" accept="image/*" class="hidden" />
                </div>

                <!-- í¸ì§‘ ì˜ì—­ -->
                <div id="editor" class="editor" contenteditable="true" aria-label="ì„¤ëª… ì…ë ¥"></div>

                <!-- ì‹¤ì œ ì „ì†¡ìš©(HTML) -->
                <textarea id="descHtml" name="description" class="hidden"></textarea>
            </div>

            <button type="submit" class="mt-2 py-2 px-6 bg-blue-600 text-white rounded font-semibold hover:bg-blue-700">
                ë“±ë¡
            </button>
        </form>
    </main>

    <!-- Footer(ì˜µì…˜) -->
    <div id="footer-container" class="w-full mt-10"></div>

    <script>
        /* ===== Header / Footer ë¡œë“œ (ì˜µì…˜) ===== */
        async function loadComponent(url, id) {
            try { const r = await fetch(url); if (r.ok) document.getElementById(id).innerHTML = await r.text(); } catch (_) { }
        }
        document.addEventListener("DOMContentLoaded", async () => {
            await loadComponent("/components/header.html", "header-container");
            await loadComponent("/components/footer.html", "footer-container");
        });

        /* ===== ì£¼ì†Œ ê²€ìƒ‰ + ì§€ë„ ===== */
        function searchAddress() {
            new daum.Postcode({
                oncomplete: function (data) {
                    const addr = data.address;
                    document.getElementById("address").value = addr;
                    updateMapByAddress(addr);
                    document.getElementById("detailAddress").focus();
                }
            }).open();
        }
        window.searchAddress = searchAddress;

        window.map = null; window.marker = null;
        kakao.maps.load(function () {
            const mapContainer = document.getElementById("map");
            const pos = new kakao.maps.LatLng(37.5665, 126.9780);
            window.map = new kakao.maps.Map(mapContainer, { center: pos, level: 3 });
            window.marker = new kakao.maps.Marker({ map: window.map, position: pos });
        });
        function updateMapByAddress(address) {
            const geocoder = new kakao.maps.services.Geocoder();
            geocoder.addressSearch(address, function (result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    const lat = result[0].y, lng = result[0].x;
                    const loc = new kakao.maps.LatLng(lat, lng);
                    window.map.setCenter(loc);
                    window.marker.setPosition(loc);
                }
            });
        }

        /* ===== ê°„ë‹¨ ì—ë””í„° ê¸°ëŠ¥ ===== */
        function fmt(cmd) { document.execCommand(cmd, false, null); }
        function setFontSize(px) {
            if (!px) return;
            wrapSelectionWithSpanStyle('font-size', px);
            document.getElementById('fontSizeSelect').value = '';
        }
        function insertHR() {
            const hr = document.createElement('hr');
            hr.style.border = 'none'; hr.style.borderTop = '1px solid #e5e7eb'; hr.style.margin = '16px 0';
            insertNodeAtCaret(hr);
        }
        function triggerImagePick() { document.getElementById('hiddenImage').click(); }
        document.getElementById('hiddenImage').addEventListener('change', async (e) => {
            const file = e.target.files?.[0];
            if (!file) return;
            try {
                const fd = new FormData(); fd.append('image', file);
                const res = await fetch('/upload/image', { method: 'POST', body: fd });
                const json = await res.json();
                if (!json?.url) { alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨'); return; }
                const img = document.createElement('img');
                img.src = json.url; img.alt = 'ì´ë¯¸ì§€'; img.className = 'img-thumb';
                img.loading = 'lazy';
                insertNodeAtCaret(img);
            } catch (err) { console.error(err); alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜¤ë¥˜'); }
            e.target.value = '';
        });

        /* ìœ í‹¸: ì„ íƒì˜ì—­ì— ë…¸ë“œ ì‚½ì…/ìŠ¤íƒ€ì¼ ì ìš© */
        function insertNodeAtCaret(node) {
            const sel = window.getSelection();
            if (!sel || !sel.rangeCount) { document.getElementById('editor').appendChild(node); return; }
            const range = sel.getRangeAt(0); range.deleteContents(); range.insertNode(node);
            range.setStartAfter(node); range.setEndAfter(node); sel.removeAllRanges(); sel.addRange(range);
        }
        function wrapSelectionWithSpanStyle(key, value) {
            const sel = window.getSelection();
            if (!sel || sel.isCollapsed) { // ì„ íƒ ì—†ìœ¼ë©´ ë¹ˆ span ì‚½ì…
                const span = document.createElement('span'); span.style[key] = value; span.textContent = 'í…ìŠ¤íŠ¸';
                insertNodeAtCaret(span); return;
            }
            const range = sel.getRangeAt(0);
            const span = document.createElement('span'); span.style[key] = value;
            span.appendChild(range.extractContents()); range.insertNode(span);
            sel.removeAllRanges(); const r = document.createRange(); r.selectNodeContents(span); sel.addRange(r);
        }

        /* ===== ì œì¶œ: ì—ë””í„° HTML ì €ì¥ í›„ ì „ì†¡ ===== */
        document.getElementById('openForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const html = document.getElementById('editor').innerHTML.trim();
            document.getElementById('descHtml').value = html;

            const fd = new FormData(e.target);
            try {
                const res = await fetch('/openregister', { method: 'POST', body: fd });
                const json = await res.json();
                if (json.success) {
                    alert('ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    e.target.reset();
                    document.getElementById('editor').innerHTML = '';
                } else {
                    alert('ë“±ë¡ ì‹¤íŒ¨: ' + (json.message || 'ì„œë²„ ì˜¤ë¥˜'));
                }
            } catch (err) {
                console.error(err);
                alert('ì„œë²„ í†µì‹  ì˜¤ë¥˜: ' + err.message);
            }
        });
    </script>
</body>

</html>