<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì„œë¸Œ ì¹´í…Œê³ ë¦¬ í˜ì´ì§€</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-white text-gray-800 min-h-screen flex flex-col">
    <div id="header-placeholder"></div>

    <!-- HERO -->
    <section class="relative h-[70vh] max-h-[400px] flex items-center justify-between px-8 bg-gray-50">
        <div class="flex-1 flex justify-center">
            <img id="heroImage" src="/uploads/sample-banner-product.png" alt="ë°°ë„ˆ" class="h-[280px] object-contain">
        </div>
        <div class="flex-1 text-left">
            <h1 id="heroTitle" class="text-3xl md:text-4xl font-bold mb-4">ì¹´í…Œê³ ë¦¬ ì œëª©</h1>
            <p id="heroSubtitle" class="text-gray-600 mb-6">ì¹´í…Œê³ ë¦¬ ì„¤ëª…</p>
            <button id="btnMore" class="px-5 py-2.5 bg-black text-white font-semibold rounded-lg">MORE VIEW</button>
        </div>
    </section>

    <!-- All of the items -->
    <section id="aboutSection" class="max-w-6xl mx-auto py-12 px-4 w-full">
        <div class="flex items-center justify-center relative mb-6">
            <h2 class="text-xl md:text-2xl font-bold text-center">All of the items</h2>

            <!-- âœ… ë”ë³´ê¸° = ë‹¤ìŒ í˜ì´ì§€ë¡œ(ì´ë™/ëª¨ë‹¬ X) -->
            <div class="absolute right-0">
                <button id="btnMoreItems"
                    class="px-4 py-2 rounded-full bg-black text-white text-sm font-semibold hover:opacity-90 transition">
                    ë”ë³´ê¸°
                </button>
            </div>
        </div>

        <div id="filterContainer" class="flex justify-center flex-wrap gap-3 mb-8"></div>

        <div id="lineGrid" class="grid grid-cols-1 sm:grid-cols-3 gap-4"></div>

        <!-- âœ… í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div class="mt-8 flex flex-col items-center gap-3">
            <div id="pageInfo" class="text-sm text-gray-600 font-semibold"></div>

            <div class="flex items-center gap-2 flex-wrap justify-center">
                <button id="btnPrevPage"
                    class="px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold transition">
                    ì´ì „
                </button>

                <div id="pageNumbers" class="flex items-center gap-2 flex-wrap justify-center"></div>

                <button id="btnNextPage"
                    class="px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold transition">
                    ë‹¤ìŒ
                </button>
            </div>
        </div>
    </section>

    <!-- Best Seller -->
    <section class="max-w-6xl mx-auto py-12 px-4">
        <h2 class="text-xl md:text-2xl font-bold text-center mb-8">Best Seller</h2>
        <div id="bestGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    </section>

    <!-- New registration -->
    <section class="max-w-6xl mx-auto py-12 px-4">
        <h2 class="text-xl md:text-2xl font-bold text-center mb-8">New registration</h2>
        <div id="newGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    </section>

    <div id="footer-placeholder"></div>

    <!-- ìš°ì¸¡ í•˜ë‹¨ ë„¤ë¹„ -->
    <div class="fixed bottom-6 right-6 flex flex-col items-center gap-4 z-50">
        <div class="flex flex-col items-center">
            <button onclick="goBack()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-gray-100 to-gray-200 text-gray-700 shadow hover:from-gray-200 hover:to-gray-300 transition">â†</button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">ì´ì „</span>
        </div>

        <div class="flex flex-col items-center">
            <button onclick="goNext()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-gray-100 to-gray-200 text-gray-700 shadow hover:from-gray-200 hover:to-gray-300 transition">â†’</button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">ë‹¤ìŒ</span>
        </div>

        <div class="flex flex-col items-center">
            <a href="/index.html"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow hover:from-blue-600 hover:to-blue-700 transition">ğŸ </a>
            <span class="text-xs mt-1 text-gray-600 font-semibold">í™ˆ</span>
        </div>
    </div>

    <script>
        // header/footer
        fetch("/components/header.html").then(r => r.text()).then(d => (document.getElementById("header-placeholder").innerHTML = d));
        fetch("/components/footer.html").then(r => r.text()).then(d => (document.getElementById("footer-placeholder").innerHTML = d));

        // URL params
        const params = new URLSearchParams(window.location.search);
        const TYPE = (params.get("type") || "food").toLowerCase();  // food / combined
        const CATEGORY = (params.get("category") || "").trim();
        const RAW_SUB = (params.get("sub") || "").trim();

        // âœ… í•œì‹ í•˜ìœ„êµ¬ë¶„(ê³ ì •)
        const HANSIK_SUBS = ["ë°¥", "ì°Œê°œíƒ•", "ê³ ê¸°êµ¬ì´", "ìƒì„ ", "ì¡±ë°œë³´ìŒˆ", "êµ­ë°¥", "ë°˜ì°¬", "ê¸°íƒ€í•œì‹"];

        // âœ… 12ê°œ í˜ì´ì§€ë„¤ì´ì…˜
        const ITEMS_PER_PAGE = 12;

        // âœ… New registration: 60ì¼(1~2ë‹¬)
        const NEW_DAYS = 60;

        // ì „ì—­ ìƒíƒœ
        let ALL_STORES = [];
        let CURRENT_SUB = RAW_SUB;
        let CURRENT_PAGE = 1;

        let DATA = {
            hero: { title: "ì¹´í…Œê³ ë¦¬", subtitle: "ì¹´í…Œê³ ë¦¬ë³„ ê°€ê²Œë¥¼ í™•ì¸í•˜ì„¸ìš”.", image: "/uploads/sample-banner-product.png" },
            filters: [],
            stores: [],
            best: [],
            new: []
        };

        function escapeHtml(input) {
            const s = input == null ? "" : String(input);
            return s.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;").replace(/'/g, "&#39;");
        }

        function normalizeSrc(src) {
            if (!src) return "/uploads/no-image.png";
            if (/^https?:\/\//i.test(src)) return src;
            return src.startsWith("/") ? src : "/" + src;
        }

        async function fetchJson(url) {
            const res = await fetch(url);
            return await res.json();
        }

        function getStoreName(store) {
            return (store.name ?? store.business_name ?? store.businessName ?? store.title ?? "-").toString().trim() || "-";
        }

        function getStoreCategory(store) {
            return (store.category ?? store.business_category ?? store.businessCategory ?? "").toString().trim();
        }

        function getStoreImage(store) {
            const imgSrc = store.image ?? store.image_url ?? store.url ?? store.main_image_url ?? "";
            return normalizeSrc(imgSrc || "/uploads/no-image.png");
        }

        // âœ… Best Sellerìš© í´ë¦­/ì¡°íšŒ ìˆ˜(ì„œë²„ í•„ë“œ ë‹¤ì–‘ ëŒ€ì‘)
        function getStoreClicks(store) {
            const cand = [
                store.click_count, store.clicks,
                store.view_count, store.views,
                store.hit, store.hits
            ];
            for (const v of cand) {
                const n = Number(v);
                if (Number.isFinite(n)) return n;
            }
            return 0;
        }

        // âœ… New registrationìš© ë“±ë¡ì¼(ì„œë²„ í•„ë“œ ë‹¤ì–‘ ëŒ€ì‘)
        function getStoreCreatedAt(store) {
            const v = store.created_at ?? store.createdAt ?? store.created_date ?? store.createdDate ?? store.reg_date ?? store.regDate ?? null;
            if (!v) return null;
            const d = new Date(v);
            return Number.isFinite(d.getTime()) ? d : null;
        }

        // âœ… í•œì‹ detail_category
        function getDetailCategory(store) {
            const raw = (store.detail_category ?? store.detailCategory ?? "").toString().trim();
            return raw ? raw : "ê¸°íƒ€í•œì‹";
        }

        // âœ… í†µí•©/í‘¸ë“œ ê³µí†µ sub(í•œì‹ ì œì™¸ëŠ” business_subcategory)
        function getBusinessSubcategory(store) {
            const raw = (
                store.business_subcategory ??
                store.businessSubcategory ??
                store.subcategory ??
                store.business_sub ??
                ""
            ).toString().trim();
            return raw ? raw : "ê¸°íƒ€";
        }

        function setHero() {
            if (TYPE === "food" && CATEGORY === "í•œì‹") {
                setHansikHero(CURRENT_SUB || "");
                return;
            }
            DATA.hero = {
                title: CATEGORY || "ì¹´í…Œê³ ë¦¬",
                subtitle: "ì¹´í…Œê³ ë¦¬ë³„ ê°€ê²Œë¥¼ í™•ì¸í•˜ì„¸ìš”.",
                image: "/uploads/sample-banner-product.png"
            };
        }

        function setHansikHero(subVal) {
            const titleBase = "í•œì‹";
            const subLabel = subVal ? ` Â· ${subVal}` : "";

            DATA.hero = {
                title: `${titleBase}${subLabel}`,
                subtitle:
                    subVal === "ë°¥" ? "ë¹„ë¹”ë°¥ Â· ë®ë°¥ Â· ë°±ë°˜ ë“± ë“ ë“ í•œ í•œ ë¼ ëª¨ìŒ"
                        : subVal === "ì°Œê°œíƒ•" ? "ë”°ëˆí•œ ì°Œê°œì™€ ì–¼í°í•œ íƒ• ìš”ë¦¬ë¥¼ ëª¨ì•˜ì–´ìš”"
                            : subVal === "ê³ ê¸°êµ¬ì´" ? "ì‚¼ê²¹ì‚´, ê°ˆë¹„, ìˆ¯ë¶ˆêµ¬ì´ ë“± ê³ ê¸° ì¢‹ì•„í•˜ëŠ” ë‚ ì— ë”±!"
                                : subVal === "ìƒì„ " ? "êµ¬ì´ Â· ì¡°ë¦¼ Â· íšŒ ë“± ë‹¤ì–‘í•œ ìƒì„  ìš”ë¦¬"
                                    : subVal === "ì¡±ë°œë³´ìŒˆ" ? "ì¡±ë°œ Â· ë³´ìŒˆ Â· ìˆ˜ìœ¡ê¹Œì§€ í‘¸ì§í•˜ê²Œ"
                                        : subVal === "êµ­ë°¥" ? "ëœ¨ëˆí•œ êµ­ë°¥ í•œ ê·¸ë¦‡ìœ¼ë¡œ ë“ ë“ í•˜ê²Œ"
                                            : subVal === "ë°˜ì°¬" ? "ì§‘ë°¥ ëŠë‚Œ ë‚˜ëŠ” ë°˜ì°¬/ë„ì‹œë½ ê°€ê²Œ ëª¨ìŒ"
                                                : subVal === "ê¸°íƒ€í•œì‹" ? "í•œì‹ ë¶„ë¥˜ì— ë“¤ì–´ê°€ì§€ ì•ŠëŠ” ë‹¤ì–‘í•œ ë©”ë‰´ ëª¨ìŒ"
                                                    : "ìš°ë¦¬ë™ë„¤ í•œì‹ ë§›ì§‘ë“¤ì„ ëª¨ì•˜ìŠµë‹ˆë‹¤.",
                image: "/uploads/sample-banner-product.png"
            };
        }

        function bindHero() {
            document.getElementById("heroTitle").innerHTML = escapeHtml(DATA.hero?.title || "ì¹´í…Œê³ ë¦¬").replace(/\n/g, "<br>");
            document.getElementById("heroSubtitle").textContent = DATA.hero?.subtitle || "ì¹´í…Œê³ ë¦¬ë³„ ê°€ê²Œë¥¼ í™•ì¸í•˜ì„¸ìš”.";
            document.getElementById("heroImage").src = DATA.hero?.image || "/uploads/sample-banner-product.png";
        }

        function uniqueNonEmpty(arr) {
            const set = new Set();
            arr.forEach(v => {
                const s = (v ?? "").toString().trim();
                if (s) set.add(s);
            });
            return Array.from(set);
        }

        // âœ… í•„í„° ë²„íŠ¼ ëª©ë¡ ë§Œë“¤ê¸°
        function buildFilters() {
            // í•œì‹ì´ë©´ ê³ ì •
            if (TYPE === "food" && CATEGORY === "í•œì‹") {
                DATA.filters = HANSIK_SUBS.slice();
                return;
            }

            // ê·¸ ì™¸(í‘¸ë“œ ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ + í†µí•©)ëŠ” business_subcategoryë¡œ ìë™ ìƒì„±
            const subs = uniqueNonEmpty(ALL_STORES.map(s => getBusinessSubcategory(s)));

            // "ê¸°íƒ€"ëŠ” ë§¨ ë’¤ë¡œ
            subs.sort((a, b) => {
                if (a === "ê¸°íƒ€" && b !== "ê¸°íƒ€") return 1;
                if (b === "ê¸°íƒ€" && a !== "ê¸°íƒ€") return -1;
                return a.localeCompare(b, "ko");
            });

            // âœ… subcategoryê°€ ì˜ë¯¸ ìˆê²Œ ì¡´ì¬í•  ë•Œë§Œ í•„í„° í‘œì‹œ
            // (ì „ë¶€ "ê¸°íƒ€" í•˜ë‚˜ ë¿ì´ë©´ ë²„íŠ¼ ì•ˆ ë³´ì—¬ë„ ë¨)
            if (subs.length <= 1) {
                DATA.filters = [];
            } else {
                DATA.filters = subs;
            }
        }

        function applyFilter(subVal, updateHistory = true) {
            CURRENT_PAGE = 1;
            CURRENT_SUB = (subVal || "").trim();

            // ê¸°ë³¸ì€ ALL (í•„í„° ì—†ìŒ)
            let filtered = ALL_STORES.slice();

            // í•œì‹: detail_categoryë¡œ ë¶„ë¦¬
            if (TYPE === "food" && CATEGORY === "í•œì‹") {
                if (CURRENT_SUB) {
                    filtered = ALL_STORES.filter(s => getDetailCategory(s) === CURRENT_SUB);
                }
            } else {
                // í†µí•©/ê¸°íƒ€: business_subcategoryë¡œ ë¶„ë¦¬(í•„í„°ê°€ ìˆì„ ë•Œë§Œ)
                if (DATA.filters.length && CURRENT_SUB) {
                    filtered = ALL_STORES.filter(s => getBusinessSubcategory(s) === CURRENT_SUB);
                }
            }

            // âœ… subë¡œ ê±¸ë €ëŠ”ë° 0ê°œë©´ All ë³µêµ¬(ë¹ˆ í™”ë©´ ë°©ì§€)
            if (!filtered.length && ALL_STORES.length) {
                CURRENT_SUB = "";
                filtered = ALL_STORES.slice();
                if (updateHistory) {
                    const q = new URLSearchParams(location.search);
                    q.delete("sub");
                    history.replaceState(null, "", `${location.pathname}?${q.toString()}`);
                }
            } else {
                if (updateHistory) {
                    const q = new URLSearchParams(location.search);
                    if (CURRENT_SUB) q.set("sub", CURRENT_SUB);
                    else q.delete("sub");
                    history.replaceState(null, "", `${location.pathname}?${q.toString()}`);
                }
            }

            DATA.stores = filtered;

            // âœ… í˜„ì¬ í•„í„° ê¸°ì¤€ìœ¼ë¡œ Best/New ì¬ê³„ì‚°
            rebuildBestAndNew();
            setHero();
            bindHero();

            renderFilters();
            renderPagedStores();
            renderPagination();
            renderSmallGrid("bestGrid", DATA.best);
            renderSmallGrid("newGrid", DATA.new);
        }

        function rebuildBestAndNew() {
            const base = (DATA.stores || []).slice();

            // Best Seller: í´ë¦­/ì¡°íšŒ ìˆ˜ ë†’ì€ ìˆœ
            DATA.best = base
                .slice()
                .sort((a, b) => getStoreClicks(b) - getStoreClicks(a))
                .slice(0, 8);

            // New registration: ìµœê·¼ 60ì¼
            const now = new Date();
            const cutoff = new Date(now.getTime() - NEW_DAYS * 24 * 60 * 60 * 1000);

            DATA.new = base
                .map(s => ({ s, d: getStoreCreatedAt(s) }))
                .filter(x => x.d && x.d >= cutoff)
                .sort((a, b) => b.d - a.d)
                .map(x => x.s)
                .slice(0, 8);
        }

        function makeFilterBtn(label, tagVal) {
            const btn = document.createElement("button");
            btn.type = "button";

            const isActive = (CURRENT_SUB || "") === (tagVal || "");
            btn.className = isActive
                ? "px-3 py-1.5 rounded-full bg-black text-white text-sm"
                : "px-3 py-1.5 rounded-full bg-gray-200 hover:bg-gray-300 text-sm";

            btn.textContent = label;

            btn.onclick = () => applyFilter(tagVal || "", true);
            return btn;
        }

        function renderFilters() {
            const wrap = document.getElementById("filterContainer");
            wrap.innerHTML = "";

            // âœ… í•œì‹ì´ë©´ í•­ìƒ ë²„íŠ¼
            if (TYPE === "food" && CATEGORY === "í•œì‹") {
                wrap.appendChild(makeFilterBtn("All", ""));
                HANSIK_SUBS.forEach(tag => wrap.appendChild(makeFilterBtn(tag, tag)));
                return;
            }

            // âœ… í†µí•©/ê¸°íƒ€ ì¹´í…Œê³ ë¦¬: subê°€ ìœ ì˜ë¯¸í•  ë•Œë§Œ ë²„íŠ¼
            if (!DATA.filters.length) return;

            wrap.appendChild(makeFilterBtn("All", ""));
            DATA.filters.forEach(tag => wrap.appendChild(makeFilterBtn(tag, tag)));
        }

        function goDetail(store) {
            const bt = (store.business_type ?? store.businessType ?? "").toString().trim();
            const type = (bt === "ìŒì‹ì " || bt === "ìŒì‹") ? "food" : "combined";
            const id = store.id ?? store.store_id ?? store.storeId ?? "";
            if (!id) return;
            window.location.href = `/ndetail.html?id=${encodeURIComponent(id)}&type=${encodeURIComponent(type)}`;
        }

        function renderPagedStores() {
            const grid = document.getElementById("lineGrid");
            grid.innerHTML = "";

            const stores = DATA.stores || [];

            if (!stores.length) {
                grid.innerHTML = `
          <div class="col-span-full flex justify-center items-center py-16">
            <div class="p-8 text-center max-w-md">
              <h3 class="text-lg font-semibold text-gray-700 mb-2">ë“±ë¡ëœ ê°€ê²Œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
              <p class="text-sm text-gray-500">ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ìƒˆë¡œìš´ ê°€ê²Œê°€ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
            </div>
          </div>`;
                document.getElementById("pageInfo").textContent = "";
                return;
            }

            const totalPages = Math.max(1, Math.ceil(stores.length / ITEMS_PER_PAGE));
            if (CURRENT_PAGE < 1) CURRENT_PAGE = 1;
            if (CURRENT_PAGE > totalPages) CURRENT_PAGE = totalPages;

            const start = (CURRENT_PAGE - 1) * ITEMS_PER_PAGE;
            const end = start + ITEMS_PER_PAGE;
            const pageItems = stores.slice(start, end);

            const wrapper = document.createElement("div");
            wrapper.className = "col-span-full grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6";

            pageItems.forEach(store => {
                const card = document.createElement("div");
                card.className = "rounded-2xl cursor-pointer hover:shadow-lg transition overflow-hidden flex flex-col bg-white";

                const name = getStoreName(store);
                const cat = getStoreCategory(store);
                const img = getStoreImage(store);

                card.innerHTML = `
          <div class="relative h-[260px]">
            <img src="${img}" alt="${escapeHtml(name)}" class="w-full h-full object-cover rounded-t-2xl">
            <div class="absolute left-0 right-0 bottom-0 bg-white/90 backdrop-blur px-4 py-2 text-center rounded-b-2xl">
              <div class="font-bold text-lg text-gray-800 leading-tight truncate">${escapeHtml(name)}</div>
              <div class="text-sm text-gray-600">${escapeHtml(cat)}</div>
            </div>
          </div>
        `;

                card.addEventListener("click", () => goDetail(store));
                wrapper.appendChild(card);
            });

            grid.appendChild(wrapper);

            const totalCount = stores.length;
            const from = start + 1;
            const to = Math.min(end, totalCount);
            document.getElementById("pageInfo").textContent = `${from} - ${to} / ${totalCount}ê°œ Â· ${CURRENT_PAGE} / ${totalPages} í˜ì´ì§€`;
        }

        function renderPagination() {
            const stores = DATA.stores || [];
            const totalPages = Math.max(1, Math.ceil(stores.length / ITEMS_PER_PAGE));

            const btnPrev = document.getElementById("btnPrevPage");
            const btnNext = document.getElementById("btnNextPage");
            const nums = document.getElementById("pageNumbers");

            btnPrev.disabled = (CURRENT_PAGE <= 1);
            btnNext.disabled = (CURRENT_PAGE >= totalPages);

            btnPrev.className = btnPrev.disabled
                ? "px-3 py-2 rounded-lg bg-gray-100 text-gray-300 font-semibold cursor-not-allowed"
                : "px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold transition";

            btnNext.className = btnNext.disabled
                ? "px-3 py-2 rounded-lg bg-gray-100 text-gray-300 font-semibold cursor-not-allowed"
                : "px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold transition";

            btnPrev.onclick = () => { CURRENT_PAGE -= 1; renderPagedStores(); renderPagination(); };
            btnNext.onclick = () => { CURRENT_PAGE += 1; renderPagedStores(); renderPagination(); };

            nums.innerHTML = "";

            const makeNumBtn = (p) => {
                const b = document.createElement("button");
                const isActive = (p === CURRENT_PAGE);
                b.type = "button";
                b.textContent = String(p);
                b.className = isActive
                    ? "min-w-[40px] px-3 py-2 rounded-lg bg-black text-white font-bold"
                    : "min-w-[40px] px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold transition";
                b.onclick = () => { CURRENT_PAGE = p; renderPagedStores(); renderPagination(); };
                return b;
            };

            const addDots = () => {
                const d = document.createElement("span");
                d.className = "px-2 text-gray-400 font-bold";
                d.textContent = "â€¦";
                nums.appendChild(d);
            };

            if (totalPages <= 7) {
                for (let p = 1; p <= totalPages; p++) nums.appendChild(makeNumBtn(p));
                return;
            }

            nums.appendChild(makeNumBtn(1));

            const left = Math.max(2, CURRENT_PAGE - 2);
            const right = Math.min(totalPages - 1, CURRENT_PAGE + 2);

            if (left > 2) addDots();
            for (let p = left; p <= right; p++) nums.appendChild(makeNumBtn(p));
            if (right < totalPages - 1) addDots();

            nums.appendChild(makeNumBtn(totalPages));
        }

        function renderSmallGrid(gridId, items) {
            const grid = document.getElementById(gridId);
            grid.innerHTML = "";

            if (!items || !items.length) {
                grid.innerHTML = `<div class="col-span-full text-center text-gray-500">ë“±ë¡ëœ ê°€ê²Œê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                return;
            }

            items.forEach(item => {
                const name = getStoreName(item);
                const img = getStoreImage(item);

                const card = document.createElement("div");
                card.className = "block rounded-2xl overflow-hidden bg-white hover:shadow-lg transition cursor-pointer";
                card.innerHTML = `
          <div class="h-40">
            <img src="${img}" alt="${escapeHtml(name)}" class="w-full h-full object-cover">
          </div>
          <div class="p-3 text-sm font-semibold truncate">${escapeHtml(name)}</div>
        `;
                card.addEventListener("click", () => goDetail(item));
                grid.appendChild(card);
            });
        }

        async function loadData() {
            try {
                ALL_STORES = [];
                DATA.stores = [];
                DATA.best = [];
                DATA.new = [];
                CURRENT_PAGE = 1;

                if (TYPE === "food") {
                    const q = new URLSearchParams();
                    q.set("category", CATEGORY);
                    const json = await fetchJson(`/api/subcategory/food?${q.toString()}`);
                    ALL_STORES = (json.stores || []);
                } else {
                    // âœ… í†µí•©: ìš°ì„  /api/subcategory/combined ì‹œë„ â†’ ì—†ìœ¼ë©´ ê¸°ì¡´(beauty)ë¡œ í´ë°±
                    try {
                        const json = await fetchJson(`/api/subcategory/combined?category=${encodeURIComponent(CATEGORY)}`);
                        ALL_STORES = (json.stores || []);
                    } catch (e) {
                        const json = await fetchJson(`/api/subcategory/beauty?category=${encodeURIComponent(CATEGORY)}`);
                        ALL_STORES = (json.stores || []);
                    }

                    // âœ… ìš”ì²­ ì¹´í…Œê³ ë¦¬ë§Œ ë‚¨ê¸°ê¸°(ì„œë²„ê°€ ëœ ê±¸ëŸ¬ì£¼ë©´ ë°©ì–´)
                    ALL_STORES = ALL_STORES.filter(s => getStoreCategory(s) === CATEGORY);
                }

                buildFilters();
                setHero();
                bindHero();

                // âœ… ìµœì´ˆ ë Œë”: subê°€ ìˆìœ¼ë©´ í•´ë‹¹ ì¡°ê±´ìœ¼ë¡œ ë°”ë¡œ í•„í„° ì ìš©
                applyFilter(CURRENT_SUB || "", false);

            } catch (e) {
                console.error("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", e);
                ALL_STORES = [];
                DATA.filters = [];
                DATA.stores = [];
                DATA.best = [];
                DATA.new = [];
                setHero();
                bindHero();
                renderFilters();
                renderPagedStores();
                renderPagination();
                renderSmallGrid("bestGrid", []);
                renderSmallGrid("newGrid", []);
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            loadData();

            // âœ… HERO MORE VIEW = All itemsë¡œ ìŠ¤í¬ë¡¤
            document.getElementById("btnMore").onclick = () => {
                document.getElementById("aboutSection").scrollIntoView({ behavior: "smooth", block: "start" });
            };

            // âœ… ë”ë³´ê¸° = ë‹¤ìŒ í˜ì´ì§€(ëì´ë©´ 1í˜ì´ì§€ë¡œ)
            document.getElementById("btnMoreItems").onclick = () => {
                const totalPages = Math.max(1, Math.ceil((DATA.stores || []).length / ITEMS_PER_PAGE));
                if (totalPages <= 1) return;

                CURRENT_PAGE = (CURRENT_PAGE < totalPages) ? (CURRENT_PAGE + 1) : 1;
                renderPagedStores();
                renderPagination();
                document.getElementById("aboutSection").scrollIntoView({ behavior: "smooth", block: "start" });
            };
        });

        function goBack() {
            if (document.referrer && document.referrer !== location.href) window.history.back();
            else window.location.href = "/foodcategory.html";
        }
        function goNext() { window.history.forward(); }
    </script>
</body>

</html>