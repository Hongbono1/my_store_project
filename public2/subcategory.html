<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì„œë¸Œ ì¹´í…Œê³ ë¦¬ í˜ì´ì§€</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-white text-gray-800 min-h-screen flex flex-col">
    <div id="header-placeholder"></div>

    <section class="relative h-[70vh] max-h-[400px] flex items-center justify-between px-8 bg-gray-50">
        <div class="flex-1 flex justify-center">
            <img id="heroImage" src="/uploads/sample-banner-product.png" alt="ë°°ë„ˆ" class="h-[280px] object-contain">
        </div>
        <div class="flex-1 text-left">
            <h1 id="heroTitle" class="text-3xl md:text-4xl font-bold mb-4">ì¹´í…Œê³ ë¦¬ ì œëª©</h1>
            <p id="heroSubtitle" class="text-gray-600 mb-6">ì¹´í…Œê³ ë¦¬ ì„¤ëª…</p>
            <button id="btnMore" class="px-5 py-2.5 bg-black text-white font-semibold rounded-lg">MORE VIEW</button>
        </div>
    </section>

    <!-- All of the items -->
    <section id="aboutSection" class="max-w-6xl mx-auto py-12 px-4 w-full">
        <div class="flex items-center justify-center relative mb-6">
            <h2 class="text-xl md:text-2xl font-bold text-center">All of the items</h2>

            <!-- âœ… ë”ë³´ê¸° = ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™ -->
            <div class="absolute right-0">
                <button id="btnMoreItems"
                    class="px-4 py-2 rounded-full bg-black text-white text-sm font-semibold hover:opacity-90 transition">
                    ë”ë³´ê¸°
                </button>
            </div>
        </div>

        <div id="filterContainer" class="flex justify-center flex-wrap gap-3 mb-8"></div>

        <!-- âœ… 12ê°œë§Œ í‘œì‹œ -->
        <div id="lineGrid" class="grid grid-cols-1 sm:grid-cols-3 gap-4"></div>

        <!-- âœ… í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div class="mt-8 flex flex-col items-center gap-3">
            <div id="pageInfo" class="text-sm text-gray-600 font-semibold"></div>

            <div class="flex items-center gap-2 flex-wrap justify-center">
                <button id="btnPrevPage"
                    class="px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold transition">
                    ì´ì „
                </button>

                <div id="pageNumbers" class="flex items-center gap-2 flex-wrap justify-center"></div>

                <button id="btnNextPage"
                    class="px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold transition">
                    ë‹¤ìŒ
                </button>
            </div>
        </div>
    </section>

    <!-- Best Seller -->
    <section class="max-w-6xl mx-auto py-12 px-4">
        <h2 class="text-xl md:text-2xl font-bold text-center mb-8">Best Seller</h2>
        <div id="bestGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    </section>

    <!-- New registration -->
    <section class="max-w-6xl mx-auto py-12 px-4">
        <h2 class="text-xl md:text-2xl font-bold text-center mb-8">New registration</h2>
        <div id="newGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    </section>

    <div id="footer-placeholder"></div>

    <!-- ìš°ì¸¡ í•˜ë‹¨ ë„¤ë¹„ -->
    <div class="fixed bottom-6 right-6 flex flex-col items-center gap-4 z-50">
        <div class="flex flex-col items-center">
            <button onclick="goBack()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-gray-100 to-gray-200 text-gray-700 shadow hover:from-gray-200 hover:to-gray-300 transition">â†</button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">ì´ì „</span>
        </div>

        <div class="flex flex-col items-center">
            <button onclick="goNext()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-gray-100 to-gray-200 text-gray-700 shadow hover:from-gray-200 hover:to-gray-300 transition">â†’</button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">ë‹¤ìŒ</span>
        </div>

        <div class="flex flex-col items-center">
            <a href="/index.html"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow hover:from-blue-600 hover:to-blue-700 transition">ğŸ </a>
            <span class="text-xs mt-1 text-gray-600 font-semibold">í™ˆ</span>
        </div>
    </div>

    <script>
        // header/footer
        fetch("/components/header.html").then(r => r.text()).then(d => (document.getElementById("header-placeholder").innerHTML = d));
        fetch("/components/footer.html").then(r => r.text()).then(d => (document.getElementById("footer-placeholder").innerHTML = d));

        // URL params
        const params = new URLSearchParams(window.location.search);
        const TYPE = (params.get("type") || "food").toLowerCase();

        // âœ… ì›ë³¸ category/sub
        const RAW_CATEGORY = (params.get("category") || "").trim();
        const RAW_SUB = (params.get("sub") || "").trim();

        // âœ… â€œë¯¸ìš©/ì´ë°œâ€ êµ¬ë¶„ ìœ ì§€
        const BEAUTY_SPLIT_SET = new Set(["ë¯¸ìš©", "ì´ë°œ", "ë„¤ì¼", "í”¼ë¶€ê´€ë¦¬", "ì™ì‹±"]);
        let CATEGORY = RAW_CATEGORY;
        let SUB = RAW_SUB;

        if ((TYPE === "beauty" || TYPE === "combined") && BEAUTY_SPLIT_SET.has(CATEGORY)) {
            SUB = SUB || CATEGORY;
            CATEGORY = "ë¯¸ìš©/ì´ë°œ";
        }

        // í•œì‹ ì†Œì œëª©(ê³ ì •)
        const HANSIK_SUBS = ["ë°¥", "ì°Œê°œíƒ•", "ê³ ê¸°êµ¬ì´", "ìƒì„ ", "ì¡±ë°œë³´ìŒˆ", "êµ­ë°¥", "ë°˜ì°¬", "ê¸°íƒ€í•œì‹"];
        // âœ… ë¯¸ìš©/ì´ë°œ ì†Œì œëª©(í•„í„°)
        const BEAUTY_SUBS = ["ë¯¸ìš©", "ì´ë°œ", "ê¸°íƒ€"];

        // ì „ì²´ ë°ì´í„°ë¥¼ 1ë²ˆë§Œ ë°›ì•„ë‘ê³ , í™”ë©´ì€ ì—¬ê¸°ì„œ í•„í„°ë§
        let ALL_STORES = [];
        let CURRENT_SUB = SUB;

        const DEFAULT_DATA = {
            hero: { title: "ìƒ˜í”Œ ì¹´í…Œê³ ë¦¬", subtitle: "ê¸°ë³¸ ì„¤ëª… í…ìŠ¤íŠ¸", image: "/uploads/sample-banner-product.png" },
            filters: [],
            stores: [],
            best: [],
            new: []
        };
        let DATA = { ...DEFAULT_DATA };

        // âœ… í˜ì´ì§€ë„¤ì´ì…˜ ì„¤ì •
        const ITEMS_PER_PAGE = 12;
        let CURRENT_PAGE = 1;

        function escapeHtml(input) {
            const s = input == null ? "" : String(input);
            return s.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;").replace(/'/g, "&#39;");
        }

        function normalizeSrc(src) {
            if (!src) return "/uploads/no-image.png";
            if (/^https?:\/\//i.test(src)) return src;
            return src.startsWith("/") ? src : "/" + src;
        }

        function getDetailCategory(store) {
            const raw = (store.detail_category ?? store.detailCategory ?? "").toString().trim();
            return raw ? raw : "ê¸°íƒ€í•œì‹";
        }

        function setHansikHero(subVal) {
            const titleBase = "í•œì‹";
            const subLabel = subVal ? ` Â· ${subVal}` : "";

            DATA.hero = {
                title: `${titleBase}${subLabel}`,
                subtitle:
                    subVal === "ë°¥" ? "ë¹„ë¹”ë°¥ Â· ë®ë°¥ Â· ë°±ë°˜ ë“± ë“ ë“ í•œ í•œ ë¼ ëª¨ìŒ"
                        : subVal === "ì°Œê°œíƒ•" ? "ë”°ëˆí•œ ì°Œê°œì™€ ì–¼í°í•œ íƒ• ìš”ë¦¬ë¥¼ ëª¨ì•˜ì–´ìš”"
                            : subVal === "ê³ ê¸°êµ¬ì´" ? "ì‚¼ê²¹ì‚´, ê°ˆë¹„, ìˆ¯ë¶ˆêµ¬ì´ ë“± ê³ ê¸° ì¢‹ì•„í•˜ëŠ” ë‚ ì— ë”±!"
                                : subVal === "ìƒì„ " ? "êµ¬ì´ Â· ì¡°ë¦¼ Â· íšŒ ë“± ë‹¤ì–‘í•œ ìƒì„  ìš”ë¦¬"
                                    : subVal === "ì¡±ë°œë³´ìŒˆ" ? "ì¡±ë°œ Â· ë³´ìŒˆ Â· ìˆ˜ìœ¡ê¹Œì§€ í‘¸ì§í•˜ê²Œ"
                                        : subVal === "êµ­ë°¥" ? "ëœ¨ëˆí•œ êµ­ë°¥ í•œ ê·¸ë¦‡ìœ¼ë¡œ ë“ ë“ í•˜ê²Œ"
                                            : subVal === "ë°˜ì°¬" ? "ì§‘ë°¥ ëŠë‚Œ ë‚˜ëŠ” ë°˜ì°¬/ë„ì‹œë½ ê°€ê²Œ ëª¨ìŒ"
                                                : subVal === "ê¸°íƒ€í•œì‹" ? "í•œì‹ ë¶„ë¥˜ì— ë“¤ì–´ê°€ì§€ ì•ŠëŠ” ë‹¤ì–‘í•œ ë©”ë‰´ ëª¨ìŒ"
                                                    : "ìš°ë¦¬ë™ë„¤ í•œì‹ ë§›ì§‘ë“¤ì„ ëª¨ì•˜ìŠµë‹ˆë‹¤.",
                image: "/uploads/sample-banner-product.png"
            };
        }

        function setBeautyHero(subVal) {
            const titleBase = "ë¯¸ìš©/ì´ë°œ";
            const subLabel = subVal ? ` Â· ${subVal}` : "";
            DATA.hero = {
                title: `${titleBase}${subLabel}`,
                subtitle:
                    subVal === "ë¯¸ìš©" ? "í—¤ì–´/ë¯¸ìš© ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ê°€ê²Œë¥¼ ëª¨ì•˜ì–´ìš”."
                        : subVal === "ì´ë°œ" ? "ì´ë°œ/ë°”ë²„ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ê°€ê²Œë¥¼ ëª¨ì•˜ì–´ìš”."
                            : subVal === "ê¸°íƒ€" ? "ë¯¸ìš©/ì´ë°œ ë¶„ë¥˜ê°€ ë¹„ì–´ìˆëŠ” ê°€ê²Œë¥¼ ëª¨ì•˜ì–´ìš”."
                                : "ë¯¸ìš©/ì´ë°œ ì¹´í…Œê³ ë¦¬ ê°€ê²Œë¥¼ í™•ì¸í•˜ì„¸ìš”.",
                image: "/uploads/sample-banner-product.png"
            };
        }

        async function fetchJson(url) {
            const res = await fetch(url);
            return await res.json();
        }

        // âœ… ë¯¸ìš©/ì´ë°œ êµ¬ë¶„: business_subcategory ì§ì ‘ ë§¤í•‘
        function getBeautyType(store) {
            const sub = (store.business_subcategory ?? "").toString().trim();
            if (sub === "ì´ë°œì†Œ") return "ì´ë°œ";
            if (sub === "ë¯¸ìš©ì‹¤") return "ë¯¸ìš©";
            return "ê¸°íƒ€";
        }

        // âœ… íŠ¹ì • ì¹´í…Œê³ ë¦¬ì— ì†í•˜ëŠ”ì§€(business_category ê¸°ì¤€)
        function isInCategory(store, targetCategory) {
            const cat = (store.business_category ?? store.category ?? "").toString().trim();
            return cat === targetCategory;
        }

        function getStoreDisplayName(store) {
            return (store.name ?? store.business_name ?? store.businessName ?? store.title ?? "-").toString().trim() || "-";
        }

        function getStoreDisplayCategory(store) {
            return (store.business_category ?? store.category ?? store.businessCategory ?? "").toString().trim();
        }

        function getStoreImage(store) {
            const imgSrc = store.image ?? store.image_url ?? store.url ?? store.main_image_url ?? "";
            return normalizeSrc(imgSrc);
        }

        function getStoreCreatedAt(store) {
            const v = store.created_at ?? store.createdAt ?? store.created_date ?? store.createdDate ?? store.reg_date ?? store.regDate ?? null;
            if (!v) return null;
            const d = new Date(v);
            return Number.isFinite(d.getTime()) ? d : null;
        }

        function getStoreScoreForBest(store) {
            const cand = [
                store.view_count, store.views, store.like_count, store.likes,
                store.rating, store.score, store.sales, store.order_count, store.orders
            ].map(x => {
                const n = Number(x);
                return Number.isFinite(n) ? n : null;
            }).find(v => v !== null);

            return cand ?? null;
        }

        function shuffle(arr) {
            const a = arr.slice();
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        // âœ… Best Seller: "ë™ì¢…ì—…ê³„" = í˜„ì¬ ì¹´í…Œê³ ë¦¬(ALL_STORES) ì•ˆì—ì„œë§Œ ë½‘ê¸°
        function pickBestSeller(stores, limit = 8) {
            if (!stores || !stores.length) return [];
            const withScore = stores.map(s => ({ s, sc: getStoreScoreForBest(s) })).filter(x => x.s);
            const hasAnyScore = withScore.some(x => x.sc !== null);

            if (hasAnyScore) {
                return withScore.sort((a, b) => (b.sc ?? -1) - (a.sc ?? -1)).slice(0, limit).map(x => x.s);
            }
            return shuffle(stores).slice(0, limit);
        }

        // âœ… New registration: ìµœê·¼ 30ì¼ ìš°ì„ , ì—†ìœ¼ë©´ ëœë¤
        function pickNewRegistration(stores, limit = 8) {
            if (!stores || !stores.length) return [];
            const now = new Date();
            const cutoff = new Date(now.getTime() - (30 * 24 * 60 * 60 * 1000));

            const recent = stores
                .map(s => ({ s, d: getStoreCreatedAt(s) }))
                .filter(x => x.d && x.d >= cutoff)
                .sort((a, b) => b.d - a.d)
                .map(x => x.s);

            if (recent.length) {
                const picked = recent.slice(0, limit);
                if (picked.length < limit) {
                    const rest = stores.filter(s => !picked.includes(s));
                    return picked.concat(shuffle(rest).slice(0, limit - picked.length));
                }
                return picked;
            }
            return shuffle(stores).slice(0, limit);
        }

        async function loadData() {
            try {
                DATA = { ...DEFAULT_DATA };
                ALL_STORES = [];
                CURRENT_PAGE = 1;

                if (TYPE === "food") {
                    const q = new URLSearchParams();
                    q.set("category", CATEGORY);
                    const json = await fetchJson(`/api/subcategory/food?${q.toString()}`);
                    ALL_STORES = json.stores || [];

                    if (CATEGORY === "í•œì‹") {
                        DATA.filters = HANSIK_SUBS.slice();
                        setHansikHero(CURRENT_SUB);
                    } else {
                        DATA.filters = [];
                        DATA.hero = {
                            title: CATEGORY || "ì¹´í…Œê³ ë¦¬",
                            subtitle: "ì¹´í…Œê³ ë¦¬ë³„ ê°€ê²Œë¥¼ í™•ì¸í•˜ì„¸ìš”.",
                            image: "/uploads/sample-banner-product.png"
                        };
                    }

                    applySubFilter(CURRENT_SUB, false);

                } else if (TYPE === "beauty" || TYPE === "combined") {
                    const json = await fetchJson(`/api/subcategory/beauty?category=${encodeURIComponent(CATEGORY)}`);
                    let stores = json.stores || [];
                    stores = stores.filter(s => isInCategory(s, CATEGORY));
                    ALL_STORES = stores;

                    if (CATEGORY === "ë¯¸ìš©/ì´ë°œ") {
                        DATA.filters = BEAUTY_SUBS.slice();
                        setBeautyHero(CURRENT_SUB);
                        applySubFilter(CURRENT_SUB, false);
                    } else {
                        DATA.filters = [];
                        DATA.stores = ALL_STORES.slice();
                        DATA.hero = {
                            title: CATEGORY || "ì¹´í…Œê³ ë¦¬",
                            subtitle: "ì¹´í…Œê³ ë¦¬ë³„ ê°€ê²Œë¥¼ í™•ì¸í•˜ì„¸ìš”.",
                            image: "/uploads/sample-banner-product.png"
                        };
                    }

                } else {
                    ALL_STORES = [];
                    DATA = { ...DEFAULT_DATA };
                }

                DATA.best = pickBestSeller(ALL_STORES, 8);
                DATA.new = pickNewRegistration(ALL_STORES, 8);

            } catch (e) {
                console.error("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", e);
                ALL_STORES = [];
                DATA = { ...DEFAULT_DATA };
                CURRENT_PAGE = 1;
            }

            init();
        }

        function applySubFilter(subVal, updateHistory = true) {
            const sub = (subVal || "").trim();
            CURRENT_SUB = sub;

            // âœ… í•„í„° ë³€ê²½ ì‹œ í˜ì´ì§€ëŠ” 1í˜ì´ì§€ë¡œ
            CURRENT_PAGE = 1;

            // âœ… í•œì‹ì€ detail_categoryë¡œ ë¶„ë¦¬
            if (TYPE === "food" && CATEGORY === "í•œì‹") {
                if (!sub) {
                    DATA.stores = ALL_STORES.slice();
                    setHansikHero("");
                    if (updateHistory) {
                        const q = new URLSearchParams(location.search);
                        q.delete("sub");
                        history.replaceState(null, "", `${location.pathname}?${q.toString()}`);
                    }
                    return;
                }

                const filtered = ALL_STORES.filter(s => getDetailCategory(s) === sub);

                // âœ… 0ê°œë©´ ìë™ All ë³µêµ¬(ë¹ˆí™”ë©´ ë°©ì§€)
                if (!filtered.length && ALL_STORES.length) {
                    CURRENT_SUB = "";
                    DATA.stores = ALL_STORES.slice();
                    setHansikHero("");
                    if (updateHistory) {
                        const q = new URLSearchParams(location.search);
                        q.delete("sub");
                        history.replaceState(null, "", `${location.pathname}?${q.toString()}`);
                    }
                    return;
                }

                DATA.stores = filtered;
                setHansikHero(sub);

                if (updateHistory) {
                    const q = new URLSearchParams(location.search);
                    q.set("sub", sub);
                    history.replaceState(null, "", `${location.pathname}?${q.toString()}`);
                }
                return;
            }

            // âœ… ë¯¸ìš©/ì´ë°œì€ business_subcategory ê¸°ë°˜ ë¶„ë¦¬
            if ((TYPE === "beauty" || TYPE === "combined") && CATEGORY === "ë¯¸ìš©/ì´ë°œ") {
                if (!sub) {
                    DATA.stores = ALL_STORES.slice();
                    setBeautyHero("");
                    if (updateHistory) {
                        const q = new URLSearchParams(location.search);
                        q.delete("sub");
                        history.replaceState(null, "", `${location.pathname}?${q.toString()}`);
                    }
                    return;
                }

                const filtered = ALL_STORES.filter(s => getBeautyType(s) === sub);

                if (!filtered.length && ALL_STORES.length) {
                    CURRENT_SUB = "";
                    DATA.stores = ALL_STORES.slice();
                    setBeautyHero("");
                    if (updateHistory) {
                        const q = new URLSearchParams(location.search);
                        q.delete("sub");
                        q.set("category", "ë¯¸ìš©/ì´ë°œ");
                        history.replaceState(null, "", `${location.pathname}?${q.toString()}`);
                    }
                    return;
                }

                DATA.stores = filtered;
                setBeautyHero(sub);

                if (updateHistory) {
                    const q = new URLSearchParams(location.search);
                    q.set("sub", sub);
                    q.set("category", "ë¯¸ìš©/ì´ë°œ");
                    history.replaceState(null, "", `${location.pathname}?${q.toString()}`);
                }
                return;
            }

            DATA.stores = ALL_STORES.slice();
        }

        function goDetail(store) {
            const bt = (store.business_type ?? store.businessType ?? "").toString().trim();
            const type = (bt === "ìŒì‹ì " || bt === "ìŒì‹") ? "food" : "combined";

            const id = store.id ?? store.store_id ?? store.storeId ?? "";
            if (!id) return;

            window.location.href = `/ndetail.html?id=${encodeURIComponent(id)}&type=${encodeURIComponent(type)}`;
        }

        function makeStoreCard(store) {
            const card = document.createElement("div");
            card.className = "rounded-2xl cursor-pointer hover:shadow-lg transition overflow-hidden flex flex-col bg-white";

            const dispName = getStoreDisplayName(store);
            const dispCategory = getStoreDisplayCategory(store);
            const imgNorm = getStoreImage(store);

            card.innerHTML = `
        <div class="relative h-[260px]">
          <img src="${imgNorm}" alt="${escapeHtml(dispName)}" class="w-full h-full object-cover rounded-t-2xl">
          <div class="absolute left-0 right-0 bottom-0 bg-white/90 backdrop-blur px-4 py-2 text-center rounded-b-2xl">
            <div class="font-bold text-lg text-gray-800 leading-tight truncate">${escapeHtml(dispName)}</div>
            <div class="text-sm text-gray-600">${escapeHtml(dispCategory)}</div>
          </div>
        </div>
      `;

            card.addEventListener("click", () => goDetail(store));
            return card;
        }

        function getTotalPages() {
            const len = (DATA.stores || []).length;
            return Math.max(1, Math.ceil(len / ITEMS_PER_PAGE));
        }

        function clampPage(p) {
            const total = getTotalPages();
            if (p < 1) return 1;
            if (p > total) return total;
            return p;
        }

        function setPage(page) {
            CURRENT_PAGE = clampPage(page);
            renderPagedAdStores(DATA.stores || []);
            renderPagination();
            // ìŠ¤í¬ë¡¤ì„ items ì˜ì—­ìœ¼ë¡œ ì‚´ì§ ëŒì–´ì£¼ê¸°(ì„ íƒ)
            document.getElementById("aboutSection").scrollIntoView({ behavior: "smooth", block: "start" });
        }

        function renderPagedAdStores(stores) {
            const grid = document.getElementById("lineGrid");
            grid.innerHTML = "";

            if (!stores || !stores.length) {
                grid.innerHTML = `
          <div class="col-span-full flex justify-center items-center py-16">
            <div class="p-8 text-center max-w-md">
              <h3 class="text-lg font-semibold text-gray-700 mb-2">ë“±ë¡ëœ ê°€ê²Œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
              <p class="text-sm text-gray-500">ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ìƒˆë¡œìš´ ê°€ê²Œê°€ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
            </div>
          </div>`;
                return;
            }

            const totalPages = getTotalPages();
            CURRENT_PAGE = clampPage(CURRENT_PAGE);

            const start = (CURRENT_PAGE - 1) * ITEMS_PER_PAGE;
            const end = start + ITEMS_PER_PAGE;
            const pageItems = stores.slice(start, end);

            const wrapper = document.createElement("div");
            wrapper.className = "col-span-full grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6";

            pageItems.forEach(store => wrapper.appendChild(makeStoreCard(store)));
            grid.appendChild(wrapper);

            // í˜ì´ì§€ ì •ë³´
            const pageInfo = document.getElementById("pageInfo");
            const totalCount = stores.length;
            const from = start + 1;
            const to = Math.min(end, totalCount);
            pageInfo.textContent = `${from} - ${to} / ${totalCount}ê°œ Â· ${CURRENT_PAGE} / ${totalPages} í˜ì´ì§€`;
        }

        function renderPagination() {
            const totalPages = getTotalPages();

            const btnPrev = document.getElementById("btnPrevPage");
            const btnNext = document.getElementById("btnNextPage");
            const nums = document.getElementById("pageNumbers");

            btnPrev.disabled = (CURRENT_PAGE <= 1);
            btnNext.disabled = (CURRENT_PAGE >= totalPages);

            btnPrev.className = btnPrev.disabled
                ? "px-3 py-2 rounded-lg bg-gray-100 text-gray-300 font-semibold cursor-not-allowed"
                : "px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold transition";

            btnNext.className = btnNext.disabled
                ? "px-3 py-2 rounded-lg bg-gray-100 text-gray-300 font-semibold cursor-not-allowed"
                : "px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold transition";

            btnPrev.onclick = () => setPage(CURRENT_PAGE - 1);
            btnNext.onclick = () => setPage(CURRENT_PAGE + 1);

            // í˜ì´ì§€ ë²ˆí˜¸ëŠ” ë„ˆë¬´ ê¸¸ë©´ ì¤„ì—¬ì„œ ë³´ì—¬ì¤Œ (í˜„ì¬ ê¸°ì¤€ Â±2, ì–‘ë í‘œì‹œ)
            nums.innerHTML = "";

            const makeNumBtn = (p, label) => {
                const b = document.createElement("button");
                const isActive = (p === CURRENT_PAGE);
                b.type = "button";
                b.textContent = label ?? String(p);
                b.className = isActive
                    ? "min-w-[40px] px-3 py-2 rounded-lg bg-black text-white font-bold"
                    : "min-w-[40px] px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold transition";
                b.onclick = () => setPage(p);
                return b;
            };

            const addDots = () => {
                const d = document.createElement("span");
                d.className = "px-2 text-gray-400 font-bold";
                d.textContent = "â€¦";
                nums.appendChild(d);
            };

            if (totalPages <= 7) {
                for (let p = 1; p <= totalPages; p++) nums.appendChild(makeNumBtn(p));
                return;
            }

            // 1
            nums.appendChild(makeNumBtn(1));

            const left = Math.max(2, CURRENT_PAGE - 2);
            const right = Math.min(totalPages - 1, CURRENT_PAGE + 2);

            if (left > 2) addDots();

            for (let p = left; p <= right; p++) nums.appendChild(makeNumBtn(p));

            if (right < totalPages - 1) addDots();

            // last
            nums.appendChild(makeNumBtn(totalPages));
        }

        function renderSmallGrid(gridId, items) {
            const grid = document.getElementById(gridId);
            grid.innerHTML = "";

            if (!items || !items.length) {
                grid.innerHTML = `<div class="col-span-full text-center text-gray-500">ë“±ë¡ëœ ê°€ê²Œê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                return;
            }

            items.forEach(item => {
                const name = getStoreDisplayName(item);
                const img = getStoreImage(item);

                const card = document.createElement("div");
                card.className = "block rounded-2xl overflow-hidden bg-white hover:shadow-lg transition cursor-pointer";
                card.innerHTML = `
          <div class="h-40">
            <img src="${img}" alt="${escapeHtml(name)}" class="w-full h-full object-cover">
          </div>
          <div class="p-3 text-sm font-semibold truncate">${escapeHtml(name)}</div>
        `;
                card.addEventListener("click", () => goDetail(item));
                grid.appendChild(card);
            });
        }

        function bindHero() {
            document.getElementById("heroTitle").innerHTML = (DATA.hero?.title || "").replace(/\n/g, "<br>");
            document.getElementById("heroSubtitle").textContent = DATA.hero?.subtitle || "";
            document.getElementById("heroImage").src = DATA.hero?.image || "/uploads/sample-banner-product.png";
        }

        function makeFilterBtn(label, tagVal) {
            const btn = document.createElement("button");
            btn.type = "button";

            const isActive = (CURRENT_SUB || "") === (tagVal || "");
            btn.className = isActive
                ? "px-3 py-1.5 rounded-full bg-black text-white text-sm"
                : "px-3 py-1.5 rounded-full bg-gray-200 hover:bg-gray-300 text-sm";

            btn.textContent = label;

            btn.onclick = () => {
                applySubFilter(tagVal || "", true);
                bindHero();
                renderFilters();
                renderPagedAdStores(DATA.stores || []);
                renderPagination();
            };
            return btn;
        }

        function renderFilters() {
            const wrap = document.getElementById("filterContainer");
            wrap.innerHTML = "";

            if (TYPE === "food" && CATEGORY === "í•œì‹") {
                wrap.appendChild(makeFilterBtn("All", ""));
                HANSIK_SUBS.forEach(tag => wrap.appendChild(makeFilterBtn(tag, tag)));
                return;
            }

            if ((TYPE === "beauty" || TYPE === "combined") && CATEGORY === "ë¯¸ìš©/ì´ë°œ") {
                wrap.appendChild(makeFilterBtn("All", ""));
                BEAUTY_SUBS.forEach(tag => wrap.appendChild(makeFilterBtn(tag, tag)));
                return;
            }

            // ê·¸ ì™¸ëŠ” í•„í„° ì—†ìŒ
        }

        function init() {
            bindHero();
            renderFilters();

            renderPagedAdStores(DATA.stores || []);
            renderPagination();

            renderSmallGrid("bestGrid", DATA.best || []);
            renderSmallGrid("newGrid", DATA.new || []);

            // âœ… MORE VIEW: items ì„¹ì…˜ìœ¼ë¡œ ì´ë™
            document.getElementById("btnMore").onclick = () => {
                document.getElementById("aboutSection").scrollIntoView({ behavior: "smooth", block: "start" });
            };

            // âœ… ë”ë³´ê¸° ë²„íŠ¼ = ë‹¤ìŒ í˜ì´ì§€
            document.getElementById("btnMoreItems").onclick = () => {
                const totalPages = getTotalPages();
                if (CURRENT_PAGE < totalPages) setPage(CURRENT_PAGE + 1);
                else setPage(1); // ë§ˆì§€ë§‰ì´ë©´ 1í˜ì´ì§€ë¡œ ìˆœí™˜(ì›ì¹˜ ì•Šìœ¼ë©´ ì´ ì¤„ ì‚­ì œ)
            };
        }

        document.addEventListener("DOMContentLoaded", loadData);

        function goBack() {
            if (document.referrer && document.referrer !== location.href) window.history.back();
            else window.location.href = "/category.html";
        }
        function goNext() { window.history.forward(); }
    </script>
</body>

</html>