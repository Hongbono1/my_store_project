<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ë¦¬ ê°€ê²Œ ìë‘ ë“±ë¡ | MALL HANKOOK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Pretendard, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .neo-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(20px);
        }

        .form-input {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            padding: 12px 16px;
            transition: all 0.3s ease;
            font-size: 15px;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 16px;
            padding: 14px 28px;
            color: white;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #667eea;
            border-radius: 16px;
            padding: 12px 24px;
            color: #667eea;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
            transform: translateY(-1px);
        }

        .label-style {
            font-weight: 600;
            color: #4a5568;
            font-size: 14px;
            margin-bottom: 8px;
            display: block;
        }

        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .qa-card {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 16px;
            border: 1px solid rgba(102, 126, 234, 0.1);
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .qa-card:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input-custom {
            background: rgba(102, 126, 234, 0.05);
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-input-custom:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #764ba2;
        }
    </style>
</head>

<body>
    <!-- í—¤ë” ë¡œë“œ ì˜ì—­ -->
    <div id="header-placeholder"></div>

    <div class="min-h-screen py-12 px-4">
        <!-- ë©”ì¸ ì œëª© -->
        <div class="max-w-4xl mx-auto mb-8 mt-20">
            <div class="text-center">
                <h1 class="text-4xl md:text-5xl font-bold text-white mb-4" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
                    âœ¨ ìš°ë¦¬ ê°€ê²Œ ìë‘í•˜ê¸°
                </h1>
                <p class="text-white/90 text-lg font-medium" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">
                    ë‹¹ì‹ ì˜ íŠ¹ë³„í•œ ê°€ê²Œë¥¼ ì„¸ìƒì— ì•Œë ¤ì£¼ì„¸ìš”!
                </p>
                <p class="mt-3 text-[12px] text-white/70">
                    STOREPRIDE REGISTER VERSION: 2025-12-12-v3
                </p>
            </div>
        </div>

        <div class="max-w-4xl mx-auto neo-card p-8 md:p-12">
            <form id="storePrideRegister" enctype="multipart/form-data" class="space-y-10">

                <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold gradient-text flex items-center gap-2">
                        ğŸª ê¸°ë³¸ ì •ë³´
                    </h2>

                    <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                        <div class="space-y-2">
                            <label class="label-style">ê°€ê²Œëª… <span class="text-red-500">*</span></label>
                            <input name="store_name" required class="form-input w-full" placeholder="ì˜ˆ) í™ë³´ë…¸ì˜ ë§›ìˆëŠ” ì§‘">
                        </div>
                        <div class="space-y-2">
                            <label class="label-style">ì—…ì¢…(ì¹´í…Œê³ ë¦¬) <span class="text-red-500">*</span></label>
                            <input name="category" required class="form-input w-full" placeholder="ì˜ˆ) í•œì‹, ì¹´í˜, ë² ì´ì»¤ë¦¬ ë“±">
                        </div>
                        <div class="space-y-2">
                            <label class="label-style">ì „í™”ë²ˆí˜¸</label>
                            <input name="phone" class="form-input w-full" placeholder="ì˜ˆ) 02-1234-5678">
                        </div>
                        <div class="space-y-2 md:col-span-2">
                            <label class="label-style">ì£¼ì†Œ <span class="text-red-500">*</span></label>
                            <input name="address" required class="form-input w-full" placeholder="ìƒì„¸í•œ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
                        </div>
                    </div>

                    <!-- ëŒ€í‘œ ì‚¬ì§„ ì—…ë¡œë“œ -->
                    <div class="space-y-2">
                        <label class="label-style">ëŒ€í‘œ ì‚¬ì§„ <span class="text-red-500">*</span></label>
                        <div class="file-input-wrapper">
                            <label for="main_img" class="file-input-custom block cursor-pointer">
                                <div class="space-y-2">
                                    <div class="text-4xl">ğŸ“¸</div>
                                    <div class="font-semibold text-gray-700">í´ë¦­í•˜ì—¬ ëŒ€í‘œ ì‚¬ì§„ ì—…ë¡œë“œ</div>
                                    <div class="text-sm text-gray-500">JPG, PNG íŒŒì¼ë§Œ ê°€ëŠ¥ (ìµœëŒ€ 5MB)</div>
                                </div>
                            </label>
                            <input id="main_img" name="main_img" type="file" accept="image/*" required class="hidden">
                        </div>
                        <div id="main_img_preview" class="hidden mt-4">
                            <img id="main_img_preview_img" class="w-full h-48 object-cover rounded-lg border-2 border-gray-200">
                        </div>
                    </div>
                </div>

                <!-- ììœ  í™ë³´ê¸€ ì„¹ì…˜ -->
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold gradient-text flex items-center gap-2">
                        âœï¸ ììœ  í™ë³´ê¸€
                    </h2>
                    <div class="space-y-2">
                        <label class="label-style">ìš°ë¦¬ ê°€ê²Œë§Œì˜ íŠ¹ë³„í•¨ì„ ììœ ë¡­ê²Œ ì†Œê°œí•´ë³´ì„¸ìš”!</label>
                        <textarea name="free_pr" rows="4" class="form-input w-full resize-none"
                            placeholder="ì˜ˆ) 20ë…„ ì „í†µì˜ ì†ë§›ìœ¼ë¡œ ë§Œë“  ê¹€ì¹˜ì°Œê°œì™€ ë”°ëœ»í•œ ì„œë¹„ìŠ¤ë¡œ ë§ì€ ë¶„ë“¤ê»˜ ì‚¬ë‘ë°›ê³  ìˆìŠµë‹ˆë‹¤. ë§¤ì¼ ìƒˆë²½ì— ì§ì ‘ ë“ì¸ ìœ¡ìˆ˜ì™€ ì—„ì„ ëœ ì¬ë£Œë¡œ..."></textarea>
                    </div>
                </div>

                <!-- ì§ˆë¬¸ ìœ í˜• ì„ íƒ -->
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold gradient-text flex items-center gap-2">
                        ğŸ’¬ ì§ˆë¬¸ & ë‹µë³€
                    </h2>

                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6">
                        <div class="text-center mb-6">
                            <p class="text-gray-600 mb-4">ê³ ê°ë“¤ì´ ê¶ê¸ˆí•´í•˜ëŠ” ë‚´ìš©ì„ Q&A í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”</p>
                            <div class="flex gap-4 justify-center flex-wrap">
                                <button type="button" id="showFixedQaBtn" class="btn-primary">
                                    ğŸ¯ ê³ ì •ì§ˆë¬¸ (8ê°œ)
                                </button>
                                <button type="button" id="showCustomQaBtn" class="btn-secondary">
                                    âœ¨ ììœ ì§ˆë¬¸ (ìµœëŒ€ 5ê°œ)
                                </button>
                            </div>
                        </div>
                        <div class="text-center text-gray-500 text-sm" id="qaModeGuide">
                            ì§ˆë¬¸ ìœ í˜•ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ í˜•ì‹ì˜ ì§ˆë¬¸ì§€ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤
                        </div>
                    </div>

                    <div id="qaSection"></div>
                </div>

                <!-- ì œì¶œ ë²„íŠ¼ -->
                <div class="pt-8 border-t border-gray-200">
                    <div class="text-center space-y-4">
                        <button id="submitBtn" type="submit" class="btn-primary text-xl px-12 py-4 w-full md:w-auto">
                            ğŸš€ ìš°ë¦¬ ê°€ê²Œ ìë‘ ë“±ë¡í•˜ê¸°
                        </button>
                        <p class="text-sm text-gray-500">
                            ë“±ë¡ í›„ ê²€í† ë¥¼ ê±°ì³ ê³µê°œë©ë‹ˆë‹¤ (ì˜ì—…ì¼ ê¸°ì¤€ 1-2ì¼)
                        </p>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- í‘¸í„° ë¡œë“œ ì˜ì—­ -->
    <div id="footer-placeholder"></div>

    <script>
        console.log("STOREPRIDE REGISTER VERSION CHECK: 2025-12-12-v3");

        // âœ… API URLì„ ë¬´ì¡°ê±´ ì ˆëŒ€ URLë¡œ ê³ ì • (ìƒëŒ€ê²½ë¡œ ë¬¸ì œ ì›ì²œì°¨ë‹¨)
        const STOREPRIDE_REGISTER_API = new URL("/api/storeprideregister/register", window.location.origin).toString();
        console.log("STOREPRIDE REGISTER API URL:", STOREPRIDE_REGISTER_API);

        // í—¤ë”ì™€ í‘¸í„° ë¡œë“œ í•¨ìˆ˜
        async function loadComponents() {
            try {
                const headerResponse = await fetch('/components/header.html');
                const headerHtml = await headerResponse.text();
                document.getElementById('header-placeholder').innerHTML = headerHtml;

                const footerResponse = await fetch('/components/footer.html');
                const footerHtml = await footerResponse.text();
                document.getElementById('footer-placeholder').innerHTML = footerHtml;
            } catch (error) {
                console.warn('í—¤ë”/í‘¸í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }
        document.addEventListener('DOMContentLoaded', loadComponents);

        // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥
        document.getElementById('main_img').addEventListener('change', function (e) {
            const file = e.target.files[0];
            const preview = document.getElementById('main_img_preview');
            const previewImg = document.getElementById('main_img_preview_img');

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewImg.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            } else {
                preview.classList.add('hidden');
            }
        });

        // ì§ˆë¬¸ ìƒíƒœ
        const questionList = [
            "ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë–¤ ë§ˆìŒìœ¼ë¡œ ì‹œì‘ í•˜ì‹¤ê±´ê°€ìš”?",
            "ê°€ê²Œë¥¼ ì¤€ë¹„í•  ë•Œ ê¼­ í•˜ëŠ” ì¼ì´ ìˆë‹¤ë©´?",
            "ìš°ë¦¬ ê°€ê²Œë§Œì˜ ìë‘ê±°ë¦¬ëŠ” ë­”ê°€ìš”?",
            "ì†ë‹˜ì—ê²Œ ê¼­ ë“œë¦¬ê³  ì‹¶ì€ ë§ˆìŒ, ì„œë¹„ìŠ¤ê°€ ìˆë‚˜ìš”?",
            "ìš°ë¦¬ ê°€ê²Œë§Œì˜ ìŠ¤í˜ì…œ ë©”ë‰´ê°€ ìˆë‹¤ë©´?",
            "ê°€ê²©/ë©”ë‰´ ì„ ì •ì€ ì–´ë–»ê²Œ í•˜ë‚˜ìš”?",
            "ì‚¬ì¥ë‹˜ë§Œì˜ ê²½ì˜ì² í•™/ì†Œì‹ ì´ ìˆë‹¤ë©´?",
            "ì˜¤ëŠ˜ í•˜ë£¨ ì‚¬ì¥ë‹˜ì˜ ë‹¤ì§ or í•œë§ˆë”” PR"
        ];

        const qaSection = document.getElementById('qaSection');
        const guide = document.getElementById('qaModeGuide');
        const fixedBtn = document.getElementById('showFixedQaBtn');
        const customBtn = document.getElementById('showCustomQaBtn');

        let qaMode = ""; // "fixed" or "custom" or ""
        let customQuestions = [{ question: "", answer: "" }]; // {question, answer, file}

        // ê³ ì •ì§ˆë¬¸ UI
        function makeFixedQaCards() {
            return questionList.map((q, i) => `
                <div class="qa-card">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold text-sm">
                            Q${i + 1}
                        </div>
                        <label class="label-style mb-0">ì§ˆë¬¸ ${i + 1}</label>
                    </div>
                    <input name="q${i + 1}_question" class="form-input w-full mb-4 bg-gray-50"
                           value="${q.replace(/"/g, '&quot;')}" readonly>

                    <label class="label-style">ë‹µë³€ <span class="text-red-500">*</span></label>
                    <textarea name="q${i + 1}_answer" rows="3" maxlength="200" required
                              class="form-input w-full mb-4 resize-none"
                              placeholder="ê³ ê°ë“¤ì´ ê¶ê¸ˆí•´í•  ë‚´ìš©ì— ëŒ€í•´ ì¹œê·¼í•˜ê³  ìƒì„¸í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”"></textarea>

                    <label class="label-style">ê´€ë ¨ ì‚¬ì§„ (ì„ íƒì‚¬í•­)</label>
                    <div class="file-input-wrapper">
                        <label for="q${i + 1}_image" class="file-input-custom block cursor-pointer py-3">
                            <div class="text-2xl mb-1">ğŸ“·</div>
                            <div class="text-sm font-medium">ì‚¬ì§„ ì¶”ê°€í•˜ê¸°</div>
                        </label>
                        <input id="q${i + 1}_image" name="q${i + 1}_image" type="file" accept="image/*" class="hidden">
                    </div>
                </div>
            `).join('');
        }

        // ììœ ì§ˆë¬¸ UI
        function makeCustomQaCards(list) {
            let html = '';
            for (let i = 0; i < list.length; i++) {
                let imgPreview = '';
                if (list[i].file) {
                    const url = URL.createObjectURL(list[i].file);
                    imgPreview = `<div class="mt-1 mb-2"><img src="${url}" class="w-28 h-20 object-cover rounded shadow border" /></div>`;
                }
                html += `
                    <div class="qa-card relative">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm">
                                    Q${i + 1}
                                </div>
                                <label class="label-style mb-0">ììœ ì§ˆë¬¸ ${i + 1}</label>
                            </div>
                            ${i > 0 ? `<button type="button" onclick="removeCustomQaCard(${i})"
                                class="w-8 h-8 bg-red-100 hover:bg-red-200 text-red-500 rounded-full flex items-center justify-center font-bold transition-colors">Ã—</button>` : ""}
                        </div>

                        <label class="label-style">ì§ˆë¬¸ ë‚´ìš© <span class="text-red-500">*</span></label>
                        <input
                            name="customq${i + 1}_question"
                            class="form-input w-full mb-4"
                            maxlength="50"
                            placeholder="ê³ ê°ì´ ê¶ê¸ˆí•´í•  ì§ˆë¬¸ì„ ì‘ì„±í•´ë³´ì„¸ìš”"
                            required
                            value="${(list[i].question || "").replace(/"/g, '&quot;')}"
                            oninput="handleCustomQInput(${i}, 'question', this.value)"
                        >

                        <label class="label-style">ë‹µë³€ <span class="text-red-500">*</span></label>
                        <textarea
                            name="customq${i + 1}_answer"
                            rows="3"
                            maxlength="200"
                            required
                            class="form-input w-full mb-4 resize-none"
                            placeholder="ì¹œê·¼í•˜ê³  ìƒì„¸í•œ ë‹µë³€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”"
                            oninput="handleCustomQInput(${i}, 'answer', this.value)"
                        >${list[i].answer || ''}</textarea>

                        <label class="label-style">ê´€ë ¨ ì‚¬ì§„ (ì„ íƒì‚¬í•­)</label>
                        ${imgPreview}
                        <div class="file-input-wrapper">
                            <label for="customq${i + 1}_image" class="file-input-custom block cursor-pointer py-3">
                                <div class="text-2xl mb-1">ğŸ“·</div>
                                <div class="text-sm font-medium">ì‚¬ì§„ ì¶”ê°€í•˜ê¸°</div>
                            </label>
                            <input id="customq${i + 1}_image" name="customq${i + 1}_image" type="file" accept="image/*"
                                class="hidden" onchange="handleCustomQFile(${i}, this.files[0])">
                        </div>
                    </div>
                `;
            }

            if (list.length < 5) {
                html += `
                    <div class="text-center">
                        <button type="button" id="addCustomQaBtnInner" class="btn-secondary">
                            â• ììœ ì§ˆë¬¸ ì¶”ê°€ (${list.length}/5)
                        </button>
                        <p class="text-sm text-gray-500 mt-2">ìµœëŒ€ 5ê°œê¹Œì§€ ì¶”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤</p>
                    </div>
                `;
            } else {
                html += `
                    <div class="text-center">
                        <p class="text-sm text-gray-500 bg-gray-100 rounded-lg py-3 px-4">
                            âœ… ìµœëŒ€ ì§ˆë¬¸ ê°œìˆ˜ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤ (5/5)
                        </p>
                    </div>
                `;
            }
            return html;
        }

        window.handleCustomQInput = function (idx, key, val) {
            customQuestions[idx][key] = val;
        };
        window.handleCustomQFile = function (idx, file) {
            customQuestions[idx].file = file;
            renderCustomQa();
        };
        window.removeCustomQaCard = function (idx) {
            customQuestions.splice(idx, 1);
            if (customQuestions.length === 0) customQuestions.push({ question: "", answer: "" });
            renderCustomQa();
        };

        function renderCustomQa() {
            qaSection.innerHTML = makeCustomQaCards(customQuestions);
            const addBtn = document.getElementById('addCustomQaBtnInner');
            if (addBtn) {
                addBtn.onclick = function () {
                    if (customQuestions.length >= 5) return alert('ììœ ì§ˆë¬¸ì€ ìµœëŒ€ 5ê°œê¹Œì§€ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
                    customQuestions.push({ question: "", answer: "" });
                    renderCustomQa();
                }
            }
        }

        // ë²„íŠ¼ í† ê¸€
        fixedBtn.onclick = function () {
            if (qaMode === "fixed") {
                qaMode = "";
                qaSection.innerHTML = "";
                guide.innerHTML = "ì§ˆë¬¸ ìœ í˜•ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ í˜•ì‹ì˜ ì§ˆë¬¸ì§€ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤";
                fixedBtn.classList.remove("ring-4", "ring-blue-300");
            } else {
                qaMode = "fixed";
                qaSection.innerHTML = makeFixedQaCards();
                guide.innerHTML = 'ğŸ¯ <strong>ê³ ì •ì§ˆë¬¸ ëª¨ë“œ</strong> - ë¯¸ë¦¬ ì¤€ë¹„ëœ 8ê°œ ì§ˆë¬¸ì— ë‹µë³€í•´ì£¼ì„¸ìš”';
                fixedBtn.classList.add("ring-4", "ring-blue-300");
                customBtn.classList.remove("ring-4", "ring-green-300");
            }
        }
        customBtn.onclick = function () {
            if (qaMode === "custom") {
                qaMode = "";
                qaSection.innerHTML = "";
                guide.innerHTML = "ì§ˆë¬¸ ìœ í˜•ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ í˜•ì‹ì˜ ì§ˆë¬¸ì§€ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤";
                customBtn.classList.remove("ring-4", "ring-green-300");
            } else {
                qaMode = "custom";
                if (customQuestions.length === 0) customQuestions = [{ question: "", answer: "" }];
                renderCustomQa();
                guide.innerHTML = 'âœ¨ <strong>ììœ ì§ˆë¬¸ ëª¨ë“œ</strong> - ê³ ê°ì´ ê¶ê¸ˆí•´í•  ë‚´ìš©ì„ ì§ì ‘ ë§Œë“¤ì–´ë³´ì„¸ìš” (ìµœëŒ€ 5ê°œ)';
                customBtn.classList.add("ring-4", "ring-green-300");
                fixedBtn.classList.remove("ring-4", "ring-blue-300");
            }
        }

        // í¼ ì œì¶œ
        document.getElementById('storePrideRegister').addEventListener('submit', async function (e) {
            e.preventDefault(); // âœ… ê°€ì¥ ë¨¼ì € ë§‰ê¸°

            if (!qaMode) {
                alert("ê³ ì •ì§ˆë¬¸/ììœ ì§ˆë¬¸ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”!");
                return;
            }

            const submitBtn = document.getElementById("submitBtn");
            submitBtn.disabled = true;
            submitBtn.style.opacity = "0.75";
            submitBtn.style.cursor = "not-allowed";

            const formData = new FormData(this);
            formData.set("qa_mode", qaMode); // âœ… DOMì— hidden input ì¶”ê°€í•˜ì§€ ë§ê³  FormDataì— ì§ì ‘

            // ììœ ì§ˆë¬¸ íŒŒì¼ë“¤ ì‚½ì…
            if (qaMode === "custom") {
                customQuestions.forEach((q, i) => {
                    if (q.file) formData.set(`customq${i + 1}_image`, q.file);
                });
            }

            try {
                const res = await fetch(STOREPRIDE_REGISTER_API, {
                    method: 'POST',
                    body: formData,
                    credentials: 'same-origin'
                });

                const contentType = res.headers.get("content-type") || "";
                const rawText = await res.text().catch(() => "");

                if (!res.ok) {
                    alert(`âŒ ë“±ë¡ ìš”ì²­ ì‹¤íŒ¨ (HTTP ${res.status})\n\nìš”ì²­URL: ${STOREPRIDE_REGISTER_API}\n\n${rawText}`);
                    return;
                }

                let data = null;
                if (contentType.includes("application/json")) {
                    data = JSON.parse(rawText || "{}");
                } else {
                    // JSONì´ ì•„ë‹ˆë©´ ê·¸ëŒ€ë¡œ ë³´ì—¬ì£¼ê¸°
                    alert(`âŒ ì‘ë‹µì´ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\n\nìš”ì²­URL: ${STOREPRIDE_REGISTER_API}\n\n${rawText}`);
                    return;
                }

                if (data && data.success && data.pride_id) {
                    location.href = `/storepridedetail.html?id=${data.pride_id}`;
                } else {
                    alert('âŒ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n' + (data?.error || 'ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'));
                }

            } catch (err) {
                alert(
                    `ğŸ”Œ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜(ìš”ì²­ì´ ëŠê¹€)\n\nìš”ì²­URL: ${STOREPRIDE_REGISTER_API}\n\n` +
                    `- ë³´í†µ "ìƒëŒ€ê²½ë¡œë¡œ ë‹¤ë¥¸ URL ìš”ì²­" ë˜ëŠ” "ì„œë²„ê°€ ì—°ê²°ì„ ëŠìŒ"ì¼ ë•Œ ë°œìƒí•©ë‹ˆë‹¤.\n` +
                    `- Network íƒ­ì—ì„œ Request URL í™•ì¸í•´ì£¼ì„¸ìš”.`
                );
            } finally {
                submitBtn.disabled = false;
                submitBtn.style.opacity = "1";
                submitBtn.style.cursor = "pointer";
            }
        });
    </script>
</body>

</html>
