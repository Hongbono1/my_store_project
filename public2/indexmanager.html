<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ë±ìŠ¤ í˜ì´ì§€ ê´‘ê³  ê´€ë¦¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .slot-preview {
            border: 2px dashed #e5e7eb;
            border-radius: 8px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f9fafb;
        }
        .slot-preview.has-image {
            border-color: #10b981;
            background: #ecfdf5;
        }
        .slot-img {
            max-width: 100%;
            max-height: 200px;
            object-fit: cover;
        }
        .slot-default {
            color: #6b7280;
            font-size: 14px;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">ì¸ë±ìŠ¤ í˜ì´ì§€ ê´‘ê³  ê´€ë¦¬</h1>

        <!-- ìŠ¬ë¡¯ ì„ íƒ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ìŠ¬ë¡¯ ì„ íƒ</h2>
            <select id="slotSelect" class="w-full p-2 border border-gray-300 rounded">
                <optgroup label="ë©”ì¸ ë°°ë„ˆ">
                    <option value="index|index_main_top">â‘  ìƒë‹¨ ë ë°°ë„ˆ</option>
                    <option value="index|index_main_visual">â‘¡ ë©”ì¸ ë¹„ì£¼ì–¼</option>
                </optgroup>
                <optgroup label="í”„ë¡œëª¨ì…˜">
                    <option value="index|index_promo_1">â‘¢ í”„ë¡œëª¨ 1</option>
                    <option value="index|index_promo_2">â‘£ í”„ë¡œëª¨ 2</option>
                    <option value="index|index_promo_3">â‘¤ í”„ë¡œëª¨ 3</option>
                </optgroup>
                <optgroup label="ê¸°ëŠ¥ ì¹´ë“œ">
                    <option value="index|index_food_delivery">â‘¨ í™ë³´ì˜ ë°°ë‹¬</option>
                    <option value="index|index_all_stores">â‘¨ ìš°ë¦¬ë™ë„¤ ëª¨ë“ ê°€ê²Œ</option>
                    <option value="index|index_hot_place">â‘¨ ê°€ì¥ HOTí•œ ìš°ë¦¬ë™ë„¤</option>
                    <option value="index|index_suggest">â‘¨ í™ë³´ì˜ ì¶”ì²œ</option>
                    <option value="index|index_open">â‘¨ ì˜¤í”ˆ ì˜ˆì •</option>
                    <option value="index|index_store_pride">â‘¨ ê°€ê²Œìë‘</option>
                    <option value="index|index_traditional">â‘¨ ì „í†µì‹œì¥</option>
                    <option value="index|index_performing">â‘¨ ê³µì—°/ì˜ˆìˆ , ì¶•ì œ</option>
                </optgroup>
                <optgroup label="ì´ë²¤íŠ¸/ê²Œì‹œíŒ">
                    <option value="index|index_event">â‘© ì´ë²¤íŠ¸</option>
                    <option value="index|index_localboard">â‘ª ì§€ì—­ ê²Œì‹œíŒ</option>
                    <option value="index|index_season">â‘« ê³„ì ˆí…Œë§ˆ</option>
                    <option value="index|index_join">â‘¬ ì‹ ê·œ íšŒì› í˜œíƒ</option>
                </optgroup>
                <optgroup label="ê³ ê°ì§€ì›">
                    <option value="index|index_support_review">â‘® ë¦¬ë·°/í›„ê¸°</option>
                    <option value="index|index_support_empty">â‘® ì¤‘ì•™ ë°•ìŠ¤</option>
                    <option value="index|index_support_inquiry">â‘® ë¬¸ì˜ê²Œì‹œíŒ</option>
                </optgroup>
                <optgroup label="Best Pick">
                    <option value="index|best_pick_1">Best Pick 1</option>
                    <option value="index|best_pick_2">Best Pick 2</option>
                    <option value="index|best_pick_3">Best Pick 3</option>
                    <option value="index|best_pick_4">Best Pick 4</option>
                    <option value="index|best_pick_5">Best Pick 5</option>
                    <option value="index|best_pick_6">Best Pick 6</option>
                    <option value="index|best_pick_7">Best Pick 7</option>
                    <option value="index|best_pick_8">Best Pick 8</option>
                    <option value="index|best_pick_9">Best Pick 9</option>
                    <option value="index|best_pick_10">Best Pick 10</option>
                </optgroup>
            </select>
        </div>

        <!-- í˜„ì¬ ìŠ¬ë¡¯ ë¯¸ë¦¬ë³´ê¸° -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">í˜„ì¬ ìŠ¬ë¡¯ ìƒíƒœ</h2>
            <div id="currentSlotPreview" class="slot-preview">
                <div class="slot-default">ìŠ¬ë¡¯ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
            </div>
            <div id="slotInfo" class="mt-4 text-sm text-gray-600"></div>
        </div>

        <!-- ì—…ë¡œë“œ í¼ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ì´ë¯¸ì§€ ì—…ë¡œë“œ</h2>
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">ì´ë¯¸ì§€ íŒŒì¼</label>
                        <input type="file" name="image" accept="image/*" required 
                               class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ë§í¬ URL (ì„ íƒ)</label>
                        <input type="url" name="linkUrl" placeholder="https://example.com" 
                               class="w-full p-2 border border-gray-300 rounded">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">ì‹œì‘ì¼ (ì„ íƒ)</label>
                        <input type="date" name="startDate" 
                               class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ì¢…ë£Œì¼ (ì„ íƒ)</label>
                        <input type="date" name="endDate" 
                               class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div class="flex items-end">
                        <label class="flex items-center">
                            <input type="checkbox" name="noEnd" class="mr-2">
                            <span class="text-sm">ë¬´ê¸°í•œ</span>
                        </label>
                    </div>
                </div>

                <input type="hidden" name="page" value="">
                <input type="hidden" name="position" value="">
                
                <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded hover:bg-blue-700 disabled:bg-gray-400">
                    ì—…ë¡œë“œ
                </button>
            </form>
        </div>

        <!-- ê°€ê²Œ ì—°ê²° í¼ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ë“±ë¡ëœ ê°€ê²Œë¡œ ì—°ê²°</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-2">ì‚¬ì—…ìë²ˆí˜¸</label>
                    <input type="text" id="bizNoInput" placeholder="123-45-67890" 
                           class="w-full p-2 border border-gray-300 rounded">
                </div>
                <div>
                    <button type="button" id="searchBizBtn" 
                            class="mt-6 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                        ê°€ê²Œ ê²€ìƒ‰
                    </button>
                </div>
            </div>
            <div id="storeSearchResults" class="mb-4"></div>
            <button type="button" id="connectStoreBtn" class="w-full bg-orange-600 text-white p-3 rounded hover:bg-orange-700 disabled:bg-gray-400" disabled>
                ì„ íƒí•œ ê°€ê²Œë¡œ ì—°ê²°
            </button>
        </div>

        <!-- í…ìŠ¤íŠ¸ ìŠ¬ë¡¯ ê´€ë¦¬ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">í…ìŠ¤íŠ¸ ìŠ¬ë¡¯ ê´€ë¦¬</h2>
            <select id="textSlotSelect" class="w-full p-2 border border-gray-300 rounded mb-4">
                <option value="">í…ìŠ¤íŠ¸ ìŠ¬ë¡¯ì„ ì„ íƒí•˜ì„¸ìš”</option>
                <option value="index|index_sub_keywords">â‘¥ ê²€ìƒ‰ì–´</option>
                <option value="index|index_sub_news">â‘¥ ìµœì‹  ì†Œì‹</option>
                <option value="index|index_sub_events">â‘¥ ì´ë²¤íŠ¸ ì •ë³´</option>
                <option value="index|index_sub_recommends">â‘¥ ì¶”ì²œ ì œí’ˆ</option>
                <option value="index|index_oneword">â‘§ ìš°ë¦¬ë™ë„¤ í•œë§ˆë””</option>
            </select>
            <textarea id="textContent" rows="4" placeholder="í…ìŠ¤íŠ¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." 
                      class="w-full p-2 border border-gray-300 rounded mb-4"></textarea>
            <button type="button" id="saveTextBtn" class="w-full bg-purple-600 text-white p-3 rounded hover:bg-purple-700">
                í…ìŠ¤íŠ¸ ì €ì¥
            </button>
        </div>

        <!-- ìŠ¬ë¡¯ ì‚­ì œ -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">ìŠ¬ë¡¯ ì‚­ì œ</h2>
            <p class="text-sm text-gray-600 mb-4">í˜„ì¬ ì„ íƒëœ ìŠ¬ë¡¯ì˜ ê´‘ê³ ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.</p>
            <button type="button" id="deleteSlotBtn" class="w-full bg-red-600 text-white p-3 rounded hover:bg-red-700 disabled:bg-gray-400" disabled>
                ìŠ¬ë¡¯ ì‚­ì œ
            </button>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentPage = '';
        let currentPosition = '';
        let selectedStore = null;

        // âœ… ì•ˆì „í•œ ì´ë¯¸ì§€ ë¡œë”© í•¨ìˆ˜ ê°œì„ 
        function safeImageLoad(img, src) {
            console.log("ğŸ–¼ï¸ ì´ë¯¸ì§€ ë¡œë“œ ì‹œë„:", src);
            
            if (!src || src.trim() === "") {
                console.log("âŒ ì´ë¯¸ì§€ URLì´ ë¹„ì–´ìˆìŒ");
                return false;
            }

            // ì ˆëŒ€ URLë¡œ ì •ê·œí™”
            let normalizedSrc = src;
            if (src.startsWith("/")) {
                normalizedSrc = window.location.origin + src;
            }

            img.onerror = function() {
                console.error("âŒ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:", normalizedSrc);
                
                // ì›ë³¸ ê²½ë¡œ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ê²½ë¡œ ì‹œë„
                if (src.startsWith("/uploads/")) {
                    const fallbackSrc = "/public2" + src;
                    console.log("ğŸ”„ ëŒ€ì²´ ê²½ë¡œ ì‹œë„:", fallbackSrc);
                    
                    img.onerror = function() {
                        console.error("âŒ ëŒ€ì²´ ê²½ë¡œë„ ì‹¤íŒ¨:", fallbackSrc);
                        img.style.display = "none";
                        const defaultEl = img.parentElement?.querySelector(".slot-default");
                        if (defaultEl) defaultEl.classList.remove("hidden");
                    };
                    img.src = fallbackSrc;
                } else {
                    img.style.display = "none";
                    const defaultEl = img.parentElement?.querySelector(".slot-default");
                    if (defaultEl) defaultEl.classList.remove("hidden");
                }
            };

            img.onload = function() {
                console.log("âœ… ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ:", normalizedSrc);
            };

            img.src = normalizedSrc;
            return true;
        }

        // âœ… ìŠ¬ë¡¯ ì´ë¯¸ì§€ í‘œì‹œ í•¨ìˆ˜ ê°œì„ 
        function displaySlotImage(container, imageUrl) {
            if (!container || !imageUrl) return;

            const img = container.querySelector(".slot-img") || container.querySelector("img");
            const defaultEl = container.querySelector(".slot-default");

            if (!img) {
                // ì´ë¯¸ì§€ ìš”ì†Œê°€ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
                const newImg = document.createElement("img");
                newImg.className = "slot-img";
                newImg.alt = "ìŠ¬ë¡¯ ì´ë¯¸ì§€";
                container.appendChild(newImg);
                
                if (safeImageLoad(newImg, imageUrl)) {
                    container.classList.add("has-image");
                    if (defaultEl) {
                        defaultEl.classList.add("hidden");
                    }
                }
                return;
            }

            console.log("ğŸ“± ìŠ¬ë¡¯ ì´ë¯¸ì§€ í‘œì‹œ:", {
                container: container.id || "unnamed",
                imageUrl: imageUrl,
                imgElement: !!img,
                defaultElement: !!defaultEl
            });

            if (safeImageLoad(img, imageUrl)) {
                img.classList.remove("hidden");
                img.style.display = "block";
                container.classList.add("has-image");
                
                if (defaultEl) {
                    defaultEl.classList.add("hidden");
                    defaultEl.style.display = "none";
                }
            }
        }

        // ìŠ¬ë¡¯ ì„ íƒ ì´ë²¤íŠ¸
        document.getElementById('slotSelect').addEventListener('change', async function() {
            const value = this.value;
            if (!value) return;

            const [page, position] = value.split('|');
            currentPage = page;
            currentPosition = position;

            // í¼ í•„ë“œ ì—…ë°ì´íŠ¸
            document.querySelector('input[name="page"]').value = page;
            document.querySelector('input[name="position"]').value = position;

            // ì‚­ì œ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('deleteSlotBtn').disabled = false;

            // í˜„ì¬ ìŠ¬ë¡¯ ìƒíƒœ ë¡œë“œ
            await loadCurrentSlot(page, position);
        });

        // í˜„ì¬ ìŠ¬ë¡¯ ìƒíƒœ ë¡œë“œ
        async function loadCurrentSlot(page, position) {
            try {
                const response = await fetch(`/manager/ad/slot?page=${encodeURIComponent(page)}&position=${encodeURIComponent(position)}`);
                const data = await response.json();
                
                const preview = document.getElementById('currentSlotPreview');
                const info = document.getElementById('slotInfo');
                
                if (data.success && data.slot) {
                    const slot = data.slot;
                    
                    // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
                    preview.innerHTML = '';
                    if (slot.image_url) {
                        displaySlotImage(preview, slot.image_url);
                    } else {
                        preview.innerHTML = '<div class="slot-default">ì´ë¯¸ì§€ ì—†ìŒ</div>';
                        preview.classList.remove("has-image");
                    }
                    
                    // ì •ë³´ í‘œì‹œ
                    info.innerHTML = `
                        <div class="grid grid-cols-2 gap-4">
                            <div><strong>ìŠ¬ë¡¯ íƒ€ì…:</strong> ${slot.slot_type || 'N/A'}</div>
                            <div><strong>ëª¨ë“œ:</strong> ${slot.slot_mode || 'N/A'}</div>
                            <div><strong>ë§í¬:</strong> ${slot.link_url ? `<a href="${slot.link_url}" target="_blank" class="text-blue-600">${slot.link_url}</a>` : 'N/A'}</div>
                            <div><strong>ìƒí˜¸ëª…:</strong> ${slot.business_name || 'N/A'}</div>
                            <div><strong>ì‹œì‘ì¼:</strong> ${slot.start_date ? new Date(slot.start_date).toLocaleDateString() : 'N/A'}</div>
                            <div><strong>ì¢…ë£Œì¼:</strong> ${slot.end_date ? new Date(slot.end_date).toLocaleDateString() : 'ë¬´ê¸°í•œ'}</div>
                        </div>
                    `;
                } else {
                    preview.innerHTML = '<div class="slot-default">ë“±ë¡ëœ ê´‘ê³  ì—†ìŒ</div>';
                    preview.classList.remove("has-image");
                    info.innerHTML = '<p class="text-gray-500">ë“±ë¡ëœ ê´‘ê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (error) {
                console.error('ìŠ¬ë¡¯ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // âœ… ì—…ë¡œë“œ ì„±ê³µ í›„ ì²˜ë¦¬ ê°œì„ 
        async function handleUploadSuccess(data, form) {
            console.log("âœ… ì—…ë¡œë“œ ì„±ê³µ:", data);
            
            if (data.ok && data.slot) {
                const { page, position, image_url } = data.slot;
                
                // í¼ ë¦¬ì…‹
                form.reset();
                
                // ì„±ê³µ ë©”ì‹œì§€
                alert("ì—…ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
                
                // âœ… ì¦‰ì‹œ ìŠ¬ë¡¯ ìƒˆë¡œê³ ì¹¨
                if (page && position) {
                    setTimeout(() => {
                        loadCurrentSlot(page, position);
                    }, 500);
                }
            }
        }

        // âœ… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì´ë²¤íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            const uploadForm = document.getElementById("uploadForm");
            if (uploadForm) {
                uploadForm.addEventListener("submit", async (e) => {
                    e.preventDefault();
                    
                    if (!currentPage || !currentPosition) {
                        alert("ë¨¼ì € ìŠ¬ë¡¯ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
                        return;
                    }
                    
                    const formData = new FormData(uploadForm);
                    const submitBtn = uploadForm.querySelector('button[type="submit"]');
                    
                    // ë””ë²„ê¹… ë¡œê·¸
                    console.log("ğŸ“¤ ì—…ë¡œë“œ í¼ ë°ì´í„°:");
                    for (let [key, value] of formData.entries()) {
                        console.log(`  ${key}:`, value instanceof File ? `File(${value.name})` : value);
                    }
                    
                    try {
                        submitBtn.disabled = true;
                        submitBtn.textContent = "ì—…ë¡œë“œ ì¤‘...";
                        
                        const response = await fetch("/manager/ad/upload", {
                            method: "POST",
                            body: formData
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok && data.ok) {
                            await handleUploadSuccess(data, uploadForm);
                        } else {
                            throw new Error(data.message || "ì—…ë¡œë“œ ì‹¤íŒ¨");
                        }
                    } catch (error) {
                        console.error("âŒ ì—…ë¡œë“œ ì˜¤ë¥˜:", error);
                        alert(error.message || "ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    } finally {
                        submitBtn.disabled = false;
                        submitBtn.textContent = "ì—…ë¡œë“œ";
                    }
                });
            }

            // ê°€ê²Œ ê²€ìƒ‰
            document.getElementById('searchBizBtn').addEventListener('click', async function() {
                const bizNo = document.getElementById('bizNoInput').value.trim();
                if (!bizNo) {
                    alert('ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                try {
                    const response = await fetch(`/manager/ad/store/search?bizNo=${encodeURIComponent(bizNo)}`);
                    const data = await response.json();

                    const resultsDiv = document.getElementById('storeSearchResults');
                    
                    if (data.ok && data.stores && data.stores.length > 0) {
                        resultsDiv.innerHTML = data.stores.map(store => `
                            <div class="border rounded p-3 mb-2 cursor-pointer hover:bg-gray-50" 
                                 onclick="selectStore('${store.id}', '${store.business_name}', '${store.business_no}')">
                                <strong>${store.business_name}</strong> (${store.business_no})
                            </div>
                        `).join('');
                    } else {
                        resultsDiv.innerHTML = '<p class="text-gray-500">ê²€ìƒ‰ëœ ê°€ê²Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                } catch (error) {
                    console.error('ê°€ê²Œ ê²€ìƒ‰ ì‹¤íŒ¨:', error);
                    alert('ê°€ê²Œ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });

            // ê°€ê²Œ ì—°ê²°
            document.getElementById('connectStoreBtn').addEventListener('click', async function() {
                if (!selectedStore || !currentPage || !currentPosition) {
                    alert('ìŠ¬ë¡¯ê³¼ ê°€ê²Œë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                try {
                    const response = await fetch('/manager/ad/store/connect', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            page: currentPage,
                            position: currentPosition,
                            bizNo: selectedStore.bizNo,
                            bizName: selectedStore.bizName
                        })
                    });

                    const data = await response.json();
                    
                    if (data.ok) {
                        alert('ê°€ê²Œê°€ ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        await loadCurrentSlot(currentPage, currentPosition);
                    } else {
                        throw new Error(data.message || 'ì—°ê²° ì‹¤íŒ¨');
                    }
                } catch (error) {
                    console.error('ê°€ê²Œ ì—°ê²° ì‹¤íŒ¨:', error);
                    alert('ê°€ê²Œ ì—°ê²° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });

            // í…ìŠ¤íŠ¸ ìŠ¬ë¡¯ ê´€ë¦¬
            document.getElementById('textSlotSelect').addEventListener('change', async function() {
                const value = this.value;
                if (!value) return;

                const [page, position] = value.split('|');
                
                try {
                    const response = await fetch(`/manager/ad/text/get?page=${encodeURIComponent(page)}&position=${encodeURIComponent(position)}`);
                    const data = await response.json();
                    
                    const textarea = document.getElementById('textContent');
                    if (data.success && data.text && data.text.content) {
                        textarea.value = data.text.content;
                    } else {
                        textarea.value = '';
                    }
                } catch (error) {
                    console.error('í…ìŠ¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                }
            });

            document.getElementById('saveTextBtn').addEventListener('click', async function() {
                const selectValue = document.getElementById('textSlotSelect').value;
                const content = document.getElementById('textContent').value.trim();
                
                if (!selectValue) {
                    alert('í…ìŠ¤íŠ¸ ìŠ¬ë¡¯ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (!content) {
                    alert('í…ìŠ¤íŠ¸ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                const [page, position] = selectValue.split('|');

                try {
                    const response = await fetch('/manager/ad/text/save', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ page, position, content })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        alert('í…ìŠ¤íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } else {
                        throw new Error(data.message || 'ì €ì¥ ì‹¤íŒ¨');
                    }
                } catch (error) {
                    console.error('í…ìŠ¤íŠ¸ ì €ì¥ ì‹¤íŒ¨:', error);
                    alert('í…ìŠ¤íŠ¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });

            // ìŠ¬ë¡¯ ì‚­ì œ
            document.getElementById('deleteSlotBtn').addEventListener('click', async function() {
                if (!currentPage || !currentPosition) return;

                if (!confirm('ì •ë§ë¡œ ì´ ìŠ¬ë¡¯ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

                try {
                    const response = await fetch(`/manager/ad/slot?page=${encodeURIComponent(currentPage)}&position=${encodeURIComponent(currentPosition)}`, {
                        method: 'DELETE'
                    });

                    const data = await response.json();
                    
                    if (data.ok) {
                        alert('ìŠ¬ë¡¯ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        await loadCurrentSlot(currentPage, currentPosition);
                    } else {
                        throw new Error(data.message || 'ì‚­ì œ ì‹¤íŒ¨');
                    }
                } catch (error) {
                    console.error('ìŠ¬ë¡¯ ì‚­ì œ ì‹¤íŒ¨:', error);
                    alert('ìŠ¬ë¡¯ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        });

        // ê°€ê²Œ ì„ íƒ í•¨ìˆ˜
        function selectStore(id, name, bizNo) {
            selectedStore = { id, bizName: name, bizNo };
            document.getElementById('connectStoreBtn').disabled = false;
            
            // ì„ íƒëœ ê°€ê²Œ í•˜ì´ë¼ì´íŠ¸
            document.querySelectorAll('#storeSearchResults > div').forEach(div => {
                div.classList.remove('bg-blue-100', 'border-blue-500');
            });
            event.target.classList.add('bg-blue-100', 'border-blue-500');
        }
    </script>
</body>
</html>