<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê´€ë¦¬ì í˜ì´ì§€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .hidden-section {
            display: none;
        }

        .active-link {
            background: linear-gradient(to right, #60a5fa, #8b5cf6);
            color: white !important;
        }

        /* ìš°ì¸¡ ë“œë¡œì–´(ì„¸ë¶€ ì •ë³´) */
        .drawer-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.35);
            display: none;
            z-index: 60;
        }

        .drawer-overlay.show {
            display: block;
        }

        .drawer {
            position: fixed;
            top: 0;
            right: 0;
            height: 100vh;
            width: min(520px, 92vw);
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border-left: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: -24px 0 60px rgba(15, 23, 42, 0.15);
            transform: translateX(110%);
            transition: transform .25s ease;
            z-index: 61;
            display: flex;
            flex-direction: column;
        }

        .drawer.show {
            transform: translateX(0);
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 font-sans">
    <div class="flex min-h-screen">

        <!-- âœ… ì‚¬ì´ë“œë°” -->
        <aside
            class="w-64 bg-white/60 backdrop-blur-xl border-r border-gray-200 shadow-[8px_8px_20px_rgba(0,0,0,0.1),-8px_-8px_20px_rgba(255,255,255,0.7)] flex flex-col">
            <div
                class="p-6 text-center font-extrabold text-2xl bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent">
                ê´€ë¦¬ì ë©”ë‰´
            </div>

            <nav id="sidebarMenu" class="flex-1 px-4 py-6 space-y-4">
                <a href="#" data-section="dashboard"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    ëŒ€ì‹œë³´ë“œ
                </a>

                <a href="#" data-section="approvals"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    ìŠ¹ì¸ Â· ê²€ìˆ˜
                </a>

                <a href="#" data-section="ads"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    ê´‘ê³  ìŠ¬ë¡¯ ê´€ë¦¬
                </a>

                <a href="#" data-section="billing"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    ê´‘ê³  ê²°ì œ Â· ì²­êµ¬
                </a>

                <a href="#" data-section="content"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    ì½˜í…ì¸  ê´€ë¦¬
                </a>

                <a href="#" data-section="users"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    ì‚¬ìš©ì Â· ê°€ê²Œ ê´€ë¦¬
                </a>

                <a href="#" data-section="cs"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    ì‹ ê³  Â· CS
                </a>

                <!-- âœ… ë“±ë¡ ë°”ë¡œê°€ê¸° (ì„¹ì…˜ ì „í™˜ X, í•˜ìœ„ ë©”ë‰´ í† ê¸€) -->
                <a href="#" data-section="register"
                    class="nav-link flex items-center justify-between px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    <span>ë“±ë¡ ë°”ë¡œê°€ê¸°</span>
                    <svg xmlns="http://www.w3.org/2000/svg"
                        class="h-4 w-4 text-gray-500 transition-transform duration-300" id="registerArrow" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </a>

                <div id="subRegisterMenu" class="submenu hidden pl-6 space-y-2">
                    <a href="#" data-target="ncombinedregister"
                        class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700 hover:bg-purple-100 hover:text-purple-700 transition">
                        ğŸª í†µí•© ê°€ê²Œ ë“±ë¡
                    </a>
                    <a href="#" data-target="openregister"
                        class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700 hover:bg-indigo-100 hover:text-indigo-700 transition">
                        ğŸ†• ì˜¤í”ˆì˜ˆì • ë“±ë¡
                    </a>
                    <a href="#" data-target="storeprideregister"
                        class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700 hover:bg-amber-100 hover:text-amber-700 transition">
                        ğŸ† ê°€ê²Œ ìë‘ ë“±ë¡
                    </a>
                    <a href="#" data-target="traditionalmarketregister"
                        class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700 hover:bg-emerald-100 hover:text-emerald-700 transition">
                        ğŸ›ï¸ ì „í†µì‹œì¥ ë“±ë¡
                    </a>
                    <a href="#" data-target="performingartregister"
                        class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700 hover:bg-yellow-100 hover:text-yellow-700 transition">
                        ğŸ­ ê³µì—°/ì˜ˆìˆ  ë“±ë¡
                    </a>
                    <a href="#" data-target="eventregister"
                        class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700 hover:bg-rose-100 hover:text-rose-700 transition">
                        ğŸ‰ ì´ë²¤íŠ¸ ë“±ë¡
                    </a>
                    <a href="#" data-target="shoppingregister"
                        class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700 hover:bg-sky-100 hover:text-sky-700 transition">
                        ğŸ›’ ì‡¼í•‘ ë“±ë¡
                    </a>
                    <a href="#" data-target="inquiryregister"
                        class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700 hover:bg-slate-100 hover:text-slate-700 transition">
                        ğŸ’¬ ë¬¸ì˜ ë“±ë¡
                    </a>
                    <a href="#" data-target="hotblogregister"
                        class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700 hover:bg-pink-100 hover:text-pink-700 transition">
                        ğŸ“° í™ë³´ ë¸”ë¡œê·¸ ë“±ë¡
                    </a>
                </div>

                <a href="#" data-section="settings"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    ì„¤ì • Â· ë¡œê·¸
                </a>
            </nav>
        </aside>

        <!-- âœ… ë©”ì¸ -->
        <main class="flex-1 p-8">
            <!-- ìƒë‹¨ í—¤ë” -->
            <header class="flex justify-between items-center mb-8">
                <div class="space-y-1">
                    <h1 class="text-3xl font-bold drop-shadow-sm">ê´€ë¦¬ì í˜ì´ì§€</h1>
                    <span id="realtime-indicator"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-gray-100 text-xs text-gray-600 font-semibold">
                        ì‹¤ì‹œê°„ ì•Œë¦¼:
                        <span id="realtime-count" class="ml-1 font-bold">ì—†ìŒ</span>
                    </span>
                </div>
                <div class="flex items-center gap-2">
                    <button id="btn-refresh"
                        class="px-4 py-2 rounded-full bg-white border border-gray-200 shadow hover:bg-gray-50 transition text-sm font-semibold">
                        ìƒˆë¡œê³ ì¹¨
                    </button>
                    <button
                        class="px-4 py-2 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow hover:opacity-90 transition text-sm font-semibold">
                        ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </header>

            <!-- ========================= -->
            <!-- ğŸ“Š ëŒ€ì‹œë³´ë“œ -->
            <!-- ========================= -->
            <section id="dashboard" class="content-section">
                <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
                    <h2 class="text-xl font-bold">ğŸ“Š ì˜¤ëŠ˜ vs ì–´ì œ</h2>
                    <div class="flex flex-wrap gap-2">
                        <button
                            class="range-btn px-3 py-1 rounded-full bg-blue-100 text-blue-700 text-sm font-semibold hover:bg-blue-200"
                            data-range="today">
                            ì˜¤ëŠ˜
                        </button>
                        <button
                            class="range-btn px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-sm font-semibold hover:bg-gray-200"
                            data-range="7d">
                            ìµœê·¼ 7ì¼
                        </button>
                        <button
                            class="range-btn px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-sm font-semibold hover:bg-gray-200"
                            data-range="30d">
                            ìµœê·¼ 30ì¼
                        </button>
                    </div>
                </div>

                <!-- âœ… ë¹„êµ ì¹´ë“œ -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-6">
                    <!-- ë…¸ì¶œ -->
                    <button type="button" data-metric="impressions"
                        class="metric-card p-6 rounded-2xl bg-white shadow text-left hover:-translate-y-1 transition">
                        <p class="text-gray-500 text-sm">ì˜¤ëŠ˜ ê´‘ê³  ë…¸ì¶œ</p>
                        <p id="m-impressions" class="text-2xl font-extrabold text-blue-600 mt-1">0</p>
                        <p id="m-impressions-delta" class="text-xs font-semibold mt-2 text-gray-600">ì–´ì œ ëŒ€ë¹„ -</p>
                    </button>

                    <!-- í´ë¦­ -->
                    <button type="button" data-metric="clicks"
                        class="metric-card p-6 rounded-2xl bg-white shadow text-left hover:-translate-y-1 transition">
                        <p class="text-gray-500 text-sm">ì˜¤ëŠ˜ ê´‘ê³  í´ë¦­</p>
                        <p id="m-clicks" class="text-2xl font-extrabold text-purple-600 mt-1">0</p>
                        <p id="m-clicks-delta" class="text-xs font-semibold mt-2 text-gray-600">ì–´ì œ ëŒ€ë¹„ -</p>
                    </button>

                    <!-- CTR -->
                    <button type="button" data-metric="ctr"
                        class="metric-card p-6 rounded-2xl bg-white shadow text-left hover:-translate-y-1 transition">
                        <p class="text-gray-500 text-sm">CTR</p>
                        <p id="m-ctr" class="text-2xl font-extrabold text-emerald-600 mt-1">0%</p>
                        <p id="m-ctr-delta" class="text-xs font-semibold mt-2 text-gray-600">ì–´ì œ ëŒ€ë¹„ -</p>
                    </button>

                    <!-- ê´‘ê³  ë§¤ì¶œ -->
                    <button type="button" data-metric="ad_revenue"
                        class="metric-card p-6 rounded-2xl bg-white shadow text-left hover:-translate-y-1 transition">
                        <p class="text-gray-500 text-sm">ì˜¤ëŠ˜ ê´‘ê³  ë§¤ì¶œ</p>
                        <p id="m-adrevenue" class="text-2xl font-extrabold text-orange-500 mt-1">â‚©0</p>
                        <p id="m-adrevenue-delta" class="text-xs font-semibold mt-2 text-gray-600">ì–´ì œ ëŒ€ë¹„ -</p>
                    </button>

                    <!-- ìŠ¹ì¸ ëŒ€ê¸° -->
                    <button type="button" data-metric="approvals"
                        class="metric-card p-6 rounded-2xl bg-white shadow text-left hover:-translate-y-1 transition">
                        <p class="text-gray-500 text-sm">ìŠ¹ì¸ ëŒ€ê¸°</p>
                        <p id="m-approvals" class="text-2xl font-extrabold text-red-500 mt-1">0</p>
                        <p id="m-approvals-delta" class="text-xs font-semibold mt-2 text-gray-600">ì–´ì œ ëŒ€ë¹„ -</p>
                    </button>
                </div>

                <!-- ğŸ”” ìš´ì˜ ì•Œë¦¼ -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">
                    <div class="p-5 rounded-2xl bg-white shadow flex flex-col gap-2">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">ğŸš¨ ì‹ ê³ /ì°¨ë‹¨ ëŒ€ê¸°</h3>
                            <span id="badge-reports"
                                class="inline-flex items-center justify-center px-3 py-1 rounded-full bg-red-50 text-red-600 text-xs font-semibold">
                                0ê±´
                            </span>
                        </div>
                        <p class="text-sm text-gray-500">
                            ì‹ ê³ ëœ ê¸€/ê°€ê²Œ/ëŒ“ê¸€ì„ ë¹ ë¥´ê²Œ í™•ì¸í•˜ê³  ë¸”ë¼ì¸ë“œ ì²˜ë¦¬í•  ìˆ˜ ìˆì–´ìš”.
                        </p>
                        <button
                            class="mt-2 self-start px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs hover:bg-blue-50"
                            onclick="jumpTo('cs')">
                            ì‹ ê³  ê´€ë¦¬ë¡œ ì´ë™
                        </button>
                    </div>

                    <div class="p-5 rounded-2xl bg-white shadow flex flex-col gap-2">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">ğŸ§¾ ê´‘ê³  ë§Œë£Œ ì„ë°•</h3>
                            <span id="badge-expiring"
                                class="inline-flex items-center justify-center px-3 py-1 rounded-full bg-yellow-50 text-yellow-700 text-xs font-semibold">
                                0ê°œ
                            </span>
                        </div>
                        <p class="text-sm text-gray-500">
                            ê¸°ê°„í˜• ê´‘ê³ ì˜ ë§Œë£Œ ì„ë°•(ì˜ˆ: 1ì¼/20ë¶„/10ë¶„ ì „) ì•Œë¦¼ ì˜ì—­.
                        </p>
                        <button
                            class="mt-2 self-start px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs hover:bg-blue-50"
                            onclick="jumpTo('ads')">
                            ê´‘ê³  ìŠ¬ë¡¯ìœ¼ë¡œ ì´ë™
                        </button>
                    </div>

                    <div class="p-5 rounded-2xl bg-white shadow flex flex-col gap-2">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">ğŸ§© ì‹ ê·œ ë“±ë¡</h3>
                            <span id="badge-new"
                                class="inline-flex items-center justify-center px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs font-semibold">
                                0ê±´
                            </span>
                        </div>
                        <p class="text-sm text-gray-500">
                            ìƒˆë¡œ ë“±ë¡ëœ ì½˜í…ì¸ /ê°€ê²Œë¥¼ ê²€ìˆ˜/ìŠ¹ì¸ìœ¼ë¡œ ì—°ê²°í•  ìˆ˜ ìˆì–´ìš”.
                        </p>
                        <button
                            class="mt-2 self-start px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs hover:bg-blue-50"
                            onclick="jumpTo('approvals')">
                            ìŠ¹ì¸ Â· ê²€ìˆ˜ë¡œ ì´ë™
                        </button>
                    </div>
                </div>

                <!-- ğŸ“ˆ ê·¸ë˜í”„ -->
                <div class="bg-white rounded-2xl shadow p-6 mb-10">
                    <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
                        <h3 class="text-lg font-bold">ğŸ“ˆ ì‹œê°„ëŒ€ë³„ ë¹„êµ (ì˜¤ëŠ˜ vs ì–´ì œ)</h3>
                        <div class="flex flex-wrap gap-2">
                            <button
                                class="kpi-btn px-3 py-1 rounded-full bg-blue-100 text-blue-700 text-sm font-semibold hover:bg-blue-200"
                                data-kpi="impressions">
                                ë…¸ì¶œ
                            </button>
                            <button
                                class="kpi-btn px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-sm font-semibold hover:bg-gray-200"
                                data-kpi="clicks">
                                í´ë¦­
                            </button>
                            <button
                                class="kpi-btn px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-sm font-semibold hover:bg-gray-200"
                                data-kpi="ad_revenue">
                                ë§¤ì¶œ
                            </button>
                        </div>
                    </div>
                    <canvas id="hourlyChart" height="110"></canvas>
                    <p class="text-xs text-gray-400 mt-3">
                        ê·¸ë˜í”„ ë§‰ëŒ€ë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ì‹œê°„ëŒ€ ì„¸ë¶€ ì •ë³´ê°€ ìš°ì¸¡ì— ì—´ë¦½ë‹ˆë‹¤.
                    </p>
                </div>

                <!-- ğŸ§· Top ê´‘ê³ /ìŠ¬ë¡¯ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-2xl shadow p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold">ğŸ† ì˜¤ëŠ˜ Top ê´‘ê³ (í´ë¦­)</h3>
                            <button class="text-xs px-3 py-1 rounded-full bg-gray-100 text-gray-700 hover:bg-blue-50"
                                onclick="openDrawer('ì˜¤ëŠ˜ Top ê´‘ê³ (í´ë¦­)', renderTopAdsHtml(window.__adminState?.top_ads || []))">
                                ì „ì²´ ë³´ê¸°
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full text-sm text-gray-700">
                                <thead>
                                    <tr class="border-b bg-gray-50">
                                        <th class="text-left py-2 px-3">ìŠ¬ë¡¯</th>
                                        <th class="text-left py-2 px-3">ê´‘ê³ ëª…</th>
                                        <th class="text-left py-2 px-3">í´ë¦­</th>
                                        <th class="text-left py-2 px-3">CTR</th>
                                    </tr>
                                </thead>
                                <tbody id="top-ads-body">
                                    <tr>
                                        <td colspan="4" class="py-6 text-center text-gray-400">ë¡œë”© ì¤‘...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold">ğŸ§¾ ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡</h3>
                            <button class="text-xs px-3 py-1 rounded-full bg-gray-100 text-gray-700 hover:bg-blue-50"
                                onclick="jumpTo('approvals')">
                                ê´€ë¦¬ë¡œ ì´ë™
                            </button>
                        </div>
                        <div class="space-y-3" id="approvals-mini">
                            <div class="p-4 rounded-xl border border-gray-100 bg-gray-50 text-sm text-gray-400">
                                ë¡œë”© ì¤‘...
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ========================= -->
            <!-- âœ… ìŠ¹ì¸ Â· ê²€ìˆ˜ -->
            <!-- ========================= -->
            <section id="approvals" class="content-section hidden-section">
                <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
                    <h2 class="text-xl font-bold">âœ… ìŠ¹ì¸ Â· ê²€ìˆ˜</h2>
                    <div class="flex flex-wrap gap-2 items-center">
                        <select id="approval-type" class="border rounded-full px-3 py-1 text-sm">
                            <option value="all">ì „ì²´</option>
                            <option value="store">ê°€ê²Œ</option>
                            <option value="content">ì½˜í…ì¸ </option>
                            <option value="ad">ê´‘ê³  ì†Œì¬</option>
                        </select>
                        <input id="approval-q" type="text" placeholder="ê²€ìƒ‰ (ìƒí˜¸/ì œëª©/ID)"
                            class="border rounded-full px-3 py-1 text-sm w-56">
                        <button id="btn-approval-refresh"
                            class="px-4 py-2 rounded-full bg-white border border-gray-200 shadow hover:bg-gray-50 transition text-sm font-semibold">
                            ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow p-6">
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-gray-700">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-2 px-3">ìœ í˜•</th>
                                    <th class="text-left py-2 px-3">ì œëª©/ìƒí˜¸</th>
                                    <th class="text-left py-2 px-3">ë“±ë¡ì</th>
                                    <th class="text-left py-2 px-3">ë“±ë¡ì¼</th>
                                    <th class="text-left py-2 px-3">ìƒíƒœ</th>
                                    <th class="text-left py-2 px-3">ì²˜ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="approval-body">
                                <tr>
                                    <td colspan="6" class="py-8 text-center text-gray-400">ë¡œë”© ì¤‘...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p class="text-xs text-gray-400 mt-4">
                        ìŠ¹ì¸/ë°˜ë ¤ëŠ” ì§€ê¸ˆì€ UIë§Œ ë™ì‘. ë‚˜ì¤‘ì— ì„œë²„ API ì—°ê²°í•˜ë©´ ì‹¤ì œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
                    </p>
                </div>
            </section>

            <!-- ========================= -->
            <!-- âœ… ê´‘ê³  ìŠ¬ë¡¯ ê´€ë¦¬ -->
            <!-- ========================= -->
            <section id="ads" class="content-section hidden-section">
                <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
                    <h2 class="text-xl font-bold">ğŸ“¢ ê´‘ê³  ìŠ¬ë¡¯ ê´€ë¦¬</h2>
                    <div class="flex flex-wrap gap-2 items-center">
                        <select id="slot-page" class="border rounded-full px-3 py-1 text-sm">
                            <option value="index">index</option>
                            <option value="hot">hot</option>
                            <option value="shopping">shopping</option>
                            <option value="performingart">performingart</option>
                            <option value="etc">etc</option>
                        </select>
                        <input id="slot-q" type="text" placeholder="ìŠ¬ë¡¯/ê°€ê²Œ/URL ê²€ìƒ‰"
                            class="border rounded-full px-3 py-1 text-sm w-56">
                        <button id="btn-slot-refresh"
                            class="px-4 py-2 rounded-full bg-white border border-gray-200 shadow hover:bg-gray-50 transition text-sm font-semibold">
                            ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <div class="p-5 rounded-2xl bg-white shadow">
                        <p class="text-gray-500 text-sm">ì „ì²´ ìŠ¬ë¡¯</p>
                        <p id="slot-total" class="text-2xl font-extrabold text-blue-600 mt-1">0</p>
                    </div>
                    <div class="p-5 rounded-2xl bg-white shadow">
                        <p class="text-gray-500 text-sm">ìš´ì˜ ì¤‘</p>
                        <p id="slot-running" class="text-2xl font-extrabold text-emerald-600 mt-1">0</p>
                    </div>
                    <div class="p-5 rounded-2xl bg-white shadow">
                        <p class="text-gray-500 text-sm">ë§Œë£Œ ì„ë°•</p>
                        <p id="slot-expiring" class="text-2xl font-extrabold text-orange-500 mt-1">0</p>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow p-6">
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-gray-700">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-2 px-3">í˜ì´ì§€</th>
                                    <th class="text-left py-2 px-3">í¬ì§€ì…˜</th>
                                    <th class="text-left py-2 px-3">íƒ€ì…/ëª¨ë“œ</th>
                                    <th class="text-left py-2 px-3">ë§í¬</th>
                                    <th class="text-left py-2 px-3">ê¸°ê°„</th>
                                    <th class="text-left py-2 px-3">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="slot-body">
                                <tr>
                                    <td colspan="6" class="py-8 text-center text-gray-400">ë¡œë”© ì¤‘...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p class="text-xs text-gray-400 mt-4">
                        ìŠ¬ë¡¯ í¸ì§‘/ì €ì¥ì€ ì¶”í›„ ë„¤ê°€ ë§Œë“  manager/ad APIë¡œ ì—°ê²°í•˜ë©´ ë¨.
                    </p>
                </div>
            </section>

            <!-- ========================= -->
            <!-- âœ… ê´‘ê³  ê²°ì œ Â· ì²­êµ¬ -->
            <!-- ========================= -->
            <section id="billing" class="content-section hidden-section">
                <h2 class="text-xl font-bold mb-6">ğŸ’³ ê´‘ê³  ê²°ì œ Â· ì²­êµ¬</h2>
                <div class="bg-white rounded-2xl shadow p-6 space-y-4 text-sm">
                    <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
                        <p class="font-semibold text-gray-800 mb-1">í˜„ì¬ ìƒíƒœ</p>
                        <p class="text-gray-600">
                            ê´‘ê³ ë§Œ ì œê³µí•˜ëŠ” êµ¬ì¡°ë¼ë©´, ê²°ì œ/ì²­êµ¬ëŠ” â€œê´‘ê³  ê³„ì•½/ê¸°ê°„/ê¸ˆì•¡/ì˜ìˆ˜ì¦â€ ìœ„ì£¼ë¡œ ë‹¨ìˆœí•˜ê²Œ ê°€ì ¸ê°€ë©´ ë¼.
                        </p>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-gray-700">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-2 px-3">ê²°ì œID</th>
                                    <th class="text-left py-2 px-3">ê´‘ê³ ì£¼</th>
                                    <th class="text-left py-2 px-3">ìŠ¬ë¡¯</th>
                                    <th class="text-left py-2 px-3">ê¸ˆì•¡</th>
                                    <th class="text-left py-2 px-3">ìƒíƒœ</th>
                                    <th class="text-left py-2 px-3">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="billing-body">
                                <tr>
                                    <td colspan="6" class="py-8 text-center text-gray-400">ë¡œë”© ì¤‘...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ========================= -->
            <!-- âœ… ì½˜í…ì¸  ê´€ë¦¬ -->
            <!-- ========================= -->
            <section id="content" class="content-section hidden-section">
                <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
                    <h2 class="text-xl font-bold">ğŸ—‚ï¸ ì½˜í…ì¸  ê´€ë¦¬</h2>
                    <div class="flex flex-wrap gap-2 items-center">
                        <select id="content-type" class="border rounded-full px-3 py-1 text-sm">
                            <option value="all">ì „ì²´</option>
                            <option value="hotblog">í™ë³´ ë¸”ë¡œê·¸</option>
                            <option value="storepride">ê°€ê²Œ ìë‘</option>
                            <option value="event">ì´ë²¤íŠ¸</option>
                            <option value="performingart">ê³µì—°/ì˜ˆìˆ </option>
                            <option value="localboard">ì§€ì—­ê²Œì‹œíŒ</option>
                        </select>
                        <input id="content-q" type="text" placeholder="ê²€ìƒ‰ (ì œëª©/ìƒí˜¸/ID)"
                            class="border rounded-full px-3 py-1 text-sm w-56">
                        <button id="btn-content-refresh"
                            class="px-4 py-2 rounded-full bg-white border border-gray-200 shadow hover:bg-gray-50 transition text-sm font-semibold">
                            ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow p-6">
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-gray-700">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-2 px-3">ìœ í˜•</th>
                                    <th class="text-left py-2 px-3">ì œëª©</th>
                                    <th class="text-left py-2 px-3">ì‘ì„±ì</th>
                                    <th class="text-left py-2 px-3">ì‘ì„±ì¼</th>
                                    <th class="text-left py-2 px-3">ìƒíƒœ</th>
                                    <th class="text-left py-2 px-3">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="content-body">
                                <tr>
                                    <td colspan="6" class="py-8 text-center text-gray-400">ë¡œë”© ì¤‘...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p class="text-xs text-gray-400 mt-4">
                        ë¸”ë¼ì¸ë“œ/ê³ ì •/ì¶”ì²œ/ì‚­ì œ(ë˜ëŠ” ìˆ¨ê¹€) ê°™ì€ ìš´ì˜ ê¸°ëŠ¥ ë„£ê¸° ì¢‹ì€ ì˜ì—­.
                    </p>
                </div>
            </section>

            <!-- ========================= -->
            <!-- âœ… ì‚¬ìš©ì Â· ê°€ê²Œ ê´€ë¦¬ -->
            <!-- ========================= -->
            <section id="users" class="content-section hidden-section">
                <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
                    <h2 class="text-xl font-bold">ğŸ‘¤ ì‚¬ìš©ì Â· ê°€ê²Œ ê´€ë¦¬</h2>
                    <div class="flex flex-wrap gap-2 items-center">
                        <select id="users-type" class="border rounded-full px-3 py-1 text-sm">
                            <option value="store">ê°€ê²Œ</option>
                            <option value="user">ì‚¬ìš©ì</option>
                        </select>
                        <input id="users-q" type="text" placeholder="ê²€ìƒ‰ (ìƒí˜¸/ì´ë©”ì¼/ID/ì—°ë½ì²˜)"
                            class="border rounded-full px-3 py-1 text-sm w-64">
                        <button id="btn-users-refresh"
                            class="px-4 py-2 rounded-full bg-white border border-gray-200 shadow hover:bg-gray-50 transition text-sm font-semibold">
                            ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow p-6">
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-gray-700">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-2 px-3">êµ¬ë¶„</th>
                                    <th class="text-left py-2 px-3">ì´ë¦„/ìƒí˜¸</th>
                                    <th class="text-left py-2 px-3">ì—°ë½ì²˜</th>
                                    <th class="text-left py-2 px-3">ìƒíƒœ</th>
                                    <th class="text-left py-2 px-3">ë“±ë¡ì¼</th>
                                    <th class="text-left py-2 px-3">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="users-body">
                                <tr>
                                    <td colspan="6" class="py-8 text-center text-gray-400">ë¡œë”© ì¤‘...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <p class="text-xs text-gray-400 mt-4">
                        ì°¨ë‹¨/í•´ì œ, ìƒíƒœ ë³€ê²½, ì‚¬ì—…ì ì¸ì¦ ìƒíƒœ í™•ì¸ ê°™ì€ ê±¸ ì—¬ê¸°ì—ì„œ ì²˜ë¦¬.
                    </p>
                </div>
            </section>

            <!-- ========================= -->
            <!-- âœ… ì‹ ê³  Â· CS -->
            <!-- ========================= -->
            <section id="cs" class="content-section hidden-section">
                <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
                    <h2 class="text-xl font-bold">ğŸ†˜ ì‹ ê³  Â· CS</h2>
                    <div class="flex flex-wrap gap-2 items-center">
                        <select id="report-type" class="border rounded-full px-3 py-1 text-sm">
                            <option value="all">ì „ì²´</option>
                            <option value="content">ì½˜í…ì¸  ì‹ ê³ </option>
                            <option value="store">ê°€ê²Œ ì‹ ê³ </option>
                            <option value="comment">ëŒ“ê¸€ ì‹ ê³ </option>
                        </select>
                        <input id="report-q" type="text" placeholder="ê²€ìƒ‰ (ì‚¬ìœ /ID)"
                            class="border rounded-full px-3 py-1 text-sm w-56">
                        <button id="btn-report-refresh"
                            class="px-4 py-2 rounded-full bg-white border border-gray-200 shadow hover:bg-gray-50 transition text-sm font-semibold">
                            ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow p-6">
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-gray-700">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-2 px-3">ìœ í˜•</th>
                                    <th class="text-left py-2 px-3">ëŒ€ìƒ</th>
                                    <th class="text-left py-2 px-3">ì‚¬ìœ </th>
                                    <th class="text-left py-2 px-3">ì‹ ê³ ì¼</th>
                                    <th class="text-left py-2 px-3">ìƒíƒœ</th>
                                    <th class="text-left py-2 px-3">ì²˜ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="report-body">
                                <tr>
                                    <td colspan="6" class="py-8 text-center text-gray-400">ë¡œë”© ì¤‘...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ========================= -->
            <!-- âœ… ì„¤ì • Â· ë¡œê·¸ -->
            <!-- ========================= -->
            <section id="settings" class="content-section hidden-section">
                <h2 class="text-xl font-bold mb-4">âš™ï¸ ì„¤ì • Â· ë¡œê·¸</h2>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-2xl shadow p-6 space-y-4 text-sm">
                        <h3 class="font-bold text-gray-800">ê´€ë¦¬ì ê¶Œí•œ/ì •ì±… (UI)</h3>
                        <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
                            <p class="font-semibold mb-1">ê´‘ê³  í”Œë«í¼ ìš´ì˜ ì •ì±…</p>
                            <ul class="list-disc list-inside text-gray-600 space-y-1">
                                <li>ê¸ˆì§€ ì—…ì¢…/ì†Œì¬(ë„ë°•/ì„±ì¸/ë¶ˆë²•/ì €ì‘ê¶Œ ìœ„ë°˜ ë“±) ë…¸ì¶œ ì°¨ë‹¨</li>
                                <li>ì‹ ê³  ì ‘ìˆ˜ ì‹œ ë¸”ë¼ì¸ë“œ/ê²€ìˆ˜ ì¬ì§„í–‰</li>
                                <li>ê´‘ê³  ê¸°ê°„/ìŠ¬ë¡¯/ë…¸ì¶œ ê¸°ì¤€ ë³€ê²½ ì‹œ ë¡œê·¸ ê¸°ë¡</li>
                            </ul>
                        </div>

                        <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
                            <p class="font-semibold mb-1">ì•Œë¦¼ ì„¤ì •(ì˜ˆì‹œ)</p>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" class="rounded" checked>
                                <span>ê´‘ê³  ë§Œë£Œ 1ì¼ ì „ ì•Œë¦¼</span>
                            </label>
                            <label class="flex items-center gap-2 mt-2">
                                <input type="checkbox" class="rounded">
                                <span>ê´‘ê³  ë§Œë£Œ 20ë¶„ ì „ ì•Œë¦¼</span>
                            </label>
                            <label class="flex items-center gap-2 mt-2">
                                <input type="checkbox" class="rounded">
                                <span>ê´‘ê³  ë§Œë£Œ 10ë¶„ ì „ ì•Œë¦¼</span>
                            </label>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow p-6">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-bold text-gray-800">ìš´ì˜ ë¡œê·¸(ìƒ˜í”Œ)</h3>
                            <button class="text-xs px-3 py-1 rounded-full bg-gray-100 text-gray-700 hover:bg-blue-50"
                                onclick="openDrawer('ìš´ì˜ ë¡œê·¸', document.getElementById('log-box').innerHTML)">
                                í¬ê²Œ ë³´ê¸°
                            </button>
                        </div>
                        <div id="log-box" class="text-sm text-gray-700 space-y-2">
                            <div class="p-3 rounded-xl bg-gray-50 border border-gray-100">
                                <p class="font-semibold">[ê´‘ê³ ] ìŠ¬ë¡¯ ë³€ê²½</p>
                                <p class="text-xs text-gray-500 mt-1">index / best_pick_1 Â· 2025-12-13 10:22</p>
                            </div>
                            <div class="p-3 rounded-xl bg-gray-50 border border-gray-100">
                                <p class="font-semibold">[ìŠ¹ì¸] ì½˜í…ì¸  ìŠ¹ì¸</p>
                                <p class="text-xs text-gray-500 mt-1">performingart #12 Â· 2025-12-13 09:50</p>
                            </div>
                            <div class="p-3 rounded-xl bg-gray-50 border border-gray-100">
                                <p class="font-semibold">[ì‹ ê³ ] ë¸”ë¼ì¸ë“œ ì²˜ë¦¬</p>
                                <p class="text-xs text-gray-500 mt-1">localboard #33 Â· 2025-12-13 09:10</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- âœ… ìš°ì¸¡ ë“œë¡œì–´ -->
    <div id="drawerOverlay" class="drawer-overlay" onclick="closeDrawer()"></div>
    <aside id="drawer" class="drawer" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="p-5 border-b border-gray-200 flex items-center justify-between">
            <div>
                <p class="text-xs text-gray-500 font-semibold">ì„¸ë¶€ ì •ë³´</p>
                <h3 id="drawerTitle" class="text-lg font-extrabold text-gray-900">-</h3>
            </div>
            <button class="w-10 h-10 rounded-full bg-white border border-gray-200 shadow hover:bg-gray-50"
                onclick="closeDrawer()" aria-label="ë‹«ê¸°">
                âœ•
            </button>
        </div>
        <div id="drawerBody" class="p-5 overflow-auto flex-1">
            <div class="text-sm text-gray-500">ë‚´ìš© ì—†ìŒ</div>
        </div>
        <div class="p-4 border-t border-gray-200 bg-white/70">
            <button
                class="w-full px-4 py-2 rounded-xl bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold shadow hover:opacity-90"
                onclick="closeDrawer()">
                ë‹«ê¸°
            </button>
        </div>
    </aside>

    <script>
        // ===============================
        // ğŸŒ ê³µí†µ ì„¤ì • (ì˜¤ë„ˆ í˜ì´ì§€ ë°©ì‹ ìœ ì§€)
        // ===============================
        const isLocal =
            location.hostname === "127.0.0.1" ||
            location.hostname === "localhost" ||
            location.hostname === "0.0.0.0";

        const API_BASE = isLocal ? "https://www.hongbono1.com" : "";
        const HTML_BASE = ""; // public2 ë£¨íŠ¸ ì„œë¹™ ê°€ì •

        async function fetchJson(path) {
            const url = API_BASE + path;
            const res = await fetch(url, { credentials: "include" });
            if (!res.ok) {
                const text = await res.text();
                throw new Error(`API ì‹¤íŒ¨: ${res.status} ${url} ${text}`);
            }
            return res.json();
        }

        // ===============================
        // âœ… ì „ì—­ ìƒíƒœ
        // ===============================
        window.__adminState = {
            range: "today",
            kpi: "impressions",  // impressions | clicks | ad_revenue
            today: null,
            yesterday: null,
            hourly: [],
            top_ads: [],
            approvals: [],
            reports: [],
            expiring_ads: [],
            new_items: 0,
            slots: [],
            billing: [],
            content: [],
            users: []
        };

        // ===============================
        // âœ… ìœ í‹¸
        // ===============================
        function fmtNumber(n) { return Number(n || 0).toLocaleString(); }
        function fmtMoney(n) { return "â‚©" + Number(n || 0).toLocaleString(); }
        function pct(a, b) {
            // a: today, b: yesterday
            const aa = Number(a || 0);
            const bb = Number(b || 0);
            if (bb === 0) return aa === 0 ? 0 : 100;
            return ((aa - bb) / bb) * 100;
        }
        function deltaText(today, yesterday, suffix = "") {
            const d = Number(today || 0) - Number(yesterday || 0);
            const p = pct(today, yesterday);
            const sign = d > 0 ? "â–²" : d < 0 ? "â–¼" : "â€”";
            const color = d > 0 ? "text-emerald-600" : d < 0 ? "text-red-600" : "text-gray-600";
            const abs = Math.abs(d);
            const pAbs = Math.abs(p).toFixed(1);
            return `<span class="${color}">${sign} ${fmtNumber(abs)}${suffix} (${pAbs}%)</span>`;
        }
        function safeText(v, fallback = "-") {
            const s = String(v ?? "").trim();
            return s ? s : fallback;
        }
        function nowKST() {
            // ë¸Œë¼ìš°ì €ëŠ” ë¡œì»¬ì´ KSTì¼ í™•ë¥  ë†’ì§€ë§Œ, UIìš©ìœ¼ë¡œë§Œ ì‚¬ìš©
            return new Date();
        }

        // ===============================
        // âœ… ë“œë¡œì–´(ì„¸ë¶€ ì •ë³´)
        // ===============================
        function openDrawer(title, html) {
            const overlay = document.getElementById("drawerOverlay");
            const drawer = document.getElementById("drawer");
            const t = document.getElementById("drawerTitle");
            const b = document.getElementById("drawerBody");
            if (!overlay || !drawer || !t || !b) return;

            t.textContent = title || "ì„¸ë¶€ ì •ë³´";
            b.innerHTML = html || `<div class="text-sm text-gray-500">ë‚´ìš© ì—†ìŒ</div>`;

            overlay.classList.add("show");
            drawer.classList.add("show");
            drawer.setAttribute("aria-hidden", "false");
            document.body.style.overflow = "hidden";
        }
        function closeDrawer() {
            const overlay = document.getElementById("drawerOverlay");
            const drawer = document.getElementById("drawer");
            if (!overlay || !drawer) return;
            overlay.classList.remove("show");
            drawer.classList.remove("show");
            drawer.setAttribute("aria-hidden", "true");
            document.body.style.overflow = "auto";
        }

        // ===============================
        // âœ… ì‚¬ì´ë“œë°” ì „í™˜(ì˜¤ë„ˆ í˜ì´ì§€ ë°©ì‹ ìœ ì§€)
        // ===============================
        const links = document.querySelectorAll(".nav-link");
        const sections = document.querySelectorAll(".content-section");

        function jumpTo(sectionId) {
            const link = document.querySelector(`[data-section="${sectionId}"]`);
            if (link) link.click();
        }

        links.forEach((link) => {
            link.addEventListener("click", (e) => {
                e.preventDefault();
                const section = link.dataset.section;

                if (section === "register") {
                    const submenu = document.getElementById("subRegisterMenu");
                    const arrow = document.getElementById("registerArrow");
                    if (submenu) submenu.classList.toggle("hidden");
                    if (arrow) arrow.classList.toggle("rotate-180");
                    return;
                }

                links.forEach((l) => l.classList.remove("active-link"));
                link.classList.add("active-link");

                sections.forEach((sec) => sec.classList.add("hidden-section"));
                const target = document.getElementById(section);
                if (target) target.classList.remove("hidden-section");
            });
        });

        // ê¸°ë³¸ í™œì„±
        const dashLink = document.querySelector('[data-section="dashboard"]');
        if (dashLink) dashLink.classList.add("active-link");

        // í•˜ìœ„ ë“±ë¡ ë©”ë‰´ ì´ë™
        document.querySelectorAll(".sub-link").forEach((sub) => {
            sub.addEventListener("click", (e) => {
                e.preventDefault();
                const target = sub.dataset.target;
                const map = {
                    openregister: "openregister.html",
                    storeprideregister: "storeprideregister.html",
                    traditionalmarketregister: "traditionalmarketregister.html",
                    performingartregister: "performingartregister.html",
                    eventregister: "eventregister.html",
                    shoppingregister: "shoppingregister.html",
                    inquiryregister: "inquiryregister.html",
                    foodregister: "foodregister.html",
                    ncombinedregister: "ncombinedregister.html",
                    hotblogregister: "hotblogregister.html",
                };
                if (map[target]) window.location.href = `${HTML_BASE}/${map[target]}`;
            });
        });

        // ===============================
        // âœ… ë”ë¯¸ ë°ì´í„° ìƒì„± (API ì—†ì„ ë•Œë„ í™”ë©´ ë™ì‘)
        // ===============================
        function seededRand(seed) {
            // ê°„ë‹¨í•œ LCG
            let s = seed % 2147483647;
            if (s <= 0) s += 2147483646;
            return function () {
                s = s * 16807 % 2147483647;
                return (s - 1) / 2147483646;
            };
        }

        function makeMockState() {
            const d = nowKST();
            const seed = Number(String(d.getFullYear()) + String(d.getMonth() + 1).padStart(2, "0") + String(d.getDate()).padStart(2, "0"));
            const r = seededRand(seed);

            const todayImpr = Math.floor(12000 + r() * 18000);
            const yestImpr = Math.floor(10000 + r() * 17000);

            const todayClicks = Math.floor(todayImpr * (0.012 + r() * 0.018));
            const yestClicks = Math.floor(yestImpr * (0.010 + r() * 0.018));

            const todayRev = Math.floor(150000 + r() * 450000);
            const yestRev = Math.floor(120000 + r() * 420000);

            const approvals = Math.floor(r() * 14);
            const reports = Math.floor(r() * 9);
            const expiring = Math.floor(r() * 6);
            const newItems = Math.floor(r() * 18);

            // ì‹œê°„ëŒ€ë³„ 24ê°œ
            const hourly = Array.from({ length: 24 }).map((_, h) => {
                const base = 200 + Math.floor(r() * 520);
                const t = base + Math.floor(r() * 220);
                const y = base - 40 + Math.floor(r() * 220);
                const tClicks = Math.floor(t * (0.010 + r() * 0.020));
                const yClicks = Math.floor(y * (0.010 + r() * 0.020));
                const tRev = Math.floor(3000 + r() * 18000);
                const yRev = Math.floor(2500 + r() * 16000);
                return {
                    hour: h,
                    impressions_today: t,
                    impressions_yesterday: y,
                    clicks_today: tClicks,
                    clicks_yesterday: yClicks,
                    revenue_today: tRev,
                    revenue_yesterday: yRev,
                };
            });

            const top_ads = Array.from({ length: 8 }).map((_, i) => {
                const clicks = 60 + Math.floor(r() * 260);
                const imp = 1200 + Math.floor(r() * 6200);
                const ctr = imp ? (clicks / imp) * 100 : 0;
                return {
                    slot: ["index:best_pick_1", "index:best_pick_2", "index:promo_1", "hot:theme_1", "index:event"][i % 5],
                    title: `ê´‘ê³  #${i + 1}`,
                    clicks,
                    impressions: imp,
                    ctr: Number(ctr.toFixed(2)),
                };
            }).sort((a, b) => b.clicks - a.clicks);

            const approvalsList = Array.from({ length: Math.min(approvals, 10) }).map((_, i) => ({
                type: ["ê°€ê²Œ", "ì½˜í…ì¸ ", "ê´‘ê³  ì†Œì¬"][i % 3],
                title: ["ìƒˆ ê°€ê²Œ ë“±ë¡", "ê³µì—° ë“±ë¡", "í™ë³´ ë¸”ë¡œê·¸"][i % 3] + ` #${100 + i}`,
                by: `user_${300 + i}`,
                created_at: new Date(Date.now() - (i + 1) * 3600 * 1000).toISOString(),
                status: "ëŒ€ê¸°",
                id: 1000 + i
            }));

            const reportsList = Array.from({ length: Math.min(reports, 10) }).map((_, i) => ({
                type: ["ì½˜í…ì¸ ", "ê°€ê²Œ", "ëŒ“ê¸€"][i % 3],
                target: `#${500 + i}`,
                reason: ["ìš•ì„¤", "í—ˆìœ„ì •ë³´", "ì €ì‘ê¶Œ", "ìŠ¤íŒ¸"][i % 4],
                created_at: new Date(Date.now() - (i + 2) * 7200 * 1000).toISOString(),
                status: "ëŒ€ê¸°",
                id: 900 + i
            }));

            const slots = Array.from({ length: 12 }).map((_, i) => {
                const page = ["index", "hot", "shopping"][i % 3];
                const position = ["best_pick_1", "best_pick_2", "promo_1", "event", "theme"][i % 5] + (i % 2 ? "" : "");
                const mode = ["store", "url", "text"][i % 3];
                const type = ["banner", "card", "mini"][i % 3];
                const start = new Date(Date.now() - (i + 1) * 86400000);
                const end = new Date(Date.now() + (i % 6) * 86400000);
                return {
                    page, position, slot_mode: mode, slot_type: type,
                    link_url: mode === "store" ? `/ndetail.html?id=${10 + i}&type=store` : `https://example.com/${i}`,
                    start_date: start.toISOString().slice(0, 10),
                    end_date: end.toISOString().slice(0, 10),
                    no_end: (i % 7 === 0)
                };
            });

            const billing = Array.from({ length: 8 }).map((_, i) => ({
                id: 2000 + i,
                advertiser: `ê´‘ê³ ì£¼_${i + 1}`,
                slot: slots[i]?.page + ":" + slots[i]?.position,
                amount: 50000 + i * 25000,
                status: ["ì™„ë£Œ", "ëŒ€ê¸°", "ì·¨ì†Œ"][i % 3]
            }));

            const content = Array.from({ length: 10 }).map((_, i) => ({
                type: ["í™ë³´ ë¸”ë¡œê·¸", "ê°€ê²Œ ìë‘", "ì´ë²¤íŠ¸", "ê³µì—°/ì˜ˆìˆ "][i % 4],
                title: `ì½˜í…ì¸  ì œëª© #${i + 1}`,
                by: `writer_${i + 10}`,
                created_at: new Date(Date.now() - (i + 1) * 86400000).toISOString(),
                status: ["ì •ìƒ", "ë¸”ë¼ì¸ë“œ", "ëŒ€ê¸°"][i % 3],
                id: 700 + i
            }));

            const users = Array.from({ length: 10 }).map((_, i) => ({
                kind: i % 2 ? "ê°€ê²Œ" : "ì‚¬ìš©ì",
                name: i % 2 ? `ìƒí˜¸_${i + 1}` : `user_${i + 1}`,
                phone: `010-12${i}4-56${i}8`,
                status: ["ì •ìƒ", "ì œí•œ", "ì°¨ë‹¨"][i % 3],
                created_at: new Date(Date.now() - (i + 3) * 86400000).toISOString(),
                id: 400 + i
            }));

            return {
                today: { impressions: todayImpr, clicks: todayClicks, ad_revenue: todayRev, approvals },
                yesterday: { impressions: yestImpr, clicks: yestClicks, ad_revenue: yestRev, approvals: Math.max(0, approvals - 2) },
                hourly,
                top_ads,
                approvalsList,
                reportsList,
                expiring,
                newItems,
                slots,
                billing,
                content,
                users
            };
        }

        // ===============================
        // âœ… ëŒ€ì‹œë³´ë“œ ë Œë”
        // ===============================
        function setRealtimeIndicator(count) {
            const wrap = document.getElementById("realtime-indicator");
            const cnt = document.getElementById("realtime-count");
            if (!wrap || !cnt) return;
            if (count > 0) {
                cnt.textContent = `${count}ê±´`;
                wrap.classList.remove("bg-gray-100", "text-gray-600");
                wrap.classList.add("bg-red-100", "text-red-700");
            } else {
                cnt.textContent = "ì—†ìŒ";
                wrap.classList.remove("bg-red-100", "text-red-700");
                wrap.classList.add("bg-gray-100", "text-gray-600");
            }
        }

        function renderMetricCards() {
            const s = window.__adminState;
            const t = s.today || {};
            const y = s.yesterday || {};
            const ctrT = t.impressions ? (t.clicks / t.impressions) * 100 : 0;
            const ctrY = y.impressions ? (y.clicks / y.impressions) * 100 : 0;

            document.getElementById("m-impressions").textContent = fmtNumber(t.impressions);
            document.getElementById("m-clicks").textContent = fmtNumber(t.clicks);
            document.getElementById("m-ctr").textContent = (ctrT || 0).toFixed(2) + "%";
            document.getElementById("m-adrevenue").textContent = fmtMoney(t.ad_revenue);
            document.getElementById("m-approvals").textContent = fmtNumber(t.approvals);

            document.getElementById("m-impressions-delta").innerHTML = "ì–´ì œ ëŒ€ë¹„ " + deltaText(t.impressions, y.impressions);
            document.getElementById("m-clicks-delta").innerHTML = "ì–´ì œ ëŒ€ë¹„ " + deltaText(t.clicks, y.clicks);
            document.getElementById("m-ctr-delta").innerHTML = "ì–´ì œ ëŒ€ë¹„ " + deltaText(ctrT, ctrY, "%");
            document.getElementById("m-adrevenue-delta").innerHTML = "ì–´ì œ ëŒ€ë¹„ " + deltaText(t.ad_revenue, y.ad_revenue, "ì›");
            document.getElementById("m-approvals-delta").innerHTML = "ì–´ì œ ëŒ€ë¹„ " + deltaText(t.approvals, y.approvals);

            // badges
            document.getElementById("badge-reports").textContent = fmtNumber((s.reports || []).length) + "ê±´";
            document.getElementById("badge-expiring").textContent = fmtNumber(s.expiring_ads || 0) + "ê°œ";
            document.getElementById("badge-new").textContent = fmtNumber(s.new_items || 0) + "ê±´";

            // ì‹¤ì‹œê°„ ëŠë‚Œ(ìƒ˜í”Œ)
            setRealtimeIndicator(Math.min(3, (s.reports || []).length));
        }

        function renderTopAds() {
            const tbody = document.getElementById("top-ads-body");
            const rows = (window.__adminState.top_ads || []).slice(0, 6);
            if (!tbody) return;
            if (!rows.length) {
                tbody.innerHTML = `<tr><td colspan="4" class="py-6 text-center text-gray-400">ë°ì´í„° ì—†ìŒ</td></tr>`;
                return;
            }
            tbody.innerHTML = rows.map(a => `
        <tr class="border-b hover:bg-gray-50 cursor-pointer" onclick="openDrawer('ê´‘ê³  ìƒì„¸', renderAdDetailHtml(${JSON.stringify(a).replace(/"/g, "&quot;")}))">
          <td class="py-2 px-3">${safeText(a.slot)}</td>
          <td class="py-2 px-3">${safeText(a.title)}</td>
          <td class="py-2 px-3 font-semibold">${fmtNumber(a.clicks)}</td>
          <td class="py-2 px-3">${(Number(a.ctr) || 0).toFixed(2)}%</td>
        </tr>
      `).join("");
        }

        function renderApprovalsMini() {
            const wrap = document.getElementById("approvals-mini");
            const list = (window.__adminState.approvals || []).slice(0, 4);
            if (!wrap) return;

            if (!list.length) {
                wrap.innerHTML = `<div class="p-4 rounded-xl border border-gray-100 bg-gray-50 text-sm text-gray-500">
          ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.
        </div>`;
                return;
            }

            wrap.innerHTML = list.map(a => `
        <button type="button" class="w-full text-left p-4 rounded-xl border border-gray-100 bg-white hover:bg-gray-50 transition"
          onclick="openDrawer('ìŠ¹ì¸ ìƒì„¸', renderApprovalDetailHtml(${JSON.stringify(a).replace(/"/g, "&quot;")}))">
          <div class="flex items-center justify-between gap-2">
            <div class="font-semibold text-gray-800">${safeText(a.type)} Â· ${safeText(a.title)}</div>
            <span class="text-xs px-2 py-0.5 rounded-full bg-yellow-50 text-yellow-700 font-semibold">ëŒ€ê¸°</span>
          </div>
          <div class="text-xs text-gray-500 mt-1">ë“±ë¡ì: ${safeText(a.by)} Â· ${safeText(a.created_at).slice(0, 16).replace('T', ' ')}</div>
        </button>
      `).join("");
        }

        // ===============================
        // âœ… í‘œ(ìŠ¹ì¸/ìŠ¬ë¡¯/ê²°ì œ/ì½˜í…ì¸ /ìœ ì €/ì‹ ê³ ) ë Œë”
        // ===============================
        function renderApprovalTable() {
            const tbody = document.getElementById("approval-body");
            if (!tbody) return;

            const q = (document.getElementById("approval-q")?.value || "").trim().toLowerCase();
            const type = (document.getElementById("approval-type")?.value || "all");

            let rows = window.__adminState.approvals || [];
            rows = rows.filter(r => {
                const okType = (type === "all") ? true : (type === "store" ? r.type === "ê°€ê²Œ" : type === "content" ? r.type === "ì½˜í…ì¸ " : r.type === "ê´‘ê³  ì†Œì¬");
                const blob = (r.type + " " + r.title + " " + r.by + " " + r.id).toLowerCase();
                const okQ = !q || blob.includes(q);
                return okType && okQ;
            });

            if (!rows.length) {
                tbody.innerHTML = `<tr><td colspan="6" class="py-8 text-center text-gray-400">í‘œì‹œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
                return;
            }

            tbody.innerHTML = rows.map(r => `
        <tr class="border-b hover:bg-gray-50">
          <td class="py-2 px-3">${safeText(r.type)}</td>
          <td class="py-2 px-3">
            <button class="text-blue-700 font-semibold hover:underline"
              onclick="openDrawer('ìŠ¹ì¸ ìƒì„¸', renderApprovalDetailHtml(${JSON.stringify(r).replace(/"/g, "&quot;")}))">
              ${safeText(r.title)}
            </button>
            <div class="text-xs text-gray-500">ID: ${safeText(r.id)}</div>
          </td>
          <td class="py-2 px-3">${safeText(r.by)}</td>
          <td class="py-2 px-3">${safeText(r.created_at).slice(0, 10)}</td>
          <td class="py-2 px-3">
            <span class="inline-flex px-2 py-0.5 rounded-full bg-yellow-50 text-yellow-700 text-xs font-semibold">ëŒ€ê¸°</span>
          </td>
          <td class="py-2 px-3">
            <div class="flex flex-wrap gap-1">
              <button class="px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs border border-emerald-200"
                onclick="uiApprove(${r.id})">ìŠ¹ì¸</button>
              <button class="px-3 py-1 rounded-full bg-red-50 text-red-600 text-xs border border-red-200"
                onclick="uiReject(${r.id})">ë°˜ë ¤</button>
              <button class="px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs border border-gray-200"
                onclick="openDrawer('ìŠ¹ì¸ ìƒì„¸', renderApprovalDetailHtml(${JSON.stringify(r).replace(/"/g, "&quot;")}))">ìƒì„¸</button>
            </div>
          </td>
        </tr>
      `).join("");
        }

        function renderSlotTable() {
            const tbody = document.getElementById("slot-body");
            if (!tbody) return;

            const page = (document.getElementById("slot-page")?.value || "index");
            const q = (document.getElementById("slot-q")?.value || "").trim().toLowerCase();

            let rows = (window.__adminState.slots || []).filter(s => s.page === page);
            if (q) {
                rows = rows.filter(s => (s.page + " " + s.position + " " + s.link_url + " " + s.slot_mode + " " + s.slot_type).toLowerCase().includes(q));
            }

            // ìš”ì•½ ì¹´ë“œ
            const total = rows.length;
            const running = rows.filter(s => !s.no_end).length; // UIìš©
            const expiring = rows.filter(s => !s.no_end && s.end_date).slice(0, 3).length;
            document.getElementById("slot-total").textContent = fmtNumber(total);
            document.getElementById("slot-running").textContent = fmtNumber(running);
            document.getElementById("slot-expiring").textContent = fmtNumber(expiring);

            if (!rows.length) {
                tbody.innerHTML = `<tr><td colspan="6" class="py-8 text-center text-gray-400">ìŠ¬ë¡¯ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
                return;
            }

            tbody.innerHTML = rows.map(s => `
        <tr class="border-b hover:bg-gray-50">
          <td class="py-2 px-3">${safeText(s.page)}</td>
          <td class="py-2 px-3 font-semibold">${safeText(s.position)}</td>
          <td class="py-2 px-3">
            <span class="text-xs px-2 py-0.5 rounded-full bg-gray-100 text-gray-700">${safeText(s.slot_type)}</span>
            <span class="text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-700 ml-1">${safeText(s.slot_mode)}</span>
          </td>
          <td class="py-2 px-3">
            <a class="text-blue-700 hover:underline break-all" href="${safeText(s.link_url, '#')}" target="_blank">
              ${safeText(s.link_url, '-')}
            </a>
          </td>
          <td class="py-2 px-3 text-xs text-gray-700">
            ${s.no_end ? `<span class="px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 font-semibold">ë¬´ê¸°í•œ</span>`
                    : `<div>${safeText(s.start_date)} ~ ${safeText(s.end_date)}</div>`}
          </td>
          <td class="py-2 px-3">
            <div class="flex flex-wrap gap-1">
              <button class="px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs border border-gray-200"
                onclick="openDrawer('ìŠ¬ë¡¯ ìƒì„¸', renderSlotDetailHtml(${JSON.stringify(s).replace(/"/g, "&quot;")}))">ìƒì„¸</button>
              <button class="px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs border border-blue-200"
                onclick="alert('UIë§Œ ë™ì‘: ìŠ¬ë¡¯ ìˆ˜ì •ì€ ë‚˜ì¤‘ì— API ì—°ê²°')">ìˆ˜ì •</button>
            </div>
          </td>
        </tr>
      `).join("");
        }

        function renderBillingTable() {
            const tbody = document.getElementById("billing-body");
            if (!tbody) return;
            const rows = window.__adminState.billing || [];
            if (!rows.length) {
                tbody.innerHTML = `<tr><td colspan="6" class="py-8 text-center text-gray-400">ê²°ì œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
                return;
            }
            tbody.innerHTML = rows.map(b => `
        <tr class="border-b hover:bg-gray-50">
          <td class="py-2 px-3">#${safeText(b.id)}</td>
          <td class="py-2 px-3">${safeText(b.advertiser)}</td>
          <td class="py-2 px-3">${safeText(b.slot)}</td>
          <td class="py-2 px-3 font-semibold">${fmtMoney(b.amount)}</td>
          <td class="py-2 px-3">${safeText(b.status)}</td>
          <td class="py-2 px-3">
            <button class="px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs border border-gray-200"
              onclick="openDrawer('ê²°ì œ ìƒì„¸', renderBillingDetailHtml(${JSON.stringify(b).replace(/"/g, "&quot;")}))">ìƒì„¸</button>
          </td>
        </tr>
      `).join("");
        }

        function renderContentTable() {
            const tbody = document.getElementById("content-body");
            if (!tbody) return;

            const type = (document.getElementById("content-type")?.value || "all");
            const q = (document.getElementById("content-q")?.value || "").trim().toLowerCase();

            let rows = window.__adminState.content || [];
            if (type !== "all") {
                const map = { hotblog: "í™ë³´ ë¸”ë¡œê·¸", storepride: "ê°€ê²Œ ìë‘", event: "ì´ë²¤íŠ¸", performingart: "ê³µì—°/ì˜ˆìˆ ", localboard: "ì§€ì—­ê²Œì‹œíŒ" };
                rows = rows.filter(r => r.type === map[type]);
            }
            if (q) {
                rows = rows.filter(r => (r.type + " " + r.title + " " + r.by + " " + r.id).toLowerCase().includes(q));
            }

            if (!rows.length) {
                tbody.innerHTML = `<tr><td colspan="6" class="py-8 text-center text-gray-400">í‘œì‹œí•  ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
                return;
            }

            tbody.innerHTML = rows.map(r => `
        <tr class="border-b hover:bg-gray-50">
          <td class="py-2 px-3">${safeText(r.type)}</td>
          <td class="py-2 px-3">
            <button class="text-blue-700 font-semibold hover:underline"
              onclick="openDrawer('ì½˜í…ì¸  ìƒì„¸', renderContentDetailHtml(${JSON.stringify(r).replace(/"/g, "&quot;")}))">
              ${safeText(r.title)}
            </button>
            <div class="text-xs text-gray-500">ID: ${safeText(r.id)}</div>
          </td>
          <td class="py-2 px-3">${safeText(r.by)}</td>
          <td class="py-2 px-3">${safeText(r.created_at).slice(0, 10)}</td>
          <td class="py-2 px-3">${safeText(r.status)}</td>
          <td class="py-2 px-3">
            <div class="flex flex-wrap gap-1">
              <button class="px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs border border-gray-200"
                onclick="openDrawer('ì½˜í…ì¸  ìƒì„¸', renderContentDetailHtml(${JSON.stringify(r).replace(/"/g, "&quot;")}))">ìƒì„¸</button>
              <button class="px-3 py-1 rounded-full bg-yellow-50 text-yellow-700 text-xs border border-yellow-200"
                onclick="alert('UIë§Œ ë™ì‘: ê³ ì •/ì¶”ì²œì€ ë‚˜ì¤‘ì— API ì—°ê²°')">ê³ ì •/ì¶”ì²œ</button>
              <button class="px-3 py-1 rounded-full bg-red-50 text-red-600 text-xs border border-red-200"
                onclick="alert('UIë§Œ ë™ì‘: ë¸”ë¼ì¸ë“œ/ì‚­ì œëŠ” ë‚˜ì¤‘ì— API ì—°ê²°')">ë¸”ë¼ì¸ë“œ</button>
            </div>
          </td>
        </tr>
      `).join("");
        }

        function renderUsersTable() {
            const tbody = document.getElementById("users-body");
            if (!tbody) return;

            const type = (document.getElementById("users-type")?.value || "store"); // store|user
            const q = (document.getElementById("users-q")?.value || "").trim().toLowerCase();

            let rows = window.__adminState.users || [];
            rows = rows.filter(r => type === "store" ? r.kind === "ê°€ê²Œ" : r.kind === "ì‚¬ìš©ì");
            if (q) {
                rows = rows.filter(r => (r.kind + " " + r.name + " " + r.phone + " " + r.status + " " + r.id).toLowerCase().includes(q));
            }

            if (!rows.length) {
                tbody.innerHTML = `<tr><td colspan="6" class="py-8 text-center text-gray-400">í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
                return;
            }

            tbody.innerHTML = rows.map(r => `
        <tr class="border-b hover:bg-gray-50">
          <td class="py-2 px-3">${safeText(r.kind)}</td>
          <td class="py-2 px-3">
            <button class="text-blue-700 font-semibold hover:underline"
              onclick="openDrawer('ê³„ì • ìƒì„¸', renderUserDetailHtml(${JSON.stringify(r).replace(/"/g, "&quot;")}))">
              ${safeText(r.name)}
            </button>
            <div class="text-xs text-gray-500">ID: ${safeText(r.id)}</div>
          </td>
          <td class="py-2 px-3">${safeText(r.phone)}</td>
          <td class="py-2 px-3">${safeText(r.status)}</td>
          <td class="py-2 px-3">${safeText(r.created_at).slice(0, 10)}</td>
          <td class="py-2 px-3">
            <div class="flex flex-wrap gap-1">
              <button class="px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs border border-gray-200"
                onclick="openDrawer('ê³„ì • ìƒì„¸', renderUserDetailHtml(${JSON.stringify(r).replace(/"/g, "&quot;")}))">ìƒì„¸</button>
              <button class="px-3 py-1 rounded-full bg-yellow-50 text-yellow-700 text-xs border border-yellow-200"
                onclick="alert('UIë§Œ ë™ì‘: ì œí•œ/í•´ì œëŠ” ë‚˜ì¤‘ì— API ì—°ê²°')">ì œí•œ</button>
              <button class="px-3 py-1 rounded-full bg-red-50 text-red-600 text-xs border border-red-200"
                onclick="alert('UIë§Œ ë™ì‘: ì°¨ë‹¨/í•´ì œëŠ” ë‚˜ì¤‘ì— API ì—°ê²°')">ì°¨ë‹¨</button>
            </div>
          </td>
        </tr>
      `).join("");
        }

        function renderReportTable() {
            const tbody = document.getElementById("report-body");
            if (!tbody) return;

            const type = (document.getElementById("report-type")?.value || "all");
            const q = (document.getElementById("report-q")?.value || "").trim().toLowerCase();

            let rows = window.__adminState.reports || [];
            if (type !== "all") {
                const map = { content: "ì½˜í…ì¸ ", store: "ê°€ê²Œ", comment: "ëŒ“ê¸€" };
                rows = rows.filter(r => r.type === map[type]);
            }
            if (q) {
                rows = rows.filter(r => (r.type + " " + r.target + " " + r.reason + " " + r.id).toLowerCase().includes(q));
            }

            if (!rows.length) {
                tbody.innerHTML = `<tr><td colspan="6" class="py-8 text-center text-gray-400">ì‹ ê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
                return;
            }

            tbody.innerHTML = rows.map(r => `
        <tr class="border-b hover:bg-gray-50">
          <td class="py-2 px-3">${safeText(r.type)}</td>
          <td class="py-2 px-3">${safeText(r.target)}</td>
          <td class="py-2 px-3">${safeText(r.reason)}</td>
          <td class="py-2 px-3">${safeText(r.created_at).slice(0, 10)}</td>
          <td class="py-2 px-3">
            <span class="inline-flex px-2 py-0.5 rounded-full bg-yellow-50 text-yellow-700 text-xs font-semibold">ëŒ€ê¸°</span>
          </td>
          <td class="py-2 px-3">
            <div class="flex flex-wrap gap-1">
              <button class="px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs border border-gray-200"
                onclick="openDrawer('ì‹ ê³  ìƒì„¸', renderReportDetailHtml(${JSON.stringify(r).replace(/"/g, "&quot;")}))">ìƒì„¸</button>
              <button class="px-3 py-1 rounded-full bg-red-50 text-red-600 text-xs border border-red-200"
                onclick="alert('UIë§Œ ë™ì‘: ë¸”ë¼ì¸ë“œ ì²˜ë¦¬ API ì—°ê²° ì˜ˆì •')">ë¸”ë¼ì¸ë“œ</button>
              <button class="px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs border border-emerald-200"
                onclick="alert('UIë§Œ ë™ì‘: ì²˜ë¦¬ì™„ë£Œ API ì—°ê²° ì˜ˆì •')">ì™„ë£Œ</button>
            </div>
          </td>
        </tr>
      `).join("");
        }

        // UIìš© ìŠ¹ì¸/ë°˜ë ¤(ì„ì‹œ)
        function uiApprove(id) { alert(`UIë§Œ ë™ì‘: ìŠ¹ì¸ ì²˜ë¦¬ (id=${id})`); }
        function uiReject(id) { alert(`UIë§Œ ë™ì‘: ë°˜ë ¤ ì²˜ë¦¬ (id=${id})`); }

        // ===============================
        // âœ… ë“œë¡œì–´ ë‚´ìš© í…œí”Œë¦¿
        // ===============================
        function renderTopAdsHtml(list) {
            const rows = (list || []).map(a => `
        <tr class="border-b">
          <td class="py-2 px-3">${safeText(a.slot)}</td>
          <td class="py-2 px-3">${safeText(a.title)}</td>
          <td class="py-2 px-3 font-semibold">${fmtNumber(a.clicks)}</td>
          <td class="py-2 px-3">${(Number(a.ctr) || 0).toFixed(2)}%</td>
        </tr>
      `).join("");

            return `
        <div class="text-sm text-gray-700">
          <div class="p-4 rounded-xl bg-gray-50 border border-gray-100 mb-4">
            <p class="font-semibold text-gray-900">ìš”ì•½</p>
            <p class="text-gray-600 mt-1">ì˜¤ëŠ˜ í´ë¦­ì´ ë§ì€ ê´‘ê³ /ìŠ¬ë¡¯ ëª©ë¡ì…ë‹ˆë‹¤.</p>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full text-sm text-gray-700">
              <thead>
                <tr class="border-b bg-gray-50">
                  <th class="text-left py-2 px-3">ìŠ¬ë¡¯</th>
                  <th class="text-left py-2 px-3">ê´‘ê³ ëª…</th>
                  <th class="text-left py-2 px-3">í´ë¦­</th>
                  <th class="text-left py-2 px-3">CTR</th>
                </tr>
              </thead>
              <tbody>${rows || `<tr><td colspan="4" class="py-8 text-center text-gray-400">ë°ì´í„° ì—†ìŒ</td></tr>`}</tbody>
            </table>
          </div>
        </div>
      `;
        }

        function renderAdDetailHtml(a) {
            const ctr = a.impressions ? (a.clicks / a.impressions) * 100 : a.ctr;
            return `
        <div class="space-y-4 text-sm text-gray-700">
          <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
            <p class="font-semibold text-gray-900">ê´‘ê³  ì •ë³´</p>
            <div class="mt-2 space-y-1">
              <div><span class="text-gray-500">ìŠ¬ë¡¯:</span> <span class="font-semibold">${safeText(a.slot)}</span></div>
              <div><span class="text-gray-500">ê´‘ê³ ëª…:</span> <span class="font-semibold">${safeText(a.title)}</span></div>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 rounded-xl bg-white border border-gray-200">
              <p class="text-gray-500 text-xs font-semibold">ë…¸ì¶œ</p>
              <p class="text-lg font-extrabold text-blue-600 mt-1">${fmtNumber(a.impressions)}</p>
            </div>
            <div class="p-4 rounded-xl bg-white border border-gray-200">
              <p class="text-gray-500 text-xs font-semibold">í´ë¦­</p>
              <p class="text-lg font-extrabold text-purple-600 mt-1">${fmtNumber(a.clicks)}</p>
            </div>
            <div class="p-4 rounded-xl bg-white border border-gray-200 col-span-2">
              <p class="text-gray-500 text-xs font-semibold">CTR</p>
              <p class="text-lg font-extrabold text-emerald-600 mt-1">${(Number(ctr) || 0).toFixed(2)}%</p>
            </div>
          </div>

          <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
            <p class="font-semibold text-gray-900">ìš´ì˜ ì•¡ì…˜(ì˜ˆì •)</p>
            <div class="flex flex-wrap gap-2 mt-2">
              <button class="px-4 py-2 rounded-full bg-blue-50 text-blue-700 border border-blue-200 font-semibold"
                onclick="alert('UIë§Œ ë™ì‘: ê´‘ê³  ìˆ˜ì •')">ìˆ˜ì •</button>
              <button class="px-4 py-2 rounded-full bg-red-50 text-red-600 border border-red-200 font-semibold"
                onclick="alert('UIë§Œ ë™ì‘: ê´‘ê³  ì¤‘ë‹¨')">ì¤‘ë‹¨</button>
            </div>
          </div>
        </div>
      `;
        }

        function renderApprovalDetailHtml(a) {
            return `
        <div class="space-y-4 text-sm text-gray-700">
          <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
            <p class="font-semibold text-gray-900">ìŠ¹ì¸ í•­ëª©</p>
            <div class="mt-2 space-y-1">
              <div><span class="text-gray-500">ìœ í˜•:</span> <span class="font-semibold">${safeText(a.type)}</span></div>
              <div><span class="text-gray-500">ì œëª©:</span> <span class="font-semibold">${safeText(a.title)}</span></div>
              <div><span class="text-gray-500">ë“±ë¡ì:</span> ${safeText(a.by)}</div>
              <div><span class="text-gray-500">ë“±ë¡ì¼:</span> ${safeText(a.created_at).slice(0, 16).replace("T", " ")}</div>
              <div><span class="text-gray-500">ID:</span> ${safeText(a.id)}</div>
            </div>
          </div>

          <div class="p-4 rounded-xl bg-white border border-gray-200">
            <p class="font-semibold text-gray-900">ê²€ìˆ˜ ì²´í¬(ì˜ˆì‹œ)</p>
            <ul class="list-disc list-inside text-gray-600 mt-2 space-y-1">
              <li>ê¸ˆì§€ ì—…ì¢…/ì†Œì¬ ì—¬ë¶€</li>
              <li>ì—°ë½ì²˜/ì£¼ì†Œ/ì´ë¯¸ì§€ ìµœì†Œ ìš”ê±´</li>
              <li>ì €ì‘ê¶Œ/ìƒí‘œê¶Œ ìœ„ë°˜ ì—¬ë¶€</li>
            </ul>
          </div>

          <div class="flex flex-wrap gap-2">
            <button class="px-4 py-2 rounded-full bg-emerald-600 text-white font-bold shadow"
              onclick="alert('UIë§Œ ë™ì‘: ìŠ¹ì¸ ì²˜ë¦¬')">ìŠ¹ì¸</button>
            <button class="px-4 py-2 rounded-full bg-red-600 text-white font-bold shadow"
              onclick="alert('UIë§Œ ë™ì‘: ë°˜ë ¤ ì²˜ë¦¬')">ë°˜ë ¤</button>
            <button class="px-4 py-2 rounded-full bg-gray-100 text-gray-700 font-bold border border-gray-200"
              onclick="closeDrawer()">ë‹«ê¸°</button>
          </div>
        </div>
      `;
        }

        function renderSlotDetailHtml(s) {
            return `
        <div class="space-y-4 text-sm text-gray-700">
          <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
            <p class="font-semibold text-gray-900">ìŠ¬ë¡¯ ì •ë³´</p>
            <div class="mt-2 space-y-1">
              <div><span class="text-gray-500">í˜ì´ì§€:</span> <span class="font-semibold">${safeText(s.page)}</span></div>
              <div><span class="text-gray-500">í¬ì§€ì…˜:</span> <span class="font-semibold">${safeText(s.position)}</span></div>
              <div><span class="text-gray-500">íƒ€ì…:</span> ${safeText(s.slot_type)}</div>
              <div><span class="text-gray-500">ëª¨ë“œ:</span> ${safeText(s.slot_mode)}</div>
              <div><span class="text-gray-500">ë§í¬:</span> <a class="text-blue-700 hover:underline break-all" href="${safeText(s.link_url, '#')}" target="_blank">${safeText(s.link_url)}</a></div>
              <div><span class="text-gray-500">ê¸°ê°„:</span> ${s.no_end ? "ë¬´ê¸°í•œ" : `${safeText(s.start_date)} ~ ${safeText(s.end_date)}`}</div>
            </div>
          </div>
          <div class="p-4 rounded-xl bg-white border border-gray-200">
            <p class="font-semibold text-gray-900">ê´€ë¦¬ ì•¡ì…˜(ì˜ˆì •)</p>
            <div class="flex flex-wrap gap-2 mt-2">
              <button class="px-4 py-2 rounded-full bg-blue-50 text-blue-700 border border-blue-200 font-semibold"
                onclick="alert('UIë§Œ ë™ì‘: ìŠ¬ë¡¯ ìˆ˜ì •')">ìˆ˜ì •</button>
              <button class="px-4 py-2 rounded-full bg-red-50 text-red-600 border border-red-200 font-semibold"
                onclick="alert('UIë§Œ ë™ì‘: ìŠ¬ë¡¯ ë¹„í™œì„±')">ë¹„í™œì„±</button>
            </div>
          </div>
        </div>
      `;
        }

        function renderBillingDetailHtml(b) {
            return `
        <div class="space-y-4 text-sm text-gray-700">
          <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
            <p class="font-semibold text-gray-900">ê²°ì œ ì •ë³´</p>
            <div class="mt-2 space-y-1">
              <div><span class="text-gray-500">ê²°ì œID:</span> <span class="font-semibold">#${safeText(b.id)}</span></div>
              <div><span class="text-gray-500">ê´‘ê³ ì£¼:</span> ${safeText(b.advertiser)}</div>
              <div><span class="text-gray-500">ìŠ¬ë¡¯:</span> ${safeText(b.slot)}</div>
              <div><span class="text-gray-500">ê¸ˆì•¡:</span> <span class="font-semibold">${fmtMoney(b.amount)}</span></div>
              <div><span class="text-gray-500">ìƒíƒœ:</span> ${safeText(b.status)}</div>
            </div>
          </div>
          <div class="p-4 rounded-xl bg-white border border-gray-200">
            <p class="font-semibold text-gray-900">ê´€ë¦¬ ì•¡ì…˜(ì˜ˆì •)</p>
            <div class="flex flex-wrap gap-2 mt-2">
              <button class="px-4 py-2 rounded-full bg-blue-50 text-blue-700 border border-blue-200 font-semibold"
                onclick="alert('UIë§Œ ë™ì‘: ì˜ìˆ˜ì¦/ì²­êµ¬ì„œ ì¶œë ¥')">ì˜ìˆ˜ì¦</button>
              <button class="px-4 py-2 rounded-full bg-red-50 text-red-600 border border-red-200 font-semibold"
                onclick="alert('UIë§Œ ë™ì‘: í™˜ë¶ˆ ì²˜ë¦¬')">í™˜ë¶ˆ</button>
            </div>
          </div>
        </div>
      `;
        }

        function renderContentDetailHtml(c) {
            return `
        <div class="space-y-4 text-sm text-gray-700">
          <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
            <p class="font-semibold text-gray-900">ì½˜í…ì¸  ì •ë³´</p>
            <div class="mt-2 space-y-1">
              <div><span class="text-gray-500">ìœ í˜•:</span> <span class="font-semibold">${safeText(c.type)}</span></div>
              <div><span class="text-gray-500">ì œëª©:</span> <span class="font-semibold">${safeText(c.title)}</span></div>
              <div><span class="text-gray-500">ì‘ì„±ì:</span> ${safeText(c.by)}</div>
              <div><span class="text-gray-500">ì‘ì„±ì¼:</span> ${safeText(c.created_at).slice(0, 16).replace("T", " ")}</div>
              <div><span class="text-gray-500">ìƒíƒœ:</span> ${safeText(c.status)}</div>
              <div><span class="text-gray-500">ID:</span> ${safeText(c.id)}</div>
            </div>
          </div>
          <div class="p-4 rounded-xl bg-white border border-gray-200">
            <p class="font-semibold text-gray-900">ê´€ë¦¬ ì•¡ì…˜(ì˜ˆì •)</p>
            <div class="flex flex-wrap gap-2 mt-2">
              <button class="px-4 py-2 rounded-full bg-yellow-50 text-yellow-700 border border-yellow-200 font-semibold"
                onclick="alert('UIë§Œ ë™ì‘: ê³ ì •/ì¶”ì²œ')">ê³ ì •/ì¶”ì²œ</button>
              <button class="px-4 py-2 rounded-full bg-red-50 text-red-600 border border-red-200 font-semibold"
                onclick="alert('UIë§Œ ë™ì‘: ë¸”ë¼ì¸ë“œ')">ë¸”ë¼ì¸ë“œ</button>
            </div>
          </div>
        </div>
      `;
        }

        function renderUserDetailHtml(u) {
            return `
        <div class="space-y-4 text-sm text-gray-700">
          <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
            <p class="font-semibold text-gray-900">ê³„ì • ì •ë³´</p>
            <div class="mt-2 space-y-1">
              <div><span class="text-gray-500">êµ¬ë¶„:</span> <span class="font-semibold">${safeText(u.kind)}</span></div>
              <div><span class="text-gray-500">ì´ë¦„/ìƒí˜¸:</span> <span class="font-semibold">${safeText(u.name)}</span></div>
              <div><span class="text-gray-500">ì—°ë½ì²˜:</span> ${safeText(u.phone)}</div>
              <div><span class="text-gray-500">ìƒíƒœ:</span> ${safeText(u.status)}</div>
              <div><span class="text-gray-500">ë“±ë¡ì¼:</span> ${safeText(u.created_at).slice(0, 10)}</div>
              <div><span class="text-gray-500">ID:</span> ${safeText(u.id)}</div>
            </div>
          </div>
          <div class="p-4 rounded-xl bg-white border border-gray-200">
            <p class="font-semibold text-gray-900">ê´€ë¦¬ ì•¡ì…˜(ì˜ˆì •)</p>
            <div class="flex flex-wrap gap-2 mt-2">
              <button class="px-4 py-2 rounded-full bg-yellow-50 text-yellow-700 border border-yellow-200 font-semibold"
                onclick="alert('UIë§Œ ë™ì‘: ì œí•œ')">ì œí•œ</button>
              <button class="px-4 py-2 rounded-full bg-red-50 text-red-600 border border-red-200 font-semibold"
                onclick="alert('UIë§Œ ë™ì‘: ì°¨ë‹¨')">ì°¨ë‹¨</button>
            </div>
          </div>
        </div>
      `;
        }

        function renderReportDetailHtml(r) {
            return `
        <div class="space-y-4 text-sm text-gray-700">
          <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
            <p class="font-semibold text-gray-900">ì‹ ê³  ì •ë³´</p>
            <div class="mt-2 space-y-1">
              <div><span class="text-gray-500">ìœ í˜•:</span> <span class="font-semibold">${safeText(r.type)}</span></div>
              <div><span class="text-gray-500">ëŒ€ìƒ:</span> ${safeText(r.target)}</div>
              <div><span class="text-gray-500">ì‚¬ìœ :</span> ${safeText(r.reason)}</div>
              <div><span class="text-gray-500">ì‹ ê³ ì¼:</span> ${safeText(r.created_at).slice(0, 16).replace("T", " ")}</div>
              <div><span class="text-gray-500">ID:</span> ${safeText(r.id)}</div>
            </div>
          </div>
          <div class="p-4 rounded-xl bg-white border border-gray-200">
            <p class="font-semibold text-gray-900">ì²˜ë¦¬ ì•¡ì…˜(ì˜ˆì •)</p>
            <div class="flex flex-wrap gap-2 mt-2">
              <button class="px-4 py-2 rounded-full bg-red-50 text-red-600 border border-red-200 font-semibold"
                onclick="alert('UIë§Œ ë™ì‘: ë¸”ë¼ì¸ë“œ')">ë¸”ë¼ì¸ë“œ</button>
              <button class="px-4 py-2 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200 font-semibold"
                onclick="alert('UIë§Œ ë™ì‘: ì²˜ë¦¬ì™„ë£Œ')">ì²˜ë¦¬ì™„ë£Œ</button>
            </div>
          </div>
        </div>
      `;
        }

        // ===============================
        // âœ… ì°¨íŠ¸
        // ===============================
        let hourlyChart;
        function buildHourlyChart() {
            const ctx = document.getElementById("hourlyChart");
            if (!ctx) return;

            if (hourlyChart) hourlyChart.destroy();

            const rows = window.__adminState.hourly || [];
            const labels = rows.map(r => String(r.hour).padStart(2, "0") + "ì‹œ");

            const kpi = window.__adminState.kpi;
            const tKey = kpi === "impressions" ? "impressions_today" : kpi === "clicks" ? "clicks_today" : "revenue_today";
            const yKey = kpi === "impressions" ? "impressions_yesterday" : kpi === "clicks" ? "clicks_yesterday" : "revenue_yesterday";

            const todayData = rows.map(r => Number(r[tKey] || 0));
            const yestData = rows.map(r => Number(r[yKey] || 0));

            hourlyChart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels,
                    datasets: [
                        {
                            label: "ì˜¤ëŠ˜",
                            data: todayData,
                            borderWidth: 0,
                            backgroundColor: "rgba(59,130,246,0.35)"
                        },
                        {
                            label: "ì–´ì œ",
                            data: yestData,
                            borderWidth: 0,
                            backgroundColor: "rgba(168,85,247,0.25)"
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    },
                    onClick: (evt, elements) => {
                        if (!elements || !elements.length) return;
                        const idx = elements[0].index;
                        const row = rows[idx];
                        openDrawer(
                            `ì‹œê°„ëŒ€ ìƒì„¸ Â· ${String(row.hour).padStart(2, "0")}ì‹œ`,
                            renderHourDetailHtml(row)
                        );
                    }
                }
            });
        }

        function renderHourDetailHtml(row) {
            return `
        <div class="space-y-4 text-sm text-gray-700">
          <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
            <p class="font-semibold text-gray-900">ì‹œê°„ëŒ€ ì§€í‘œ</p>
            <div class="grid grid-cols-2 gap-3 mt-3">
              <div class="p-4 rounded-xl bg-white border border-gray-200">
                <p class="text-xs text-gray-500 font-semibold">ì˜¤ëŠ˜ ë…¸ì¶œ</p>
                <p class="text-lg font-extrabold text-blue-600 mt-1">${fmtNumber(row.impressions_today)}</p>
              </div>
              <div class="p-4 rounded-xl bg-white border border-gray-200">
                <p class="text-xs text-gray-500 font-semibold">ì–´ì œ ë…¸ì¶œ</p>
                <p class="text-lg font-extrabold text-purple-600 mt-1">${fmtNumber(row.impressions_yesterday)}</p>
              </div>
              <div class="p-4 rounded-xl bg-white border border-gray-200">
                <p class="text-xs text-gray-500 font-semibold">ì˜¤ëŠ˜ í´ë¦­</p>
                <p class="text-lg font-extrabold text-blue-600 mt-1">${fmtNumber(row.clicks_today)}</p>
              </div>
              <div class="p-4 rounded-xl bg-white border border-gray-200">
                <p class="text-xs text-gray-500 font-semibold">ì–´ì œ í´ë¦­</p>
                <p class="text-lg font-extrabold text-purple-600 mt-1">${fmtNumber(row.clicks_yesterday)}</p>
              </div>
              <div class="p-4 rounded-xl bg-white border border-gray-200 col-span-2">
                <p class="text-xs text-gray-500 font-semibold">ì˜¤ëŠ˜ ë§¤ì¶œ</p>
                <p class="text-lg font-extrabold text-orange-600 mt-1">${fmtMoney(row.revenue_today)}</p>
                <p class="text-xs text-gray-500 mt-1">ì–´ì œ: ${fmtMoney(row.revenue_yesterday)}</p>
              </div>
            </div>
          </div>

          <div class="p-4 rounded-xl bg-white border border-gray-200">
            <p class="font-semibold text-gray-900">ì´ ì‹œê°„ëŒ€ Top ê´‘ê³ (ì˜ˆì •)</p>
            <p class="text-gray-500 mt-1">
              ë‚˜ì¤‘ì— â€œí´ë¦­ ë¡œê·¸ í…Œì´ë¸”â€ ë¶™ì´ë©´ ì´ ì‹œê°„ëŒ€ì— í´ë¦­ëœ ê´‘ê³ ë¥¼ ì—¬ê¸°ë¡œ ë½‘ì•„ì£¼ë©´ ë¼.
            </p>
          </div>
        </div>
      `;
        }

        // ===============================
        // âœ… ë°ì´í„° ë¡œë“œ (ì§€ê¸ˆì€ ë”ë¯¸ ìš°ì„ )
        // ===============================
        async function loadAll(range = "today") {
            window.__adminState.range = range;

            // âœ… ì§€ê¸ˆì€ ì„œë²„ APIê°€ ì—†ì–´ë„ ë™ì‘í•´ì•¼ í•˜ë‹ˆê¹Œ:
            // 1) API ì‹œë„
            // 2) ì‹¤íŒ¨í•˜ë©´ ë”ë¯¸
            let payload = null;

            try {
                // ë„¤ê°€ ë‚˜ì¤‘ì— ì„œë²„ì— ë§Œë“¤ API(ì˜ˆì‹œ)
                // payload = await fetchJson(`/admin/overview?range=${range}`);
                // if (!payload || !payload.ok) throw new Error("no payload");

                throw new Error("API not wired"); // í˜„ì¬ëŠ” ê°•ì œë¡œ ë”ë¯¸ ì‚¬ìš©
            } catch (e) {
                const m = makeMockState();
                payload = {
                    ok: true,
                    today: m.today,
                    yesterday: m.yesterday,
                    hourly: m.hourly,
                    top_ads: m.top_ads,
                    approvals: m.approvalsList,
                    reports: m.reportsList,
                    expiring_ads: m.expiring,
                    new_items: m.newItems,
                    slots: m.slots,
                    billing: m.billing,
                    content: m.content,
                    users: m.users,
                };
            }

            // ìƒíƒœ ë°˜ì˜
            window.__adminState.today = payload.today || {};
            window.__adminState.yesterday = payload.yesterday || {};
            window.__adminState.hourly = payload.hourly || [];
            window.__adminState.top_ads = payload.top_ads || [];
            window.__adminState.approvals = payload.approvals || [];
            window.__adminState.reports = payload.reports || [];
            window.__adminState.expiring_ads = payload.expiring_ads || 0;
            window.__adminState.new_items = payload.new_items || 0;
            window.__adminState.slots = payload.slots || [];
            window.__adminState.billing = payload.billing || [];
            window.__adminState.content = payload.content || [];
            window.__adminState.users = payload.users || [];

            // ë Œë”
            renderMetricCards();
            renderTopAds();
            renderApprovalsMini();
            buildHourlyChart();

            renderApprovalTable();
            renderSlotTable();
            renderBillingTable();
            renderContentTable();
            renderUsersTable();
            renderReportTable();
        }

        // ===============================
        // âœ… ì¹´ë“œ í´ë¦­(ì„¸ë¶€)
        // ===============================
        function openMetricDetail(metric) {
            const s = window.__adminState;
            const t = s.today || {};
            const y = s.yesterday || {};
            const rows = s.top_ads || [];

            if (metric === "impressions") {
                openDrawer("ì˜¤ëŠ˜ ê´‘ê³  ë…¸ì¶œ ìƒì„¸", `
          <div class="space-y-4 text-sm text-gray-700">
            <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
              <p class="font-semibold text-gray-900">ì˜¤ëŠ˜ ë…¸ì¶œ</p>
              <p class="text-2xl font-extrabold text-blue-600 mt-1">${fmtNumber(t.impressions)}</p>
              <p class="text-sm mt-2">ì–´ì œ: <span class="font-semibold">${fmtNumber(y.impressions)}</span></p>
              <p class="text-sm mt-1">ë³€í™”: ${deltaText(t.impressions, y.impressions)}</p>
            </div>
            ${renderTopAdsHtml(rows.slice(0, 8))}
          </div>
        `);
                return;
            }

            if (metric === "clicks") {
                openDrawer("ì˜¤ëŠ˜ ê´‘ê³  í´ë¦­ ìƒì„¸", `
          <div class="space-y-4 text-sm text-gray-700">
            <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
              <p class="font-semibold text-gray-900">ì˜¤ëŠ˜ í´ë¦­</p>
              <p class="text-2xl font-extrabold text-purple-600 mt-1">${fmtNumber(t.clicks)}</p>
              <p class="text-sm mt-2">ì–´ì œ: <span class="font-semibold">${fmtNumber(y.clicks)}</span></p>
              <p class="text-sm mt-1">ë³€í™”: ${deltaText(t.clicks, y.clicks)}</p>
            </div>
            ${renderTopAdsHtml(rows.slice(0, 8))}
          </div>
        `);
                return;
            }

            if (metric === "ctr") {
                const ctrT = t.impressions ? (t.clicks / t.impressions) * 100 : 0;
                const ctrY = y.impressions ? (y.clicks / y.impressions) * 100 : 0;
                openDrawer("CTR ìƒì„¸", `
          <div class="space-y-4 text-sm text-gray-700">
            <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
              <p class="font-semibold text-gray-900">ì˜¤ëŠ˜ CTR</p>
              <p class="text-2xl font-extrabold text-emerald-600 mt-1">${ctrT.toFixed(2)}%</p>
              <p class="text-sm mt-2">ì–´ì œ: <span class="font-semibold">${ctrY.toFixed(2)}%</span></p>
              <p class="text-sm mt-1">ë³€í™”: ${deltaText(ctrT, ctrY, "%")}</p>
            </div>
            <div class="p-4 rounded-xl bg-white border border-gray-200">
              <p class="font-semibold text-gray-900">ì°¸ê³ </p>
              <p class="text-gray-600 mt-1">CTR = í´ë¦­ / ë…¸ì¶œ. ìŠ¬ë¡¯ë³„ CTRì„ ë½‘ì•„ì„œ â€œíš¨ìœ¨ ì¢‹ì€ ê´‘ê³ â€ë¥¼ ìë™ ì¶”ì²œí•˜ëŠ” ê²ƒë„ ê°€ëŠ¥.</p>
            </div>
          </div>
        `);
                return;
            }

            if (metric === "ad_revenue") {
                openDrawer("ê´‘ê³  ë§¤ì¶œ ìƒì„¸", `
          <div class="space-y-4 text-sm text-gray-700">
            <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
              <p class="font-semibold text-gray-900">ì˜¤ëŠ˜ ê´‘ê³  ë§¤ì¶œ</p>
              <p class="text-2xl font-extrabold text-orange-600 mt-1">${fmtMoney(t.ad_revenue)}</p>
              <p class="text-sm mt-2">ì–´ì œ: <span class="font-semibold">${fmtMoney(y.ad_revenue)}</span></p>
              <p class="text-sm mt-1">ë³€í™”: ${deltaText(t.ad_revenue, y.ad_revenue, "ì›")}</p>
            </div>
            <div class="p-4 rounded-xl bg-white border border-gray-200">
              <p class="font-semibold text-gray-900">êµ¬ì„±(ì˜ˆì •)</p>
              <p class="text-gray-600 mt-1">ê²°ì œ í…Œì´ë¸”/ì²­êµ¬ì„œ í…Œì´ë¸”ì„ ë¶™ì´ë©´ â€œì˜¤ëŠ˜ ê²°ì œ ì™„ë£Œ/ëŒ€ê¸°/ì·¨ì†Œâ€ë¥¼ ì—¬ê¸°ì„œ ë°”ë¡œ ë³¼ ìˆ˜ ìˆì–´.</p>
            </div>
          </div>
        `);
                return;
            }

            if (metric === "approvals") {
                openDrawer("ìŠ¹ì¸ ëŒ€ê¸° ìƒì„¸", `
          <div class="space-y-4 text-sm text-gray-700">
            <div class="p-4 rounded-xl bg-gray-50 border border-gray-100">
              <p class="font-semibold text-gray-900">ìŠ¹ì¸ ëŒ€ê¸°</p>
              <p class="text-2xl font-extrabold text-red-600 mt-1">${fmtNumber(t.approvals)}</p>
              <p class="text-sm mt-1">ì–´ì œ: ${fmtNumber(y.approvals)}</p>
            </div>
            <div class="p-4 rounded-xl bg-white border border-gray-200">
              <p class="font-semibold text-gray-900">ëŒ€ê¸° ëª©ë¡</p>
              <div class="mt-2 space-y-2">
                ${(s.approvals || []).slice(0, 8).map(a => `
                  <button class="w-full text-left p-3 rounded-xl bg-gray-50 border border-gray-100 hover:bg-gray-100"
                    onclick="openDrawer('ìŠ¹ì¸ ìƒì„¸', renderApprovalDetailHtml(${JSON.stringify(a).replace(/"/g, "&quot;")}))">
                    <div class="font-semibold">${safeText(a.type)} Â· ${safeText(a.title)}</div>
                    <div class="text-xs text-gray-500 mt-1">ë“±ë¡ì: ${safeText(a.by)} Â· ID: ${safeText(a.id)}</div>
                  </button>
                `).join("") || `<div class="text-gray-400">ëŒ€ê¸° ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>`}
              </div>
            </div>
          </div>
        `);
                return;
            }
        }

        document.querySelectorAll(".metric-card").forEach(btn => {
            btn.addEventListener("click", () => openMetricDetail(btn.dataset.metric));
        });

        // ===============================
        // âœ… KPI ë²„íŠ¼(ê·¸ë˜í”„ ì§€í‘œ ë³€ê²½)
        // ===============================
        document.querySelectorAll(".kpi-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                document.querySelectorAll(".kpi-btn").forEach(b => {
                    b.classList.remove("bg-blue-100", "text-blue-700");
                    b.classList.add("bg-gray-100", "text-gray-700");
                });
                btn.classList.remove("bg-gray-100", "text-gray-700");
                btn.classList.add("bg-blue-100", "text-blue-700");
                window.__adminState.kpi = btn.dataset.kpi;
                buildHourlyChart();
            });
        });

        // ===============================
        // âœ… ê¸°ê°„ ë²„íŠ¼(ì˜¤ëŠ˜/7ì¼/30ì¼)
        // ===============================
        document.querySelectorAll(".range-btn").forEach(btn => {
            btn.addEventListener("click", async () => {
                document.querySelectorAll(".range-btn").forEach(b => {
                    b.classList.remove("bg-blue-100", "text-blue-700");
                    b.classList.add("bg-gray-100", "text-gray-700");
                });
                btn.classList.remove("bg-gray-100", "text-gray-700");
                btn.classList.add("bg-blue-100", "text-blue-700");
                await loadAll(btn.dataset.range);
            });
        });

        // ===============================
        // âœ… ê° ì„¹ì…˜ ìƒˆë¡œê³ ì¹¨/í•„í„° ì´ë²¤íŠ¸
        // ===============================
        document.getElementById("btn-refresh")?.addEventListener("click", () => loadAll(window.__adminState.range));

        document.getElementById("btn-approval-refresh")?.addEventListener("click", renderApprovalTable);
        document.getElementById("approval-type")?.addEventListener("change", renderApprovalTable);
        document.getElementById("approval-q")?.addEventListener("input", renderApprovalTable);

        document.getElementById("btn-slot-refresh")?.addEventListener("click", renderSlotTable);
        document.getElementById("slot-page")?.addEventListener("change", renderSlotTable);
        document.getElementById("slot-q")?.addEventListener("input", renderSlotTable);

        document.getElementById("btn-content-refresh")?.addEventListener("click", renderContentTable);
        document.getElementById("content-type")?.addEventListener("change", renderContentTable);
        document.getElementById("content-q")?.addEventListener("input", renderContentTable);

        document.getElementById("btn-users-refresh")?.addEventListener("click", renderUsersTable);
        document.getElementById("users-type")?.addEventListener("change", renderUsersTable);
        document.getElementById("users-q")?.addEventListener("input", renderUsersTable);

        document.getElementById("btn-report-refresh")?.addEventListener("click", renderReportTable);
        document.getElementById("report-type")?.addEventListener("change", renderReportTable);
        document.getElementById("report-q")?.addEventListener("input", renderReportTable);

        // ESCë¡œ ë“œë¡œì–´ ë‹«ê¸°
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") closeDrawer();
        });

        // ===============================
        // âœ… ìµœì´ˆ ë¡œë“œ
        // ===============================
        window.addEventListener("DOMContentLoaded", async () => {
            setRealtimeIndicator(0);
            await loadAll("today");
        });
    </script>
</body>

</html>