<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì˜¤í”ˆ ì˜ˆì • ìƒì„¸ | MALL HANKOOK</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Kakao ì§€ë„ (autoload=false í•„ìˆ˜: kakao.maps.load ì“°ë ¤ë©´) -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&autoload=false&libraries=services"></script>

  <style>
    body {
      font-family: Pretendard, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif;
      min-height: 100vh;
      background:
        radial-gradient(circle at top left, #dbeafe, #eef2ff 35%, #f9fafb 75%),
        linear-gradient(135deg, #e5e7eb, #f9fafb);
      color: #0f172a;
    }

    .neo-card {
      background: rgba(255, 255, 255, 0.86);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-radius: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.75);
      box-shadow:
        10px 14px 28px rgba(15, 23, 42, 0.14),
        -8px -8px 20px rgba(255, 255, 255, 0.9);
    }

    .title-grad {
      background: linear-gradient(90deg, #2563eb, #7c3aed, #f97316);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .btn-3d {
      border-radius: 999px;
      box-shadow:
        0 8px 20px rgba(15, 23, 42, 0.15),
        0 0 0 1px rgba(255, 255, 255, 0.7) inset;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .btn-3d:hover {
      transform: translateY(-1px);
      box-shadow:
        0 12px 26px rgba(15, 23, 42, 0.18),
        0 0 0 1px rgba(255, 255, 255, 0.9) inset;
    }

    .btn-3d:active {
      transform: translateY(0);
      box-shadow:
        0 6px 14px rgba(15, 23, 42, 0.2),
        0 0 0 1px rgba(255, 255, 255, 0.7) inset;
    }

    /* âœ… ì†Œê°œ ë¯¸ë¦¬ë³´ê¸°(ê¸°ë³¸ ë°•ìŠ¤ í˜•íƒœ ìœ ì§€) */
    .desc-clamp {
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 6;
      overflow: hidden;
    }

    /* âœ… ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ */
    .modal-fade-in {
      animation: fadeIn 0.16s ease-out forwards;
    }

    .modal-pop-in {
      animation: popIn 0.18s ease-out forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes popIn {
      from { opacity: 0; transform: translateY(8px) scale(0.985); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    /* âœ… ìŠ¤í¬ë¡¤ë°” â€œë³´ì´ê²Œâ€(í•­ìƒ ëœ¨ê²Œ) */
    .force-scrollbar {
      overflow-y: scroll;   /* autoê°€ ì•„ë‹ˆë¼ scrollë¡œ ê°•ì œ */
      scrollbar-gutter: stable;
    }

    .force-scrollbar::-webkit-scrollbar {
      width: 10px;
    }

    .force-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(100, 116, 139, 0.35);
      border-radius: 999px;
      border: 2px solid transparent;
      background-clip: padding-box;
    }
  </style>
</head>

<body class="min-h-screen">

  <!-- ê³µí†µ í—¤ë” -->
  <div id="header"></div>

  <main class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 pb-16 pt-6">
    <!-- íƒ€ì´í‹€ -->
    <section class="mb-6 sm:mb-8">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <p class="text-xs font-semibold text-indigo-500 uppercase tracking-wide mb-1">Open Soon</p>
          <h1 id="heroName" class="title-grad text-2xl sm:text-3xl md:text-4xl font-extrabold tracking-tight">
            ì˜¤í”ˆ ì˜ˆì • ê°€ê²Œ
          </h1>
          <p class="text-sm text-slate-500 mt-1">ë¯¸ë¦¬ ê°€ê²Œ ì •ë³´ë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”.</p>
        </div>
        <a href="/open.html"
          class="btn-3d inline-flex items-center gap-2 px-4 py-2 bg-white/90 text-xs sm:text-sm font-semibold text-slate-700 border border-slate-200 hover:bg-slate-50">
          <span class="text-lg leading-none">â†</span>
          <span>ì˜¤í”ˆ ì˜ˆì • ëª©ë¡ìœ¼ë¡œ</span>
        </a>
      </div>
    </section>

    <!-- 2x2 ì¹´ë“œ -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-7">

      <!-- ì‚¬ì§„ -->
      <article class="neo-card p-4 sm:p-5 flex flex-col min-h-[260px]">
        <header class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2 text-sm font-semibold text-slate-600">
            <span class="text-lg">ğŸ“¸</span><span>ëŒ€í‘œ ì‚¬ì§„</span>
          </div>
        </header>

        <div class="relative flex-1 rounded-2xl overflow-hidden border border-slate-100 bg-slate-900/5">
          <img id="storeImage" src="/uploads/no-thumb.png" alt="ëŒ€í‘œ ì´ë¯¸ì§€"
            class="w-full h-full max-h-72 object-cover" />
        </div>
      </article>

      <!-- ê¸°ë³¸ ì •ë³´ -->
      <article class="neo-card p-4 sm:p-5 flex flex-col justify-between min-h-[260px]">
        <header class="mb-3">
          <p class="text-xs font-semibold tracking-wide text-indigo-500 uppercase">ê¸°ë³¸ ì •ë³´</p>
          <h2 id="storeName" class="mt-1 text-2xl sm:text-3xl font-extrabold title-grad break-words">ìƒí˜¸ëª…</h2>
        </header>

        <dl class="mt-2 space-y-3 sm:space-y-4 text-sm sm:text-base leading-relaxed flex-1">
          <div class="flex gap-4 items-baseline">
            <dt class="min-w-[5.5rem] text-slate-500"><span>ğŸ“…</span> ì˜¤í”ˆì¼</dt>
            <dd id="openDate" class="font-semibold text-slate-900">-</dd>
          </div>

          <div class="flex gap-4 items-baseline">
            <dt class="min-w-[5.5rem] text-slate-500"><span>ğŸ·ï¸</span> ì¹´í…Œê³ ë¦¬</dt>
            <dd id="category" class="font-semibold text-slate-900">-</dd>
          </div>

          <div class="flex gap-4 items-baseline">
            <dt class="min-w-[5.5rem] text-slate-500"><span>ğŸ“</span> ì „í™”</dt>
            <dd class="font-semibold text-slate-900">
              <a id="phoneLink" href="#" class="underline underline-offset-2 hover:text-blue-600">
                <span id="phone">-</span>
              </a>
            </dd>
          </div>

          <div class="flex gap-4 items-start">
            <dt class="min-w-[5.5rem] text-slate-500 mt-0.5"><span>ğŸ“</span> ì£¼ì†Œ</dt>
            <dd class="font-semibold text-slate-900 break-words">
              <span id="addressText">-</span>
            </dd>
          </div>
        </dl>

        <p class="text-[11px] text-slate-400 mt-3">â€» ì‹¤ì œ ì˜¤í”ˆ ì‹œì ì˜ ì •ë³´ëŠ” ì¼ë¶€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </article>

      <!-- ì§€ë„ -->
      <article class="neo-card p-4 sm:p-5 flex flex-col min-h-[260px]">
        <header class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2 text-sm font-semibold text-slate-600">
            <span class="text-lg">ğŸ—ºï¸</span><span>ê°€ê²Œ ìœ„ì¹˜</span>
          </div>
        </header>

        <div class="flex-1 rounded-2xl overflow-hidden border border-slate-200 bg-slate-100">
          <div id="map" class="w-full h-56 sm:h-64"></div>
        </div>

        <div class="flex justify-end pt-3">
          <a id="kakaoDirBtn" href="#" target="_blank" rel="noopener"
            class="btn-3d px-4 py-2 bg-gradient-to-r from-sky-500 to-indigo-500 text-xs sm:text-sm font-semibold text-white hover:from-sky-600 hover:to-indigo-600">
            ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸° ì—´ê¸°
          </a>
        </div>
      </article>

      <!-- ì†Œê°œ -->
      <article class="neo-card p-4 sm:p-5 flex flex-col min-h-[260px]">
        <header class="mb-3 flex items-center justify-between gap-3">
          <div class="flex items-center gap-2 text-sm font-semibold text-slate-600">
            <span class="text-lg">ğŸ“</span><span>ê°€ê²Œ ì†Œê°œ</span>
          </div>

          <!-- âœ… ë¬´ì¡°ê±´ ë™ì‘í•˜ê²Œ: ê¸°ë³¸ í‘œì‹œ(ë‚´ìš© ì—†ìœ¼ë©´ ìë™ ìˆ¨ê¹€ ì²˜ë¦¬) -->
          <button id="descMoreBtn" type="button"
            class="btn-3d px-4 py-2 text-[12px] sm:text-sm font-extrabold text-white bg-gradient-to-r from-indigo-500 via-purple-500 to-orange-400 hover:from-indigo-600 hover:via-purple-600 hover:to-orange-500">
            ë”ë³´ê¸° âœ¨
          </button>
        </header>

        <div id="desc"
          class="flex-1 text-sm sm:text-base leading-relaxed text-slate-800 whitespace-pre-line break-words desc-clamp">
          ë“±ë¡ëœ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.
        </div>

        <p class="text-[11px] text-slate-400 mt-3">â€» ì†Œê°œ ê¸€ì€ ì¶”í›„ ìˆ˜ì •ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </article>

    </section>
  </main>

  <!-- ê³µí†µ í‘¸í„° -->
  <div id="footer"></div>

  <!-- âœ… ì†Œê°œ ëª¨ë‹¬ -->
  <div id="descModal" class="fixed inset-0 z-[999] hidden">
    <div id="descModalOverlay" class="absolute inset-0 bg-slate-900/45 backdrop-blur-sm modal-fade-in"></div>

    <div class="relative w-full h-full flex items-center justify-center p-4 sm:p-6">
      <div class="w-full max-w-3xl rounded-3xl border border-white/60 shadow-2xl modal-pop-in"
        style="background: rgba(255,255,255,0.9); backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px);">

        <div class="px-5 sm:px-7 pt-5 sm:pt-6 pb-4 border-b border-slate-200/60 rounded-t-3xl"
          style="background: radial-gradient(circle at top left, rgba(99,102,241,0.18), rgba(168,85,247,0.12) 35%, rgba(251,146,60,0.10) 70%, rgba(255,255,255,0.0));">
          <div class="flex items-start justify-between gap-3">
            <div>
              <p class="text-xs font-black uppercase tracking-wider text-indigo-500">OPEN SOON</p>
              <h3 class="mt-1 text-xl sm:text-2xl font-extrabold title-grad flex items-center gap-2">
                <span class="text-2xl">ğŸ“</span><span>ê°€ê²Œ ì†Œê°œ</span>
              </h3>
              <p class="mt-1 text-sm text-slate-500">
                <span id="modalStoreName" class="font-semibold text-slate-700">-</span>
                <span class="mx-1 text-slate-300">â€¢</span>
                <span>ì „ì²´ ë‚´ìš©</span>
              </p>
            </div>

            <button id="descModalCloseBtn" type="button"
              class="btn-3d w-10 h-10 flex items-center justify-center bg-white/90 border border-slate-200 hover:bg-slate-50 text-slate-700">
              âœ•
            </button>
          </div>
        </div>

        <div class="px-5 sm:px-7 py-5">
          <div class="rounded-2xl border border-slate-200 bg-white/70 p-4 sm:p-5">
            <!-- âœ… ê¸¸ë©´ ìŠ¤í¬ë¡¤ + ìŠ¤í¬ë¡¤ë°” ê°•ì œ í‘œì‹œ -->
            <div id="modalDesc"
              class="force-scrollbar text-sm sm:text-base leading-relaxed text-slate-800 whitespace-pre-line break-words"
              style="max-height: 60vh;">
              -
            </div>
          </div>
        </div>

        <div class="px-5 sm:px-7 pb-5 sm:pb-6 flex items-center justify-end gap-2">
          <button id="descModalOkBtn" type="button"
            class="btn-3d px-5 py-2.5 text-sm font-extrabold text-white bg-gradient-to-r from-sky-500 to-indigo-500 hover:from-sky-600 hover:to-indigo-600">
            ë‹«ê¸°
          </button>
        </div>

      </div>
    </div>
  </div>

  <script>
    // âœ… í—¤ë”/í‘¸í„°
    fetch('/components/header.html').then(r => r.text()).then(html => {
      const el = document.getElementById('header');
      if (el) el.innerHTML = html;
    }).catch(() => { });

    fetch('/components/footer.html').then(r => r.text()).then(html => {
      const el = document.getElementById('footer');
      if (el) el.innerHTML = html;
    }).catch(() => { });

    // âœ… ëª¨ë‹¬ ì—´ê³ /ë‹«ê¸°(ì´ë²¤íŠ¸ ìœ„ì„ìœ¼ë¡œ "ë¬´ì¡°ê±´ ë™ì‘" ë³´ì¥)
    function openDescModal() {
      const modal = document.getElementById('descModal');
      if (!modal) return;
      modal.classList.remove('hidden');
      document.documentElement.style.overflow = 'hidden';
      document.body.style.overflow = 'hidden';
    }

    function closeDescModal() {
      const modal = document.getElementById('descModal');
      if (!modal) return;
      modal.classList.add('hidden');
      document.documentElement.style.overflow = '';
      document.body.style.overflow = '';
    }

    document.addEventListener('click', (e) => {
      if (e.target.closest('#descMoreBtn')) openDescModal();
      if (e.target.closest('#descModalOverlay')) closeDescModal();
      if (e.target.closest('#descModalCloseBtn')) closeDescModal();
      if (e.target.closest('#descModalOkBtn')) closeDescModal();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeDescModal();
    });

    // âœ… ë°ì´í„° ë¡œë“œ
    function qs(name) { return new URLSearchParams(location.search).get(name); }

    async function fetchJson(url) {
      const res = await fetch(url, { cache: 'no-store' });
      const text = await res.text();
      let json = null;
      try { json = JSON.parse(text); } catch { }
      if (!res.ok) throw new Error(`HTTP ${res.status}\n${text.slice(0, 120)}`);
      return json ?? {};
    }

    // Kakao ì§€ë„
    let map, marker, geocoder;

    function initMap(centerLatLng) {
      const container = document.getElementById('map');
      map = new kakao.maps.Map(container, { center: centerLatLng, level: 3 });
      marker = new kakao.maps.Marker({ map, position: centerLatLng });
      geocoder = new kakao.maps.services.Geocoder();
    }

    function updateMapByAddress(address, storeName) {
      if (!geocoder) geocoder = new kakao.maps.services.Geocoder();

      geocoder.addressSearch(address, function (result, status) {
        if (status === kakao.maps.services.Status.OK && result.length > 0) {
          const lat = parseFloat(result[0].y);
          const lng = parseFloat(result[0].x);
          const loc = new kakao.maps.LatLng(lat, lng);
          map.setCenter(loc);
          marker.setPosition(loc);

          const dir = document.getElementById('kakaoDirBtn');
          const label = encodeURIComponent(storeName || 'ëª©ì ì§€');
          dir.href = `https://map.kakao.com/link/to/${label},${lat},${lng}`;
        } else {
          // ì‹¤íŒ¨ ì‹œ ê²€ìƒ‰ ë§í¬ë¡œ í´ë°±
          const dir = document.getElementById('kakaoDirBtn');
          dir.href = `https://map.kakao.com/link/search/${encodeURIComponent(address)}`;
        }
      });
    }

    function htmlToText(html) {
      if (!html) return '';
      const tmp = document.createElement('div');
      tmp.innerHTML = html;
      return (tmp.textContent || tmp.innerText || '').trim();
    }

    async function main() {
      const id = qs('id');
      if (!id) {
        alert('idê°€ ì—†ìŠµë‹ˆë‹¤.');
        location.href = '/open.html';
        return;
      }

      const api = `/api/open/${id}`;
      const payload = await fetchJson(api);
      const row = payload.data || payload;

      const storeName = row.store_name || 'ìƒí˜¸ëª… ë¯¸ì •';

      document.getElementById('heroName').textContent = storeName;
      document.getElementById('storeName').textContent = storeName;

      // ë‚ ì§œ
      let openText = row.open_date || '-';
      try {
        if (row.open_date) openText = new Date(row.open_date).toLocaleDateString('ko-KR');
      } catch { }
      document.getElementById('openDate').textContent = openText;

      document.getElementById('category').textContent = row.category || '-';

      const phone = row.phone || '';
      document.getElementById('phone').textContent = phone || '-';
      const phoneLink = document.getElementById('phoneLink');
      phoneLink.href = phone ? `tel:${phone.replace(/[^\d+]/g, '')}` : '#';

      const addr = (row.address || '').trim();
      document.getElementById('addressText').textContent = addr || '-';

      // ì´ë¯¸ì§€
      const img = row.image_path || '/uploads/no-thumb.png';
      document.getElementById('storeImage').src = img;

      // ì†Œê°œ(ë¯¸ë¦¬ë³´ê¸° + ëª¨ë‹¬)
      const descText = htmlToText(row.description || '');
      const descEl = document.getElementById('desc');
      const moreBtn = document.getElementById('descMoreBtn');

      if (!descText) {
        descEl.classList.remove('desc-clamp');
        descEl.textContent = 'ë“±ë¡ëœ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.';
        moreBtn.classList.add('hidden'); // ë‚´ìš© ì—†ìœ¼ë©´ ë”ë³´ê¸° ìˆ¨ê¹€
        document.getElementById('modalDesc').textContent = 'ë“±ë¡ëœ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.';
      } else {
        descEl.classList.add('desc-clamp'); // ê¸°ë³¸ ë°•ìŠ¤ëŠ” ë¯¸ë¦¬ë³´ê¸° ìœ ì§€
        descEl.textContent = descText;
        moreBtn.classList.remove('hidden'); // âœ… ë‚´ìš© ìˆìœ¼ë©´ ë”ë³´ê¸° ë¬´ì¡°ê±´ ë…¸ì¶œ
        document.getElementById('modalDesc').textContent = descText;
      }

      document.getElementById('modalStoreName').textContent = storeName;

      // ì§€ë„
      if (!window.kakao || !kakao.maps || !kakao.maps.load) return;
      kakao.maps.load(function () {
        // ê¸°ë³¸ ì„¼í„°
        const center = new kakao.maps.LatLng(37.5665, 126.9780);
        initMap(center);
        if (addr && addr !== '-') updateMapByAddress(addr, storeName);
        else document.getElementById('kakaoDirBtn').href = 'https://map.kakao.com/';
      });
    }

    main().catch((e) => {
      console.error('open detail error:', e);
      // ì—¬ê¸°ì„œ redirectí•˜ì§€ ì•Šê³ , í™”ë©´ì€ ìœ ì§€(ëª¨ë‹¬/ë²„íŠ¼ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥)
    });
  </script>

</body>

</html>
