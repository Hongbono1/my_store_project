<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê´‘ê³  í˜ì´ì§€ | í™ë³´ì˜ ì¶”ì²œ</title>
    <meta name="color-scheme" content="light" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --card-r: 22px;
            --shadow-soft: 0 10px 30px rgba(0, 0, 0, .06);
            --border: rgba(0, 0, 0, .06);
        }

        .card {
            background: rgba(255, 255, 255, .8);
            border: 1px solid var(--border);
            border-radius: var(--card-r);
            box-shadow: var(--shadow-soft);
            backdrop-filter: blur(10px);
            transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 14px 42px rgba(0, 0, 0, .10);
            border-color: rgba(0, 0, 0, .08);
        }

        .btn-3d {
            box-shadow: 0 8px 20px rgba(0, 0, 0, .08);
            transition: transform .15s ease, box-shadow .2s ease;
            border-radius: 9999px;
        }

        .btn-3d:hover {
            box-shadow: 0 12px 26px rgba(0, 0, 0, .12);
            transform: translateY(-1px);
        }

        .btn-3d:active {
            transform: translateY(0);
            box-shadow: 0 6px 16px rgba(0, 0, 0, .08);
        }

        .btn-white {
            background: #fff;
            color: #111827;
            border: 1px solid var(--border);
        }

        .mood-btn {
            font-weight: 600;
            padding: .75rem 1.25rem;
        }

        .mood-btn.active {
            background: #111827;
            color: #fff;
            border-color: #111827;
        }

        .title-gradient {
            background: linear-gradient(90deg, #111, #6b7280 70%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .slider-item {
            min-width: 240px;
            max-width: 240px;
        }

        @media (min-width:1024px) {
            .masonry {
                column-count: 2;
                column-gap: 2rem;
            }

            .masonry>.card {
                display: inline-block;
                width: 100%;
                margin: 0 0 2rem;
            }
        }
    </style>
</head>

<body class="bg-white text-gray-900 antialiased">
    <!-- Header -->
    <div id="header"></div>

    <!-- Hero -->
    <section class="max-w-6xl mx-auto px-5 sm:px-8 pt-10 pb-4 text-center">
        <h1 class="text-4xl sm:text-5xl font-extrabold title-gradient tracking-tight">í™ë³´ì˜ ì¶”ì²œ</h1>
        <p class="text-gray-600 mt-3 sm:mt-4 leading-relaxed">
            í™ë³´ê°€ íë ˆì´ì…˜í•œ ìš°ë¦¬ ë™ë„¤ Hot Placeë¥¼ ë‹´ë°±í•˜ê³  ì‚°ëœ»í•˜ê²Œ.
        </p>
    </section>

    <!-- ğŸ† Top 4 -->
    <section class="relative max-w-screen-xl mx-auto px-5 sm:px-8 py-10">
        <div class="mb-8 text-center">
            <h3 class="text-2xl sm:text-3xl font-extrabold text-gray-900">ğŸ† ì˜¤ëŠ˜ì˜ Top 4</h3>
        </div>
        <div id="suggest-top4" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 sm:gap-8">
            <!-- JSì—ì„œ ì¹´ë“œ ì‚½ì… -->
        </div>
    </section>

    <!-- ğŸ˜‹ ê¸°ë¶„/ìƒí™©ë³„ ì¶”ì²œ -->
    <section class="max-w-6xl mx-auto px-5 sm:px-8 py-10">
        <h2 class="text-2xl sm:text-3xl font-bold text-center mb-8 text-gray-900">
            ğŸ˜‹ ì˜¤ëŠ˜ ê¸°ë¶„/ìƒí™©ì— ë”°ë¼ ì¶”ì²œ
        </h2>
        <div class="flex flex-wrap justify-center gap-2 sm:gap-3 mb-8">
            <button class="mood-btn btn-3d btn-white" data-mood="ì „ì²´">ì „ì²´</button>
            <button class="mood-btn btn-3d btn-white" data-mood="í•´ì¥ í•„ìš”">í•´ì¥ í•„ìš”</button>
            <button class="mood-btn btn-3d btn-white" data-mood="ê¸°ë¶„ ì¢‹ìŒ">ê¸°ë¶„ ì¢‹ìŒ</button>
            <button class="mood-btn btn-3d btn-white" data-mood="í”¼ê³¤í•¨">í”¼ê³¤í•¨</button>
            <button class="mood-btn btn-3d btn-white" data-mood="ë°ì´íŠ¸">ë°ì´íŠ¸</button>
            <button class="mood-btn btn-3d btn-white" data-mood="ê°€ì¡± ëª¨ì„">ê°€ì¡± ëª¨ì„</button>
            <button class="mood-btn btn-3d btn-white" data-mood="ìš°ìš¸í•  ë•Œ">ìš°ìš¸í•  ë•Œ</button>
            <button class="mood-btn btn-3d btn-white" data-mood="íšŒì‹ ìë¦¬">íšŒì‹ ìë¦¬</button>
            <button class="mood-btn btn-3d btn-white" data-mood="ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì„ ë•Œ">ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì„ ë•Œ</button>
            <button class="mood-btn btn-3d btn-white" data-mood="ì¶•í•˜/íŒŒí‹°">ì¶•í•˜/íŒŒí‹°</button>
            <button class="mood-btn btn-3d btn-white" data-mood="ìš´ë™ í›„">ìš´ë™ í›„</button>
            <button class="mood-btn btn-3d btn-white" data-mood="ë¹„ ì˜¤ëŠ” ë‚ ">ë¹„ ì˜¤ëŠ” ë‚ </button>
            <button class="mood-btn btn-3d btn-white" data-mood="í˜¼ë°¥í•  ë•Œ">í˜¼ë°¥í•  ë•Œ</button>
        </div>

        <!-- ê´‘ê³  ì¹´ë“œ ê·¸ë¦¬ë“œ -->
        <div id="mood-grid"
            class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 sm:gap-8 max-w-screen-xl mx-auto px-5 sm:px-8">
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ -->
        <div class="flex justify-center gap-3 sm:gap-4 mt-8">
            <button id="prevPage"
                class="px-4 py-2 rounded-full border border-gray-200 hover:bg-gray-50 transition disabled:opacity-50 disabled:cursor-not-allowed">ì´ì „</button>
            <span id="pageInfo" class="px-4 py-2 text-gray-600"></span>
            <button id="nextPage"
                class="px-4 py-2 rounded-full border border-gray-200 hover:bg-gray-50 transition disabled:opacity-50 disabled:cursor-not-allowed">ë‹¤ìŒ</button>
        </div>
    </section>

    <!-- ìš°ì¸¡ í•˜ë‹¨ ê³ ì • ë„¤ë¹„ -->
    <div class="fixed bottom-6 right-6 flex flex-col items-center gap-4 z-50">
        <div class="flex flex-col items-center">
            <button onclick="goBack()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gray-100 text-gray-800 border border-gray-200 shadow hover:bg-gray-50 transition">â†</button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">ì´ì „</span>
        </div>
        <div class="flex flex-col items-center">
            <button onclick="goNext()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gray-100 text-gray-800 border border-gray-200 shadow hover:bg-gray-50 transition">â†’</button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">ë‹¤ìŒ</span>
        </div>
        <div class="flex flex-col items-center">
            <a href="/index.html"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-blue-600 text-white shadow hover:bg-blue-700 transition">ğŸ </a>
            <span class="text-xs mt-1 text-gray-600 font-semibold">í™ˆ</span>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer"></div>

    <!-- ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // í—¤ë”/í‘¸í„° ë¶ˆëŸ¬ì˜¤ê¸°
        fetch('/components/header.html')
            .then(r => r.text()).then(d => document.getElementById('header').innerHTML = d);
        fetch('/components/footer.html')
            .then(r => r.text()).then(d => document.getElementById('footer').innerHTML = d);

        // ==========================
        // ğŸ† ì˜¤ëŠ˜ì˜ Top 4 (í´ë¦­ ìˆ˜ ê¸°ì¤€)
        // ==========================
        async function loadTop4() {
            const top4Container = document.getElementById("suggest-top4");
            if (!top4Container) return;

            try {
                const res = await fetch("/api/suggest/top4");
                const json = await res.json();

                console.log("ğŸ† Top4 ì‘ë‹µ:", json);

                top4Container.innerHTML = "";

                if (!json.ok || !Array.isArray(json.data) || json.data.length === 0) {
                    top4Container.innerHTML = `
          <p class="text-gray-400 text-center col-span-4 py-10">
            ì•„ì§ Top4 ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.
          </p>
        `;
                    return;
                }

                json.data.forEach((item, idx) => {
                    const menuName = item.name || "ë©”ë‰´ëª… ì—†ìŒ";
                    const storeName = item.store_name || "ê°€ê²Œ ì •ë³´ ì—†ìŒ";
                    const img = item.image_url || "/uploads/default.jpg";
                    // âœ… ndetail + type=food
                    const detailUrl = `/ndetail.html?id=${item.store_id}&type=food`;
                    const rank = idx + 1;

                    const card = document.createElement("a");
                    card.href = detailUrl;
                    card.className =
                        "card block overflow-hidden hover:shadow-xl transition-transform hover:-translate-y-1";

                    card.innerHTML = `
          <div class="relative">
            <img src="${img}" alt="${menuName}" class="w-full h-40 object-cover">
            <span class="absolute left-3 top-3 inline-flex items-center px-3 py-1 text-xs font-semibold rounded-full bg-black/70 text-white">
              ${rank}ìœ„
            </span>
          </div>
          <div class="p-4 text-center">
            <h3 class="text-lg sm:text-xl font-bold mb-1">${menuName}</h3>
            <p class="text-sm sm:text-base text-gray-600">${storeName}</p>
          </div>
        `;
                    top4Container.appendChild(card);
                });
            } catch (err) {
                console.error("âŒ Top4 ë¡œë“œ ì˜¤ë¥˜:", err);
                const top4Container = document.getElementById("suggest-top4");
                if (top4Container) {
                    top4Container.innerHTML = `
          <p class="text-gray-400 text-center col-span-4 py-10">
            Top4 ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
          </p>
        `;
                }
            }
        }

        // ==========================
        // ğŸ˜‹ ì˜¤ëŠ˜ ê¸°ë¶„/ìƒí™©ë³„ ì¶”ì²œ + í˜ì´ì§€ë„¤ì´ì…˜
        // ==========================
        const buttons = document.querySelectorAll(".mood-btn");
        const container = document.getElementById("mood-grid");
        const prevPageBtn = document.getElementById("prevPage");
        const nextPageBtn = document.getElementById("nextPage");
        const pageInfoEl = document.getElementById("pageInfo");

        const PAGE_SIZE = 12;
        let currentPage = 1;
        let currentData = [];

        function renderPage() {
            container.innerHTML = "";

            if (!currentData || currentData.length === 0) {
                container.innerHTML = `
        <p class="text-gray-400 text-center py-10 col-span-full">ì¶”ì²œ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      `;
                if (prevPageBtn) prevPageBtn.disabled = true;
                if (nextPageBtn) nextPageBtn.disabled = true;
                if (pageInfoEl) pageInfoEl.textContent = "";
                return;
            }

            const totalPages = Math.max(1, Math.ceil(currentData.length / PAGE_SIZE));
            if (currentPage > totalPages) currentPage = totalPages;

            const start = (currentPage - 1) * PAGE_SIZE;
            const end = start + PAGE_SIZE;
            const slice = currentData.slice(start, end);

            slice.forEach(item => {
                const storeName = item.store_name || "ê°€ê²Œ ì •ë³´ ì—†ìŒ";
                const menuName = item.name || "ë©”ë‰´ëª… ì—†ìŒ";
                const img = item.image_url || "/uploads/default.jpg";
                // âœ… ndetail + type=food
                const detailUrl = `/ndetail.html?id=${item.store_id}&type=food`;

                const card = document.createElement("a");
                card.href = detailUrl;
                card.className =
                    "block bg-white rounded-xl shadow-md overflow-hidden hover:scale-105 transition cursor-pointer";

                card.innerHTML = `
        <img src="${img}" alt="${menuName}" class="w-full h-48 object-cover">
        <div class="p-4 flex flex-col items-center text-center">
          <h3 class="text-lg font-semibold mb-2">${menuName}</h3>
          <p class="text-gray-700 text-base font-medium mb-2">${storeName}</p>
          <span
            class="inline-block text-center bg-blue-500 text-white text-sm font-semibold px-4 py-1 rounded-lg mt-1">
            ìì„¸íˆ ë³´ê¸° â†’
          </span>
        </div>
      `;
                container.appendChild(card);
            });

            if (pageInfoEl) pageInfoEl.textContent = `${currentPage} / ${totalPages}`;
            if (prevPageBtn) prevPageBtn.disabled = (currentPage <= 1);
            if (nextPageBtn) nextPageBtn.disabled = (currentPage >= totalPages);
        }

        async function loadMood(moodText) {
            buttons.forEach(b => b.classList.remove("active"));
            const clicked = Array.from(buttons).find(b => b.dataset.mood === moodText);
            if (clicked) clicked.classList.add("active");

            let url = "/api/suggest";
            if (moodText && moodText !== "ì „ì²´") {
                url += `?mood=${encodeURIComponent(moodText)}`;
            }

            try {
                const res = await fetch(url);
                const data = await res.json();

                console.log("ğŸ¯ mood ê²°ê³¼:", data);
                if (data.ok && Array.isArray(data.data)) {
                    currentData = data.data;
                    currentPage = 1;
                    renderPage();
                } else {
                    currentData = [];
                    currentPage = 1;
                    renderPage();
                }
            } catch (err) {
                console.error("âŒ mood fetch ì˜¤ë¥˜:", err);
                currentData = [];
                currentPage = 1;
                renderPage();
            }
        }

        buttons.forEach(btn => {
            btn.addEventListener("click", () => {
                const mood = btn.dataset.mood;
                loadMood(mood);
            });
        });

        if (prevPageBtn) {
            prevPageBtn.addEventListener("click", () => {
                if (currentPage > 1) {
                    currentPage -= 1;
                    renderPage();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            });
        }

        if (nextPageBtn) {
            nextPageBtn.addEventListener("click", () => {
                const totalPages = Math.max(1, Math.ceil((currentData?.length || 0) / PAGE_SIZE));
                if (currentPage < totalPages) {
                    currentPage += 1;
                    renderPage();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            });
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ: Top4 ë¡œë“œ + "ì „ì²´" ìë™ í´ë¦­
        document.addEventListener("DOMContentLoaded", () => {
            loadTop4();

            const allBtn = document.querySelector('.mood-btn[data-mood="ì „ì²´"]');
            if (allBtn) allBtn.click();
        });

        // âœ… ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼
        function goBack() { window.history.back(); }
        function goNext() { window.history.forward(); }
    </script>

</body>

</html>