<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì§€ì—­ ê²Œì‹œê¸€ ìƒì„¸</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">

<div id="header"></div>

<div class="max-w-3xl mx-auto bg-white mt-10 p-6 rounded-2xl shadow-lg">

  <h1 id="title" class="text-3xl font-bold mb-2"></h1>
  <div id="info" class="text-gray-500 mb-4"></div>

  <div id="images" class="grid grid-cols-3 gap-3 my-4"></div>

  <div id="content" class="whitespace-pre-line mb-10 text-lg"></div>

  <div class="flex gap-4">
    <button onclick="report()" class="px-3 py-2 bg-red-500 text-white rounded-lg">ì‹ ê³ </button>
    <button onclick="toggleNotice()" class="px-3 py-2 bg-yellow-500 text-white rounded-lg">ê³µì§€</button>
    <button onclick="blockPost()" class="px-3 py-2 bg-gray-700 text-white rounded-lg">ì •ì§€</button>
  </div>

  <h2 class="text-xl font-bold mt-10 mb-3">ğŸ’¬ ëŒ“ê¸€</h2>

  <div id="comments" class="mb-5"></div>

  <div class="flex gap-2">
    <input id="commentWriter" class="border p-2 flex-1" placeholder="ì‘ì„±ì">
    <input id="commentText" class="border p-2 flex-1" placeholder="ëŒ“ê¸€ ë‚´ìš©">
    <button onclick="submitComment()" class="px-4 bg-indigo-600 text-white rounded-lg">ë“±ë¡</button>
  </div>

</div>

<div id="footer"></div>

<script>
fetch('components/header.html').then(r => r.text()).then(h => header.innerHTML = h);
fetch('components/footer.html').then(r => r.text()).then(f => footer.innerHTML = f);

const id = new URLSearchParams(location.search).get("id");

async function loadDetail() {
  const res = await fetch(`/api/localboard/${id}`);
  const post = await res.json();

  title.textContent = post.title;
  info.textContent = `${post.region} Â· ì¡°íšŒ ${post.views}`;

  images.innerHTML = post.images
    .map(img => `<img src="${img.image_url}" class="rounded-lg shadow">`)
    .join("");

  content.textContent = post.content;
}
loadDetail();

async function loadComments() {
  const res = await fetch(`/api/localboard/${id}/comments`);
  const data = await res.json();

  comments.innerHTML = data
    .map(c => `<div class="border-b py-2"><b>${c.writer}</b> ${c.comment}</div>`)
    .join("");
}
loadComments();

async function submitComment() {
  await fetch(`/api/localboard/${id}/comment`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      writer: commentWriter.value,
      comment: commentText.value
    })
  });

  commentWriter.value = "";
  commentText.value = "";
  loadComments();
}

async function report() {
  await fetch(`/api/localboard/${id}/report`, { method: "POST" });
  alert("ì‹ ê³ ë˜ì—ˆìŠµë‹ˆë‹¤.");
}

async function toggleNotice() {
  await fetch(`/api/localboard/${id}/notice`, { method: "POST" });
  alert("ê³µì§€ ì„¤ì •ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
}

async function blockPost() {
  await fetch(`/api/localboard/${id}/block`, { method: "POST" });
  alert("ê²Œì‹œê¸€ì´ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.");
}

</script>

</body>
</html>
