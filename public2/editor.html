<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì•ˆì •í˜• ì—ë””í„° (ë¦¬ì…‹-ë¯¸ë‹ˆ)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: Pretendard, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif
    }

    .editor {
      min-height: 360px
    }

    .editor:focus {
      outline: none
    }

    .btn {
      min-width: 2.25rem;
      height: 2.25rem
    }

    /* ë ˆì´ì•„ì›ƒ í”ë“¤ë¦¼ ë°©ì§€: outline ëŒ€ì‹  inset box-shadow */
    .btn.active {
      box-shadow: inset 0 0 0 2px rgb(59 130 246);
      background: #eff6ff
    }

    .swatch {
      width: 1.25rem;
      height: 1.25rem;
      border: 1px solid #e5e7eb;
      border-radius: .375rem
    }

    .sep {
      width: 1px;
      height: 1.75rem;
      background: #e5e7eb
    }
  </style>
</head>

<body class="bg-slate-50 min-h-screen">
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-xl font-bold mb-3">ì•ˆì •í˜• ì—ë””í„° (ë¦¬ì…‹-ë¯¸ë‹ˆ)</h1>

    <!-- Toolbar -->
    <div id="toolbar"
      class="sticky top-0 z-10 bg-white/80 backdrop-blur border rounded-xl shadow-sm p-2 flex flex-wrap items-center gap-2">
      <!-- í°íŠ¸/í¬ê¸° -->
      <div class="flex items-center gap-2">
        <label class="text-xs text-slate-500">ê¸€ê¼´</label>
        <div class="relative">
          <button id="fontNameBtn" class="h-9 px-3 border rounded-md bg-white hover:bg-slate-50 flex items-center gap-2">
            <span id="fontNameLabel">ê¸°ë³¸</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div id="fontNameMenu" class="absolute top-full left-0 mt-1 bg-white border rounded-md shadow-lg z-20 min-w-[160px] hidden">
            <button data-font="" class="w-full px-3 py-2 text-left hover:bg-slate-50 border-b border-slate-100">ê¸°ë³¸</button>
            <button data-font="Pretendard" class="w-full px-3 py-2 text-left hover:bg-slate-50 border-b border-slate-100" style="font-family: Pretendard">Pretendard</button>
            <button data-font="'Malgun Gothic'" class="w-full px-3 py-2 text-left hover:bg-slate-50 border-b border-slate-100" style="font-family: 'Malgun Gothic'">ë§‘ì€ ê³ ë”•</button>
            <button data-font="'Nanum Gothic'" class="w-full px-3 py-2 text-left hover:bg-slate-50 border-b border-slate-100" style="font-family: 'Nanum Gothic'">ë‚˜ëˆ”ê³ ë”•</button>
            <button data-font="Arial" class="w-full px-3 py-2 text-left hover:bg-slate-50 border-b border-slate-100" style="font-family: Arial">Arial</button>
            <button data-font="'Times New Roman'" class="w-full px-3 py-2 text-left hover:bg-slate-50" style="font-family: 'Times New Roman'">Times New Roman</button>
          </div>
        </div>
        <label class="text-xs text-slate-500">í¬ê¸°</label>
        <select id="fontSize" class="h-9 px-2 border rounded-md bg-white">
          <option value="3">ê¸°ë³¸(3)</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
        </select>
      </div>

      <div class="sep" aria-hidden="true"></div>

      <!-- B I U S -->
      <div class="flex items-center gap-2">
        <button data-cmd="bold" class="btn border rounded-md bg-white hover:bg-slate-50 font-bold">B</button>
        <button data-cmd="italic" class="btn border rounded-md bg-white hover:bg-slate-50 italic">I</button>
        <button data-cmd="underline" class="btn border rounded-md bg-white hover:bg-slate-50 underline">U</button>
        <button data-cmd="strikeThrough"
          class="btn border rounded-md bg-white hover:bg-slate-50 line-through">S</button>
      </div>

      <div class="sep" aria-hidden="true"></div>

      <!-- Align / list / indent -->
      <div class="flex items-center gap-2">
        <button data-cmd="justifyLeft" class="btn border rounded-md bg-white hover:bg-slate-50">âŸ¸</button>
        <button data-cmd="justifyCenter" class="btn border rounded-md bg-white hover:bg-slate-50">â‡”</button>
        <button data-cmd="justifyRight" class="btn border rounded-md bg-white hover:bg-slate-50">âŸ¹</button>
        <button data-cmd="insertUnorderedList" class="btn border rounded-md bg-white hover:bg-slate-50">â€¢</button>
        <button data-cmd="insertOrderedList" class="btn border rounded-md bg-white hover:bg-slate-50">1.</button>
        <button data-cmd="outdent" class="btn border rounded-md bg-white hover:bg-slate-50">â‡¤</button>
        <button data-cmd="indent" class="btn border rounded-md bg-white hover:bg-slate-50">â‡¥</button>
      </div>

      <div class="sep" aria-hidden="true"></div>

      <!-- Color (simple palette) -->
      <div class="flex items-center gap-2">
        <span class="text-xs text-slate-500">ê¸€ì</span>
        <div id="forePalette" class="flex gap-1">
          <button class="swatch" data-fore="#111827" style="background:#111827" title="#111827"></button>
          <button class="swatch" data-fore="#ef4444" style="background:#ef4444"></button>
          <button class="swatch" data-fore="#f59e0b" style="background:#f59e0b"></button>
          <button class="swatch" data-fore="#10b981" style="background:#10b981"></button>
          <button class="swatch" data-fore="#3b82f6" style="background:#3b82f6"></button>
        </div>
        <span class="text-xs text-slate-500 ml-2">ë°°ê²½</span>
        <div id="backPalette" class="flex gap-1">
          <button class="swatch" data-back="#ffffff" style="background:#ffffff"></button>
          <button class="swatch" data-back="#fef3c7" style="background:#fef3c7"></button>
          <button class="swatch" data-back="#fee2e2" style="background:#fee2e2"></button>
          <button class="swatch" data-back="#dcfce7" style="background:#dcfce7"></button>
          <button class="swatch" data-back="#e0e7ff" style="background:#e0e7ff"></button>
        </div>
      </div>

      <div class="ml-auto flex items-center gap-2">
        <button id="linkBtn" class="btn border rounded-md bg-white hover:bg-slate-50" title="ë§í¬">ğŸ”—</button>
        <button id="clearBtn" class="btn border rounded-md bg-white hover:bg-slate-50" title="ì„œì‹ì œê±°">âš</button>
        <button id="undoBtn" class="btn border rounded-md bg-white hover:bg-slate-50" title="ë˜ëŒë¦¬ê¸°">â†¶</button>
        <button id="redoBtn" class="btn border rounded-md bg-white hover:bg-slate-50" title="ë‹¤ì‹œí•˜ê¸°">â†·</button>
      </div>
    </div>

    <!-- Editor -->
    <div id="editor" class="editor bg-white border rounded-xl shadow-sm p-4 mt-3" contenteditable="true">
      <p>ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”. (Ctrl/âŒ˜+B/U/I ì§€ì›, ì„œì‹ í† ê¸€ ìƒíƒœ ìœ ì§€)</p>
    </div>

    <div id="status" class="mt-2 text-xs text-slate-500">Ready</div>
  </div>

  <script>
    (function () {
      const editor = document.getElementById('editor');
      const toolbar = document.getElementById('toolbar');
      const status = document.getElementById('status');
      const fontNameBtn = document.getElementById('fontNameBtn');
      const fontNameMenu = document.getElementById('fontNameMenu');
      const fontNameLabel = document.getElementById('fontNameLabel');
      const fontSize = document.getElementById('fontSize');

      // CSS ì¸ë¼ì¸ ì ìš© ê°•ì œ
      try { document.execCommand('styleWithCSS', false, true); } catch (_) { }

      // === Selection Keeper (íˆ´ë°” í´ë¦­ì—ë„ ì„ íƒ ìœ ì§€) ===
      let savedRange = null;
      function saveSelection() {
        const sel = window.getSelection();
        if (!sel.rangeCount) return;
        savedRange = sel.getRangeAt(0);
      }
      function restoreSelection() {
        if (!savedRange) return;
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(savedRange);
      }
      editor.addEventListener('keyup', saveSelection);
      editor.addEventListener('mouseup', saveSelection);
      document.addEventListener('selectionchange', () => {
        if (document.activeElement === editor || editor.contains(document.activeElement)) {
          saveSelection();
          updateState();
        }
      });

      // íˆ´ë°”ê°€ í¬ì»¤ìŠ¤ë¥¼ ëºì§€ ì•Šë„ë¡
      toolbar.addEventListener('mousedown', (e) => {
        const t = e.target.closest('button,select');
        if (!t) return;
        e.preventDefault();
        restoreSelection();
      });

      // ê³µí†µ ëª…ë ¹
      function doCmd(cmd, value = null) {
        restoreSelection();
        document.execCommand(cmd, false, value);
        updateState();
        editor.focus();
      }

      // ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬
      toolbar.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;

        const cmd = btn.dataset.cmd;
        if (cmd) { doCmd(cmd); return; }

        if (btn.id === 'linkBtn') {
          const url = prompt('ë§í¬ URL', 'https://');
          if (url) doCmd('createLink', url);
          return;
        }
        if (btn.id === 'clearBtn') {
          doCmd('removeFormat'); doCmd('unlink');
          return;
        }
        if (btn.id === 'undoBtn') { doCmd('undo'); return; }
        if (btn.id === 'redoBtn') { doCmd('redo'); return; }
      });

      // íŒ”ë ˆíŠ¸ (ê¸€ì/ë°°ê²½)
      document.getElementById('forePalette').addEventListener('click', (e) => {
        const color = e.target.getAttribute('data-fore');
        if (!color) return;
        applyInlineStyle('color', color);
      });
      document.getElementById('backPalette').addEventListener('click', (e) => {
        const color = e.target.getAttribute('data-back');
        if (!color) return;
        applyInlineStyle('backgroundColor', color);
      });

      // ê¸€ê¼´ ë²„íŠ¼ ë“œë¡­ë‹¤ìš´
      fontNameBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        fontNameMenu.classList.toggle('hidden');
      });

      // ê¸€ê¼´ ë©”ë‰´ í•­ëª© í´ë¦­
      fontNameMenu.addEventListener('click', (e) => {
        const fontBtn = e.target.closest('[data-font]');
        if (!fontBtn) return;
        
        const fontValue = fontBtn.getAttribute('data-font');
        const fontDisplay = fontBtn.textContent;
        
        // ë¼ë²¨ ì—…ë°ì´íŠ¸
        fontNameLabel.textContent = fontDisplay;
        
        // ê¸€ê¼´ ì ìš©
        if (fontValue) {
          try { doCmd('fontName', fontValue); } 
          finally { applyInlineStyle('fontFamily', fontValue, true); }
        } else {
          // ê¸°ë³¸ ê¸€ê¼´ë¡œ ë¦¬ì…‹
          try { doCmd('removeFormat'); }
          finally { applyInlineStyle('fontFamily', null, true); }
        }
        
        // ë©”ë‰´ ë‹«ê¸°
        fontNameMenu.classList.add('hidden');
      });

      // ë©”ë‰´ ë°”ê¹¥ í´ë¦­ì‹œ ë‹«ê¸°
      document.addEventListener('click', () => {
        fontNameMenu.classList.add('hidden');
      });
      fontSize.addEventListener('change', (e) => {
        const v = e.target.value;
        try { doCmd('fontSize', v); } finally { /* ë¸Œë¼ìš°ì €ë³„ <font size> ì²˜ë¦¬ ê·¸ëŒ€ë¡œ í—ˆìš© */ }
      });

      // ë‹¨ì¶•í‚¤ Ctrl/âŒ˜ + B/I/U
      editor.addEventListener('keydown', (e) => {
        const meta = e.ctrlKey || e.metaKey;
        if (!meta) return;
        const k = e.key.toLowerCase();
        if (k === 'b') { e.preventDefault(); doCmd('bold'); }
        if (k === 'i') { e.preventDefault(); doCmd('italic'); }
        if (k === 'u') { e.preventDefault(); doCmd('underline'); }
      });

      // ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì ìš©(ì„ íƒ ì˜ì—­ì— span ë˜í•‘)
      function applyInlineStyle(prop, value, allowNull) {
        restoreSelection();
        const sel = window.getSelection();
        if (!sel.rangeCount) return;
        const range = sel.getRangeAt(0);
        if (range.collapsed) return;

        // ê¸°ì¡´ ë‚´ìš© ì¶”ì¶œ â†’ spanì— ë„£ê³  ìŠ¤íƒ€ì¼ ì ìš© â†’ ë‹¤ì‹œ ì‚½ì…
        const frag = range.extractContents();
        const span = document.createElement('span');
        if (value || allowNull) {
          if (value) span.style[prop] = value;
        }
        span.appendChild(frag);
        range.insertNode(span);

        // ì»¤ì„œ ë’¤ë¡œ ì´ë™
        sel.removeAllRanges();
        const r = document.createRange();
        r.selectNodeContents(span);
        r.collapse(false);
        sel.addRange(r);
        saveSelection();
        updateState();
        editor.focus();
      }

      // ìƒíƒœ/í† ê¸€ ì—…ë°ì´íŠ¸
      function updateState() {
        const map = {
          bold: document.queryCommandState('bold'),
          italic: document.queryCommandState('italic'),
          underline: document.queryCommandState('underline'),
          strikeThrough: document.queryCommandState('strikeThrough'),
          justifyLeft: document.queryCommandState('justifyLeft'),
          justifyCenter: document.queryCommandState('justifyCenter'),
          justifyRight: document.queryCommandState('justifyRight'),
          insertOrderedList: document.queryCommandState('insertOrderedList'),
          insertUnorderedList: document.queryCommandState('insertUnorderedList'),
        };
        toolbar.querySelectorAll('[data-cmd]').forEach(btn => {
          const c = btn.dataset.cmd;
          if (map[c]) btn.classList.add('active'); else btn.classList.remove('active');
        });
        status.textContent =
          `B:${map.bold ? 'on' : 'off'} I:${map.italic ? 'on' : 'off'} U:${map.underline ? 'on' : 'off'} Â· L:${map.justifyLeft ? 'on' : 'off'} C:${map.justifyCenter ? 'on' : 'off'} R:${map.justifyRight ? 'on' : 'off'}`;
      }

      // ì´ˆê¸°í™”
      editor.focus();
      saveSelection();
      updateState();
    })();
  </script>
</body>

</html>