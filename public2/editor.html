<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì•ˆì •í˜• í…ìŠ¤íŠ¸ ì—ë””í„° | MALL HANKOOK</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: Pretendard, system-ui, sans-serif;
    }

    .editor-toolbar button {
      @apply w-10 h-10 flex items-center justify-center border rounded-md bg-white shadow-sm hover:bg-gray-100 transition;
    }

    .editor-toolbar button.active {
      background-color: #2563eb;
      /* íŒŒë‘ */
      color: white;
    }

    .editor-area {
      min-height: 250px;
      border: 1px solid #ddd;
      border-radius: 0.5rem;
      padding: 1rem;
      background: white;
      overflow-y: auto;
    }

    .editor-area img {
      max-width: 100%;
      margin: 0.5rem 0;
    }
  </style>
</head>

<body class="bg-slate-50 text-gray-800 p-6">
  <div class="max-w-3xl mx-auto bg-white p-5 rounded-lg shadow">
    <h1 class="text-2xl font-semibold mb-4 text-center">ì•ˆì •í˜• í…ìŠ¤íŠ¸ ì—ë””í„°</h1>

    <!-- íˆ´ë°” -->
    <div
      class="editor-toolbar flex flex-wrap items-center justify-center gap-4 mb-4 border p-3 rounded bg-gray-50 shadow-sm">
      <button id="boldBtn" title="êµµê²Œ"><span class="font-bold text-lg">B</span></button>
      <button id="underlineBtn" title="ë°‘ì¤„"><span class="underline text-lg">U</span></button>

      <div class="border-l h-6"></div>

      <select id="fontSizeSelect" class="border rounded px-2 py-1 text-sm">
        <option value="">ê¸€ì í¬ê¸°</option>
        <option value="14px">ì‘ê²Œ</option>
        <option value="16px">ë³´í†µ</option>
        <option value="20px">í¬ê²Œ</option>
        <option value="26px">ì•„ì£¼ í¬ê²Œ</option>
      </select>

      <input type="color" id="fontColor" class="border rounded w-8 h-8 p-0 cursor-pointer" title="ê¸€ì ìƒ‰ìƒ ì„ íƒ" />

      <div class="border-l h-6"></div>

      <label
        class="flex items-center gap-1 cursor-pointer bg-gray-100 border px-3 py-2 rounded-md hover:bg-gray-200 shadow-sm">
        <input id="imageInput" type="file" accept="image/*" hidden />
        <span>ğŸ–¼ ì´ë¯¸ì§€ ì‚½ì…</span>
      </label>

      <div class="flex items-center gap-2">
        <span class="text-xs text-gray-600">ë¬¸ë‹¨</span>
        <button data-textalign="left" title="ë¬¸ë‹¨ ì™¼ìª½ ì •ë ¬">â¬…ï¸</button>
        <button data-textalign="center" title="ë¬¸ë‹¨ ê°€ìš´ë° ì •ë ¬">â†”ï¸</button>
        <button data-textalign="right" title="ë¬¸ë‹¨ ì˜¤ë¥¸ìª½ ì •ë ¬">â¡ï¸</button>
      </div>

      <div class="border-l h-6"></div>

      <!-- ì´ë¯¸ì§€ ì •ë ¬ ì „ìš© ê·¸ë£¹ (ìƒˆë¡œ ì¶”ê°€) -->
      <div class="flex items-center gap-2">
        <span class="text-xs text-gray-600">ì´ë¯¸ì§€</span>
        <button data-imgalign="left" title="ì´ë¯¸ì§€ ì™¼ìª½ ì •ë ¬" class="w-8 h-8 flex items-center justify-center border rounded-md bg-white hover:bg-gray-100 shadow-sm">â¬…ï¸</button>
        <button data-imgalign="center" title="ì´ë¯¸ì§€ ê°€ìš´ë° ì •ë ¬" class="w-8 h-8 flex items-center justify-center border rounded-md bg-white hover:bg-gray-100 shadow-sm">â†”ï¸</button>
        <button data-imgalign="right" title="ì´ë¯¸ì§€ ì˜¤ë¥¸ìª½ ì •ë ¬" class="w-8 h-8 flex items-center justify-center border rounded-md bg-white hover:bg-gray-100 shadow-sm">â¡ï¸</button>
      </div>
    </div>

    <!-- ì—ë””í„° -->
    <div id="editor" class="editor-area" contenteditable="true" spellcheck="true">
    </div>

    <button id="saveBtn" class="mt-4 bg-indigo-600 text-white px-4 py-2 rounded">ì €ì¥</button>
    <textarea id="result" class="w-full mt-3 border rounded p-2 text-sm" rows="5"
      placeholder="ì €ì¥ëœ HTML ë¯¸ë¦¬ë³´ê¸°"></textarea>
  </div>

  <script>

    const editor = document.getElementById("editor");

    // 1) íˆ´ë°” í´ë¦­ ì‹œ ë²„íŠ¼ì— í•œí•´ì„œë§Œ í¬ì»¤ìŠ¤ ì´ë™ ë°©ì§€
    const toolbar = document.querySelector('.editor-toolbar');
    toolbar.addEventListener('mousedown', (e) => {
      const btn = e.target.closest('button');
      if (btn) e.preventDefault(); // select, input[color]ì—ëŠ” ì ìš© X
    });

    // 2) Selectionì´ ì—ë””í„° ë‚´ë¶€ì¼ ë•Œë§Œ ì €ì¥/ë³µì›
    // ì—ë””í„° ë‚´ë¶€ì¸ì§€ íŒë³„
    function isInEditor(node) {
      if (!node) return false;
      return node === editor || editor.contains(node);
    }

    // ì»¤ì„œ ì €ì¥
    let savedRange = null;
    function saveSelection() {
      const sel = window.getSelection();
      if (sel.rangeCount > 0) {
        const r = sel.getRangeAt(0);
        if (isInEditor(r.commonAncestorContainer)) {
          savedRange = r.cloneRange();
        }
      }
    }

    // ì»¤ì„œ ë³µì› (ì‹¤íŒ¨ ì‹œ ì—ë””í„° ëìœ¼ë¡œ ì´ë™)
    function restoreSelection() {
      const sel = window.getSelection();
      if (savedRange && isInEditor(savedRange.commonAncestorContainer)) {
        sel.removeAllRanges();
        sel.addRange(savedRange);
        return true;
      }
      placeCaretAtEnd(editor);
      return false;
    }

    function placeCaretAtEnd(el) {
      el.focus();
      const r = document.createRange();
      r.selectNodeContents(el);
      r.collapse(false);
      const s = window.getSelection();
      s.removeAllRanges();
      s.addRange(r);
      savedRange = r.cloneRange();
    }

    // selection ë³€í™” ì¶”ì  (íˆ´ë°” í´ë¦­ ì¤‘ì—ë„ ìµœì‹  Range ìœ ì§€)
    document.addEventListener('selectionchange', () => {
      const sel = window.getSelection();
      // activeElementê°€ editorì´ê±°ë‚˜, selectionì´ editor ì•ˆì— ìˆì„ ë•Œì—ë§Œ ì €ì¥
      if (document.activeElement === editor || isInEditor(sel.anchorNode)) {
        saveSelection();
      }
    });

    // ì—ë””í„° ì´ë²¤íŠ¸ì— ì €ì¥ ì¶”ê°€
    editor.addEventListener('keyup', saveSelection);
    editor.addEventListener('mouseup', saveSelection);
    editor.addEventListener('input', saveSelection);
    editor.addEventListener('focus', saveSelection);

    // ì´ˆê¸° í¬ì»¤ìŠ¤
    window.addEventListener('load', () => editor.focus());

    // 3) ì„ íƒì´ ì—†ì–´ë„(ì»¤ì„œë§Œ) ìŠ¤íƒ€ì¼ ì ìš©ë˜ê²Œ wrapSelection êµì²´
    function wrapSelection(styleObj = {}) {
      editor.focus();
      restoreSelection();

      const sel = window.getSelection();
      if (!sel.rangeCount) return;
      let range = sel.getRangeAt(0);

      // ì„ íƒì´ ì—†ì„ ë•Œ: ìŠ¤íƒ€ì¼ spanì„ ë§Œë“¤ê³  ì»¤ì„œë¥¼ ê·¸ ì•ˆìœ¼ë¡œ ì´ë™
      if (range.collapsed) {
        const span = document.createElement('span');
        Object.assign(span.style, styleObj);
        const zwsp = document.createTextNode('\u200B'); // zero-width space
        span.appendChild(zwsp);
        range.insertNode(span);

        // ì»¤ì„œë¥¼ span ë‚´ë¶€(zwsp ë’¤)ë¡œ ì´ë™ â†’ ì´í›„ íƒ€ì´í•‘ì— ìŠ¤íƒ€ì¼ ìœ ì§€
        range = document.createRange();
        range.setStart(zwsp, 1);
        range.collapse(true);
        sel.removeAllRanges();
        sel.addRange(range);
        savedRange = range.cloneRange();
        return;
      }

      // ì„ íƒì´ ìˆì„ ë•Œ: ì„ íƒ ë‚´ìš©ì„ ê°ì‹¸ê¸°
      const span = document.createElement('span');
      Object.assign(span.style, styleObj);
      const content = range.extractContents();
      span.appendChild(content);
      range.insertNode(span);

      // ì»¤ì„œë¥¼ span ë’¤ë¡œ ì´ë™
      range.setStartAfter(span);
      range.collapse(true);
      sel.removeAllRanges();
      sel.addRange(range);
      savedRange = range.cloneRange();
    }

    // ê¸€ì êµµê²Œ
    document.getElementById("boldBtn").addEventListener("click", () => {
      wrapSelection({ fontWeight: "bold" });
    });

    // ë°‘ì¤„ í† ê¸€: í˜„ì¬ ìœ„ì¹˜ê°€ ë°‘ì¤„ì´ë©´ í•´ì œ, ì•„ë‹ˆë©´ ì ìš©
    function isUnderlineActive() {
      const sel = window.getSelection();
      if (!sel.rangeCount) return false;
      const node = sel.anchorNode && (sel.anchorNode.nodeType === 1 ? sel.anchorNode : sel.anchorNode.parentElement);
      if (!node) return false;
      const el = node.closest('#editor *') || editor; // ì—ë””í„° ë‚´ë¶€ ê¸°ì¤€
      const cs = window.getComputedStyle(el);
      return cs.textDecorationLine.includes('underline');
    }

    document.getElementById("underlineBtn").addEventListener("click", () => {
      // ì„ íƒì´ ì—†ìœ¼ë©´ ì»¤ì„œë§Œ ìˆëŠ” ìë¦¬ ê¸°ì¤€ìœ¼ë¡œ í† ê¸€
      if (isUnderlineActive()) {
        // í•´ì œ: ìƒì†ëœ underlineì„ ìƒì‡„
        wrapSelection({ textDecoration: "none" });
      } else {
        wrapSelection({ textDecoration: "underline" });
      }
      editor.focus();
    });

    // 4) í°íŠ¸/ìƒ‰/ì´ë¯¸ì§€ ì ìš© ì „ì— ë°˜ë“œì‹œ ë³µì›
    document.getElementById('fontSizeSelect').addEventListener('change', (e) => {
      const size = e.target.value;
      if (size) wrapSelection({ fontSize: size });
      e.target.value = '';
      editor.focus();
    });

    document.getElementById('fontColor').addEventListener('input', (e) => {
      wrapSelection({ color: e.target.value });
      editor.focus();
    });

    const imageInput = document.getElementById('imageInput');
    imageInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      const img = document.createElement('img');
      img.src = url;
      img.alt = file.name;
      img.style.display = 'block';
      img.style.margin = 'auto';

      editor.focus();
      restoreSelection();
      const sel = window.getSelection();
      if (!sel.rangeCount) return;
      const range = sel.getRangeAt(0);
      range.insertNode(img);

      // ì»¤ì„œë¥¼ ì´ë¯¸ì§€ ë’¤ë¡œ
      range.setStartAfter(img);
      range.collapse(true);
      sel.removeAllRanges();
      sel.addRange(range);
      savedRange = range.cloneRange();
    });

    // ë¬¸ë‹¨ ì •ë ¬ ë¡œì§
    function closestBlock(node) {
      if (!node) return editor;
      let el = (node.nodeType === 1 ? node : node.parentElement);
      while (el && el !== editor) {
        const disp = window.getComputedStyle(el).display;
        if (disp === 'block' || disp === 'list-item' || el.tagName === 'P' || el.tagName === 'DIV') return el;
        el = el.parentElement;
      }
      return editor; // ëª» ì°¾ìœ¼ë©´ ì—ë””í„°ì— ì ìš©
    }

    document.querySelectorAll("[data-textalign]").forEach(btn => {
      btn.addEventListener("click", () => {
        editor.focus();
        restoreSelection();
        const sel = window.getSelection();
        if (!sel.rangeCount) return;
        const range = sel.getRangeAt(0);
        const block = closestBlock(range.startContainer);
        block.style.textAlign = btn.dataset.textalign; // 'left' | 'center' | 'right'
      });
    });

    // ì´ë¯¸ì§€ ì •ë ¬ ë¡œì§
    function getSelectedImage() {
      const sel = window.getSelection();
      if (!sel.rangeCount) return null;
      const node = sel.anchorNode;
      if (!node) return null;
      if (node.nodeType === 1 && node.tagName === 'IMG') return node;
      const el = (node.nodeType === 1 ? node : node.parentElement);
      return el ? el.closest('#editor img') : null;
    }

    document.querySelectorAll("[data-imgalign]").forEach(btn => {
      btn.addEventListener("click", () => {
        editor.focus();
        restoreSelection();
        const img = getSelectedImage();
        if (!img) return; // ì´ë¯¸ì§€ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ë‹¤ë©´ ë¬´ì‹œ

        const align = btn.dataset.imgalign;
        // float + margin ì¡°í•© (í…ìŠ¤íŠ¸ ê°ì‹¸ê¸° í¬í•¨)
        if (align === 'left') {
          img.style.display = 'inline-block';
          img.style.float = 'left';
          img.style.margin = '0 0.75rem 0.5rem 0';
        } else if (align === 'right') {
          img.style.display = 'inline-block';
          img.style.float = 'right';
          img.style.margin = '0 0 0.5rem 0.75rem';
        } else {
          // center
          img.style.float = 'none';
          img.style.display = 'block';
          img.style.margin = '0.5rem auto';
        }
      });
    });

    // ì €ì¥
    document.getElementById("saveBtn").addEventListener("click", () => {
      document.getElementById("result").value = editor.innerHTML;
      alert("ì €ì¥ ì™„ë£Œ");
    });
  </script>
</body>

</html>