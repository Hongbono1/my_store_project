<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µì—° Â· ì˜ˆìˆ  Â· ë²„ìŠ¤ì»¤ ìƒì„¸ë³´ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&libraries=services"></script>

    <style>
        /* glass */
        .glass-box {
            backdrop-filter: blur(14px);
            background: rgba(255, 255, 255, 0.35);
            border-radius: 22px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow:
                8px 8px 18px rgba(0, 0, 0, 0.12),
                -5px -5px 16px rgba(255, 255, 255, 0.8),
                inset 0 0 4px rgba(255, 255, 255, 0.3);
        }

        /* card shadow */
        .neo-card {
            border-radius: 18px;
            background: linear-gradient(135deg, #ffffff, #f1f5ff);
            box-shadow:
                8px 8px 20px rgba(0, 0, 0, 0.12),
                -6px -6px 18px rgba(255, 255, 255, 0.85);
        }

        .section-title {
            @apply text-2xl font-bold mb-3 text-gray-800 drop-shadow;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-indigo-100 via-blue-50 to-purple-100 min-h-screen">

    <div id="header"></div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div class="max-w-5xl mx-auto px-5 py-10">

        <!-- ì œëª© + ì¹´í…Œê³ ë¦¬ -->
        <div class="glass-box p-8 mb-10 text-center">
            <h1 id="title" class="text-4xl font-extrabold text-gray-900"></h1>
            <p id="category" class="text-xl font-semibold text-indigo-600 mt-2 drop-shadow"></p>
        </div>

        <!-- ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” (ìµœëŒ€ 3ì¥) -->
        <div class="glass-box p-6 mb-10">
            <div class="flex gap-4 justify-center items-center" id="image-area"></div>
        </div>

        <!-- ê¸°ë³¸ ì •ë³´ -->
        <div class="glass-box p-8 mb-10">
            <h2 class="section-title">ê¸°ë³¸ ì •ë³´</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
                <p><strong>ğŸ“… ì‹œì‘ì¼ :</strong> <span id="start_date"></span></p>
                <p><strong>ğŸ“… ì¢…ë£Œì¼ :</strong> <span id="end_date"></span></p>
                <p><strong>ğŸ• ì‹œê°„ :</strong> <span id="time"></span></p>
                <p><strong>ğŸ“ ì¥ì†Œ :</strong> <span id="venue"></span></p>
                <p><strong>ğŸ’° ì°¸ê°€ë¹„ :</strong> <span id="price"></span></p>
                <p><strong>ğŸ‘¥ ì •ì› :</strong> <span id="capacity"></span></p>
                <p><strong>ğŸ­ ì£¼ìµœ/ì£¼ê´€ :</strong> <span id="host"></span></p>
                <p><strong>ğŸ” ê´€ëŒë“±ê¸‰ :</strong> <span id="age_limit"></span></p>
                <p class="md:col-span-2"><strong>ğŸ“ ì—°ë½ì²˜ :</strong> <span id="phone"></span></p>
                <p class="md:col-span-2"><strong>ğŸ  ì£¼ì†Œ :</strong> <span id="address"></span></p>
            </div>

            <!-- íƒœê·¸ -->
            <div id="tags-area" class="mt-4 flex flex-wrap gap-2"></div>
        </div>

        <!-- ì§€ë„ -->
        <div class="glass-box p-8 mb-10" id="map-section">
            <h2 class="section-title">ìœ„ì¹˜ ì•ˆë‚´</h2>
            <div id="map" class="w-full h-64 rounded-xl border"></div>
        </div>

        <!-- ìƒì„¸ ì†Œê°œ -->
        <div class="glass-box p-8 mb-10">
            <h2 class="section-title">ìƒì„¸ ì†Œê°œ</h2>
            <p id="description" class="whitespace-pre-line leading-relaxed text-gray-700"></p>
        </div>

        <!-- íŒœí”Œë › -->
        <div class="glass-box p-8 mb-10" id="pamphlet-section" style="display:none;">
            <h2 class="section-title">íŒœí”Œë › / í¬ìŠ¤í„°</h2>
            <div id="pamphlet-area" class="flex flex-wrap gap-4"></div>
        </div>

        <!-- ì†Œì…œ/ì˜ˆë§¤ ë§í¬ -->
        <div class="glass-box p-8 mb-10" id="links-section" style="display:none;">
            <h2 class="section-title">ë§í¬</h2>
            <div id="links-area" class="space-y-2"></div>
        </div>

    </div>

    <div id="footer"></div>

    <script>
        /* í—¤ë”/í‘¸í„° */
        fetch('components/header.html').then(r => r.text()).then(h => header.innerHTML = h);
        fetch('components/footer.html').then(r => r.text()).then(f => footer.innerHTML = f);

        const id = new URLSearchParams(location.search).get("id");

        async function loadDetail() {
            try {
                const res = await fetch(`/api/performingart/${id}`);
                const json = await res.json();
                
                if (!json.success) {
                    alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const data = json.data;

                /* í…ìŠ¤íŠ¸ ì •ë³´ ì¶œë ¥ */
                title.textContent = data.title;
                category.textContent = `${data.type || 'ê³µì—°'}`;
                phone.textContent = data.phone || '-';
                address.textContent = data.address || '-';
                start_date.textContent = data.start_date || '-';
                end_date.textContent = data.end_date || '-';
                time.textContent = data.time || '-';
                venue.textContent = data.venue || '-';
                price.textContent = data.price || '-';
                capacity.textContent = data.capacity ? `${data.capacity}ëª…` : '-';
                host.textContent = data.host || '-';
                age_limit.textContent = data.age_limit || 'ì œí•œì—†ìŒ';
                description.textContent = data.description || '';

                /* íƒœê·¸ */
                if (data.tags) {
                    const tagsArray = data.tags.split(/[,#]/).map(t => t.trim()).filter(Boolean);
                    document.getElementById('tags-area').innerHTML = tagsArray.map(tag => 
                        `<span class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm">#${tag}</span>`
                    ).join('');
                }

                /* ì´ë¯¸ì§€ ë¡œë“œ (main_img + filesì˜ image íƒ€ì…) */
                const images = [data.main_img, ...(data.files || []).filter(f => f.file_type === 'image').map(f => f.file_path)].filter(Boolean);
                const imgBox = document.getElementById("image-area");

                if (images.length === 0) {
                    imgBox.innerHTML = `<div class="text-gray-400 text-center py-10">ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                } else if (images.length === 1) {
                    // 1ì¥: ê°€ìš´ë° ë°°ì¹˜, í° í¬ê¸°
                    imgBox.innerHTML = `
                        <img src="${images[0]}" class="w-96 h-80 object-cover rounded-xl shadow-lg"/>
                    `;
                } else if (images.length === 2) {
                    // 2ì¥: ê· í˜•ìˆê²Œ ê°€ìš´ë° ë°°ì¹˜
                    imgBox.innerHTML = images.map(src => `
                        <img src="${src}" class="w-80 h-72 object-cover rounded-xl shadow-lg hover:scale-105 transition"/>
                    `).join('');
                } else {
                    // 3ì¥: ê°€ë“ ì±„ì›€
                    imgBox.innerHTML = images.slice(0, 3).map(src => `
                        <img src="${src}" class="w-72 h-64 object-cover rounded-xl shadow-lg hover:scale-105 transition"/>
                    `).join('');
                }

                /* íŒœí”Œë › */
                const pamphlets = (data.files || []).filter(f => f.file_type === 'pamphlet');
                if (pamphlets.length > 0) {
                    document.getElementById('pamphlet-section').style.display = 'block';
                    document.getElementById('pamphlet-area').innerHTML = pamphlets.map(p => {
                        const isPdf = p.file_path.toLowerCase().endsWith('.pdf');
                        if (isPdf) {
                            return `<a href="${p.file_path}" target="_blank" class="px-4 py-2 bg-amber-100 text-amber-800 rounded-lg">ğŸ“„ PDF ë³´ê¸°</a>`;
                        } else {
                            return `<img src="${p.file_path}" class="w-40 h-52 object-cover rounded-lg shadow"/>`;
                        }
                    }).join('');
                }

                /* ì†Œì…œ/ì˜ˆë§¤ ë§í¬ */
                const links = [];
                if (data.social1) links.push({ url: data.social1, label: 'í™ˆí˜ì´ì§€/ì†Œì…œ1' });
                if (data.social2) links.push({ url: data.social2, label: 'ì†Œì…œ2' });
                if (data.social3) links.push({ url: data.social3, label: 'ì†Œì…œ3' });
                if (data.booking_url) links.push({ url: data.booking_url, label: 'ğŸ« ì˜ˆë§¤í•˜ê¸°' });

                if (links.length > 0) {
                    document.getElementById('links-section').style.display = 'block';
                    document.getElementById('links-area').innerHTML = links.map(link => 
                        `<a href="${link.url}" target="_blank" class="inline-block px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">${link.label}</a>`
                    ).join('');
                }

                /* ì§€ë„ */
                if (data.address) {
                    drawMap(data.address);
                } else {
                    document.getElementById('map-section').style.display = 'none';
                }

            } catch (err) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', err);
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function drawMap(address) {
            if (!address) return;

            kakao.maps.load(() => {
                const geocoder = new kakao.maps.services.Geocoder();

                geocoder.addressSearch(address, function (result, status) {
                    if (status !== kakao.maps.services.Status.OK) {
                        document.getElementById('map').innerHTML = '<p class="text-gray-500 text-center py-10">ì§€ë„ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                        return;
                    }

                    const lat = result[0].y;
                    const lng = result[0].x;

                    const map = new kakao.maps.Map(document.getElementById('map'), {
                        center: new kakao.maps.LatLng(lat, lng),
                        level: 3
                    });

                    new kakao.maps.Marker({
                        map,
                        position: new kakao.maps.LatLng(lat, lng)
                    });
                });
            });
        }

        loadDetail();
    </script>

</body>
</html>
