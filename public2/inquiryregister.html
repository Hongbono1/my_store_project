<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬¸ì˜ ë“±ë¡ | MALL HANKOOK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Pretendard, system-ui, -apple-system, BlinkMacSystemFont,
                "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
        }

        .neo-card {
            background: radial-gradient(circle at 0 0,
                    rgba(255, 255, 255, 0.98),
                    rgba(241, 245, 249, 0.96));
            backdrop-filter: blur(14px);
            border-radius: 1.75rem;
            box-shadow:
                16px 16px 40px rgba(15, 23, 42, 0.18),
                -10px -10px 26px rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .neo-input {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 0.9rem;
            box-shadow:
                inset 3px 3px 7px rgba(15, 23, 42, 0.08),
                inset -3px -3px 7px rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(226, 232, 240, 0.9);
            transition: all 0.18s ease;
        }

        .neo-input:focus {
            outline: none;
            box-shadow:
                inset 4px 4px 10px rgba(15, 23, 42, 0.16),
                inset -4px -4px 10px rgba(255, 255, 255, 1);
            border-color: rgba(129, 140, 248, 0.7);
            background: #ffffff;
        }

        .badge-pill {
            backdrop-filter: blur(12px);
            background: linear-gradient(135deg,
                    rgba(129, 140, 248, 0.16),
                    rgba(56, 189, 248, 0.14));
            border-radius: 999px;
            border: 1px solid rgba(191, 219, 254, 0.9);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-50 via-sky-50 to-indigo-100 min-h-screen">
    <div id="header"></div>

    <main class="max-w-3xl mx-auto py-16 px-4 sm:px-6 lg:px-8">
        <!-- ìƒë‹¨ ì„¤ëª… -->
        <header class="mb-8">
            <div
                class="inline-flex items-center gap-2 badge-pill px-3 py-1 text-[11px] sm:text-xs text-indigo-700 font-semibold">
                <span class="w-1.5 h-1.5 rounded-full bg-indigo-500"></span>
                ê³ ê° ë¬¸ì˜ ë“±ë¡
            </div>
            <h1 class="mt-3 text-2xl sm:text-3xl font-extrabold text-slate-900 tracking-tight">
                ê¶ê¸ˆí•œ ì ì„ ë‚¨ê²¨ì£¼ì„¸ìš”
            </h1>
            <p class="mt-1 text-sm sm:text-base text-slate-500">
                ì„œë¹„ìŠ¤ ì´ìš©, ê°€ê²Œ ë“±ë¡, ì œíœ´ ë¬¸ì˜ ë“± ë¬´ì—‡ì´ë“  í¸í•˜ê²Œ ì‘ì„±í•´ì£¼ì‹œë©´ í™•ì¸ í›„ ì—°ë½ë“œë¦´ê²Œìš”.
            </p>
        </header>

        <!-- ë©”ì¸ ì¹´ë“œ -->
        <section class="neo-card p-6 sm:p-8">
            <form id="inquiryForm" class="space-y-6" enctype="multipart/form-data">
                <!-- ê¸°ë³¸ ì •ë³´ -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                    <!-- ì œëª© -->
                    <div class="sm:col-span-2">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">
                            ì œëª© <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="title" lang="ko" required
                            class="neo-input w-full px-4 py-3 text-sm sm:text-base text-slate-900 placeholder-slate-400"
                            placeholder="ë¬¸ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" />
                    </div>

                    <!-- ë¬¸ì˜ ìœ í˜• -->
                    <div class="sm:col-span-2">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">
                            ë¬¸ì˜ ìœ í˜•
                        </label>
                        <select name="inquiry_type"
                            class="neo-input w-full px-4 py-3 text-sm sm:text-base text-slate-900">
                            <option value="">ë¬¸ì˜ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš” (ì„ íƒ)</option>
                            <option value="ì„œë¹„ìŠ¤ ë¬¸ì˜">ì„œë¹„ìŠ¤ ë¬¸ì˜</option>
                            <option value="ê°€ê²Œ ë“±ë¡ ë¬¸ì˜">ê°€ê²Œ ë“±ë¡ ë¬¸ì˜</option>
                            <option value="ì œíœ´/ê´‘ê³  ë¬¸ì˜">ì œíœ´/ê´‘ê³  ë¬¸ì˜</option>
                            <option value="ê¸°íƒ€ ë¬¸ì˜">ê¸°íƒ€ ë¬¸ì˜</option>
                        </select>
                    </div>

                    <!-- ì´ë¦„ -->
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">
                            ì´ë¦„ <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="user_name" lang="ko" required
                            class="neo-input w-full px-4 py-3 text-sm sm:text-base text-slate-900 placeholder-slate-400"
                            placeholder="ì„±í•¨ì„ ì…ë ¥í•˜ì„¸ìš”" />
                    </div>

                    <!-- ì—°ë½ì²˜ -->
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">
                            ì—°ë½ì²˜
                        </label>
                        <input type="tel" name="user_phone"
                            class="neo-input w-full px-4 py-3 text-sm sm:text-base text-slate-900 placeholder-slate-400"
                            placeholder="ì—°ë½ ê°€ëŠ¥í•œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
                    </div>

                    <!-- ì´ë©”ì¼ -->
                    <div class="sm:col-span-2">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">
                            ì´ë©”ì¼
                        </label>
                        <input type="email" name="writer_email"
                            class="neo-input w-full px-4 py-3 text-sm sm:text-base text-slate-900 placeholder-slate-400"
                            placeholder="ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒ)" />
                    </div>

                    <!-- ë¹„ë°€ê¸€ -->
                    <div class="mt-1 sm:col-span-2">
                        <label class="inline-flex items-center gap-2 text-xs sm:text-sm text-slate-600">
                            <input type="checkbox" name="is_secret" class="rounded border-slate-300 text-indigo-600" />
                            <span>ë¹„ë°€ê¸€ë¡œ ë“±ë¡ (ë‚˜ë§Œ ë³´ì´ë„ë¡ í‘œì‹œ)</span>
                        </label>
                    </div>
                </div>

                <!-- ë¬¸ì˜ ë‚´ìš© -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-semibold text-slate-700">
                            ë¬¸ì˜ ë‚´ìš© <span class="text-red-500">*</span>
                        </label>
                        <span class="text-[11px] sm:text-xs text-slate-400">
                            ê°€ëŠ¥í•œ í•œ ìì„¸í•˜ê²Œ ì ì–´ì£¼ì‹œë©´ ë¹ ë¥¸ ì•ˆë‚´ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.
                        </span>
                    </div>
                    <textarea name="content" required rows="8" lang="ko" autocomplete="off" autocapitalize="off"
                        spellcheck="false"
                        class="neo-input w-full px-4 py-3 text-sm sm:text-base text-slate-900 placeholder-slate-400 resize-none"
                        placeholder="ë¬¸ì˜í•˜ì‹¤ ë‚´ìš©ì„ ìì„¸íˆ ì‘ì„±í•´ì£¼ì„¸ìš”. (ì„œë¹„ìŠ¤ ê´€ë ¨, ê°€ê²Œ ë“±ë¡, ì œíœ´/ê´‘ê³  ë¬¸ì˜ ë“±)"></textarea>
                </div>

                <!-- ì²¨ë¶€ ì´ë¯¸ì§€ -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-semibold text-slate-700">
                            ì²¨ë¶€ ì´ë¯¸ì§€
                        </label>
                        <span class="text-[11px] sm:text-xs text-slate-400">
                            ì„ íƒ ì‚¬í•­ Â· ìµœëŒ€ 3ì¥ (jpg, png ë“±)
                        </span>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                        <label class="neo-input flex flex-col items-center justify-center px-3 py-4 cursor-pointer">
                            <span class="text-xs font-semibold text-slate-600 mb-1">ì´ë¯¸ì§€ 1</span>
                            <span class="text-[11px] text-slate-400" id="fileLabel1">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
                            <input type="file" name="images" accept="image/*" class="hidden" id="image1">
                        </label>

                        <label class="neo-input flex flex-col items-center justify-center px-3 py-4 cursor-pointer">
                            <span class="text-xs font-semibold text-slate-600 mb-1">ì´ë¯¸ì§€ 2</span>
                            <span class="text-[11px] text-slate-400" id="fileLabel2">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
                            <input type="file" name="images" accept="image/*" class="hidden" id="image2">
                        </label>

                        <label class="neo-input flex flex-col items-center justify-center px-3 py-4 cursor-pointer">
                            <span class="text-xs font-semibold text-slate-600 mb-1">ì´ë¯¸ì§€ 3</span>
                            <span class="text-[11px] text-slate-400" id="fileLabel3">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
                            <input type="file" name="images" accept="image/*" class="hidden" id="image3">
                        </label>
                    </div>

                    <p class="mt-2 text-[11px] text-slate-400">
                        ê°€ê²Œ ì‚¬ì§„, ìº¡ì²˜ í™”ë©´ ë“± ì„¤ëª…ì— ë„ì›€ì´ ë˜ëŠ” ì´ë¯¸ì§€ë¥¼ ì˜¬ë ¤ì£¼ì„¸ìš”. (í•œ ì¥ë‹¹ ìš©ëŸ‰ ì œí•œì€ ì„œë²„ ì„¤ì • ê¸°ì¤€)
                    </p>
                </div>

                <!-- ë²„íŠ¼ ì˜ì—­ -->
                <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 pt-2">
                    <button type="button" onclick="history.back()"
                        class="w-full sm:flex-1 py-3 px-6 border border-slate-200 text-sm sm:text-base text-slate-600 rounded-xl font-semibold bg-white/80 hover:bg-slate-50 hover:border-slate-300 transition">
                        ì·¨ì†Œ
                    </button>
                    <button type="submit" id="submitBtn"
                        class="w-full sm:flex-1 py-3 px-6 rounded-xl font-semibold text-sm sm:text-base text-white bg-gradient-to-r from-indigo-500 via-sky-500 to-cyan-400 shadow-md shadow-indigo-500/30 hover:from-indigo-600 hover:via-sky-600 hover:to-cyan-500 transition">
                        ë¬¸ì˜ ë“±ë¡
                    </button>
                </div>
            </form>

            <!-- ê²°ê³¼ ë©”ì‹œì§€ -->
            <div id="result" class="mt-6 hidden text-sm"></div>
        </section>
    </main>

    <div id="footer"></div>

    <script>
        // Header/Footer ë¡œë“œ
        fetch("/components/header.html")
            .then(res => res.text())
            .then(html => document.getElementById("header").innerHTML = html)
            .catch(err => console.warn("Header ë¡œë“œ ì‹¤íŒ¨:", err));

        fetch("/components/footer.html")
            .then(res => res.text())
            .then(html => document.getElementById("footer").innerHTML = html)
            .catch(err => console.warn("Footer ë¡œë“œ ì‹¤íŒ¨:", err));

        // íŒŒì¼ ì´ë¦„ í‘œì‹œ
        function bindFileLabel(inputId, labelId) {
            const input = document.getElementById(inputId);
            const label = document.getElementById(labelId);
            if (!input || !label) return;

            input.addEventListener("change", () => {
                if (input.files && input.files[0]) {
                    label.textContent = input.files[0].name;
                    label.classList.remove("text-slate-400");
                    label.classList.add("text-slate-600");
                } else {
                    label.textContent = "ì„ íƒëœ íŒŒì¼ ì—†ìŒ";
                    label.classList.remove("text-slate-600");
                    label.classList.add("text-slate-400");
                }
            });
        }

        bindFileLabel("image1", "fileLabel1");
        bindFileLabel("image2", "fileLabel2");
        bindFileLabel("image3", "fileLabel3");

        // ë¬¸ì˜ ë“±ë¡ ì²˜ë¦¬
        document.getElementById("inquiryForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const form = e.target;
            const formData = new FormData(form);
            const resultDiv = document.getElementById("result");
            const submitBtn = document.getElementById("submitBtn");

            console.log("\nğŸš€ === Mall Hankook ë¬¸ì˜ ë“±ë¡ ì‹œì‘ ===");
            console.log("ğŸ“ FormData ë‚´ìš©:");
            for (let [key, value] of formData.entries()) {
                if (value instanceof File) {
                    console.log(`  ${key}: [File] ${value.name} (${value.size} bytes, ${value.type})`);
                } else {
                    console.log(`  ${key}: ${value}`);
                }
            }

            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = "ë“±ë¡ ì¤‘...";
            submitBtn.classList.add("opacity-50");

            try {
                const title = formData.get('title')?.trim();
                const content = formData.get('content')?.trim();
                const userName = formData.get('user_name')?.trim();

                if (!title || !content || !userName) {
                    throw new Error("ì œëª©, ë¬¸ì˜ ë‚´ìš©, ì´ë¦„ì€ í•„ìˆ˜ ì…ë ¥ì‚¬í•­ì…ë‹ˆë‹¤.");
                }

                if (!formData.get("inquiry_type")) {
                    formData.set("inquiry_type", "ì¼ë°˜ ë¬¸ì˜");
                }

                console.log("ğŸ“¤ API í˜¸ì¶œ: POST /api/inquiry");

                const response = await fetch("/api/inquiry", {
                    method: "POST",
                    body: formData
                });

                console.log(`ğŸ“¥ ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`);

                const responseText = await response.text();
                console.log("ğŸ“„ ì‘ë‹µ ë³¸ë¬¸:", responseText.substring(0, 200));

                let result;
                try {
                    result = JSON.parse(responseText);
                    console.log("ğŸ“Š ì‘ë‹µ JSON:", result);
                } catch (parseErr) {
                    console.error("âŒ JSON íŒŒì‹± ì‹¤íŒ¨:", parseErr);
                    throw new Error(`ì„œë²„ ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜: ${responseText.substring(0, 100)}`);
                }

                if (!response.ok) {
                    throw new Error(result.error || result.message || `HTTP ${response.status}`);
                }

                // âœ… ì„±ê³µ ì²˜ë¦¬: result.ok ë˜ëŠ” result.success í™•ì¸
                if (result.ok || result.success) {
                    // âœ… ì„œë²„ ì‘ë‹µì—ì„œ ë¬¸ì˜ ID êº¼ë‚´ê¸° (ë‘˜ ë‹¤ ëŒ€ì‘: { id } ë˜ëŠ” { data: { id } })
                    const inquiryId = result.id || result.data?.id;

                    resultDiv.innerHTML = `
                        <div class="p-4 rounded-2xl bg-emerald-50 border border-emerald-200 text-emerald-700 shadow-sm">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-2">âœ…</span>
                                <p class="font-semibold text-sm sm:text-base">ë¬¸ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
                            </div>
                            ${inquiryId ? `
                            <p class="text-xs sm:text-sm mt-1">
                                ğŸ“‹ ë¬¸ì˜ ë²ˆí˜¸: <span class="font-mono bg-emerald-100 px-2 py-0.5 rounded">#${inquiryId}</span>
                            </p>` : ""}
                            ${result.uploaded_files > 0 ? `
                                <p class="text-xs sm:text-sm mt-1">
                                    ğŸ“ ì²¨ë¶€ íŒŒì¼: ${result.uploaded_files}ê°œ ì—…ë¡œë“œë¨
                                </p>
                            ` : ''}
                            <p class="text-xs sm:text-[13px] mt-2 text-emerald-600">
                                ë‹´ë‹¹ìê°€ ë‚´ìš©ì„ í™•ì¸í•œ í›„ ìˆœì°¨ì ìœ¼ë¡œ ë‹µë³€ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤.
                            </p>
                            <p class="text-[11px] mt-2 text-emerald-500">
                                ê³§ ë¬¸ì˜ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...
                            </p>
                        </div>
                    `;
                    resultDiv.classList.remove("hidden");

                    form.reset();
                    ["fileLabel1", "fileLabel2", "fileLabel3"].forEach(id => {
                        const el = document.getElementById(id);
                        if (el) {
                            el.textContent = "ì„ íƒëœ íŒŒì¼ ì—†ìŒ";
                            el.classList.remove("text-slate-600");
                            el.classList.add("text-slate-400");
                        }
                    });

                    console.log("âœ… === ë¬¸ì˜ ë“±ë¡ ì™„ë£Œ ===\n");

                    // âœ… ë“±ë¡ëœ ë¬¸ì˜ ìƒì„¸ í˜ì´ì§€ë¡œ ìë™ ì´ë™
                    setTimeout(() => {
                        if (inquiryId) {
                            // âœ… ë“±ë¡ëœ ê¸€ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
                            window.location.href = `/inquirydetail.html?id=${encodeURIComponent(inquiryId)}`;
                        } else {
                            // í˜¹ì‹œ IDê°€ ì—†ìœ¼ë©´ ëª©ë¡ìœ¼ë¡œ
                            window.location.href = "/inquiryboard.html";
                        }
                    }, 3000);

                } else {
                    throw new Error(result.message || result.error || "ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }

            } catch (error) {
                console.error("âŒ ë¬¸ì˜ ë“±ë¡ ì˜¤ë¥˜:", error);

                resultDiv.innerHTML = `
                    <div class="p-4 rounded-2xl bg-rose-50 border border-rose-200 text-rose-700 shadow-sm">
                        <div class="flex items-center mb-2">
                            <span class="text-2xl mr-2">âŒ</span>
                            <p class="font-semibold text-sm sm:text-base">ë¬¸ì˜ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>
                        </div>
                        <p class="text-xs sm:text-[13px] mt-1 mb-3">ì˜¤ë¥˜: ${error.message}</p>
                        <button onclick="location.reload()" 
                                class="px-4 py-2 bg-rose-600 text-white text-sm rounded-lg hover:bg-rose-700 transition">
                            ğŸ”„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                `;
                resultDiv.classList.remove("hidden");

            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                submitBtn.classList.remove("opacity-50");
            }
        });
    </script>
</body>

</html>