<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬¸ì˜ ë“±ë¡ | MALL HANKOOK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Pretendard, system-ui, -apple-system, BlinkMacSystemFont,
                "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
        }

        .neo-card {
            background: radial-gradient(circle at 0 0,
                    rgba(255, 255, 255, 0.98),
                    rgba(241, 245, 249, 0.96));
            backdrop-filter: blur(14px);
            border-radius: 1.75rem;
            box-shadow:
                16px 16px 40px rgba(15, 23, 42, 0.18),
                -10px -10px 26px rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .neo-input {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 0.9rem;
            box-shadow:
                inset 3px 3px 7px rgba(15, 23, 42, 0.08),
                inset -3px -3px 7px rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(226, 232, 240, 0.9);
            transition: all 0.18s ease;
        }

        .neo-input:focus {
            outline: none;
            box-shadow:
                inset 4px 4px 10px rgba(15, 23, 42, 0.16),
                inset -4px -4px 10px rgba(255, 255, 255, 1);
            border-color: rgba(129, 140, 248, 0.7);
            background: #ffffff;
        }

        .badge-pill {
            backdrop-filter: blur(12px);
            background: linear-gradient(135deg,
                    rgba(129, 140, 248, 0.16),
                    rgba(56, 189, 248, 0.14));
            border-radius: 999px;
            border: 1px solid rgba(191, 219, 254, 0.9);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-50 via-sky-50 to-indigo-100 min-h-screen">
    <div id="header"></div>

    <main class="max-w-3xl mx-auto py-16 px-4 sm:px-6 lg:px-8">
        <!-- ìƒë‹¨ ì„¤ëª… -->
        <header class="mb-8">
            <div
                class="inline-flex items-center gap-2 badge-pill px-3 py-1 text-[11px] sm:text-xs text-indigo-700 font-semibold">
                <span class="w-1.5 h-1.5 rounded-full bg-indigo-500"></span>
                ê³ ê° ë¬¸ì˜ ë“±ë¡
            </div>
            <h1 class="mt-3 text-2xl sm:text-3xl font-extrabold text-slate-900 tracking-tight">
                ê¶ê¸ˆí•œ ì ì„ ë‚¨ê²¨ì£¼ì„¸ìš”
            </h1>
            <p class="mt-1 text-sm sm:text-base text-slate-500">
                ì„œë¹„ìŠ¤ ì´ìš©, ê°€ê²Œ ë“±ë¡, ì œíœ´ ë¬¸ì˜ ë“± ë¬´ì—‡ì´ë“  í¸í•˜ê²Œ ì‘ì„±í•´ì£¼ì‹œë©´ í™•ì¸ í›„ ì—°ë½ë“œë¦´ê²Œìš”.
            </p>
        </header>

        <!-- ë©”ì¸ ì¹´ë“œ -->
        <section class="neo-card p-6 sm:p-8">
            <!-- ğŸ”¹ íŒŒì¼ ì—…ë¡œë“œë¥¼ ìœ„í•´ enctype ì¶”ê°€ -->
            <form id="inquiryForm" class="space-y-6" enctype="multipart/form-data">
                <!-- ê¸°ë³¸ ì •ë³´ -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                    <!-- ì œëª© -->
                    <div class="sm:col-span-2">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">
                            ì œëª© <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="title" lang="ko" required
                            class="neo-input w-full px-4 py-3 text-sm sm:text-base text-slate-900 placeholder-slate-400"
                            placeholder="ë¬¸ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" />
                    </div>

                    <!-- ë¬¸ì˜ ìœ í˜• -->
                    <div class="sm:col-span-2">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">
                            ë¬¸ì˜ ìœ í˜•
                        </label>
                        <select name="inquiry_type"
                            class="neo-input w-full px-4 py-3 text-sm sm:text-base text-slate-900">
                            <option value="">ë¬¸ì˜ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš” (ì„ íƒ)</option>
                            <option value="ì„œë¹„ìŠ¤ ë¬¸ì˜">ì„œë¹„ìŠ¤ ë¬¸ì˜</option>
                            <option value="ê°€ê²Œ ë“±ë¡ ë¬¸ì˜">ê°€ê²Œ ë“±ë¡ ë¬¸ì˜</option>
                            <option value="ì œíœ´/ê´‘ê³  ë¬¸ì˜">ì œíœ´/ê´‘ê³  ë¬¸ì˜</option>
                            <option value="ê¸°íƒ€ ë¬¸ì˜">ê¸°íƒ€ ë¬¸ì˜</option>
                        </select>
                    </div>

                    <!-- ì´ë¦„ -->
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">
                            ì´ë¦„ <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="writer_name" lang="ko" required
                            class="neo-input w-full px-4 py-3 text-sm sm:text-base text-slate-900 placeholder-slate-400"
                            placeholder="ì„±í•¨ì„ ì…ë ¥í•˜ì„¸ìš”" />
                    </div>

                    <!-- ì—°ë½ì²˜ -->
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">
                            ì—°ë½ì²˜
                        </label>
                        <input type="tel" name="writer_phone"
                            class="neo-input w-full px-4 py-3 text-sm sm:text-base text-slate-900 placeholder-slate-400"
                            placeholder="ì—°ë½ ê°€ëŠ¥í•œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
                    </div>

                    <!-- ì´ë©”ì¼ (ì„ íƒ) -->
                    <div class="sm:col-span-2">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">
                            ì´ë©”ì¼
                        </label>
                        <input type="email" name="writer_email"
                            class="neo-input w-full px-4 py-3 text-sm sm:text-base text-slate-900 placeholder-slate-400"
                            placeholder="ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒ)" />
                    </div>

                    <!-- ë¹„ë°€ê¸€ -->
                    <div class="mt-1 sm:col-span-2">
                        <label class="inline-flex items-center gap-2 text-xs sm:text-sm text-slate-600">
                            <input type="checkbox" name="is_secret" class="rounded border-slate-300 text-indigo-600" />
                            <span>ë¹„ë°€ê¸€ë¡œ ë“±ë¡ (ë‚˜ë§Œ ë³´ì´ë„ë¡ í‘œì‹œ)</span>
                        </label>
                    </div>
                </div>

                <!-- ë¬¸ì˜ ë‚´ìš© -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-semibold text-slate-700">
                            ë¬¸ì˜ ë‚´ìš© <span class="text-red-500">*</span>
                        </label>
                        <span class="text-[11px] sm:text-xs text-slate-400">
                            ê°€ëŠ¥í•œ í•œ ìì„¸í•˜ê²Œ ì ì–´ì£¼ì‹œë©´ ë¹ ë¥¸ ì•ˆë‚´ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.
                        </span>
                    </div>
                    <textarea name="content" required rows="8" lang="ko" autocomplete="off" autocapitalize="off"
                        spellcheck="false"
                        class="neo-input w-full px-4 py-3 text-sm sm:text-base text-slate-900 placeholder-slate-400 resize-none"
                        placeholder="ë¬¸ì˜í•˜ì‹¤ ë‚´ìš©ì„ ìì„¸íˆ ì‘ì„±í•´ì£¼ì„¸ìš”. (ì„œë¹„ìŠ¤ ê´€ë ¨, ê°€ê²Œ ë“±ë¡, ì œíœ´/ê´‘ê³  ë¬¸ì˜ ë“±)"></textarea>
                </div>

                <!-- ğŸ”¹ ì²¨ë¶€ ì´ë¯¸ì§€ (ìµœëŒ€ 3ì¥) -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-semibold text-slate-700">
                            ì²¨ë¶€ ì´ë¯¸ì§€
                        </label>
                        <span class="text-[11px] sm:text-xs text-slate-400">
                            ì„ íƒ ì‚¬í•­ Â· ìµœëŒ€ 3ì¥ (jpg, png ë“±)
                        </span>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                        <!-- âœ… ì´ë¯¸ì§€ 1 -->
                        <label class="neo-input flex flex-col items-center justify-center px-3 py-4 cursor-pointer">
                            <span class="text-xs font-semibold text-slate-600 mb-1">ì´ë¯¸ì§€ 1</span>
                            <span class="text-[11px] text-slate-400" id="fileLabel1">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
                            <!-- name ìˆ˜ì • -->
                            <input type="file" name="image1" accept="image/*" class="hidden" id="image1">
                        </label>

                        <!-- âœ… ì´ë¯¸ì§€ 2 -->
                        <label class="neo-input flex flex-col items-center justify-center px-3 py-4 cursor-pointer">
                            <span class="text-xs font-semibold text-slate-600 mb-1">ì´ë¯¸ì§€ 2</span>
                            <span class="text-[11px] text-slate-400" id="fileLabel2">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
                            <!-- name ìˆ˜ì • -->
                            <input type="file" name="image2" accept="image/*" class="hidden" id="image2">
                        </label>

                        <!-- âœ… ì´ë¯¸ì§€ 3 -->
                        <label class="neo-input flex flex-col items-center justify-center px-3 py-4 cursor-pointer">
                            <span class="text-xs font-semibold text-slate-600 mb-1">ì´ë¯¸ì§€ 3</span>
                            <span class="text-[11px] text-slate-400" id="fileLabel3">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
                            <!-- name ìˆ˜ì • -->
                            <input type="file" name="image3" accept="image/*" class="hidden" id="image3">
                        </label>
                    </div>

                    <p class="mt-2 text-[11px] text-slate-400">
                        ê°€ê²Œ ì‚¬ì§„, ìº¡ì²˜ í™”ë©´ ë“± ì„¤ëª…ì— ë„ì›€ì´ ë˜ëŠ” ì´ë¯¸ì§€ë¥¼ ì˜¬ë ¤ì£¼ì„¸ìš”. (í•œ ì¥ë‹¹ ìš©ëŸ‰ ì œí•œì€ ì„œë²„ ì„¤ì • ê¸°ì¤€)
                    </p>
                </div>

                <!-- ë²„íŠ¼ ì˜ì—­ -->
                <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 pt-2">
                    <button type="button" onclick="history.back()"
                        class="w-full sm:flex-1 py-3 px-6 border border-slate-200 text-sm sm:text-base text-slate-600 rounded-xl font-semibold bg-white/80 hover:bg-slate-50 hover:border-slate-300 transition">
                        ì·¨ì†Œ
                    </button>
                    <button type="submit"
                        class="w-full sm:flex-1 py-3 px-6 rounded-xl font-semibold text-sm sm:text-base text-white bg-gradient-to-r from-indigo-500 via-sky-500 to-cyan-400 shadow-md shadow-indigo-500/30 hover:from-indigo-600 hover:via-sky-600 hover:to-cyan-500 transition">
                        ë¬¸ì˜ ë“±ë¡
                    </button>
                </div>
            </form>

            <!-- ê²°ê³¼ ë©”ì‹œì§€ -->
            <div id="result" class="mt-6 hidden text-sm"></div>
        </section>
    </main>

    <div id="footer"></div>

    <script>
        // Header/Footer ë¡œë“œ
        fetch("/components/header.html")
            .then(res => res.text())
            .then(html => document.getElementById("header").innerHTML = html)
            .catch(err => console.warn("Header ë¡œë“œ ì‹¤íŒ¨:", err));

        fetch("/components/footer.html")
            .then(res => res.text())
            .then(html => document.getElementById("footer").innerHTML = html)
            .catch(err => console.warn("Footer ë¡œë“œ ì‹¤íŒ¨:", err));

        // ğŸ”¹ íŒŒì¼ ì´ë¦„ í‘œì‹œ
        function bindFileLabel(inputId, labelId) {
            const input = document.getElementById(inputId);
            const label = document.getElementById(labelId);
            if (!input || !label) return;

            input.addEventListener("change", () => {
                if (input.files && input.files[0]) {
                    label.textContent = input.files[0].name;
                    label.classList.remove("text-slate-400");
                    label.classList.add("text-slate-600");
                } else {
                    label.textContent = "ì„ íƒëœ íŒŒì¼ ì—†ìŒ";
                    label.classList.remove("text-slate-600");
                    label.classList.add("text-slate-400");
                }
            });
        }

        bindFileLabel("image1", "fileLabel1");
        bindFileLabel("image2", "fileLabel2");
        bindFileLabel("image3", "fileLabel3");

        // ë¬¸ì˜ ë“±ë¡ ì²˜ë¦¬ (multipart/form-data ì „ì†¡)
        document.getElementById("inquiryForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const form = e.target;
            const formData = new FormData(form); // ğŸ”¹ íŒŒì¼ í¬í•¨

            const resultDiv = document.getElementById("result");

            // ë²„íŠ¼ ë¹„í™œì„±í™”
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = "ë“±ë¡ ì¤‘...";

            try {
                console.log("ğŸ“¤ ë¬¸ì˜ ë“±ë¡ API í˜¸ì¶œ: /api/inquiry");

                // inquiry_type ê¸°ë³¸ê°’ ì²˜ë¦¬ (ì„ íƒ ì•ˆ í•˜ë©´ 'ì¼ë°˜ ë¬¸ì˜')
                if (!formData.get("inquiry_type")) {
                    formData.set("inquiry_type", "ì¼ë°˜ ë¬¸ì˜");
                }

                const response = await fetch("/api/inquiry", {
                    method: "POST",
                    body: formData // ğŸ”¹ Content-Type ì§ì ‘ ì§€ì •í•˜ì§€ ì•ŠìŒ (ë¸Œë¼ìš°ì €ê°€ boundary í¬í•¨í•´ì„œ ì„¤ì •)
                });

                const result = await response.json();
                console.log("ğŸ“¥ ì‘ë‹µ ë°ì´í„°:", result);

                // âœ… ì„œë²„ ì‘ë‹µ í˜•ì‹: { ok: true, id: NEW_ID, message: "..." }
                if (response.ok && result.ok) {
                    const newId = result.id;

                    resultDiv.innerHTML = `
        <div class="p-4 rounded-2xl bg-emerald-50 border border-emerald-200 text-emerald-700 shadow-sm">
          <p class="font-semibold text-sm sm:text-base">âœ… ë¬¸ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
          <p class="text-xs sm:text-sm mt-1">
            ë¬¸ì˜ ë²ˆí˜¸: <span class="font-mono">${newId}</span>
          </p>
          <p class="text-xs sm:text-[13px] mt-2 text-emerald-600">
            ë°©ê¸ˆ ì‘ì„±í•˜ì‹  ë‚´ìš©ì„ ìƒì„¸ í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </p>
        </div>
    `;
                    resultDiv.classList.remove("hidden");

                    // âœ… ë°”ë¡œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
                    location.href = `/inquirydetail.html?id=${newId}`;

                } else {
                    // ì„œë²„ì—ì„œ ë³´ë‚¸ ì—ëŸ¬ ë©”ì‹œì§€ ìš°ì„  ì‚¬ìš©
                    throw new Error(result.message || result.error || "ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }

            } catch (error) {
                console.error("âŒ ë¬¸ì˜ ë“±ë¡ ì˜¤ë¥˜:", error);

                resultDiv.innerHTML = `
          <div class="p-4 rounded-2xl bg-rose-50 border border-rose-200 text-rose-700 shadow-sm">
            <p class="font-semibold text-sm sm:text-base">âŒ ë¬¸ì˜ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
            <p class="text-xs sm:text-[13px] mt-1">${error.message}</p>
            <p class="text-[11px] mt-2 text-rose-500">
              ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”. ë¬¸ì œê°€ ê³„ì†ë˜ë©´ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.
            </p>
          </div>
        `;
                resultDiv.classList.remove("hidden");

            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        });
    </script>
</body>

</html>