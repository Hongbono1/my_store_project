<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìŠ¤í† ì–´ í”„ë¼ì´ë“œ ìƒì„¸ | MALL HANKOOK</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&autoload=false&libraries=services"></script>
  <style>
    body {
      font-family: Pretendard, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, "Noto Sans KR", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .neo-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(102, 126, 234, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(20px);
    }

    .gradient-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .pill {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(255, 255, 255, 0.8);
    }

    .content-area p {
      margin-bottom: 0.75rem;
    }

    .content-area ul {
      list-style: disc;
      padding-left: 1.5rem;
      margin: 0.75rem 0;
    }

    .content-area h1,
    .content-area h2,
    .content-area h3 {
      font-weight: 700;
      margin: 1rem 0 0.5rem;
    }

    .content-area img {
      max-width: 100%;
      height: auto;
      border-radius: 16px;
      margin: 1rem auto;
      display: block;
    }
  </style>
</head>

<body class="text-slate-900">
  <div class="min-h-screen flex flex-col">
    <!-- í—¤ë” ë¡œë“œ ì˜ì—­ -->
    <div id="header-placeholder"></div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="flex-1">
      <div class="max-w-5xl mx-auto px-4 py-6 md:py-10">
        <!-- ë¡œë”© / ì—ëŸ¬ ì˜ì—­ -->
        <div id="status" class="mb-4 text-sm text-slate-500 hidden"></div>

        <div class="neo-card p-5 md:p-8">
          <!-- ìƒë‹¨: ê°€ê²Œ ì •ë³´ í—¤ë” -->
          <div class="text-center mb-8">
            <h1 id="store-name" class="text-3xl md:text-4xl font-bold gradient-text mb-2">
              ê°€ê²Œ ì´ë¦„
            </h1>
            <p id="business-tags" class="text-lg text-gray-600 mb-4">
              <!-- ì—…ì¢… / ì¹´í…Œê³ ë¦¬ -->
            </p>
            <div class="flex justify-center flex-wrap gap-3 mb-6">
              <span
                class="px-4 py-2 bg-gradient-to-r from-blue-100 to-purple-100 text-blue-700 rounded-full text-sm font-medium border border-blue-200">
                âœ¨ STORE PRIDE
              </span>
              <span id="category-pill"
                class="px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium border border-gray-200">
                ì¹´í…Œê³ ë¦¬
              </span>
              <span id="date-pill"
                class="px-4 py-2 bg-gray-100 text-gray-600 rounded-full text-sm border border-gray-200">
                ë‚ ì§œ
              </span>
            </div>
          </div>

          <!-- ê°€ê²Œ ê¸°ë³¸ ì •ë³´ -->
          <div class="flex flex-col gap-4 md:gap-6 border-b border-slate-200/70 pb-8 mb-8">

            <!-- ì‚¬ì§„ê³¼ ì§€ë„ - ìœ„ìª½ ë‚˜ë€íˆ -->
            <div class="flex flex-col md:flex-row gap-6 items-start">

              <!-- âœ… ì™¼ìª½: ì´ë¯¸ì§€ + ì—°ë½ì²˜(ì´ë¯¸ì§€ í•˜ë‹¨) -->
              <div class="w-full md:w-1/2 space-y-4">
                <!-- ëŒ€í‘œ ì´ë¯¸ì§€ -->
                <div class="w-full">
                  <div
                    class="relative rounded-3xl overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200 aspect-[4/3] shadow-2xl border-4 border-white">
                    <img id="thumbnail" src="" alt="ìŠ¤í† ì–´ í”„ë¼ì´ë“œ ëŒ€í‘œ ì´ë¯¸ì§€"
                      class="w-full h-full object-cover hidden transition-all duration-300 hover:scale-105" />
                    <div id="thumbnail-placeholder"
                      class="flex flex-col items-center justify-center h-full text-gray-400">
                      <div
                        class="w-16 h-16 rounded-full bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center text-gray-500 text-2xl shadow-inner">
                        ğŸ“·
                      </div>
                      <span class="mt-3 text-sm font-medium">ëŒ€í‘œ ì´ë¯¸ì§€</span>
                      <span class="text-xs">ì¤€ë¹„ ì¤‘...</span>
                    </div>
                  </div>
                </div>

                <!-- âœ… ì—°ë½ì²˜: ì´ë¯¸ì§€ í•˜ë‹¨ -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6">
                  <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-green-500 rounded-xl flex items-center justify-center">
                      <span class="text-white text-sm">ğŸ“</span>
                    </div>
                    <div class="flex-1">
                      <div class="text-sm font-semibold text-gray-700 mb-1">ì—°ë½ì²˜</div>
                      <div id="phone" class="text-gray-800 font-medium">ì—°ë½ì²˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- âœ… ì˜¤ë¥¸ìª½: ì§€ë„ + ë²„íŠ¼(ì§€ë„ ì•„ë˜ ì˜¤ë¥¸ìª½) + ì£¼ì†Œ(ì§€ë„ ì•„ë˜) -->
              <div class="w-full md:w-1/2 space-y-4">

                <!-- ì§€ë„ -->
                <div class="w-full">
                  <div class="rounded-2xl overflow-hidden bg-gray-100 aspect-[4/3] shadow-lg" style="min-height:300px;">
                    <!-- âœ… map idëŠ” ë¬´ì¡°ê±´ 1ê°œë§Œ -->
                    <div id="map" class="w-full h-full"></div>
                  </div>

                  <!-- âœ… ë²„íŠ¼: ì§€ë„ ì•„ë˜ ì˜¤ë¥¸ìª½(ìƒì‹œ ë…¸ì¶œ/í´ë¦­ 100%) -->
                  <div class="mt-3 flex justify-end">
                    <button id="kakao-map-btn" type="button" onclick="openKakaoMap()"
                      class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow-lg font-medium transition-all flex items-center gap-2">
                      <span>ğŸ—ºï¸</span>
                      <span>ì¹´ì¹´ì˜¤ë§µ</span>
                    </button>
                  </div>
                </div>

                <!-- âœ… ì£¼ì†Œ: ì§€ë„ í•˜ë‹¨ -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6">
                  <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-blue-500 rounded-xl flex items-center justify-center">
                      <span class="text-white text-sm">ğŸ“</span>
                    </div>
                    <div class="flex-1">
                      <div class="text-sm font-semibold text-gray-700 mb-1">ì£¼ì†Œ</div>
                      <div id="address" class="text-gray-800 font-medium">ì£¼ì†Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </div>
                  </div>
                </div>

              </div>
            </div>

            <!-- ë‚´ìš© ì˜ì—­ -->
            <section>
              <div class="text-center mb-8">
                <h2 class="text-2xl font-bold gradient-text mb-2">ğŸ¯ ê°€ê²Œ ìë‘ ìŠ¤í† ë¦¬</h2>
                <p class="text-gray-600">ì‚¬ì¥ë‹˜ì´ ì§ì ‘ ë“¤ë ¤ì£¼ëŠ” ìš°ë¦¬ ê°€ê²Œë§Œì˜ íŠ¹ë³„í•œ ì´ì•¼ê¸°</p>
              </div>

              <div id="pride-content"
                class="content-area text-base leading-relaxed text-gray-800 bg-gradient-to-br from-white to-gray-50 rounded-3xl px-6 py-8 border-2 border-gray-100 shadow-lg">
                <div class="text-center py-8">
                  <div class="animate-pulse">
                    <div
                      class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                      <span class="text-white text-xl">âœ¨</span>
                    </div>
                    <p class="text-gray-500">ê°€ê²Œ ìë‘ ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
                  </div>
                </div>
              </div>
            </section>

            <!-- ì´ì „/ë‹¤ìŒ ë²„íŠ¼ -->
            <div class="flex justify-between mt-10 gap-4">
              <a id="prevBtn" href="#"
                class="px-6 py-3 bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 text-gray-700 rounded-xl font-medium transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                <span>â†</span><span>ì´ì „</span>
              </a>

              <a id="nextBtn" href="#"
                class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-xl font-medium transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                <span>ë‹¤ìŒ</span><span>â†’</span>
              </a>
            </div>

          </div>
        </div>
      </div>
    </main>

    <!-- í‘¸í„° ë¡œë“œ ì˜ì—­ -->
    <div id="footer-placeholder"></div>
  </div>

  <!-- ìš°ì¸¡ í•˜ë‹¨ ê³ ì • ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
  <div class="fixed bottom-6 right-6 flex flex-col gap-3 z-50">
    <button id="goPrev"
      class="w-14 h-14 rounded-full bg-white shadow-xl border border-gray-200 flex items-center justify-center text-lg font-bold hover:scale-110 transition">
      â†
    </button>

    <button id="goHome"
      class="w-14 h-14 rounded-full bg-white shadow-xl border border-gray-200 flex items-center justify-center text-lg font-bold hover:scale-110 transition">
      ğŸ 
    </button>

    <button id="goNext"
      class="w-14 h-14 rounded-full bg-white shadow-xl border border-gray-200 flex items-center justify-center text-lg font-bold hover:scale-110 transition">
      â†’
    </button>
  </div>

  <script>
    // í—¤ë”ì™€ í‘¸í„° ë¡œë“œ í•¨ìˆ˜
    async function loadComponents() {
      try {
        const headerResponse = await fetch("/components/header.html");
        const headerHtml = await headerResponse.text();
        document.getElementById("header-placeholder").innerHTML = headerHtml;

        const footerResponse = await fetch("/components/footer.html");
        const footerHtml = await footerResponse.text();
        document.getElementById("footer-placeholder").innerHTML = footerHtml;
      } catch (error) {
        console.warn("í—¤ë”/í‘¸í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:", error);
      }
    }

    // ì „ì—­(ì¹´ì¹´ì˜¤ë§µ ë²„íŠ¼ìš©)
    let storeCoords = null;       // kakao.maps.LatLng
    let storeAddress = "";        // string
    let storeNameGlobal = "";     // string
    window.__storePrideMap = null; // { map, marker, infowindow, geocoder }

    // âœ… ì§€ë„ í•˜ë‹¨ ë²„íŠ¼: ì¹´ì¹´ì˜¤ë§µ ì ‘ì†(ìƒì‹œ)
    function openKakaoMap() {
      const name = encodeURIComponent(storeNameGlobal || "ê°€ê²Œ ìœ„ì¹˜");
      const addrText = (storeAddress || document.getElementById("address")?.textContent || "").trim();

      // ì¢Œí‘œ ìˆìœ¼ë©´ ì§€ë„ ë³´ê¸°ë¡œ
      if (storeCoords && typeof storeCoords.getLat === "function") {
        const lat = storeCoords.getLat();
        const lng = storeCoords.getLng();
        const url = `https://map.kakao.com/link/map/${name},${lat},${lng}`;
        window.open(url, "_blank", "noopener,noreferrer");
        return;
      }

      // ì¢Œí‘œ ì—†ìœ¼ë©´ ì£¼ì†Œ ê²€ìƒ‰ìœ¼ë¡œ
      if (addrText && !addrText.includes("ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘") && addrText !== "-") {
        const url = `https://map.kakao.com/link/search/${encodeURIComponent(addrText)}`;
        window.open(url, "_blank", "noopener,noreferrer");
        return;
      }

      alert("ì£¼ì†Œ/ì¢Œí‘œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }

    // ì´ì „/ë‹¤ìŒ ë²„íŠ¼ ì„¤ì •
    function setupNavigationButtons() {
      const currentId = Number(new URLSearchParams(location.search).get("id"));
      const nextId = currentId + 1;

      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      if (prevBtn) {
        prevBtn.href = "javascript:void(0)";
        prevBtn.onclick = (e) => {
          e.preventDefault();
          history.back();
        };
      }

      if (nextBtn) {
        nextBtn.href = `/storepridedetail.html?id=${nextId}`;
      }

      // ìš°ì¸¡ í•˜ë‹¨ ê³ ì • ë²„íŠ¼
      const goPrevBtn = document.getElementById("goPrev");
      const goNextBtn = document.getElementById("goNext");
      const goHomeBtn = document.getElementById("goHome");

      if (goPrevBtn) goPrevBtn.onclick = () => history.back();
      if (goNextBtn) goNextBtn.onclick = () => (location.href = `/storepridedetail.html?id=${nextId}`);
      if (goHomeBtn) goHomeBtn.onclick = () => (location.href = `/substorepride.html`);
    }

    // ì¿¼ë¦¬ìŠ¤íŠ¸ë§
    function getQueryParam(name) {
      return new URLSearchParams(window.location.search).get(name);
    }

    async function loadStorePrideDetail() {
      const statusEl = document.getElementById("status");
      const id = getQueryParam("id");

      if (!id) {
        statusEl.textContent = "ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤. id íŒŒë¼ë¯¸í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
        statusEl.classList.remove("hidden");
        statusEl.classList.add("text-red-500");
        return;
      }

      try {
        statusEl.textContent = "ìŠ¤í† ì–´ í”„ë¼ì´ë“œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...";
        statusEl.classList.remove("hidden");
        statusEl.classList.remove("text-red-500");
        statusEl.classList.add("text-slate-500");

        const res = await fetch(`/api/storeprideregister/${id}`);

        if (res.status === 404) {
          statusEl.textContent = "ìš”ì²­í•˜ì‹  ìŠ¤í† ì–´ í”„ë¼ì´ë“œ ê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          statusEl.classList.remove("text-slate-500");
          statusEl.classList.add("text-red-500");
          const contentEl = document.getElementById("pride-content");
          if (contentEl) contentEl.innerHTML = `<p class="text-slate-500">ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²Œì‹œë¬¼(ID: ${id})ì…ë‹ˆë‹¤.</p>`;
          return;
        }

        if (!res.ok) throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${res.status}`);

        const json = await res.json();
        if (!json.ok) throw new Error(json.error || "ë°ì´í„° ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");

        const data = json.data || {};

        // ì „ì—­(ì¹´ì¹´ì˜¤ë§µ ë²„íŠ¼ìš©)
        storeNameGlobal = data.store_name || "ê°€ê²Œ ìœ„ì¹˜";
        storeAddress = data.address || "";

        // ê¸°ë³¸ ì •ë³´
        document.getElementById("store-name").textContent = data.store_name || "(ê°€ê²Œ ì´ë¦„ ì—†ìŒ)";
        document.getElementById("business-tags").textContent = data.category || "";
        document.getElementById("address").textContent = data.address || "-";
        document.getElementById("phone").textContent = data.phone || "-";

        // ì¹´í…Œê³ ë¦¬/ë‚ ì§œ
        document.getElementById("category-pill").textContent =
          data.category ? `ë¶„ë¥˜: ${data.category}` : "ë¶„ë¥˜ ì •ë³´ ì—†ìŒ";

        if (data.created_at) {
          const d = new Date(data.created_at);
          const y = d.getFullYear();
          const m = String(d.getMonth() + 1).padStart(2, "0");
          const day = String(d.getDate()).padStart(2, "0");
          document.getElementById("date-pill").textContent = `${y}-${m}-${day}`;
        } else {
          document.getElementById("date-pill").textContent = "ë‚ ì§œ ì •ë³´ ì—†ìŒ";
        }

        // ëŒ€í‘œ ì´ë¯¸ì§€
        const thumbEl = document.getElementById("thumbnail");
        const thumbPlaceholder = document.getElementById("thumbnail-placeholder");

        if (data.main_img) {
          let imgPath = data.main_img;
          if (!imgPath.startsWith("/uploads/") && !imgPath.startsWith("http")) imgPath = `/uploads/${imgPath}`;
          thumbEl.src = imgPath;
          thumbEl.classList.remove("hidden");
          thumbPlaceholder.classList.add("hidden");
        } else {
          thumbEl.classList.add("hidden");
          thumbPlaceholder.classList.remove("hidden");
        }

        // ì§€ë„ ì´ˆê¸°í™”
        if (data.address) initKakaoMap(data.address, data.store_name);

        // ì½˜í…ì¸  ë Œë”ë§
        const contentEl = document.getElementById("pride-content");
        let contentHtml = "";

        if (data.free_pr && String(data.free_pr).trim()) {
          contentHtml += `
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-slate-800 mb-3">ğŸ¯ ê°€ê²Œ í™ë³´</h3>
            <div class="bg-white rounded-xl p-4 border border-slate-200">
              ${String(data.free_pr).replace(/\n/g, "<br>")}
            </div>
          </div>
        `;
        }

        if (Array.isArray(data.qas) && data.qas.length > 0) {
          contentHtml += `
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-slate-800 mb-3">ğŸ’¬ ì§ˆë¬¸ê³¼ ë‹µë³€ (${data.qa_mode === "fixed" ? "ê³ ì • ì§ˆë¬¸" : "ììœ  ì§ˆë¬¸"})</h3>
            <div class="space-y-4">
        `;

          data.qas.forEach((qa, index) => {
            contentHtml += `
            <div class="bg-white rounded-xl p-4 border border-slate-200">
              <div class="mb-3">
                <span class="inline-block bg-sky-100 text-sky-700 text-sm font-medium px-2 py-1 rounded-lg">
                  Q${qa.seq || index + 1}
                </span>
              </div>
              <div class="mb-3">
                <p class="font-semibold text-slate-800">${qa.question || "ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤"}</p>
              </div>
              <div class="mb-3">
                <p class="text-slate-700">${qa.answer ? String(qa.answer).replace(/\n/g, "<br>") : "ë‹µë³€ì´ ì—†ìŠµë‹ˆë‹¤"}</p>
              </div>
          `;

            if (qa.image_path) {
              let qaImgPath = qa.image_path;
              if (!qaImgPath.startsWith("/uploads/") && !qaImgPath.startsWith("http")) qaImgPath = `/uploads/${qaImgPath}`;
              contentHtml += `
              <div class="mt-3">
                <img src="${qaImgPath}" alt="Q&A ì´ë¯¸ì§€" class="max-w-full h-auto rounded-lg border border-slate-200" />
              </div>
            `;
            }

            contentHtml += `</div>`;
          });

          contentHtml += `</div></div>`;
        }

        contentEl.innerHTML = contentHtml || '<p class="text-slate-500">ë“±ë¡ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';

        statusEl.classList.add("hidden");
        setupNavigationButtons();
      } catch (err) {
        console.error(err);
        statusEl.textContent = `ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤: ${err.message}`;
        statusEl.classList.remove("hidden");
        statusEl.classList.remove("text-slate-500");
        statusEl.classList.add("text-red-500");
      }
    }

    // ì¹´ì¹´ì˜¤ ì§€ë„ ì´ˆê¸°í™”
    function initKakaoMap(address, storeName) {
      const mapContainer = document.getElementById("map");
      if (!mapContainer) return;

      if (typeof kakao === "undefined" || !kakao.maps) {
        mapContainer.innerHTML = '<div class="flex items-center justify-center h-full text-gray-500">ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }

      kakao.maps.load(() => {
        const mapOption = {
          center: new kakao.maps.LatLng(37.5665, 126.9780),
          level: 3,
        };

        const map = new kakao.maps.Map(mapContainer, mapOption);
        const geocoder = new kakao.maps.services.Geocoder();
        const marker = new kakao.maps.Marker({ map });
        const infowindow = new kakao.maps.InfoWindow({ removable: false });

        window.__storePrideMap = { map, geocoder, marker, infowindow };

        geocoder.addressSearch(address, (result, status) => {
          if (status === kakao.maps.services.Status.OK && result?.[0]) {
            const coords = new kakao.maps.LatLng(result[0].y, result[0].x);

            storeCoords = coords; // âœ… ë²„íŠ¼ì—ì„œ ì‚¬ìš©
            marker.setPosition(coords);

            infowindow.setContent(
              `<div style="width:150px;text-align:center;padding:6px 0;font-size:12px;">${storeName || "ê°€ê²Œ ìœ„ì¹˜"}</div>`
            );
            infowindow.open(map, marker);

            map.setCenter(coords);
            map.setLevel(3);
          }
        });
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadComponents();
      loadStorePrideDetail();
    });
  </script>

</body>

</html>