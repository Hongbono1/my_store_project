<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사장님 페이지</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden-section {
            display: none;
        }

        .active-link {
            background: linear-gradient(to right, #60a5fa, #8b5cf6);
            color: white !important;
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 font-sans">
    <div class="flex min-h-screen">

        <!-- ✅ 사이드바 -->
        <aside
            class="w-64 bg-white/60 backdrop-blur-xl border-r border-gray-200 shadow-[8px_8px_20px_rgba(0,0,0,0.1),-8px_-8px_20px_rgba(255,255,255,0.7)] flex flex-col">
            <div
                class="p-6 text-center font-extrabold text-2xl bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent">
                사장님 메뉴
            </div>
            <nav id="sidebarMenu" class="flex-1 px-4 py-6 space-y-4">
                <a href="#" data-section="dashboard"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    대시보드
                </a>

                <!-- 🧾 주문 관리 -->
                <a href="#" data-section="order"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    주문 관리
                </a>

                <a href="#" data-section="store"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    가게 관리
                </a>

                <a href="#" data-section="menu"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    메뉴 관리
                </a>

                <a href="#" data-section="promotion"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    광고/홍보 관리
                </a>

                <a href="#" data-section="event"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    이벤트 관리
                </a>

                <!-- ✅ 등록 관리 (섹션 전환 X, 하위 메뉴 토글용) -->
                <a href="#" data-section="register"
                    class="nav-link flex items-center justify-between px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    <span>등록 관리</span>
                    <svg xmlns="http://www.w3.org/2000/svg"
                        class="h-4 w-4 text-gray-500 transition-transform duration-300" id="registerArrow" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </a>

                <!-- ✅ 등록 관리 하위 메뉴 (10개) -->
                <div id="subRegisterMenu" class="submenu hidden pl-6 space-y-2">
                    <!-- 🍜 음식점 등록 -->
                    <a href="#" data-target="foodregister" class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700
                          hover:bg-blue-100 hover:text-blue-700 transition">
                        🍜 음식점 등록
                    </a>

                    <!-- 🏪 통합 가게 등록 -->
                    <a href="#" data-target="ncombinedregister" class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700
                          hover:bg-purple-100 hover:text-purple-700 transition">
                        🏪 통합 가게 등록
                    </a>

                    <!-- 🆕 오픈예정 매장 등록 -->
                    <a href="#" data-target="openregister" class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700
                          hover:bg-indigo-100 hover:text-indigo-700 transition">
                        🆕 오픈예정 등록
                    </a>

                    <!-- 🏆 가게 자랑 등록 -->
                    <a href="#" data-target="storeprideregister" class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700
                          hover:bg-amber-100 hover:text-amber-700 transition">
                        🏆 가게 자랑 등록
                    </a>

                    <!-- 🏛️ 전통시장 등록 -->
                    <a href="#" data-target="traditionalmarketregister" class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700
                          hover:bg-emerald-100 hover:text-emerald-700 transition">
                        🏛️ 전통시장 등록
                    </a>

                    <!-- 🎭 공연/예술 등록 -->
                    <a href="#" data-target="performingartregister" class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700
                          hover:bg-yellow-100 hover:text-yellow-700 transition">
                        🎭 공연/예술 등록
                    </a>

                    <!-- 🎉 이벤트 등록 -->
                    <a href="#" data-target="eventregister" class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700
                          hover:bg-rose-100 hover:text-rose-700 transition">
                        🎉 이벤트 등록
                    </a>

                    <!-- 🛒 쇼핑 등록 -->
                    <a href="#" data-target="shoppingregister" class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700
                          hover:bg-sky-100 hover:text-sky-700 transition">
                        🛒 쇼핑 등록
                    </a>

                    <!-- 💬 문의 등록 -->
                    <a href="#" data-target="inquiryregister" class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700
                          hover:bg-slate-100 hover:text-slate-700 transition">
                        💬 문의 등록
                    </a>

                    <!-- 📰 홍보 블로그 등록 -->
                    <a href="#" data-target="hotblogregister" class="sub-link block px-4 py-2 rounded-lg bg-gray-50 text-gray-700
                          hover:bg-pink-100 hover:text-pink-700 transition">
                        📰 홍보 블로그 등록
                    </a>
                </div>

                <!-- 💬 리뷰/문의 관리 -->
                <a href="#" data-section="review"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    리뷰 · 문의 관리
                </a>

                <!-- 💰 정산/매출 -->
                <a href="#" data-section="settlement"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    정산 / 매출
                </a>

                <!-- 📚 가이드 -->
                <a href="#" data-section="guide"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    가이드 / 도움말
                </a>

                <a href="#" data-section="settings"
                    class="nav-link block px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition shadow">
                    설정
                </a>
            </nav>
        </aside>


        <!-- ✅ 메인 -->
        <main class="flex-1 p-8">
            <!-- 상단 헤더 -->
            <header class="flex justify-between items-center mb-8">
                <div class="space-y-1">
                    <h1 class="text-3xl font-bold drop-shadow-sm">사장님 페이지</h1>
                    <!-- 실시간 주문 알림 표시 -->
                    <span id="realtime-order-indicator"
                        class="inline-flex items-center px-3 py-1 rounded-full bg-gray-100 text-xs text-gray-600 font-semibold">
                        실시간 주문 알림:
                        <span id="realtime-order-count" class="ml-1 font-bold">없음</span>
                    </span>
                </div>
                <button
                    class="px-4 py-2 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow hover:opacity-90 transition">로그아웃</button>
            </header>

            <!-- 📊 대시보드 -->
            <section id="dashboard" class="content-section">
                <h2 class="text-xl font-bold mb-4">📊 오늘의 요약</h2>

                <!-- ✅ 통계 카드 -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-6">
                    <div class="p-6 rounded-2xl bg-white shadow text-center hover:-translate-y-1 transition">
                        <p class="text-gray-500 text-sm">오늘 방문자</p>
                        <p id="today-visitors" class="text-2xl font-extrabold text-blue-600">0</p>
                    </div>
                    <div class="p-6 rounded-2xl bg-white shadow text-center hover:-translate-y-1 transition">
                        <p class="text-gray-500 text-sm">즐겨찾기 수</p>
                        <p id="favorites" class="text-2xl font-extrabold text-green-600">0</p>
                    </div>
                    <div class="p-6 rounded-2xl bg-white shadow text-center hover:-translate-y-1 transition">
                        <p class="text-gray-500 text-sm">주문 건수</p>
                        <p id="orders" class="text-2xl font-extrabold text-purple-600">0</p>
                    </div>
                    <div class="p-6 rounded-2xl bg-white shadow text-center hover:-translate-y-1 transition">
                        <p class="text-gray-500 text-sm">리뷰 수</p>
                        <p id="reviews" class="text-2xl font-extrabold text-pink-600">0</p>
                    </div>
                    <div class="p-6 rounded-2xl bg-white shadow text-center hover:-translate-y-1 transition">
                        <p class="text-gray-500 text-sm">오늘 매출</p>
                        <p id="today-sales" class="text-2xl font-extrabold text-orange-500">₩0</p>
                    </div>
                </div>

                <!-- 🔔 처리해야 할 일 / 알림 -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">
                    <div class="p-5 rounded-2xl bg-white shadow flex flex-col gap-2">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">⚠️ 처리해야 할 리뷰</h3>
                            <span
                                class="inline-flex items-center justify-center px-3 py-1 rounded-full bg-red-50 text-red-600 text-xs font-semibold">
                                미답변 0건
                            </span>
                        </div>
                        <p class="text-sm text-gray-500">
                            최근 7일 내 리뷰 중 답변이 없는 리뷰를 모아서 보여줄 예정입니다.
                        </p>
                    </div>
                    <div class="p-5 rounded-2xl bg-white shadow flex flex-col gap-2">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">📮 문의 처리</h3>
                            <span
                                class="inline-flex items-center justify-center px-3 py-1 rounded-full bg-yellow-50 text-yellow-700 text-xs font-semibold">
                                대기 0건
                            </span>
                        </div>
                        <p class="text-sm text-gray-500">
                            고객 문의(문의 게시판, 1:1 문의 등) 처리 현황을 이곳에서 한눈에 확인할 수 있습니다.
                        </p>
                    </div>
                    <div class="p-5 rounded-2xl bg-white shadow flex flex-col gap-2">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800">📢 진행 중인 광고</h3>
                            <span
                                class="inline-flex items-center justify-center px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs font-semibold">
                                0개
                            </span>
                        </div>
                        <p class="text-sm text-gray-500">
                            메인 배너 / 우리동네 추천 / 스토어 프라이드 노출 현황이 표시될 예정입니다.
                        </p>
                    </div>
                </div>

                <!-- ✅ 오늘 할 일 체크리스트 -->
                <div class="bg-white rounded-2xl shadow p-6 mb-10">
                    <h3 class="text-lg font-bold mb-4">📌 오늘의 할 일</h3>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li class="flex items-center gap-2">
                            <input type="checkbox" class="rounded text-blue-500">
                            <span>오늘 등록된 신규 리뷰 확인</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <input type="checkbox" class="rounded text-blue-500">
                            <span>대표 메뉴 사진 1장 이상 업로드</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <input type="checkbox" class="rounded text-blue-500">
                            <span>영업시간 / 브레이크타임 정보 최신화 확인</span>
                        </li>
                    </ul>
                </div>

                <!-- 📈 그래프 -->
                <div class="bg-white rounded-2xl shadow p-6 mb-10">
                    <h3 class="text-lg font-bold mb-4">📅 매출 추이 (일/주/월 등)</h3>
                    <canvas id="statsChart" height="100"></canvas>

                    <!-- ✅ 기간 선택 버튼 -->
                    <div class="flex flex-wrap gap-2 justify-end mt-4">
                        <button class="period-btn px-3 py-1 bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200"
                            data-period="daily">일간</button>
                        <button class="period-btn px-3 py-1 bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200"
                            data-period="weekly">주간</button>
                        <button class="period-btn px-3 py-1 bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200"
                            data-period="monthly">월간</button>
                        <button class="period-btn px-3 py-1 bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200"
                            data-period="quarterly">분기</button>
                        <button class="period-btn px-3 py-1 bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200"
                            data-period="half">반기</button>
                        <button class="period-btn px-3 py-1 bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200"
                            data-period="yearly">연간</button>
                    </div>
                </div>

                <!-- 📦 최근 주문 내역 -->
                <div class="bg-white rounded-2xl shadow p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold">🧾 최근 주문 내역</h3>
                        <button id="go-order-from-dashboard"
                            class="text-xs px-3 py-1 rounded-full bg-gray-100 text-gray-700 hover:bg-blue-50">
                            주문 관리로 이동
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-gray-700">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-2 px-3">주문번호</th>
                                    <th class="text-left py-2 px-3">메뉴</th>
                                    <th class="text-left py-2 px-3">가격</th>
                                    <th class="text-left py-2 px-3">주문시간</th>
                                    <th class="text-left py-2 px-3">상태</th>
                                </tr>
                            </thead>
                            <tbody id="recent-orders-body">
                                <tr>
                                    <td colspan="5" class="py-6 text-center text-gray-400">로딩 중...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- 🧾 주문 관리 -->
            <section id="order" class="content-section hidden-section">
                <h2 class="text-xl font-bold mb-6">🧾 주문 관리</h2>

                <!-- 필터 / 검색 -->
                <div class="bg-white rounded-2xl shadow p-4 mb-4 flex flex-wrap gap-3 items-center justify-between">
                    <div class="flex flex-wrap gap-2 items-center text-sm">
                        <span class="text-gray-600 font-semibold mr-1">기간</span>
                        <button
                            class="px-3 py-1 rounded-full border text-gray-700 hover:bg-blue-50 hover:border-blue-300">오늘</button>
                        <button
                            class="px-3 py-1 rounded-full border text-gray-700 hover:bg-blue-50 hover:border-blue-300">3일</button>
                        <button
                            class="px-3 py-1 rounded-full border text-gray-700 hover:bg-blue-50 hover:border-blue-300">7일</button>
                        <button
                            class="px-3 py-1 rounded-full border text-gray-700 hover:bg-blue-50 hover:border-blue-300">30일</button>
                    </div>
                    <div class="flex flex-wrap gap-2 items-center text-sm">
                        <select class="border rounded-full px-3 py-1 text-gray-700">
                            <option value="">전체 상태</option>
                            <option value="pending">대기중</option>
                            <option value="preparing">조리중</option>
                            <option value="delivering">배달중</option>
                            <option value="completed">완료</option>
                            <option value="canceled">취소</option>
                        </select>
                        <input type="text" placeholder="메뉴명 / 주문번호 검색"
                            class="border rounded-full px-3 py-1 text-sm w-48">
                    </div>
                </div>

                <!-- 주문 리스트 -->
                <div class="bg-white rounded-2xl shadow p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-gray-800">주문 목록</h3>
                        <span class="text-xs text-gray-500">상태 변경 / 취소 기능은 나중에 서버와 연동 예정입니다.</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-gray-700">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-2 px-3">주문번호</th>
                                    <th class="text-left py-2 px-3">메뉴</th>
                                    <th class="text-left py-2 px-3">가격</th>
                                    <th class="text-left py-2 px-3">주문시간</th>
                                    <th class="text-left py-2 px-3">상태</th>
                                    <th class="text-left py-2 px-3">관리</th>
                                </tr>
                            </thead>
                            <tbody id="order-manage-body">
                                <tr>
                                    <td colspan="6" class="py-6 text-center text-gray-400">주문 데이터를 불러오는 중입니다.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- 🏪 가게 관리 -->
            <section id="store" class="content-section hidden-section">
                <h2 class="text-xl font-bold mb-6">🏪 가게 등록 / 관리</h2>

                <form id="registerForm" enctype="multipart/form-data" class="space-y-6 bg-white p-6 rounded-2xl shadow">

                    <!-- ✅ 사업자 정보 (읽기 전용) -->
                    <div>
                        <label class="block font-bold mb-2">사업자 등록번호</label>
                        <input type="text" name="businessNumber" value="000-00-00000"
                            class="w-full p-2 border rounded bg-gray-100 text-gray-600" readonly>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block font-bold mb-2">대표자 이름</label>
                            <input type="text" name="ownerName" value="홍길동"
                                class="w-full p-2 border rounded bg-gray-100 text-gray-600" readonly>
                        </div>
                        <div>
                            <label class="block font-bold mb-2">연락처</label>
                            <input type="text" name="ownerPhone" value="010-1234-5678"
                                class="w-full p-2 border rounded">
                            <!-- 연락처는 수정 가능 -->
                        </div>
                    </div>

                    <div>
                        <label class="block font-bold mb-2">가게명</label>
                        <input type="text" name="storeName" value="홍길동 식당"
                            class="w-full p-2 border rounded bg-gray-100 text-gray-600" readonly>
                    </div>

                    <!-- ✅ 가게 정보 입력 (사장이 직접 관리) -->
                    <div>
                        <label class="block font-bold mb-2">주소</label>
                        <input type="text" name="storeAddress" class="w-full p-2 border rounded">
                    </div>

                    <div>
                        <label class="block font-bold mb-2">영업시간</label>
                        <input type="text" name="openHours" class="w-full p-2 border rounded"
                            placeholder="예: 10:00 ~ 22:00">
                    </div>

                    <!-- 브레이크 타임 / 쉬는 시간 -->
                    <div>
                        <label class="block font-bold mb-2">브레이크 타임 (쉬는 시간)</label>
                        <div class="flex items-center gap-2">
                            <input type="time" name="breakStart" class="p-2 border rounded">
                            <span class="text-sm text-gray-600">~</span>
                            <input type="time" name="breakEnd" class="p-2 border rounded">
                        </div>
                        <p class="text-xs text-gray-400 mt-1">예) 15:00 ~ 17:00 (준비 시간 등으로 주문을 받지 않는 시간)</p>
                    </div>

                    <div>
                        <label class="block font-bold mb-2">가게 설명</label>
                        <textarea name="description" rows="3" class="w-full p-2 border rounded"></textarea>
                    </div>

                    <!-- 영업 형태 -->
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <label class="inline-flex items-center gap-2 text-sm text-gray-700">
                            <input type="checkbox" class="rounded text-blue-500" name="hasDelivery">
                            <span>배달 가능</span>
                        </label>
                        <label class="inline-flex items-center gap-2 text-sm text-gray-700">
                            <input type="checkbox" class="rounded text-blue-500" name="hasTakeout">
                            <span>포장 가능</span>
                        </label>
                        <label class="inline-flex items-center gap-2 text-sm text-gray-700">
                            <input type="checkbox" class="rounded text-blue-500" name="hasHall">
                            <span>매장 식사 가능</span>
                        </label>
                    </div>

                    <!-- 가게 태그 -->
                    <div>
                        <label class="block font-bold mb-2">가게 태그</label>
                        <input type="text" name="storeTags" class="w-full p-2 border rounded"
                            placeholder="#혼밥 #단체석 #주차가능 등">
                        <p class="text-xs text-gray-400 mt-1">
                            검색/필터 및 상위 페이지 노출에 활용될 태그입니다. 쉼표 또는 띄어쓰기로 구분해서 입력해주세요.
                        </p>
                    </div>

                    <!-- 가게 이미지 업로드 -->
                    <div>
                        <label class="block font-bold mb-2">가게 대표 이미지</label>
                        <input type="file" name="storeImages" multiple class="w-full p-2 border rounded">
                        <p class="text-xs text-gray-400 mt-1">최대 3~5장 정도를 권장합니다. 첫 번째 이미지가 대표 이미지로
                            사용됩니다.</p>
                    </div>

                    <button type="submit" class="px-6 py-2 bg-green-500 text-white rounded-full shadow">
                        등록하기
                    </button>
                </form>
            </section>

            <!-- 🍜 메뉴 관리 -->
            <section id="menu" class="content-section hidden-section">
                <h2 class="text-xl font-bold mb-4">🍜 메뉴 관리</h2>

                <!-- 메뉴 카테고리 안내 -->
                <div class="bg-white rounded-2xl shadow p-4 mb-4 flex flex-wrap gap-3 items-center justify-between">
                    <div class="text-sm text-gray-700 flex flex-wrap gap-2 items-center">
                        <span class="font-semibold text-gray-800 mr-2">카테고리 예시</span>
                        <span class="px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs">식사류</span>
                        <span class="px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs">사이드</span>
                        <span class="px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs">음료</span>
                        <span class="px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs">주류</span>
                    </div>
                    <button id="btn-add-menu" class="px-4 py-2 bg-green-500 text-white rounded-full shadow text-sm">
                        + 메뉴 추가
                    </button>
                </div>

                <div id="menu-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- JS에서 메뉴 카드 채움 -->
                </div>

                <!-- 메뉴 추가/수정 모달 (UI만, 추후 서버 연동) -->
                <div id="menu-modal"
                    class="fixed inset-0 bg-black/40 flex items-center justify-center z-40 hidden px-4">
                    <div class="bg-white rounded-2xl shadow-xl max-w-lg w-full p-6 space-y-4">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-lg font-bold text-gray-800">🍜 메뉴 등록 / 수정</h3>
                            <button id="menu-modal-close"
                                class="text-gray-400 hover:text-gray-700 text-xl leading-none">&times;</button>
                        </div>

                        <div class="space-y-3 text-sm">
                            <div>
                                <label class="block text-gray-700 mb-1">메뉴명</label>
                                <input type="text" id="menu-name-input" class="w-full p-2 border rounded"
                                    placeholder="예: 김치찌개 정식">
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-gray-700 mb-1">카테고리</label>
                                    <input type="text" id="menu-category-input" class="w-full p-2 border rounded"
                                        placeholder="예: 식사류 / 사이드">
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-1">가격(원)</label>
                                    <input type="number" id="menu-price-input" class="w-full p-2 border rounded"
                                        placeholder="예: 9000">
                                </div>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">옵션 / 추가 설정 (간단 메모)</label>
                                <input type="text" id="menu-option-input" class="w-full p-2 border rounded"
                                    placeholder="예: 곱빼기 +2000, 치즈추가 +1500">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">설명</label>
                                <textarea id="menu-desc-input" rows="2" class="w-full p-2 border rounded"
                                    placeholder="예: 국내산 돼지고기를 사용한 구수한 김치찌개입니다."></textarea>
                            </div>
                        </div>

                        <div class="flex justify-end gap-2 mt-4">
                            <button id="menu-modal-cancel"
                                class="px-4 py-2 rounded-full border border-gray-300 text-gray-700 text-sm">
                                취소
                            </button>
                            <button id="menu-modal-save"
                                class="px-4 py-2 rounded-full bg-green-500 text-white text-sm shadow">
                                저장 (UI만 동작)
                            </button>
                        </div>
                        <p class="text-xs text-gray-400 mt-2">
                            실제 DB 저장/수정/삭제는 추후 API 연동 시 구현합니다.
                        </p>
                    </div>
                </div>
            </section>

            <!-- 📢 광고/홍보 관리 -->
            <section id="promotion" class="content-section hidden-section">
                <h2 class="text-xl font-bold mb-4">📢 광고/홍보 관리</h2>
                <div class="bg-white rounded-2xl shadow p-6 space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="p-4 rounded-xl border bg-gradient-to-br from-blue-50 to-blue-100">
                            <h3 class="font-semibold text-gray-800 mb-1">메인 배너 상단 노출</h3>
                            <p class="text-xs text-gray-600 mb-2">홈 상단 배너 영역에 가게 광고를 노출합니다.</p>
                            <button
                                class="mt-1 px-3 py-1 rounded-full bg-white text-sm border border-blue-300 text-blue-700">자세히</button>
                        </div>
                        <div class="p-4 rounded-xl border bg-gradient-to-br from-purple-50 to-purple-100">
                            <h3 class="font-semibold text-gray-800 mb-1">우리동네 추천 영역</h3>
                            <p class="text-xs text-gray-600 mb-2">HOT PLACE / 추천 가게 카드에 노출합니다.</p>
                            <button
                                class="mt-1 px-3 py-1 rounded-full bg-white text-sm border border-purple-300 text-purple-700">자세히</button>
                        </div>
                        <div class="p-4 rounded-xl border bg-gradient-to-br from-amber-50 to-amber-100">
                            <h3 class="font-semibold text-gray-800 mb-1">스토어 프라이드 노출</h3>
                            <p class="text-xs text-gray-600 mb-2">가게 자랑/홍보 글을 상위에 고정 노출합니다.</p>
                            <button
                                class="mt-1 px-3 py-1 rounded-full bg-white text-sm border border-amber-300 text-amber-700">자세히</button>
                        </div>
                    </div>

                    <div class="border-t pt-4">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-semibold text-gray-800">진행 중인 광고</h3>
                            <button class="px-4 py-2 bg-purple-500 text-white rounded-full text-sm shadow">+ 새 광고
                                신청</button>
                        </div>
                        <p class="text-sm text-gray-400">현재 진행 중인 광고가 없습니다. 광고를 신청하면 이곳에 노출됩니다.</p>
                    </div>
                </div>
            </section>

            <!-- 🎉 이벤트 관리 -->
            <section id="event" class="content-section hidden-section">
                <h2 class="text-xl font-bold mb-4">🎉 이벤트 관리</h2>
                <div class="bg-white rounded-2xl shadow p-6 space-y-4">
                    <div class="flex items-center justify-between">
                        <h3 class="font-semibold text-gray-800">이벤트 / 쿠폰</h3>
                        <button class="px-4 py-2 bg-pink-500 text-white rounded-full shadow text-sm">+ 이벤트 등록</button>
                    </div>
                    <p class="text-sm text-gray-500">
                        신규 고객 할인, 요일별 할인, 특정 메뉴 할인 등 다양한 이벤트를 등록할 수 있도록 확장될 예정입니다.
                    </p>
                    <div class="border-t pt-4">
                        <p class="text-sm text-gray-400">현재 등록된 이벤트가 없습니다.</p>
                    </div>
                </div>
            </section>

            <!-- 💬 리뷰 / 문의 관리 -->
            <section id="review" class="content-section hidden-section">
                <h2 class="text-xl font-bold mb-4">💬 리뷰 · 문의 관리</h2>

                <!-- 리뷰 통계 카드 -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4 text-sm">
                    <div class="p-4 bg-white rounded-2xl shadow">
                        <p class="text-gray-500 mb-1">평균 별점</p>
                        <p class="text-2xl font-extrabold text-yellow-500">0.0 ★</p>
                    </div>
                    <div class="p-4 bg-white rounded-2xl shadow">
                        <p class="text-gray-500 mb-1">전체 리뷰 수</p>
                        <p class="text-2xl font-extrabold text-blue-600">0</p>
                    </div>
                    <div class="p-4 bg-white rounded-2xl shadow">
                        <p class="text-gray-500 mb-1">미답변 리뷰</p>
                        <p class="text-2xl font-extrabold text-red-500">0</p>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow p-6">
                    <!-- 탭 -->
                    <div class="flex gap-3 border-b pb-3 mb-4 text-sm">
                        <button
                            class="review-tab px-3 py-1 rounded-full bg-blue-600 text-white font-semibold text-xs">리뷰</button>
                        <button
                            class="review-tab px-3 py-1 rounded-full bg-gray-100 text-gray-700 font-semibold text-xs">문의</button>
                        <button
                            class="review-tab px-3 py-1 rounded-full bg-gray-100 text-gray-700 font-semibold text-xs">댓글</button>
                    </div>

                    <!-- 필터 -->
                    <div class="flex flex-wrap gap-3 items-center justify-between mb-4 text-sm">
                        <div class="flex gap-2 items-center">
                            <span class="text-gray-600 text-xs font-semibold mr-1">필터</span>
                            <button
                                class="px-3 py-1 rounded-full border text-gray-700 hover:bg-blue-50 hover:border-blue-300 text-xs">전체</button>
                            <button
                                class="px-3 py-1 rounded-full border text-gray-700 hover:bg-blue-50 hover:border-blue-300 text-xs">미답변만</button>
                            <button
                                class="px-3 py-1 rounded-full border text-gray-700 hover:bg-blue-50 hover:border-blue-300 text-xs">별점
                                높은 순</button>
                        </div>
                        <span class="text-xs text-gray-400">실제 데이터 연동은 추후 구현 예정입니다.</span>
                    </div>

                    <!-- 리스트 영역 -->
                    <div id="review-list" class="space-y-4 text-sm">
                        <div class="p-4 rounded-xl border border-gray-100 bg-gray-50">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center gap-2">
                                    <span class="text-yellow-500 text-xs">★★★★★</span>
                                    <span class="text-xs text-gray-500">닉네임 · 2025-01-01</span>
                                </div>
                                <span
                                    class="inline-flex px-2 py-0.5 rounded-full bg-green-50 text-green-600 text-[11px] font-semibold">답변
                                    완료</span>
                            </div>
                            <p class="text-gray-700 mb-2">예시 리뷰 내용입니다. 실제 리뷰 내용이 이곳에 표시됩니다.</p>
                            <div class="mt-2 pl-3 border-l-2 border-blue-100 text-xs text-gray-600">
                                <span class="font-semibold text-blue-600">사장님 답변</span>
                                <p class="mt-1">이용해 주셔서 감사합니다. 다음에도 맛있게 준비하겠습니다 :)</p>
                            </div>
                        </div>

                        <div class="p-4 rounded-xl border border-gray-100 bg-white">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center gap-2">
                                    <span class="text-yellow-500 text-xs">★★★☆☆</span>
                                    <span class="text-xs text-gray-500">닉네임 · 2025-01-02</span>
                                </div>
                                <span
                                    class="inline-flex px-2 py-0.5 rounded-full bg-red-50 text-red-600 text-[11px] font-semibold">미답변</span>
                            </div>
                            <p class="text-gray-700 mb-2">여기에 실제 리뷰 내용이 표시됩니다.</p>
                            <button
                                class="mt-1 px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs border border-blue-200">
                                답글 달기
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 💰 정산 / 매출 관리 -->
            <section id="settlement" class="content-section hidden-section">
                <h2 class="text-xl font-bold mb-4">💰 정산 / 매출 관리</h2>

                <!-- 요약 카드 -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="p-4 rounded-2xl bg-white shadow text-sm">
                        <p class="text-gray-500 mb-1">이번 달 매출(가게 기준)</p>
                        <p class="text-2xl font-extrabold text-blue-600">₩0</p>
                    </div>
                    <div class="p-4 rounded-2xl bg-white shadow text-sm">
                        <p class="text-gray-500 mb-1">이번 달 광고 이용료</p>
                        <p class="text-2xl font-extrabold text-purple-600">₩0</p>
                    </div>
                    <div class="p-4 rounded-2xl bg-white shadow text-sm">
                        <p class="text-gray-500 mb-1">플랫폼 이용료</p>
                        <p class="text-2xl font-extrabold text-emerald-600">₩0</p>
                    </div>
                    <div class="p-4 rounded-2xl bg-white shadow text-sm">
                        <p class="text-gray-500 mb-1">다음 정산 예정일</p>
                        <p class="text-base font-semibold text-gray-800 mt-1">-</p>
                        <p class="text-xs text-gray-400 mt-1">정산 주기/방식은 추후 설정에서 지정할 수 있습니다.</p>
                    </div>
                </div>

                <!-- 일별 매출 테이블 -->
                <div class="bg-white rounded-2xl shadow p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-gray-800">일별 매출 내역</h3>
                        <span class="text-xs text-gray-400">실제 매출/정산 데이터 연동은 나중에 추가 예정입니다.</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-gray-700">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-2 px-3">날짜</th>
                                    <th class="text-left py-2 px-3">주문 건수</th>
                                    <th class="text-left py-2 px-3">총 매출</th>
                                    <th class="text-left py-2 px-3">정산 상태</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="py-2 px-3 text-gray-400 text-center" colspan="4">
                                        매출 데이터가 아직 없습니다.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- 📚 가이드 / 도움말 -->
            <section id="guide" class="content-section hidden-section">
                <h2 class="text-xl font-bold mb-4">📚 가이드 / 도움말</h2>

                <div class="bg-white rounded-2xl shadow p-6 space-y-6 text-sm">
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-2">1. 처음 오신 사장님</h3>
                        <ol class="list-decimal list-inside text-gray-700 space-y-1">
                            <li>회원가입 및 로그인 후, 사업자 인증을 완료합니다.</li>
                            <li>사장님 페이지에서 <span class="font-semibold">가게 관리</span>에 기본 정보를 입력합니다.</li>
                            <li><span class="font-semibold">메뉴 관리</span>에서 음식/서비스 메뉴를 등록합니다.</li>
                            <li>원하실 경우, <span class="font-semibold">스토어 프라이드 / 홍보 블로그</span>로 가게를 홍보합니다.</li>
                            <li>향후 주문 기능이 연동되면, <span class="font-semibold">주문 관리</span>에서 주문을 확인하고 처리합니다.</li>
                        </ol>
                    </div>

                    <div class="border-t pt-4">
                        <h3 class="font-semibold text-gray-800 mb-2">2. 문의가 필요할 때</h3>
                        <p class="text-gray-700 mb-1">
                            사용 중 궁금한 점이 있다면, <span class="font-semibold">문의 등록</span> 페이지를 통해 문의를 남길 수 있습니다.
                        </p>
                        <p class="text-xs text-gray-400">
                            추후 “사장님 전용 고객센터” 메뉴가 추가되면 이곳에서 바로 연결될 예정입니다.
                        </p>
                    </div>
                </div>
            </section>

            <!-- ⚙️ 설정 -->
            <section id="settings" class="content-section hidden-section">
                <h2 class="text-xl font-bold mb-4">⚙️ 설정</h2>
                <form class="space-y-8 bg-white p-6 rounded-xl shadow max-w-2xl">

                    <!-- 🧾 연락 / 알림 설정 -->
                    <div>
                        <h3 class="font-semibold mb-3 text-gray-800">📲 연락 / 알림 설정</h3>

                        <!-- 알림용 휴대폰 번호 -->
                        <div class="mb-4">
                            <label class="block text-sm text-gray-600 mb-1">알림용 휴대폰 번호</label>
                            <input type="tel" name="notifyPhone" class="w-full p-2 border rounded"
                                placeholder="010-0000-0000">
                            <p class="text-xs text-gray-400 mt-1">
                                주문 / 문의 / 리뷰 알림을 받을 휴대폰 번호입니다.
                            </p>
                        </div>

                        <!-- 알림 채널 선택 -->
                        <div class="mb-4">
                            <p class="block text-sm text-gray-600 mb-1">알림 채널</p>
                            <label class="flex items-center gap-2 text-sm text-gray-700">
                                <input type="checkbox" name="notifyChannelSms" class="rounded">
                                <span>SMS 알림 (주문/문의 알림 문자 수신)</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm text-gray-700 mt-2">
                                <input type="checkbox" name="notifyChannelEmail" class="rounded">
                                <span>이메일 알림 (정산 안내 / 공지 메일)</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm text-gray-700 mt-2">
                                <input type="checkbox" name="notifyChannelPush" class="rounded" disabled>
                                <span>앱 푸시 알림 (추후 지원 예정)</span>
                            </label>
                        </div>

                        <!-- 알림 종류 on/off -->
                        <div>
                            <p class="block text-sm text-gray-600 mb-1">알림 종류</p>
                            <label class="flex items-center gap-2 text-sm text-gray-700">
                                <input type="checkbox" name="notifyOrder" class="rounded" checked disabled>
                                <span>주문 알림 (필수)</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm text-gray-700 mt-2">
                                <input type="checkbox" name="notifyReview" class="rounded">
                                <span>리뷰 · 문의 알림</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm text-gray-700 mt-2">
                                <input type="checkbox" name="notifyMarketing" class="rounded">
                                <span>이벤트 · 마케팅 알림 수신 동의</span>
                            </label>
                        </div>
                    </div>

                    <hr class="border-gray-200">

                    <!-- 🏪 가게 운영 기본값 -->
                    <div>
                        <h3 class="font-semibold mb-3 text-gray-800">🏪 가게 운영 기본값</h3>

                        <!-- 영업 상태 토글 (임시 휴무/일시 정지 포함) -->
                        <div class="mb-4">
                            <p class="block text-sm text-gray-600 mb-1">영업 상태</p>
                            <div class="flex items-center gap-4">
                                <label class="inline-flex items-center gap-2 text-sm text-gray-700">
                                    <input type="radio" name="storeStatus" value="open" class="accent-blue-500" checked>
                                    <span>영업 중</span>
                                </label>
                                <label class="inline-flex items-center gap-2 text-sm text-gray-700">
                                    <input type="radio" name="storeStatus" value="pause" class="accent-blue-500">
                                    <span>일시 정지 (임시 휴무)</span>
                                </label>
                            </div>
                            <p class="text-xs text-gray-400 mt-1">
                                브레이크 타임이나 임시 휴무 시 &ldquo;일시 정지&rdquo;로 설정하면 주문을 잠시 받지 않습니다.
                            </p>
                        </div>

                        <!-- 주문 가능 시간대 -->
                        <div class="mb-4">
                            <p class="block text-sm text-gray-600 mb-1">주문 가능 시간대</p>
                            <div class="flex items-center gap-2">
                                <input type="time" name="orderStart" class="p-2 border rounded" value="10:00">
                                <span class="text-sm text-gray-600">~</span>
                                <input type="time" name="orderEnd" class="p-2 border rounded" value="21:30">
                            </div>
                            <p class="text-xs text-gray-400 mt-1">
                                설정한 시간 외에는 주문 버튼이 비활성화됩니다.
                            </p>
                        </div>

                        <!-- 최소 주문 금액 -->
                        <div class="mb-4">
                            <label class="block text-sm text-gray-600 mb-1">최소 주문 금액</label>
                            <div class="flex items-center gap-2">
                                <input type="number" name="minOrderAmount" class="p-2 border rounded w-40"
                                    placeholder="15000">
                                <span class="text-sm text-gray-600">원 (배달 기준)</span>
                            </div>
                            <p class="text-xs text-gray-400 mt-1">
                                예) 배달 15,000원 이상부터 주문 가능. 포장은 나중에 따로 설정 가능.
                            </p>
                        </div>

                        <!-- 배달팁 설정 -->
                        <div class="mb-4">
                            <label class="block text-sm text-gray-600 mb-1">배달팁 설정</label>
                            <div class="flex items-center gap-2">
                                <input type="number" name="deliveryTip" class="p-2 border rounded w-40"
                                    placeholder="3000">
                                <span class="text-sm text-gray-600">원 (기본 배달팁)</span>
                            </div>
                            <p class="text-xs text-gray-400 mt-1">
                                추후 세부 조건(거리별/시간대별 배달팁)은 별도 페이지로 확장 가능합니다.
                            </p>
                        </div>

                        <!-- 배달 가능 거리 / 지역 -->
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">배달 가능 거리</label>
                            <div class="flex items-center gap-2">
                                <input type="number" name="deliveryRadius" class="p-2 border rounded w-32"
                                    placeholder="3">
                                <span class="text-sm text-gray-600">km 이내</span>
                            </div>
                            <p class="text-xs text-gray-400 mt-1">
                                나중에 지도와 연동하여 반경 기준으로 배달 가능 지역을 제한할 수 있습니다.
                            </p>
                        </div>
                    </div>

                    <div class="flex justify-end gap-2 pt-2">
                        <button type="button" class="px-4 py-2 rounded-full border border-gray-300 text-gray-700">
                            취소
                        </button>
                        <button type="submit" class="px-4 py-2 rounded-full bg-blue-600 text-white shadow">
                            저장
                        </button>
                    </div>
                </form>
            </section>
        </main>
    </div>

    <!-- ✅ Chart.js 라이브러리 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- ✅ JS: 메뉴 전환 + API 연동 -->
    <script>
        // ===============================
        // 🌐 공통 설정: store_id + API_BASE
        // ===============================
        const storeId =
            new URLSearchParams(location.search).get("store_id") ||
            localStorage.getItem("store_id") ||
            "1"; // 로그인 후 실제 store_id로 교체 예정

        // 로컬(127.0.0.1 / localhost / 0.0.0.0)에서 열면 배포 서버로 요청 보내기
        const isLocal =
            location.hostname === "127.0.0.1" ||
            location.hostname === "localhost" ||
            location.hostname === "0.0.0.0";

        const API_BASE = isLocal ? "https://www.hongbono1.com" : "";
        // ✅ 로컬에서도 빈 문자열로 변경 (server.js가 public2를 루트로 서빙하므로)
        const HTML_BASE = "";

        async function fetchJson(path) {
            const url = API_BASE + path;
            const res = await fetch(url, {
                credentials: "include", // 나중에 쿠키/로그인 쓰면 유지
            });

            if (!res.ok) {
                const text = await res.text();
                console.error("❌ API 요청 실패:", res.status, url, text);
                throw new Error(`API 실패: ${res.status}`);
            }

            return res.json();
        }

        // 실시간 주문 알림용 전역 상태
        let latestOrderId = 0;

        function updateRealtimeIndicator(count) {
            const wrap = document.getElementById("realtime-order-indicator");
            const cnt = document.getElementById("realtime-order-count");
            if (!wrap || !cnt) return;

            if (count > 0) {
                cnt.textContent = `${count}건`;
                wrap.classList.remove("bg-gray-100", "text-gray-600");
                wrap.classList.add("bg-red-100", "text-red-700");
            } else {
                cnt.textContent = "없음";
                wrap.classList.remove("bg-red-100", "text-red-700");
                wrap.classList.add("bg-gray-100", "text-gray-600");
            }
        }

        // ===============================
        // 1. 대시보드 정보
        // ===============================
        async function loadDashboard() {
            try {
                const data = await fetchJson(`/owner/dashboard?store_id=${storeId}`);
                if (!data.ok) return;

                const $todayVisitors = document.querySelector("#today-visitors");
                const $favorites = document.querySelector("#favorites");
                const $orders = document.querySelector("#orders");
                const $reviews = document.querySelector("#reviews");
                const $todaySales = document.querySelector("#today-sales");

                if ($todayVisitors) $todayVisitors.textContent = data.today_visitors || 0;
                if ($favorites) $favorites.textContent = data.favorites || 0;
                if ($orders) $orders.textContent = data.order_count || 0;
                if ($reviews) $reviews.textContent = data.reviews || 0;
                if ($todaySales) {
                    $todaySales.textContent =
                        "₩" + Number(data.today_sales || 0).toLocaleString();
                }
            } catch (err) {
                console.error("[loadDashboard] 에러:", err);
            }
        }

        // ===============================
        // 공통 포맷 유틸
        // ===============================
        function formatPrice(value) {
            return "₩" + Number(value || 0).toLocaleString();
        }

        function formatTime(isoString) {
            const date = new Date(isoString);
            if (Number.isNaN(date.getTime())) return "-";
            return date.toLocaleTimeString("ko-KR", {
                hour: "2-digit",
                minute: "2-digit",
                hour12: false,
            });
        }

        function formatStatus(status) {
            switch (status) {
                case "pending":
                    return `<span class="text-gray-600 font-semibold">대기중</span>`;
                case "preparing":
                    return `<span class="text-yellow-600 font-semibold">조리중</span>`;
                case "delivering":
                    return `<span class="text-blue-600 font-semibold">배달중</span>`;
                case "completed":
                    return `<span class="text-green-600 font-semibold">완료</span>`;
                case "canceled":
                    return `<span class="text-red-600 font-semibold">취소</span>`;
                default:
                    return `<span class="text-gray-600 font-semibold">${status || "-"}</span>`;
            }
        }

        // ===============================
        // 2. 최근 주문 리스트 + 주문 관리
        // ===============================
        async function loadRecentOrders() {
            const tbody = document.getElementById("recent-orders-body");
            const manageBody = document.getElementById("order-manage-body");

            if (tbody) {
                tbody.innerHTML =
                    `<tr><td colspan="5" class="py-6 text-center text-gray-400">로딩 중...</td></tr>`;
            }
            if (manageBody) {
                manageBody.innerHTML =
                    `<tr><td colspan="6" class="py-6 text-center text-gray-400">주문 데이터를 불러오는 중입니다...</td></tr>`;
            }

            try {
                const json = await fetchJson(`/owner/orders?store_id=${storeId}`);

                if (!json.ok || !json.orders || !json.orders.length) {
                    if (tbody) {
                        tbody.innerHTML =
                            `<tr><td colspan="5" class="py-6 text-center text-gray-400">최근 주문이 없습니다.</td></tr>`;
                    }
                    if (manageBody) {
                        manageBody.innerHTML =
                            `<tr><td colspan="6" class="py-6 text-center text-gray-400">표시할 주문이 없습니다.</td></tr>`;
                    }
                    updateRealtimeIndicator(0);
                    return;
                }

                const rowsForDashboard = json.orders
                    .map(
                        (o) => `
            <tr class="border-b hover:bg-gray-50">
              <td class="py-2 px-3">#A${String(o.id).padStart(5, "0")}</td>
              <td class="py-2 px-3">${o.menu_label || "-"}</td>
              <td class="py-2 px-3">${formatPrice(o.total_price)}</td>
              <td class="py-2 px-3">${formatTime(o.created_at)}</td>
              <td class="py-2 px-3">${formatStatus(o.status)}</td>
            </tr>
          `
                    )
                    .join("");

                const rowsForManage = json.orders
                    .map(
                        (o) => `
            <tr class="border-b hover:bg-gray-50">
              <td class="py-2 px-3">#A${String(o.id).padStart(5, "0")}</td>
              <td class="py-2 px-3">${o.menu_label || "-"}</td>
              <td class="py-2 px-3">${formatPrice(o.total_price)}</td>
              <td class="py-2 px-3">${formatTime(o.created_at)}</td>
              <td class="py-2 px-3">${formatStatus(o.status)}</td>
              <td class="py-2 px-3">
                <div class="flex flex-wrap gap-1">
                  <button class="px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs hover:bg-blue-50 border border-gray-200">
                    상세
                  </button>
                  <button class="px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs hover:bg-blue-100 border border-blue-200">
                    다음 단계
                  </button>
                  <button class="px-3 py-1 rounded-full bg-red-50 text-red-600 text-xs hover:bg-red-100 border border-red-200">
                    취소
                  </button>
                </div>
              </td>
            </tr>
          `
                    )
                    .join("");

                if (tbody) tbody.innerHTML = rowsForDashboard;
                if (manageBody) manageBody.innerHTML = rowsForManage;

                // 실시간 알림용 latestOrderId 업데이트
                const ids = json.orders
                    .map((o) => Number(o.id))
                    .filter((n) => Number.isFinite(n));
                if (ids.length) {
                    const maxId = Math.max(...ids);
                    // 첫 로딩이면 기준만 잡고 알림 X
                    if (latestOrderId === 0) {
                        latestOrderId = maxId;
                        updateRealtimeIndicator(0);
                    } else if (maxId > latestOrderId) {
                        const diff = maxId - latestOrderId;
                        latestOrderId = maxId;
                        updateRealtimeIndicator(diff);
                    } else {
                        updateRealtimeIndicator(0);
                    }
                }
            } catch (err) {
                console.error("[loadRecentOrders]", err);
                if (tbody) {
                    tbody.innerHTML =
                        `<tr><td colspan="5" class="py-6 text-center text-red-500">주문 불러오기 실패</td></tr>`;
                }
                if (manageBody) {
                    manageBody.innerHTML =
                        `<tr><td colspan="6" class="py-6 text-center text-red-500">주문 불러오기 실패</td></tr>`;
                }
                updateRealtimeIndicator(0);
            }
        }

        // 주기적으로 새 주문 체크 (실시간 알림 느낌)
        async function checkNewOrders() {
            try {
                const json = await fetchJson(`/owner/orders?store_id=${storeId}`);
                if (!json.ok || !json.orders || !json.orders.length) {
                    updateRealtimeIndicator(0);
                    return;
                }

                const ids = json.orders
                    .map((o) => Number(o.id))
                    .filter((n) => Number.isFinite(n));
                if (!ids.length) {
                    updateRealtimeIndicator(0);
                    return;
                }

                const maxId = Math.max(...ids);
                if (latestOrderId === 0) {
                    latestOrderId = maxId;
                    updateRealtimeIndicator(0);
                } else if (maxId > latestOrderId) {
                    const diff = maxId - latestOrderId;
                    latestOrderId = maxId;
                    updateRealtimeIndicator(diff);
                } else {
                    updateRealtimeIndicator(0);
                }
            } catch (err) {
                console.error("[checkNewOrders]", err);
            }
        }

        // ===============================
        // 3. 기간별 통계 그래프
        // ===============================
        let chartInstance;

        async function loadStats(period = "weekly") {
            try {
                const data = await fetchJson(
                    `/owner/stats?store_id=${storeId}&period=${period}`
                );
                if (data.ok) updateChart(data.data || []);
            } catch (err) {
                console.error("[loadStats]", err);
            }
        }

        function updateChart(rows) {
            const ctx = document.getElementById("statsChart");
            if (!ctx) return;
            if (chartInstance) chartInstance.destroy();

            const labels = rows.map((r) => r.label);
            const values = rows.map((r) => r.total_sales);

            chartInstance = new Chart(ctx, {
                type: "line",
                data: {
                    labels,
                    datasets: [
                        {
                            label: "매출 (원)",
                            data: values,
                            borderColor: "#3B82F6",
                            backgroundColor: "rgba(59,130,246,0.15)",
                            tension: 0.4,
                            fill: true,
                        },
                    ],
                },
                options: { responsive: true, scales: { y: { beginAtZero: true } } },
            });
        }

        // ===============================
        // 4. 가게 정보
        // ===============================
        async function loadStoreInfo() {
            try {
                const data = await fetchJson(`/owner/store?store_id=${storeId}`);

                if (data.ok && data.store) {
                    const s = data.store;
                    const $addr = document.querySelector("[name='storeAddress']");
                    const $open = document.querySelector("[name='openHours']");
                    const $desc = document.querySelector("[name='description']");

                    if ($addr) $addr.value = s.address || "";
                    if ($open) $open.value = s.open_hours || "";
                    if ($desc) $desc.value = s.description || "";
                }
            } catch (err) {
                console.error("[loadStoreInfo]", err);
            }
        }

        // ===============================
        // 5. 메뉴 목록
        // ===============================
        async function loadMenuList() {
            const container = document.getElementById("menu-list");
            if (!container) return;

            container.innerHTML =
                `<p class="text-gray-400 text-sm">메뉴를 불러오는 중입니다...</p>`;

            try {
                const data = await fetchJson(`/owner/menu?store_id=${storeId}`);

                container.innerHTML = "";
                if (!data.ok || !data.menus || !data.menus.length) {
                    container.innerHTML =
                        `<p class="text-gray-400 text-sm">등록된 메뉴가 없습니다.</p>`;
                    return;
                }

                data.menus.forEach((m) => {
                    const div = document.createElement("div");
                    div.className = "p-4 bg-white rounded-xl shadow flex flex-col gap-2";
                    div.innerHTML = `
              <div class="flex items-center justify-between">
                <div>
                  <h3 class="font-bold text-gray-800">${m.name}</h3>
                  <p class="text-gray-600 text-sm">₩${Number(m.price).toLocaleString()}</p>
                </div>
                <span class="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-600">${m.category || "기타"}</span>
              </div>
              <div class="flex flex-wrap items-center justify-between gap-2 mt-2 text-xs text-gray-700">
                <label class="inline-flex items-center gap-1">
                  <input type="checkbox" class="rounded text-red-500">
                  <span>품절 처리</span>
                </label>
                <div class="flex flex-wrap gap-1">
                  <button class="px-2 py-1 rounded-full border border-gray-200 bg-gray-50 hover:bg-gray-100">
                    ▲ 위로
                  </button>
                  <button class="px-2 py-1 rounded-full border border-gray-200 bg-gray-50 hover:bg-gray-100">
                    ▼ 아래로
                  </button>
                  <button class="px-2 py-1 rounded-full border border-blue-200 bg-blue-50 text-blue-700">
                    옵션 관리
                  </button>
                  <button class="px-2 py-1 rounded-full border border-gray-200 bg-white">
                    수정
                  </button>
                  <button class="px-2 py-1 rounded-full border border-red-200 bg-red-50 text-red-600">
                    삭제
                  </button>
                </div>
              </div>
            `;
                    container.appendChild(div);
                });
            } catch (err) {
                console.error("[loadMenuList]", err);
                container.innerHTML =
                    `<p class="text-red-500 text-sm">메뉴를 불러오지 못했습니다.</p>`;
            }
        }

        // ===============================
        // 6. 기간 버튼 이벤트
        // ===============================
        document.querySelectorAll(".period-btn").forEach((btn) => {
            btn.addEventListener("click", () => loadStats(btn.dataset.period));
        });

        // ===============================
        // 7. 사이드바 메뉴 전환
        // ===============================
        const links = document.querySelectorAll(".nav-link");
        const sections = document.querySelectorAll(".content-section");

        links.forEach((link) => {
            link.addEventListener("click", (e) => {
                e.preventDefault();
                const section = link.dataset.section;

                // ✅ 등록 관리는 섹션 전환 X (하위 메뉴 토글만)
                if (section === "register") {
                    const submenu = document.getElementById("subRegisterMenu");
                    if (submenu) submenu.classList.toggle("hidden");
                    return;
                }

                links.forEach((l) => l.classList.remove("active-link"));
                link.classList.add("active-link");
                sections.forEach((sec) => sec.classList.add("hidden-section"));
                const targetSection = document.getElementById(section);
                if (targetSection) targetSection.classList.remove("hidden-section");
            });
        });
        document
            .querySelector('[data-section="dashboard"]')
            .classList.add("active-link");

        // 대시보드 → 주문 관리 이동 버튼
        const goOrderBtn = document.getElementById("go-order-from-dashboard");
        if (goOrderBtn) {
            goOrderBtn.addEventListener("click", () => {
                const orderLink = document.querySelector('[data-section="order"]');
                if (!orderLink) return;
                orderLink.click();
            });
        }

        // ===============================
        // 8. 하위 등록 메뉴 클릭 시 각 등록 페이지로 이동
        // ===============================
        const subLinks = document.querySelectorAll(".sub-link");
        subLinks.forEach((sub) => {
            sub.addEventListener("click", (e) => {
                e.preventDefault();
                const target = sub.dataset.target;

                switch (target) {
                    case "openregister":
                        window.location.href = `${HTML_BASE}/openregister.html`;
                        break;
                    case "storeprideregister":
                        window.location.href = `${HTML_BASE}/storeprideregister.html`;
                        break;
                    case "traditionalmarketregister":
                        window.location.href = `${HTML_BASE}/traditionalmarketregister.html`;
                        break;
                    case "performingartregister":
                        window.location.href = `${HTML_BASE}/performingartregister.html`;
                        break;
                    case "eventregister":
                        window.location.href = `${HTML_BASE}/eventregister.html`;
                        break;
                    case "shoppingregister":
                        window.location.href = `${HTML_BASE}/shoppingregister.html`;
                        break;
                    case "inquiryregister":
                        window.location.href = `${HTML_BASE}/inquiryregister.html`;
                        break;
                    case "foodregister":
                        window.location.href = `${HTML_BASE}/foodregister.html`;
                        break;
                    case "ncombinedregister":
                        window.location.href = `${HTML_BASE}/ncombinedregister.html`;
                        break;
                    case "hotblogregister":
                        window.location.href = `${HTML_BASE}/hotblogregister.html`;
                        break;
                    default:
                        console.warn("알 수 없는 target:", target);
                }
            });
        });

        // ===============================
        // 9. 메뉴 추가 모달 오픈/닫기 (UI만)
        // ===============================
        const menuAddBtn = document.getElementById("btn-add-menu");
        const menuModal = document.getElementById("menu-modal");
        const menuModalClose = document.getElementById("menu-modal-close");
        const menuModalCancel = document.getElementById("menu-modal-cancel");
        const menuModalSave = document.getElementById("menu-modal-save");

        function openMenuModal() {
            if (menuModal) menuModal.classList.remove("hidden");
        }
        function closeMenuModal() {
            if (menuModal) menuModal.classList.add("hidden");
        }

        if (menuAddBtn) menuAddBtn.addEventListener("click", openMenuModal);
        if (menuModalClose) menuModalClose.addEventListener("click", closeMenuModal);
        if (menuModalCancel) menuModalCancel.addEventListener("click", closeMenuModal);
        if (menuModalSave) {
            menuModalSave.addEventListener("click", () => {
                // 실제 저장은 추후 API 연동 시 구현
                alert("메뉴 정보는 UI 상에서만 입력됩니다. 실제 저장은 나중에 서버 연동 시 구현합니다.");
                closeMenuModal();
            });
        }

        // ===============================
        // 10. 페이지 로드시 한 번에 로딩 + 실시간 체크
        // ===============================
        window.addEventListener("DOMContentLoaded", async () => {
            updateRealtimeIndicator(0);
            await loadDashboard();
            await loadStats("weekly");
            await loadStoreInfo();
            await loadMenuList();
            await loadRecentOrders();

            // 30초마다 새 주문 확인 (실시간 주문 알림)
            setInterval(checkNewOrders, 30000);
        });
    </script>

</body>

</html>