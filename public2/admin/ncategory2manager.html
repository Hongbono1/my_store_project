<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ncategory2 매니저</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* ncategory2와 동일 */
        .neo-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 1.2rem;
            box-shadow: 6px 6px 16px #d9e0ec, -6px -6px 16px #ffffff;
            backdrop-filter: blur(16px) saturate(120%);
            transition: all .25s ease;
        }

        .neo-card:hover {
            transform: translateY(-4px);
            box-shadow: 4px 4px 12px #cfd8e6, -4px -4px 12px #ffffff, 0 8px 24px rgba(80, 130, 255, 0.15);
        }

        .btn-3d {
            background: linear-gradient(90deg, #6dd5fa, #2980b9);
            border-radius: 1.3rem;
            padding: .5rem 1.5rem;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 0 #2393b3, 0 8px 16px rgba(0, 64, 128, 0.14);
            transition: all .15s;
            user-select: none;
        }

        .btn-3d:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #2393b3, 0 4px 10px rgba(0, 64, 128, 0.16);
        }

        .scroll-x {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            scrollbar-width: thin;
        }

        .scroll-x::-webkit-scrollbar {
            height: 6px;
        }

        .scroll-x::-webkit-scrollbar-thumb {
            background: #a3bffa;
            border-radius: 9999px;
        }

        .sidebar-scroll {
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: transparent transparent;
        }

        .sidebar-scroll:hover {
            scrollbar-color: #cbd5e1 transparent;
        }

        .sidebar-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar-scroll::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar-scroll::-webkit-scrollbar-thumb {
            background: transparent;
            border-radius: 9999px;
        }

        .sidebar-scroll:hover::-webkit-scrollbar-thumb {
            background: #cbd5e1;
        }

        .sidebar-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* 관리자 클릭용(레이아웃은 그대로, 표시만 아주 작게) */
        .admin-slot {
            cursor: pointer;
            position: relative;
        }

        .admin-slot::after {
            content: "관리";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            font-weight: 900;
            padding: 6px 10px;
            border-radius: 9999px;
            background: rgba(255, 255, 255, 0.78);
            border: 1px solid rgba(59, 130, 246, 0.25);
            backdrop-filter: blur(8px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            color: rgba(30, 64, 175, 0.95);
            pointer-events: none;
        }

        /* 모달 */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.45);
            backdrop-filter: blur(6px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 1rem;
        }

        .modal-panel {
            width: min(980px, 95vw);
            max-height: 90vh;
            overflow: auto;
        }

        .input {
            width: 100%;
            padding: .65rem .85rem;
            border-radius: 1rem;
            border: 1px solid rgba(148, 163, 184, .6);
            background: rgba(255, 255, 255, 0.75);
            outline: none;
        }

        .input:focus {
            border-color: rgba(59, 130, 246, .75);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, .15);
        }

        .chip {
            display: inline-flex;
            align-items: center;
            gap: .4rem;
            padding: .35rem .7rem;
            border-radius: 9999px;
            background: rgba(59, 130, 246, .10);
            border: 1px solid rgba(59, 130, 246, .20);
            font-weight: 800;
            font-size: .85rem;
            color: rgba(30, 64, 175, .92);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 via-white to-blue-100 min-h-screen text-gray-800">
    <!-- ✅ header.html 불러오기 -->
    <div id="header-placeholder"></div>

    <header class="py-6 text-center">
        <h1 class="text-3xl font-bold text-blue-700">우리동네 가게</h1>
        <p class="text-gray-600 mt-1">ncategory2 매니저(레이아웃 동일) - combined_store_info 연결</p>
    </header>

    <div class="max-w-6xl mx-auto grid grid-cols-12 gap-6 py-6 px-4">

        <!-- 좌측 사이드바 (레이아웃 동일) -->
        <aside class="col-span-3 neo-card p-3 h-full max-h-[1346px] sidebar-scroll">
            <h2 class="font-bold text-2xl mb-4 text-center">CATEGORY</h2>
            <ul class="space-y-3">

                <!-- 병원 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-16 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        병 원 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=hospital&category=종합병원"
                                class="block px-5 py-2 neo-card text-center">종합병원</a></li>
                        <li><a href="/subcategory.html?type=hospital&category=내과"
                                class="block px-3 py-2 neo-card text-center">내과</a></li>
                        <li><a href="/subcategory.html?type=hospital&category=치과"
                                class="block px-3 py-2 neo-card text-center">치과</a></li>
                        <li><a href="/subcategory.html?type=hospital&category=소아과"
                                class="block px-3 py-2 neo-card text-center">소아과</a></li>
                        <li><a href="/subcategory.html?type=hospital&category=정형외과"
                                class="block px-3 py-2 neo-card text-center">정형외과</a></li>
                        <li><a href="/subcategory.html?type=hospital&category=산부인과"
                                class="block px-3 py-2 neo-card text-center">산부인과</a></li>
                        <li><a href="/subcategory.html?type=hospital&category=한의원"
                                class="block px-3 py-2 neo-card text-center">한의원</a></li>
                        <li><a href="/subcategory.html?type=hospital&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a></li>
                    </ul>
                </li>

                <!-- 약국 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-16 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        약 국 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=pharmacy&category=일반약국"
                                class="block px-3 py-2 neo-card text-center">일반약국</a></li>
                        <li><a href="/subcategory.html?type=pharmacy&category=24시약국"
                                class="block px-3 py-2 neo-card text-center">24시약국</a></li>
                        <li><a href="/subcategory.html?type=pharmacy&category=한약방"
                                class="block px-3 py-2 neo-card text-center">한약방</a></li>
                        <li><a href="/subcategory.html?type=pharmacy&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a></li>
                    </ul>
                </li>

                <!-- 어린이집 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-12 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        어린이집 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-1 hidden">
                        <li><a href="/subcategory.html?type=kindergarten&category=국공립"
                                class="block px-3 py-2 neo-card text-center">어린이집 통합</a></li>
                    </ul>
                </li>

                <!-- 학원 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-16 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        학 원 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=academy&category=입시학원"
                                class="block px-3 py-2 neo-card text-center">입시학원</a></li>
                        <li><a href="/subcategory.html?type=academy&category=영어"
                                class="block px-3 py-2 neo-card text-center">영어</a>
                        </li>
                        <li><a href="/subcategory.html?type=academy&category=수학"
                                class="block px-3 py-2 neo-card text-center">수학</a>
                        </li>
                        <li><a href="/subcategory.html?type=academy&category=음악"
                                class="block px-3 py-2 neo-card text-center">음악</a>
                        </li>
                        <li><a href="/subcategory.html?type=academy&category=미술"
                                class="block px-3 py-2 neo-card text-center">미술</a>
                        </li>
                        <li><a href="/subcategory.html?type=academy&category=컴퓨터"
                                class="block px-3 py-2 neo-card text-center">컴퓨터</a></li>
                        <li><a href="/subcategory.html?type=academy&category=체육"
                                class="block px-3 py-2 neo-card text-center">체육</a>
                        </li>
                        <li><a href="/subcategory.html?type=academy&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a>
                        </li>
                    </ul>
                </li>

                <!-- 마트 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-16 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        마 트 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=mart&category=대형마트"
                                class="block px-3 py-2 neo-card text-center">대형마트</a></li>
                        <li><a href="/subcategory.html?type=mart&category=중소마트"
                                class="block px-3 py-2 neo-card text-center">중소마트</a></li>
                        <li><a href="/subcategory.html?type=mart&category=슈퍼마켓"
                                class="block px-3 py-2 neo-card text-center">슈퍼마켓</a></li>
                        <li><a href="/subcategory.html?type=mart&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a>
                        </li>
                    </ul>
                </li>

                <!-- 편의점 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-14 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        편의점 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=store&category=CU"
                                class="block px-3 py-2 neo-card text-center">CU</a>
                        </li>
                        <li><a href="/subcategory.html?type=store&category=GS25"
                                class="block px-3 py-2 neo-card text-center">GS25</a></li>
                        <li><a href="/subcategory.html?type=store&category=세븐일레븐"
                                class="block px-3 py-2 neo-card text-center">세븐일레븐</a></li>
                        <li><a href="/subcategory.html?type=store&category=이마트24"
                                class="block px-3 py-2 neo-card text-center">이마트24</a></li>
                        <li><a href="/subcategory.html?type=store&category=미니스톱"
                                class="block px-3 py-2 neo-card text-center">미니스톱</a></li>
                        <li><a href="/subcategory.html?type=store&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a>
                        </li>
                    </ul>
                </li>

                <!-- 운동 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-16 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        운 동 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=exercise&category=헬스장"
                                class="block px-3 py-2 neo-card text-center">헬스장</a></li>
                        <li><a href="/subcategory.html?type=exercise&category=필라테스"
                                class="block px-3 py-2 neo-card text-center">필라테스</a></li>
                        <li><a href="/subcategory.html?type=exercise&category=요가"
                                class="block px-3 py-2 neo-card text-center">요가</a></li>
                        <li><a href="/subcategory.html?type=exercise&category=태권도"
                                class="block px-3 py-2 neo-card text-center">태권도</a></li>
                        <li><a href="/subcategory.html?type=exercise&category=스포츠센터"
                                class="block px-3 py-2 neo-card text-center">스포츠센터</a></li>
                        <li><a href="/subcategory.html?type=exercise&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a></li>

                    </ul>
                </li>

                <!-- 미용/이발 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-11 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        미용/이발 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=beauty&category=미용"
                                class="block px-3 py-2 neo-card text-center">미용</a>
                        </li>
                        <li><a href="/subcategory.html?type=beauty&category=이발"
                                class="block px-3 py-2 neo-card text-center">이발</a>
                        </li>
                        <li><a href="/subcategory.html?type=beauty&category=네일"
                                class="block px-3 py-2 neo-card text-center">네일</a>
                        </li>
                        <li><a href="/subcategory.html?type=beauty&category=피부관리"
                                class="block px-3 py-2 neo-card text-center">피부관리</a></li>
                        <li><a href="/subcategory.html?type=beauty&category=왁싱"
                                class="block px-3 py-2 neo-card text-center">왁싱</a>
                        </li>
                        <li><a href="/subcategory.html?type=beauty&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a>
                        </li>

                    </ul>
                </li>

                <!-- 스터디/독서실 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-8 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        스터디/독서실 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=beauty&category=스터디룸"
                                class="block px-3 py-2 neo-card text-center">스터디룸</a></li>
                        <li><a href="/subcategory.html?type=beauty&category=독서실"
                                class="block px-3 py-2 neo-card text-center">독서실</a></li>
                        <li><a href="/subcategory.html?type=beauty&category=도서관"
                                class="block px-3 py-2 neo-card text-center">도서관</a></li>
                        <li><a href="/subcategory.html?type=beauty&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a>
                        </li>

                    </ul>
                </li>

                <!-- 목욕 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-16 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        목 욕 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=beauty&category=목욕"
                                class="block px-3 py-2 neo-card text-center">목 욕
                                전체</a>
                    </ul>
                </li>

                <!-- 세탁/옷수선 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-10 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        세탁/옷수선 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=laundry&category=세탁_옷_신발수선"
                                class="block px-3 py-2 neo-card text-center">세탁/옷수선 전체</a></li>

                    </ul>
                </li>

                <!-- 숙박 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-16 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        숙 박 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=stay&category=호텔"
                                class="block px-3 py-2 neo-card text-center">호텔</a>
                        </li>
                        <li><a href="/subcategory.html?type=stay&category=모텔"
                                class="block px-3 py-2 neo-card text-center">모텔</a>
                        </li>
                        <li><a href="/subcategory.html?type=stay&category=게스트하우스"
                                class="block px-3 py-2 neo-card text-center">게스트하우스</a></li>
                        <li><a href="/subcategory.html?type=stay&category=펜션"
                                class="block px-3 py-2 neo-card text-center">펜션</a>
                        </li>
                        <li><a href="/subcategory.html?type=stay&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a>
                        </li>

                    </ul>
                </li>

                <!-- 중고/구제 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-12 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        중고/구제 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=used&category=중고가전"
                                class="block px-3 py-2 neo-card text-center">중고가전</a></li>
                        <li><a href="/subcategory.html?type=used&category=중고가구"
                                class="block px-3 py-2 neo-card text-center">중고가구</a></li>
                        <li><a href="/subcategory.html?type=used&category=중고명품"
                                class="block px-3 py-2 neo-card text-center">중고명품</a></li>
                        <li><a href="/subcategory.html?type=used&category=리사이클"
                                class="block px-3 py-2 neo-card text-center">리사이클</a></li>
                        <li><a href="/subcategory.html?type=used&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a>
                        </li>

                    </ul>
                </li>

                <!-- 자동차 정비/수리 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-6 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        자동차 정비/수리 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=car&category=카센터"
                                class="block px-3 py-2 neo-card text-center">카센터</a>
                        </li>
                        <li><a href="/subcategory.html?type=car&category=정비소"
                                class="block px-3 py-2 neo-card text-center">정비소</a>
                        </li>
                        <li><a href="/subcategory.html?type=car&category=자동차용품"
                                class="block px-3 py-2 neo-card text-center">자동차용품</a></li>
                        <li><a href="/subcategory.html?type=car&category=타이어"
                                class="block px-3 py-2 neo-card text-center">타이어
                                전문점</a></li>
                        <li><a href="/subcategory.html?type=car&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a>
                        </li>

                    </ul>
                </li>

                <!-- 주유소 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-14 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        주유소 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=gas&category=직영주유소"
                                class="block px-3 py-2 neo-card text-center">직영주유소</a></li>
                        <li><a href="/subcategory.html?type=gas&category=알뜰주유소"
                                class="block px-3 py-2 neo-card text-center">알뜰주유소</a></li>
                        <li><a href="/subcategory.html?type=gas&category=충전소"
                                class="block px-3 py-2 neo-card text-center">충전소</a>
                        </li>
                        <li><a href="/subcategory.html?type=gas&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a>
                        </li>

                    </ul>
                </li>

                <!-- 반려동물 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-12 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        반려동물 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=pet&category=동물병원"
                                class="block px-3 py-2 neo-card text-center">동물병원</a>

                        <li><a href="/subcategory.html?type=pet&category=애견미용"
                                class="block px-3 py-2 neo-card text-center">애견미용</a>
                        </li>
                        <li><a href="/subcategory.html?type=pet&category=애견호텔"
                                class="block px-3 py-2 neo-card text-center">애견호텔</a>
                        </li>
                        <li><a href="/subcategory.html?type=pet&category=애견카페"
                                class="block px-3 py-2 neo-card text-center">애견카페</a>
                        </li>
                        <li><a href="/subcategory.html?type=pet&category=동물용품"
                                class="block px-3 py-2 neo-card text-center">동물용품</a>
                        </li>
                        <li><a href="/subcategory.html?type=pet&category=펫시터"
                                class="block px-3 py-2 neo-card text-center">펫시터</a>
                        </li>
                        <li><a href="/subcategory.html?type=pet&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a>
                        </li>

                    </ul>
                </li>

                <!-- 가전제품 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-12 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        가전제품 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=electronics&category=가전판매"
                                class="block px-3 py-2 neo-card text-center">가전판매</a></li>
                        <li><a href="/subcategory.html?type=electronics&category=가전수리"
                                class="block px-3 py-2 neo-card text-center">가전수리</a></li>
                        <li><a href="/subcategory.html?type=electronics&category=휴대폰"
                                class="block px-3 py-2 neo-card text-center">휴대폰</a></li>
                        <li><a href="/subcategory.html?type=electronics&category=PC수리"
                                class="block px-3 py-2 neo-card text-center">PC수리</a></li>
                        <li><a href="/subcategory.html?type=electronics&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a></li>

                    </ul>
                </li>

                <!-- 철물/자재 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-11 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        철물/자재 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=materials&category=철물점"
                                class="block px-3 py-2 neo-card text-center">철물점</a></li>
                        <li><a href="/subcategory.html?type=materials&category=건축자재"
                                class="block px-3 py-2 neo-card text-center">건축자재</a></li>
                        <li><a href="/subcategory.html?type=materials&category=인테리어자재"
                                class="block px-3 py-2 neo-card text-center">인테리어자재</a></li>
                        <li><a href="/subcategory.html?type=materials&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a></li>

                    </ul>
                </li>

                <!-- 간판/광고 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-11 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        간판/광고 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=sign&category=간판제작"
                                class="block px-3 py-2 neo-card text-center">간판제작</a></li>
                        <li><a href="/subcategory.html?type=sign&category=인쇄"
                                class="block px-3 py-2 neo-card text-center">인쇄</a>
                        </li>
                        <li><a href="/subcategory.html?type=sign&category=홍보물"
                                class="block px-3 py-2 neo-card text-center">홍보물</a>
                        </li>
                        <li><a href="/subcategory.html?type=sign&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a>
                        </li>

                    </ul>
                </li>

                <!-- 통신/인터넷/TV -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-7 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        통신/인터넷/TV <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=telecom&category=SK"
                                class="block px-3 py-2 neo-card text-center">SK</a>
                        </li>
                        <li><a href="/subcategory.html?type=telecom&category=KT"
                                class="block px-3 py-2 neo-card text-center">KT</a>
                        </li>
                        <li><a href="/subcategory.html?type=telecom&category=LG"
                                class="block px-3 py-2 neo-card text-center">LG</a>
                        </li>
                        <li><a href="/subcategory.html?type=telecom&category=인터넷_TV"
                                class="block px-3 py-2 neo-card text-center">인터넷_TV</a></li>
                        <li><a href="/subcategory.html?type=telecom&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a>
                        </li>

                    </ul>
                </li>

                <!-- 안경/사진/꽃집 -->
                <li class="mb-5">
                    <button
                        class="w-full text-left pl-7 pr-3 py-2 neo-card flex justify-between items-center font-bold text-xl"
                        onclick="toggleSub(this)">
                        안경/사진/꽃집 <span>▼</span>
                    </button>
                    <ul class="ml-4 mt-1 space-y-3 hidden">
                        <li><a href="/subcategory.html?type=shop&category=안경점"
                                class="block px-3 py-2 neo-card text-center">안경점</a>
                        </li>
                        <li><a href="/subcategory.html?type=shop&category=사진관"
                                class="block px-3 py-2 neo-card text-center">사진관</a>
                        </li>
                        <li><a href="/subcategory.html?type=shop&category=꽃집"
                                class="block px-3 py-2 neo-card text-center">꽃집</a>
                        </li>
                        <li><a href="/subcategory.html?type=shop&category=화원"
                                class="block px-3 py-2 neo-card text-center">화원</a>
                        </li>
                        <li><a href="/subcategory.html?type=shop&category=기타"
                                class="block px-3 py-2 neo-card text-center">기타</a>
                        </li>

                    </ul>
                </li>
            </ul>

            <!-- ✅ 광고 박스 -->
            <div class="neo-card mt-6 p-4 text-center border-2 border-dashed border-blue-300">
                <h3 class="font-bold text-lg mb-2">광고 영역</h3>
                <p class="text-sm text-gray-600">이곳은 광고 배너/이미지가 들어갈 박스입니다.</p>
                <img src="/uploads/sample-ad.jpg" alt="광고 이미지" class="mt-3 w-full h-[30px] object-cover rounded-xl">
            </div>
        </aside>

        <!-- 중앙 메인 (레이아웃 동일) -->
        <main class="col-span-9 space-y-8">

            <!-- 메인 배너(동일) -->
            <section class="relative h-60 neo-card flex items-center justify-center">
                <div class="text-center">
                    <h1 class="text-3xl font-bold mb-2">Premium 카테고리</h1>
                    <p class="text-gray-600 text-sm">카테고리 설명 문구를 여기에 넣습니다.</p>
                </div>
            </section>

            <!-- 파워 광고(동일 구조: 그룹 3개, 그룹당 3개) -->
            <section class="mt-10">
                <h2 class="font-bold text-2xl text-purple-600 text-center mb-4">강력 추천</h2>

                <div id="powerViewport" class="relative overflow-hidden">
                    <div id="powerAdTrack"
                        class="flex transition-transform duration-500 ease-in-out will-change-transform"></div>

                    <button id="prevBtn"
                        class="absolute left-0 top-1/2 -translate-y-1/2 bg-white shadow rounded-full px-3 py-2">‹</button>
                    <button id="nextBtn"
                        class="absolute right-0 top-1/2 -translate-y-1/2 bg-white shadow rounded-full px-3 py-2">›</button>
                </div>
            </section>

            <!-- 최고의 가게 영역(동일 배치: 좌 3칸 + 우 9칸) -->
            <section class="grid grid-cols-12 gap-6 items-stretch">

                <!-- 좌측: MVP + HIGHLIGHT -->
                <div class="col-span-3 h-full">
                    <div class="neo-card p-4 w-full h-full flex flex-col gap-4">

                        <!-- MVP -->
                        <div class="flex-1 flex flex-col">
                            <h2 class="font-bold text-2xl text-blue-600 text-center mb-3">MVP</h2>
                            <a href="#"
                                class="neo-card p-0 overflow-hidden relative rounded-2xl h-full border-2 border-blue-500 admin-slot"
                                data-position="ncategory2_mvp" data-label="MVP">
                                <img data-role="img" src="/uploads/sample-left-top.jpg"
                                    class="w-full h-full object-cover" alt="상호명 Top">
                                <div
                                    class="absolute left-3 right-3 bottom-3 bg-white/70 backdrop-blur-md rounded-xl shadow px-4 py-2 text-center">
                                    <div class="font-bold text-lg leading-tight" data-role="name">상호명 Top</div>
                                    <div class="text-sm text-slate-600" data-role="category">업종: 한식</div>
                                </div>
                            </a>
                        </div>

                        <!-- HIGHLIGHT -->
                        <div class="flex-1 flex flex-col">
                            <h2 class="font-bold text-2xl text-yellow-600 text-center mb-3">HIGHLIGHT</h2>
                            <a href="#"
                                class="neo-card p-0 overflow-hidden relative rounded-2xl h-full border-2 border-yellow-500 admin-slot"
                                data-position="ncategory2_highlight" data-label="HIGHLIGHT">
                                <img data-role="img" src="/uploads/sample-left-bottom.jpg"
                                    class="w-full h-full object-cover" alt="상호명 Bottom">
                                <div
                                    class="absolute left-3 right-3 bottom-3 bg-white/70 backdrop-blur-md rounded-xl shadow px-4 py-2 text-center">
                                    <div class="font-bold text-lg leading-tight" data-role="name">상호명 Bottom</div>
                                    <div class="text-sm text-slate-600" data-role="category">업종: 카페</div>
                                </div>
                            </a>
                        </div>

                    </div>
                </div>

                <!-- 우측: 최고의 가게(동일 그리드) -->
                <div class="col-span-9 flex flex-col gap-6">
                    <div class="neo-card p-5">
                        <h2 class="font-bold mb-3 text-2xl text-center">최고의 가게</h2>
                        <div id="bestGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                    </div>
                </div>
            </section>

            <!-- ✅ 하단 박스 두 개(동일) -->
            <div class="grid grid-cols-2 gap-6">
                <div class="neo-card p-6 text-center">
                    <h3 class="font-bold text-lg mb-2">하단 박스 1</h3>
                    <p class="text-gray-600 text-sm">이곳은 설명 텍스트</p>
                </div>
                <div class="neo-card p-6 text-center">
                    <h3 class="font-bold text-lg mb-2">하단 박스 2</h3>
                    <p class="text-gray-600 text-sm">이곳은 설명 텍스트</p>
                </div>
            </div>

        </main>
    </div>

    <!-- 오른쪽 하단 세로 네비게이션(동일) -->
    <div class="fixed bottom-6 right-6 flex flex-col items-center gap-4 z-50">
        <div class="flex flex-col items-center">
            <button onclick="goBack()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-gray-100 to-gray-200 text-gray-700 shadow hover:from-gray-200 hover:to-gray-300 transition">
                ←
            </button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">이전</span>
        </div>

        <div class="flex flex-col items-center">
            <button onclick="goNext()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-gray-100 to-gray-200 text-gray-700 shadow hover:from-gray-200 hover:to-gray-300 transition">
                →
            </button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">다음</span>
        </div>

        <div class="flex flex-col items-center">
            <a href="/index.html"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow hover:from-blue-600 hover:to-blue-700 transition">
                🏠
            </a>
            <span class="text-xs mt-1 text-gray-600 font-semibold">홈</span>
        </div>
    </div>

    <!-- ✅ footer.html 불러오기 -->
    <div id="footer-placeholder"></div>

    <!-- ===================== SLOT MODAL (foodcategorymanager 방식) ===================== -->
    <div id="slotModal" class="fixed inset-0 z-[9999] hidden">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" onclick="closeSlotModal()"></div>

        <div class="relative mx-auto mt-10 w-[95vw] max-w-6xl">
            <div class="neo-card overflow-hidden border border-white/60">
                <!-- header -->
                <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200/60">
                    <div>
                        <div class="text-xl font-extrabold text-slate-800">슬롯 설정</div>
                        <div id="slotModalSub" class="text-sm text-slate-500 mt-0.5"></div>
                    </div>
                    <button class="btn-3d" type="button" onclick="closeSlotModal()">닫기</button>
                </div>

                <!-- body: 왼쪽만 스크롤, 오른쪽은 고정 -->
                <div class="flex gap-0">
                    <!-- LEFT (scroll) -->
                    <div class="w-2/3 p-5 max-h-[78vh] overflow-y-auto">
                        <!-- 기본 정보 -->
                        <div class="neo-card p-4">
                            <div class="font-bold text-lg mb-3">슬롯 기본정보</div>

                            <div class="grid grid-cols-12 gap-3">
                                <div class="col-span-6">
                                    <label class="text-sm font-semibold text-slate-700">page</label>
                                    <input id="m_page" class="mt-1 w-full px-3 py-2 neo-card" readonly />
                                </div>
                                <div class="col-span-6">
                                    <label class="text-sm font-semibold text-slate-700">position</label>
                                    <input id="m_position" class="mt-1 w-full px-3 py-2 neo-card" readonly />
                                </div>

                                <div class="col-span-6">
                                    <label class="text-sm font-semibold text-slate-700">priority</label>
                                    <input id="m_priority" class="mt-1 w-full px-3 py-2 neo-card" readonly />
                                </div>

                                <div class="col-span-6">
                                    <label class="text-sm font-semibold text-slate-700">모드</label>
                                    <div class="mt-1 flex gap-2">
                                        <label class="neo-card px-3 py-2 flex items-center gap-2 cursor-pointer">
                                            <input type="radio" name="m_slotMode" value="banner" checked />
                                            <span class="font-semibold">이미지</span>
                                        </label>
                                        <label class="neo-card px-3 py-2 flex items-center gap-2 cursor-pointer">
                                            <input type="radio" name="m_slotMode" value="store" />
                                            <span class="font-semibold">가게연결</span>
                                        </label>
                                        <label class="neo-card px-3 py-2 flex items-center gap-2 cursor-pointer">
                                            <input type="radio" name="m_slotMode" value="text" />
                                            <span class="font-semibold">텍스트</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 이미지 -->
                        <div class="neo-card p-4 mt-5">
                            <div class="font-bold text-lg mb-3">이미지</div>

                            <div class="grid grid-cols-12 gap-3 items-start">
                                <div class="col-span-7">
                                    <label class="text-sm font-semibold text-slate-700">업로드</label>
                                    <input id="m_imageFile" type="file" accept="image/*"
                                        class="mt-1 w-full px-3 py-2 neo-card" />
                                    <div class="flex gap-3 mt-2 text-sm">
                                        <label class="flex items-center gap-2">
                                            <input id="m_keepImage" type="checkbox" />
                                            <span>기존 이미지 유지</span>
                                        </label>
                                        <label class="flex items-center gap-2">
                                            <input id="m_clearImage" type="checkbox" />
                                            <span class="text-rose-600 font-semibold">이미지/내용 초기화</span>
                                        </label>
                                    </div>
                                </div>

                                <div class="col-span-5">
                                    <div class="text-sm font-semibold text-slate-700">미리보기</div>
                                    <div class="neo-card mt-1 p-2">
                                        <img id="m_previewImg" src="" alt=""
                                            class="w-full h-40 object-cover rounded-xl hidden" />
                                        <div id="m_previewEmpty" class="text-slate-500 text-sm text-center py-10">
                                            미리보기 없음
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-3">
                                <label class="text-sm font-semibold text-slate-700">이미지 URL(선택)</label>
                                <input id="m_imageUrl" class="mt-1 w-full px-3 py-2 neo-card"
                                    placeholder="/uploads/..." />
                            </div>
                        </div>

                        <!-- 가게 연결 정보 (직접입력 금지: readonly) -->
                        <div class="neo-card p-4 mt-5">
                            <div class="font-bold text-lg mb-3">가게 연결 정보 (직접 입력 금지)</div>

                            <div class="grid grid-cols-12 gap-3">
                                <div class="col-span-4">
                                    <label class="text-sm font-semibold text-slate-700">table_source</label>
                                    <input id="m_tableSource" class="mt-1 w-full px-3 py-2 neo-card" readonly />
                                </div>
                                <div class="col-span-4">
                                    <label class="text-sm font-semibold text-slate-700">store_id</label>
                                    <input id="m_storeId" class="mt-1 w-full px-3 py-2 neo-card" readonly />
                                </div>
                                <div class="col-span-4">
                                    <label class="text-sm font-semibold text-slate-700">business_no</label>
                                    <input id="m_businessNo" class="mt-1 w-full px-3 py-2 neo-card" readonly />
                                </div>

                                <div class="col-span-12">
                                    <label class="text-sm font-semibold text-slate-700">business_name</label>
                                    <input id="m_businessName" class="mt-1 w-full px-3 py-2 neo-card" readonly />
                                </div>
                            </div>
                        </div>

                        <!-- 링크 / 텍스트 -->
                        <div class="neo-card p-4 mt-5">
                            <div class="font-bold text-lg mb-3">텍스트 / 링크</div>

                            <div class="grid grid-cols-12 gap-3">
                                <div class="col-span-12">
                                    <label class="text-sm font-semibold text-slate-700">link_url (가게 선택 시 자동)</label>
                                    <input id="m_linkUrl" class="mt-1 w-full px-3 py-2 neo-card"
                                        placeholder="/ndetail.html?id=...&type=..." />
                                </div>
                                <div class="col-span-12">
                                    <label class="text-sm font-semibold text-slate-700">text_content</label>
                                    <textarea id="m_textContent" rows="3" class="mt-1 w-full px-3 py-2 neo-card"
                                        placeholder="텍스트 모드일 때 표시될 내용"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- 저장 버튼 -->
                        <div class="flex gap-3 mt-6">
                            <button class="btn-3d" type="button" onclick="saveSlotFromModal()">저장</button>
                            <button class="neo-card px-5 py-2 font-bold" type="button"
                                onclick="closeSlotModal()">취소</button>
                            <div id="m_status" class="ml-auto text-sm text-slate-600 flex items-center"></div>
                        </div>
                    </div>

                    <!-- RIGHT (fixed) -->
                    <div class="w-1/3 p-5 border-l border-slate-200/60 max-h-[78vh]">
                        <div class="neo-card p-4">
                            <div class="font-bold text-lg mb-3">가게 검색</div>

                            <div class="grid grid-cols-12 gap-2">
                                <div class="col-span-12">
                                    <label class="text-sm font-semibold text-slate-700">가게명/업종 검색</label>
                                    <input id="storeSearchQ" class="mt-1 w-full px-3 py-2 neo-card"
                                        placeholder="예: 하늘식당" />
                                </div>
                                <div class="col-span-12">
                                    <label class="text-sm font-semibold text-slate-700">사업자번호 검색</label>
                                    <input id="storeSearchBizNo" class="mt-1 w-full px-3 py-2 neo-card"
                                        placeholder="숫자만/일부 가능" />
                                </div>
                                <div class="col-span-12 flex gap-2 mt-2">
                                    <button class="btn-3d w-full" type="button" onclick="doStoreSearch()">검색</button>
                                </div>
                            </div>

                            <div class="mt-4">
                                <div class="text-sm font-semibold text-slate-700 mb-2">검색 결과</div>
                                <div id="storeSearchResults" class="space-y-2 overflow-y-auto max-h-[48vh] pr-1"></div>
                            </div>

                            <div class="mt-4 text-xs text-slate-500">
                                * “선택”하면 store_id/table_source/business_no/link_url 이 자동 입력됩니다.
                            </div>
                        </div>
                    </div>
                </div> <!-- /body -->
            </div>
        </div>
    </div>

    <script>
        // header/footer
        fetch("/components/header.html").then(r => r.text()).then(d => document.getElementById("header-placeholder").innerHTML = d);
        fetch("/components/footer.html").then(r => r.text()).then(d => document.getElementById("footer-placeholder").innerHTML = d);

        // ✅ 서브카테고리 토글
        function toggleSub(btn) {
            const ul = btn.nextElementSibling;
            if (!ul) return;
            ul.classList.toggle("hidden");
        }

        function goBack() {
            if (document.referrer && document.referrer !== location.href) window.history.back();
            else window.location.href = "/category.html";
        }
        function goNext() { window.history.forward(); }

        // ===================== 관리자 슬롯 로직 =====================
        const API_BASE = "/ncategory2manager/ad";
        const $ = (id) => document.getElementById(id);
        const digitsOnly = (v) => String(v || "").replace(/[^\d]/g, "");

        const state = {
            slots: new Map(),           // position -> slot row
            current: null,              // position
            currentLabel: "",
            currentStoreId: null,       // store mode에서 내부 저장(직접입력 금지)
        };

        // 이 페이지에서 쓰는 슬롯 포지션(화면 배치 그대로)
        const POWER_POS = Array.from({ length: 9 }, (_, i) => `ncategory2_power_${i + 1}`);
        const BEST_POS = Array.from({ length: 6 }, (_, i) => `ncategory2_best_${i + 1}`);

        function buildCombinedLink(id) {
            return `/ndetail.html?id=${encodeURIComponent(String(id))}&type=combined`;
        }

        function setPreview(url) {
            const img = $("imgPreview");
            const empty = $("imgEmpty");
            if (url) {
                img.src = url;
                img.classList.remove("hidden");
                empty.classList.add("hidden");
            } else {
                img.src = "";
                img.classList.add("hidden");
                empty.classList.remove("hidden");
            }
        }

        function getRadio(name) {
            const el = document.querySelector(`input[name="${name}"]:checked`);
            return el ? el.value : "";
        }
        function setRadio(name, value) {
            const el = document.querySelector(`input[name="${name}"][value="${value}"]`);
            if (el) el.checked = true;
        }

        function applyModeUi() {
            const mode = getRadio("slotMode");
            const isStore = mode === "store";
            $("fBusinessName").disabled = isStore;
            $("fCategory").disabled = isStore;
            $("fBizNo").disabled = isStore;
            $("fLinkUrl").disabled = isStore;
            $("fTextContent").disabled = (mode !== "custom");
        }

        document.querySelectorAll('input[name="slotMode"]').forEach(el => el.addEventListener("change", applyModeUi));

        // --------- API ----------
        async function apiGetSlots() {
            const res = await fetch(`${API_BASE}/slots`);
            const data = await res.json();
            if (!data.success) throw new Error(data.error || "slots load failed");
            return data.slots || [];
        }

        async function apiGetSlot(position) {
            const res = await fetch(`${API_BASE}/slot?position=${encodeURIComponent(position)}`);
            const data = await res.json();
            if (!data.success) throw new Error(data.error || "slot load failed");
            return data.slot || null;
        }

        async function apiSearchStore({ q, bizNo }) {
            const qs = new URLSearchParams();
            if (q) qs.set("q", q);
            if (bizNo) qs.set("bizNo", bizNo);
            const res = await fetch(`${API_BASE}/store/search?${qs.toString()}`);
            const data = await res.json();
            // ✅ 서버는 { ok:true, stores:[...] }로 응답
            if (!data || data.ok !== true) throw new Error(data.error || "검색 실패");
            return data.stores || [];
        }

        async function apiUpsertSlot(position) {
            const fd = new FormData();

            const slotMode = getRadio("slotMode");
            const slotType = getRadio("slotType");

            fd.set("position", position);
            fd.set("page", "ncategory2");
            fd.set("slot_mode", slotMode);
            fd.set("slot_type", slotType);

            if (slotMode === "store") {
                if (!state.currentStoreId) throw new Error("가게 연결 모드인데 선택된 가게가 없습니다.");
                fd.set("store_type", "combined_store_info");
                fd.set("store_id", String(state.currentStoreId));
                fd.set("business_no", digitsOnly($("fBizNo").value));
                fd.set("business_name", $("fBusinessName").value || "");
                fd.set("category", $("fCategory").value || "");
                fd.set("link_url", buildCombinedLink(state.currentStoreId));
                fd.set("text_content", "");
            } else {
                fd.set("store_type", "");
                fd.set("store_id", "");
                fd.set("business_no", digitsOnly($("fBizNo").value));
                fd.set("business_name", $("fBusinessName").value || "");
                fd.set("category", $("fCategory").value || "");
                fd.set("link_url", $("fLinkUrl").value || "");
                fd.set("text_content", $("fTextContent").value || "");
            }

            const file = $("fImage").files && $("fImage").files[0];
            if (file) fd.append("image", file);

            const res = await fetch(`${API_BASE}/slot`, { method: "POST", body: fd });
            const data = await res.json();
            if (!data.success) throw new Error(data.error || "save failed");
            return data.slot || null;
        }

        async function apiDeleteSlot(position) {
            const res = await fetch(`${API_BASE}/slot?position=${encodeURIComponent(position)}`, { method: "DELETE" });
            const data = await res.json();
            if (!data.success) throw new Error(data.error || "delete failed");
            return true;
        }

        // --------- 화면 생성(반복 DOM을 JS로 만들어서 레이아웃은 동일) ----------
        function makeSlotCard(position, label, imgHClass = "h-60 md:h-64") {
            // ncategory2 카드와 동일 구조(오버레이 포함)
            const wrap = document.createElement("div");
            wrap.className = "neo-card p-0 overflow-hidden relative rounded-2xl border-4 border-yellow-200 admin-slot";
            wrap.setAttribute("data-position", position);
            wrap.setAttribute("data-label", label);

            wrap.innerHTML = `
        <img data-role="img" src="/uploads/sample-1.jpg" alt="${label}" class="w-full ${imgHClass} object-cover">
        <div class="absolute left-3 right-3 bottom-3 bg-white/70 backdrop-blur-md rounded-xl shadow px-4 py-2 text-center">
          <div class="font-bold text-lg" data-role="name">${label}</div>
          <div class="text-sm text-slate-600" data-role="category">업종:</div>
        </div>
      `;
            return wrap;
        }

        function buildPowerSliderDom() {
            const track = $("powerAdTrack");
            track.innerHTML = "";

            // 3그룹(각 3개) 동일
            for (let g = 0; g < 3; g++) {
                const group = document.createElement("div");
                group.className = "power-group flex basis-full shrink-0";

                for (let i = 0; i < 3; i++) {
                    const idx = g * 3 + i; // 0..8
                    const pos = POWER_POS[idx];
                    const col = document.createElement("div");
                    col.className = "w-1/3 px-2";

                    // 링크는 slot에서 치환(관리페이지니까 클릭은 모달로)
                    const a = document.createElement("a");
                    a.href = "#";
                    a.className = "block";
                    a.appendChild(makeSlotCard(pos, `강력추천 ${idx + 1}`));

                    col.appendChild(a);
                    group.appendChild(col);
                }
                track.appendChild(group);
            }
        }

        function buildBestGridDom() {
            const grid = $("bestGrid");
            grid.innerHTML = "";
            for (let i = 0; i < 6; i++) {
                const pos = BEST_POS[i];
                const a = document.createElement("a");
                a.href = "#";
                a.className = "block group";

                const card = document.createElement("div");
                card.className = "neo-card p-0 overflow-hidden relative rounded-2xl transition-transform admin-slot";
                card.setAttribute("data-position", pos);
                card.setAttribute("data-label", `최고의가게 ${i + 1}`);

                card.innerHTML = `
          <div class="w-full h-60">
            <img data-role="img" src="/uploads/sample-1.jpg" alt="상호명" class="w-full h-full object-cover">
          </div>
          <div class="absolute left-3 right-3 bottom-3 bg-white/70 backdrop-blur-md rounded-xl shadow px-4 py-3">
            <div class="font-bold text-lg leading-tight" data-role="name">상호명</div>
            <div class="text-sm text-slate-600" data-role="category">업종:</div>
          </div>
        `;

                a.appendChild(card);
                grid.appendChild(a);
            }
        }

        // --------- 슬롯값을 화면에 반영 ----------
        function applySlotToEl(el, slot) {
            if (!el) return;
            const img = el.querySelector('[data-role="img"]');
            const name = el.querySelector('[data-role="name"]');
            const category = el.querySelector('[data-role="category"]');

            const fallbackImg = img?.getAttribute("src") || "";
            const imageUrl = slot?.image_url || fallbackImg;
            const businessName = slot?.business_name || slot?.text_content || (el.getAttribute("data-label") || "");
            const cat = slot?.category || "";

            if (img) img.src = imageUrl || fallbackImg;
            if (name) name.textContent = businessName || "";
            if (category) category.textContent = cat ? `업종: ${cat}` : "업종:";

            // 링크 치환(관리페이지에서는 클릭 시 모달이 뜨므로, href는 유지/미리보기용으로만)
            const a = el.closest("a");
            if (a) a.href = slot?.link_url || "#";
        }

        function bindAdminClicks() {
            document.querySelectorAll("[data-position]").forEach(el => {
                el.addEventListener("click", (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const pos = el.getAttribute("data-position");
                    const label = el.getAttribute("data-label") || pos;
                    openModal(pos, label);
                });
            });
        }

        async function loadAndRender() {
            const rows = await apiGetSlots();
            state.slots.clear();
            rows.forEach(r => state.slots.set(r.position, r));

            // 페이지 안의 모든 슬롯 엘리먼트에 반영
            document.querySelectorAll("[data-position]").forEach(el => {
                const pos = el.getAttribute("data-position");
                applySlotToEl(el, state.slots.get(pos));
            });
        }

        // --------- 모달 ----------
        function openModal(position, label) {
            state.current = position;
            state.currentLabel = label;
            state.currentStoreId = null;

            $("mTitle").textContent = label;
            $("mPositionChip").textContent = position;

            $("qName").value = "";
            $("qBiz").value = "";
            $("searchMsg").textContent = "";
            $("searchResults").innerHTML = "";
            $("saveMsg").textContent = "";
            $("fImage").value = "";
            setPreview("");

            setRadio("slotMode", "store");
            setRadio("slotType", "image");

            const saved = state.slots.get(position);
            if (saved) {
                if (saved.slot_mode) setRadio("slotMode", saved.slot_mode);
                if (saved.slot_type) setRadio("slotType", saved.slot_type);

                $("fBusinessName").value = saved.business_name || "";
                $("fCategory").value = saved.category || "";
                $("fBizNo").value = saved.business_no || "";
                $("fLinkUrl").value = saved.link_url || "";
                $("fTextContent").value = saved.text_content || "";

                if (saved.store_id) state.currentStoreId = saved.store_id;
                setPreview(saved.image_url || "");
            } else {
                $("fBusinessName").value = "";
                $("fCategory").value = "";
                $("fBizNo").value = "";
                $("fLinkUrl").value = "";
                $("fTextContent").value = "";
            }

            applyModeUi();

            $("modal").style.display = "flex";
            document.body.style.overflow = "hidden";
        }

        function closeModal() {
            $("modal").style.display = "none";
            document.body.style.overflow = "";
        }

        $("mClose").addEventListener("click", closeModal);
        $("modal").addEventListener("click", (e) => { if (e.target === $("modal")) closeModal(); });

        $("fImage").addEventListener("change", () => {
            const f = $("fImage").files && $("fImage").files[0];
            if (!f) return;
            const url = URL.createObjectURL(f);
            setPreview(url);
        });

        $("btnSearch").addEventListener("click", async () => {
            const q = $("qName").value.trim();
            const bizNo = digitsOnly($("qBiz").value.trim());

            $("searchMsg").textContent = "검색 중...";
            $("searchResults").innerHTML = "";

            try {
                const stores = await apiSearchStore({ q, bizNo });
                if (!stores.length) {
                    $("searchMsg").textContent = "검색 결과가 없습니다.";
                    return;
                }

                $("searchMsg").textContent = `검색 결과: ${stores.length}건`;

                stores.forEach(s => {
                    const row = document.createElement("div");
                    row.className = "neo-card p-3 flex items-center justify-between gap-3";
                    row.innerHTML = `
            <div class="min-w-0">
              <div class="font-black text-slate-800 truncate">${s.business_name || "-"}</div>
              <div class="text-sm font-bold text-slate-600 truncate">${s.category ? `업종: ${s.category}` : ""}</div>
              <div class="text-xs font-extrabold text-slate-500 truncate">biz: ${s.business_no || ""}</div>
            </div>
            <div class="shrink-0">
              <button class="btn-3d">선택</button>
            </div>
          `;
                    row.querySelector("button").addEventListener("click", () => {
                        state.currentStoreId = s.id;

                        $("fBusinessName").value = s.business_name || "";
                        $("fCategory").value = s.category || "";
                        $("fBizNo").value = s.business_no || "";
                        $("fLinkUrl").value = buildCombinedLink(s.id);

                        setRadio("slotMode", "store");
                        applyModeUi();

                        $("saveMsg").textContent = "가게 선택 완료. 저장을 누르세요.";
                    });

                    $("searchResults").appendChild(row);
                });
            } catch (e) {
                $("searchMsg").textContent = "";
                alert(e.message);
            }
        });

        $("btnSave").addEventListener("click", async () => {
            if (!state.current) return;
            $("btnSave").disabled = true;
            $("saveMsg").textContent = "저장 중...";

            try {
                const saved = await apiUpsertSlot(state.current);
                if (saved) state.slots.set(saved.position, saved);
                else {
                    const s = await apiGetSlot(state.current);
                    if (s) state.slots.set(state.current, s);
                }

                await loadAndRender();
                bindAdminClicks(); // DOM에 다시 바인딩(안전)
                $("saveMsg").textContent = "저장 완료";
            } catch (e) {
                $("saveMsg").textContent = "";
                alert(e.message);
            } finally {
                $("btnSave").disabled = false;
            }
        });

        $("btnDelete").addEventListener("click", async () => {
            if (!state.current) return;
            if (!confirm("이 슬롯을 삭제할까요?")) return;

            $("btnDelete").disabled = true;
            try {
                await apiDeleteSlot(state.current);
                state.slots.delete(state.current);

                await loadAndRender();
                bindAdminClicks();
                closeModal();
            } catch (e) {
                alert(e.message);
            } finally {
                $("btnDelete").disabled = false;
            }
        });

        // ===================== 파워 광고 슬라이더(네 코드 그대로) =====================
        function initPowerSlider() {
            const viewport = $("powerViewport");
            const track = $("powerAdTrack");
            if (!viewport || !track) return;

            let groups = track.querySelectorAll(".power-group").length;
            let index = Math.floor(Math.random() * groups);
            let dir = 1;

            function updateSlider() {
                const slideWidth = viewport.clientWidth;
                track.style.transform = `translateX(${-index * slideWidth}px)`;
            }

            function stepAuto() {
                if (groups <= 1) return;
                if (index >= groups - 1) dir = -1;
                else if (index <= 0) dir = 1;
                index = index + dir;
                updateSlider();
            }

            function nextManual() {
                if (groups <= 1) return;
                if (index < groups - 1) index++;
                else { dir = -1; index = groups - 2; }
                updateSlider();
            }

            function prevManual() {
                if (groups <= 1) return;
                if (index > 0) index--;
                else { dir = 1; index = 1; }
                updateSlider();
            }

            const nextBtn = $("nextBtn");
            const prevBtn = $("prevBtn");
            if (nextBtn && prevBtn) {
                nextBtn.addEventListener("click", () => { stopAuto(); nextManual(); startAuto(); });
                prevBtn.addEventListener("click", () => { stopAuto(); prevManual(); startAuto(); });
            }

            window.addEventListener("resize", updateSlider);

            const INTERVAL = 10000;
            let timer = null;
            function startAuto() { if (!timer) timer = setInterval(stepAuto, INTERVAL); }
            function stopAuto() { if (timer) { clearInterval(timer); timer = null; } }

            document.addEventListener("visibilitychange", () => { document.hidden ? stopAuto() : startAuto(); });
            viewport.addEventListener("mouseenter", stopAuto);
            viewport.addEventListener("mouseleave", startAuto);

            updateSlider();
            startAuto();
        }

        // init
        document.addEventListener("DOMContentLoaded", async () => {
            buildPowerSliderDom();   // 파워(레이아웃 동일 구조 생성)
            buildBestGridDom();      // 최고의가게(레이아웃 동일 구조 생성)
            bindAdminClicks();       // 클릭 → 모달
            await loadAndRender();   // 서버값 반영
            initPowerSlider();       // 슬라이더 동작
        });

        // ✅ 모달 관리 스크립트 (API_BASE는 위에서 이미 선언됨)

        let currentSlotKey = { page: "ncategory2", position: "", priority: "" };

        function $(id) { return document.getElementById(id); }

        function setStatus(msg) {
            const el = $("m_status");
            if (el) el.textContent = msg || "";
        }

        function openSlotModal(position, priority = "") {
            currentSlotKey.page = "ncategory2";
            currentSlotKey.position = position || "";
            currentSlotKey.priority = (priority === null || priority === undefined) ? "" : String(priority);

            $("m_page").value = currentSlotKey.page;
            $("m_position").value = currentSlotKey.position;
            $("m_priority").value = currentSlotKey.priority;

            // 초기화
            setStatus("");
            $("m_imageFile").value = "";
            $("m_keepImage").checked = false;
            $("m_clearImage").checked = false;

            $("m_imageUrl").value = "";
            $("m_previewImg").classList.add("hidden");
            $("m_previewEmpty").classList.remove("hidden");
            $("m_previewImg").src = "";

            $("m_tableSource").value = "";
            $("m_storeId").value = "";
            $("m_businessNo").value = "";
            $("m_businessName").value = "";
            $("m_linkUrl").value = "";
            $("m_textContent").value = "";

            // 모드 기본
            document.querySelectorAll('input[name="m_slotMode"]').forEach(r => {
                r.checked = (r.value === "banner");
            });

            $("storeSearchResults").innerHTML = "";
            $("storeSearchQ").value = "";
            $("storeSearchBizNo").value = "";

            // 열기
            $("slotModal").classList.remove("hidden");
            $("slotModalSub").textContent = `page=${currentSlotKey.page} / position=${currentSlotKey.position}` +
                (currentSlotKey.priority ? ` / priority=${currentSlotKey.priority}` : " / priority=NULL");

            // 슬롯 불러오기
            loadSlotIntoModal();
        }

        function closeSlotModal() {
            $("slotModal").classList.add("hidden");
        }

        async function loadSlotIntoModal() {
            try {
                setStatus("불러오는 중...");
                const url = new URL(`${API_BASE}/slot`, window.location.origin);
                url.searchParams.set("page", currentSlotKey.page);
                url.searchParams.set("position", currentSlotKey.position);
                if (currentSlotKey.priority !== "") url.searchParams.set("priority", currentSlotKey.priority);

                const r = await fetch(url.toString());
                const data = await r.json();

                if (!data || data.success !== true) {
                    setStatus("슬롯 없음(신규)");
                    return;
                }

                const slot = data.slot || null;
                if (!slot) { setStatus("슬롯 없음(신규)"); return; }

                // 모드
                const mode = (slot.slot_mode || slot.slotMode || "banner");
                document.querySelectorAll('input[name="m_slotMode"]').forEach(r => {
                    r.checked = (r.value === mode);
                });

                // 이미지
                const img = slot.image_url || "";
                $("m_imageUrl").value = img || "";
                if (img) {
                    $("m_previewImg").src = img;
                    $("m_previewImg").classList.remove("hidden");
                    $("m_previewEmpty").classList.add("hidden");
                }

                // 가게 연결
                $("m_tableSource").value = slot.table_source || slot.tableSource || "";
                $("m_storeId").value = slot.store_id || slot.storeId || "";
                $("m_businessNo").value = slot.business_no || slot.businessNo || "";
                $("m_businessName").value = slot.business_name || slot.businessName || "";

                // 링크/텍스트
                $("m_linkUrl").value = slot.link_url || slot.linkUrl || "";
                $("m_textContent").value = slot.text_content || slot.textContent || "";

                setStatus("불러오기 완료");
            } catch (e) {
                console.error(e);
                setStatus("불러오기 실패");
            }
        }

        // ✅ 가게 검색
        async function doStoreSearch() {
            try {
                const q = ($("storeSearchQ").value || "").trim();
                const bizNo = ($("storeSearchBizNo").value || "").trim();

                const url = new URL(`${API_BASE}/store/search`, window.location.origin);
                if (q) url.searchParams.set("q", q);
                if (bizNo) url.searchParams.set("bizNo", bizNo);

                $("storeSearchResults").innerHTML = `<div class="text-sm text-slate-500">검색 중...</div>`;

                const r = await fetch(url.toString());
                const data = await r.json();

                // 서버 응답: {ok:true, stores:[...] }
                if (!data || data.ok !== true) {
                    $("storeSearchResults").innerHTML = `<div class="text-sm text-rose-600">검색 실패</div>`;
                    return;
                }

                renderStoreResults(data.stores || []);
            } catch (e) {
                console.error(e);
                $("storeSearchResults").innerHTML = `<div class="text-sm text-rose-600">검색 오류</div>`;
            }
        }

        function renderStoreResults(stores) {
            const wrap = $("storeSearchResults");
            wrap.innerHTML = "";

            if (!stores.length) {
                wrap.innerHTML = `<div class="text-sm text-slate-500">검색 결과 없음</div>`;
                return;
            }

            stores.forEach((s) => {
                const id = s.id || "";
                const ts = s.table_source || "";
                const biz = s.business_no || "";
                const name = s.business_name || "";
                const cat = s.category || "";
                const img = s.image_url || "";

                const row = document.createElement("div");
                row.className = "neo-card p-3 flex gap-3 items-center";

                row.innerHTML = `
            <div class="w-16 h-12 rounded-xl overflow-hidden bg-white/60 shrink-0">
                ${img ? `<img src="${img}" class="w-full h-full object-cover" />` : `<div class="w-full h-full flex items-center justify-center text-xs text-slate-400">NO IMG</div>`}
            </div>
            <div class="flex-1 min-w-0">
                <div class="font-extrabold text-slate-800 truncate">${name}</div>
                <div class="text-xs text-slate-600 mt-0.5 truncate">${cat ? `(${cat})` : ""} ${biz ? `· ${biz}` : ""}</div>
                <div class="text-[11px] text-slate-400 mt-0.5 truncate">${ts} · id=${id}</div>
            </div>
            <button class="btn-3d shrink-0" type="button">선택</button>
            `;

                row.querySelector("button").addEventListener("click", () => {
                    applySelectedStore({ id, table_source: ts, business_no: biz, business_name: name });
                });

                wrap.appendChild(row);
            });
        }

        // ✅ “선택” 시 자동 매핑 (직접입력 금지)
        function applySelectedStore(store) {
            const storeId = store.id || "";
            const tableSource = store.table_source || "";
            const businessNo = store.business_no || "";
            const businessName = store.business_name || "";

            $("m_storeId").value = storeId;
            $("m_tableSource").value = tableSource;
            $("m_businessNo").value = businessNo;
            $("m_businessName").value = businessName;

            // 모드는 가게연결로 자동
            document.querySelectorAll('input[name="m_slotMode"]').forEach(r => {
                r.checked = (r.value === "store");
            });

            // link_url 자동 생성 규칙 (컨트롤러 normalize/save와 동일)
            const type = tableSource === "combined_store_info" ? "combined"
                : tableSource === "food_stores" ? "food"
                    : "store_info";
            $("m_linkUrl").value = `/ndetail.html?id=${storeId}&type=${type}`;

            setStatus("가게 연결 완료");
        }

        // ✅ 저장 (multipart/form-data)
        async function saveSlotFromModal() {
            try {
                setStatus("저장 중...");

                const page = $("m_page").value;
                const position = $("m_position").value;
                const priority = $("m_priority").value;

                const mode = document.querySelector('input[name="m_slotMode"]:checked')?.value || "banner";

                const fd = new FormData();
                fd.append("page", page);
                fd.append("position", position);
                if (priority !== "") fd.append("priority", priority);

                // controller가 받는 키들
                fd.append("slotMode", mode);
                fd.append("slotType", "banner"); // 유지 (필요하면 확장)

                fd.append("linkUrl", ($("m_linkUrl").value || "").trim());
                fd.append("textContent", ($("m_textContent").value || "").trim());

                fd.append("storeId", ($("m_storeId").value || "").trim());
                fd.append("businessNo", ($("m_businessNo").value || "").trim());
                fd.append("businessName", ($("m_businessName").value || "").trim());
                fd.append("tableSource", ($("m_tableSource").value || "").trim() || "store_info");

                fd.append("keepImage", $("m_keepImage").checked ? "true" : "false");
                fd.append("clearImage", $("m_clearImage").checked ? "true" : "false");
                fd.append("imageUrl", ($("m_imageUrl").value || "").trim());

                const file = $("m_imageFile").files && $("m_imageFile").files[0];
                if (file) fd.append("image", file); // ✅ 라우터 multer.single("image") 가정

                const r = await fetch(`${API_BASE}/slot`, { method: "POST", body: fd });
                const data = await r.json();

                if (!data || data.success !== true) {
                    setStatus("저장 실패");
                    console.log("saveSlot resp:", data);
                    return;
                }

                setStatus("저장 완료");

                // 저장 결과를 다시 로드해서 미리보기/값 최신화
                await loadSlotIntoModal();

                // 필요하면 여기서 슬롯 카드 UI도 갱신 호출
                // refreshSlots?.();

            } catch (e) {
                console.error(e);
                setStatus("저장 오류");
            }
        }


    </script>
</body>

</html>