<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‘¸ë“œì¹´í…Œê³ ë¦¬ ë§í¬ ì¼ê´„ ìˆ˜ì •</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow p-6">
            <h1 class="text-2xl font-bold mb-4">ğŸ”§ í‘¸ë“œì¹´í…Œê³ ë¦¬ ìŠ¬ë¡¯ ë§í¬ ì¼ê´„ ìˆ˜ì •</h1>
            <p class="text-slate-600 mb-6">
                DBì— ì €ì¥ëœ ì˜ëª»ëœ link_urlì„ ì˜¬ë°”ë¥¸ íƒ€ì…ìœ¼ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤.<br>
                (store_info â†’ type=store_info, combined_store_info â†’ type=combined)
            </p>
            
            <button id="btnFix" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
                ë§í¬ ìˆ˜ì • ì‹¤í–‰
            </button>
            
            <div id="output" class="mt-6 p-4 bg-slate-100 rounded-lg font-mono text-sm hidden"></div>
            <pre id="results" class="mt-4 p-4 bg-slate-800 text-green-400 rounded-lg text-xs overflow-auto hidden"></pre>
        </div>
    </div>

    <script>
        const btnFix = document.getElementById('btnFix');
        const output = document.getElementById('output');
        const results = document.getElementById('results');

        btnFix.addEventListener('click', async () => {
            btnFix.disabled = true;
            btnFix.textContent = 'ìˆ˜ì • ì¤‘...';
            output.classList.remove('hidden');
            output.innerHTML = '<div class="text-blue-600">â³ ì²˜ë¦¬ ì¤‘...</div>';
            
            try {
                // 1. store_info ìˆ˜ì •
                output.innerHTML += '<div class="mt-2">1ï¸âƒ£ store_info í…Œì´ë¸” ë§í¬ ìˆ˜ì • ì¤‘...</div>';
                const res1 = await fetch('/foodcategorymanager/ad/fix-links/store_info', { method: 'POST' });
                const data1 = await res1.json();
                output.innerHTML += `<div class="text-green-600">âœ… ${data1.count || 0}ê°œ ìˆ˜ì •ë¨</div>`;
                
                // 2. combined_store_info ìˆ˜ì •
                output.innerHTML += '<div class="mt-2">2ï¸âƒ£ combined_store_info í…Œì´ë¸” ë§í¬ ìˆ˜ì • ì¤‘...</div>';
                const res2 = await fetch('/foodcategorymanager/ad/fix-links/combined_store_info', { method: 'POST' });
                const data2 = await res2.json();
                output.innerHTML += `<div class="text-green-600">âœ… ${data2.count || 0}ê°œ ìˆ˜ì •ë¨</div>`;
                
                // 3. food_stores ìˆ˜ì •
                output.innerHTML += '<div class="mt-2">3ï¸âƒ£ food_stores í…Œì´ë¸” ë§í¬ ìˆ˜ì • ì¤‘...</div>';
                const res3 = await fetch('/foodcategorymanager/ad/fix-links/food_stores', { method: 'POST' });
                const data3 = await res3.json();
                output.innerHTML += `<div class="text-green-600">âœ… ${data3.count || 0}ê°œ ìˆ˜ì •ë¨</div>`;
                
                // 4. ê²°ê³¼ í™•ì¸
                output.innerHTML += '<div class="mt-4 text-blue-600">ğŸ“Š ìˆ˜ì • í›„ ìƒíƒœ í™•ì¸ ì¤‘...</div>';
                const res4 = await fetch('/foodcategorymanager/ad/check-links');
                const data4 = await res4.json();
                
                results.classList.remove('hidden');
                results.textContent = JSON.stringify(data4.slots || [], null, 2);
                
                output.innerHTML += `<div class="mt-2 text-green-600 font-bold">âœ… ëª¨ë“  ìˆ˜ì • ì™„ë£Œ! (ì´ ${data4.slots?.length || 0}ê°œ ìŠ¬ë¡¯)</div>`;
                btnFix.textContent = 'âœ… ìˆ˜ì • ì™„ë£Œ';
            } catch (err) {
                console.error(err);
                output.innerHTML += `<div class="mt-2 text-red-600">âŒ ì˜¤ë¥˜: ${err.message}</div>`;
                btnFix.disabled = false;
                btnFix.textContent = 'ë‹¤ì‹œ ì‹œë„';
            }
        });
    </script>
</body>
</html>
