<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MALL HANKOOK | Index Layout Manager (indexmanager)</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: 'Noto Sans KR', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        /* =========================
       âœ… ì¹´ë“œ/ìŠ¬ë¡¯ ê¸°ë³¸ ìŠ¤íƒ€ì¼
    ========================== */
        .neo-card {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(59, 130, 246, 0.18);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 1rem;
            box-shadow:
                6px 6px 12px rgba(0, 0, 0, 0.08),
                -6px -6px 12px rgba(255, 255, 255, 0.85);
            transition: all 0.22s ease;
        }

        .neo-card:hover {
            transform: translateY(-2px);
            box-shadow:
                10px 10px 18px rgba(0, 0, 0, 0.12),
                -6px -6px 10px rgba(255, 255, 255, 0.95);
        }

        .slot-banner {
            position: relative;
            overflow: hidden;
            cursor: pointer;
            isolation: isolate;
        }

        /* âœ… ìŠ¬ë¡¯ ì´ë¯¸ì§€ ì•ˆì „ ê·œê²© */
        .slot-banner .slot-img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
            z-index: 1;
        }

        .slot-banner .slot-default {
            position: relative;
            z-index: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(107, 114, 128, 0.9);
            font-size: 0.85rem;
            background: linear-gradient(135deg, #f8fafc, #f1f 5f9);
        }

        .slot-img.hidden {
            display: none !important;
        }

        /* =========================
       âœ… ê´€ë¦¬ì ì˜¤ë²„ë ˆì´ ë°°ì§€
       - label(ê²€ì • ë°”íƒ• ì´ë¦„ ë°°ì§€)ì€ HTMLì—ì„œ ëª¨ë‘ ì œê±°ë¨
    ========================== */
        .slot-badge {
            position: absolute;
            z-index: 3;
            font-size: 10px;
            line-height: 1;
            padding: 6px 8px;
            border-radius: 9999px;
            background: rgba(15, 23, 42, 0.85);
            color: white;
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            letter-spacing: 0.2px;
        }

        .slot-badge.size {
            bottom: 10px;
            right: 10px;
            background: rgba(37, 99, 235, 0.9);
        }

        .slot-badge.store {
            bottom: 10px;
            left: 10px;
            background: rgba(16, 185, 129, 0.9);
        }

        /* =========================
       âœ… ì»¤ì„œ ë”°ë¼ì˜¤ëŠ” íˆ´íŒ
    ========================== */
        #hoverTip {
            position: fixed;
            z-index: 9999;
            pointer-events: none;
            transform: translate(12px, 12px);
            padding: 6px 10px;
            font-size: 11px;
            border-radius: 8px;
            background: rgba(2, 6, 23, 0.9);
            color: white;
            opacity: 0;
            transition: opacity 0.08s ease;
            white-space: nowrap;
        }

        #hoverTip.show {
            opacity: 1;
        }

        /* =========================
       âœ… ëª¨ë‹¬ ê¸°ë³¸
    ========================== */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(2, 6, 23, 0.65);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            z-index: 9998;
        }

        .modal-panel {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            z-index: 9999;
        }

        .modal-card {
            width: min(920px, 96vw);
            max-height: 92vh;
            overflow: auto;
            border-radius: 20px;
            background: white;
            border: 1px solid rgba(148, 163, 184, 0.35);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
        }

        .field {
            width: 100%;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 10px 12px;
            outline: none;
        }

        .field:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.25);
        }

        .divider {
            height: 1px;
            background: #eef2f7;
        }

        /* Best Pick ì›í˜• ìŠ¬ë¡¯ */
        .best-circle {
            position: relative;
            border-radius: 9999px;
            overflow: hidden;
        }

        .best-circle .slot-img {
            object-fit: cover;
        }

        .slot-text-body:empty+.slot-hint {
            display: block;
        }

        .slot-text-body:not(:empty)+.slot-hint {
            display: none;
        }
    </style>
</head>

<body class="bg-white text-gray-800">

    <!-- ìƒë‹¨ íƒ€ì´í‹€ -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 pt-10">
        <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3">
            <div>
                <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">
                    Index ë ˆì´ì•„ì›ƒ ê´€ë¦¬ì (indexmanager)
                </h1>
                <p class="text-sm text-gray-500 mt-1">
                    ê° ë°•ìŠ¤ë¥¼ í´ë¦­í•´ ì´ë¯¸ì§€ / ê°€ê²Œ ì—°ê²° / í…ìŠ¤íŠ¸ ê´‘ê³ ë¥¼ ì„¤ì •í•˜ì„¸ìš”.
                </p>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-xs px-2 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100">
                    page = index
                </span>
                <span class="text-xs px-2 py-1 rounded-full bg-slate-50 text-slate-600 border border-slate-100">
                    /manager/ad/slot ì—°ë™
                </span>
            </div>
        </div>
    </div>

    <!-- =========================
       â‘  ìƒë‹¨ ë ë°°ë„ˆ
  ========================== -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 mt-10">
        <div id="slot_index_main_top"
            class="neo-card h-48 flex flex-col items-center justify-center text-center slot-banner"
            data-position="index_main_top" data-label="ìƒë‹¨ ë ë°°ë„ˆ" data-size="ê°€ë¡œí˜• (ê¶Œì¥ ë¹„ìœ¨ 6:1)">
            <img class="slot-img hidden" alt="ìƒë‹¨ ë ë°°ë„ˆ">
            <div class="slot-default">
                <div>
                    <p class="text-lg sm:text-xl font-bold">ìƒë‹¨ ë ë°°ë„ˆ</p>
                    <p class="text-gray-500 text-xs sm:text-sm">í´ë¦­í•˜ì—¬ ê´‘ê³  ì„¤ì •</p>
                </div>
            </div>
            <span class="slot-badge size">6:1</span>
            <span class="slot-badge store hidden"></span>
        </div>
    </div>

    <!-- =========================
       â‘¡ ë©”ì¸ ë¹„ì£¼ì–¼ + â‘¢â‘£â‘¤ í”„ë¡œëª¨
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 items-stretch">

            <!-- ë©”ì¸ ë¹„ì£¼ì–¼ -->
            <div class="lg:col-span-3">
                <div id="slot_index_main_visual"
                    class="slot-banner rounded-2xl overflow-hidden bg-gray-100 shadow-lg aspect-[21/9] w-full h-full"
                    data-position="index_main_visual" data-label="ë©”ì¸ ë¹„ì£¼ì–¼" data-size="ê¶Œì¥ ë¹„ìœ¨ 21:9">
                    <img class="slot-img hidden w-full h-full" alt="ë©”ì¸ ë¹„ì£¼ì–¼">
                    <div class="slot-default w-full h-full">
                        <div class="text-center">
                            <p class="text-lg sm:text-xl font-bold">ë©”ì¸ ë¹„ì£¼ì–¼</p>
                            <p class="text-gray-500 text-xs sm:text-sm mt-1">í´ë¦­í•˜ì—¬ ê´‘ê³  ì„¤ì •</p>
                        </div>
                    </div>
                    <span class="slot-badge size">21:9</span>
                    <span class="slot-badge store hidden"></span>
                </div>
            </div>

            <!-- í”„ë¡œëª¨ 1/2/3 ì»¬ëŸ¼ -->
            <div class="lg:col-span-1 flex flex-col gap-4 h-full">

                <div id="slot_index_promo_1"
                    class="slot-banner rounded-2xl border border-gray-100 bg-white shadow-sm overflow-hidden flex-1 min-h-[90px] aspect-[4/3]"
                    data-position="index_promo_1" data-label="í”„ë¡œëª¨ 1" data-size="ê¶Œì¥ ë¹„ìœ¨ 4:3">
                    <img class="slot-img hidden" alt="í”„ë¡œëª¨ 1">
                    <div class="slot-default">
                        <span>Promo 1</span>
                    </div>
                    <span class="slot-badge size">4:3</span>
                    <span class="slot-badge store hidden"></span>
                </div>

                <div id="slot_index_promo_2"
                    class="slot-banner rounded-2xl border border-gray-100 bg-white shadow-sm overflow-hidden flex-1 min-h-[90px] aspect-[4/3]"
                    data-position="index_promo_2" data-label="í”„ë¡œëª¨ 2" data-size="ê¶Œì¥ ë¹„ìœ¨ 4:3">
                    <img class="slot-img hidden" alt="í”„ë¡œëª¨ 2">
                    <div class="slot-default">
                        <span>Promo 2</span>
                    </div>
                    <span class="slot-badge size">4:3</span>
                    <span class="slot-badge store hidden"></span>
                </div>

                <div id="slot_index_promo_3"
                    class="slot-banner rounded-2xl border border-gray-100 bg-white shadow-sm overflow-hidden flex-1 min-h-[90px] aspect-[4/3]"
                    data-position="index_promo_3" data-label="í”„ë¡œëª¨ 3" data-size="ê¶Œì¥ ë¹„ìœ¨ 4:3">
                    <img class="slot-img hidden" alt="í”„ë¡œëª¨ 3">
                    <div class="slot-default">
                        <span>Promo 3</span>
                    </div>
                    <span class="slot-badge size">4:3</span>
                    <span class="slot-badge store hidden"></span>
                </div>

            </div>
        </div>
    </section>

    <!-- =========================
       â‘¥ ìƒë‹¨ ì„œë¸Œ ë°•ìŠ¤
       âœ… 4ê°œëŠ” "í…ìŠ¤íŠ¸ ì „ìš©"
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-6">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 text-center">

            <!-- 1) ê²€ìƒ‰ì–´ -->
            <div>
                <h3 class="font-extrabold text-2xl sm:text-3xl mb-3">ê²€ìƒ‰ì–´</h3>
                <div id="slot_index_sub_keywords" class="neo-card min-h-[180px] sm:min-h-[220px] p-6 sm:p-7 slot-banner"
                    data-position="index_sub_keywords" data-label="ê²€ìƒ‰ì–´ ë°•ìŠ¤" data-size="í…ìŠ¤íŠ¸ ì˜ì—­">
                    <img class="slot-img hidden" alt="ê²€ìƒ‰ì–´">

                    <div class="h-full flex flex-col items-center justify-center gap-3">
                        <div
                            class="slot-text-body text-[18px] sm:text-[22px] font-semibold text-gray-800 leading-relaxed whitespace-pre-line">
                        </div>
                        <div class="slot-hint text-base sm:text-lg text-gray-500 font-medium">í…ìŠ¤íŠ¸ ì „ìš©</div>
                    </div>

                    <span class="slot-badge size text-sm sm:text-base">Text</span>
                    <span class="slot-badge store hidden"></span>
                </div>
            </div>

            <!-- 2) ìµœì‹  ì†Œì‹ -->
            <div>
                <h3 class="font-extrabold text-2xl sm:text-3xl mb-3">ìµœì‹  ì†Œì‹</h3>
                <div id="slot_index_sub_news" class="neo-card min-h-[180px] sm:min-h-[220px] p-6 sm:p-7 slot-banner"
                    data-position="index_sub_news" data-label="ìµœì‹  ì†Œì‹ ë°•ìŠ¤" data-size="í…ìŠ¤íŠ¸ ì˜ì—­">
                    <img class="slot-img hidden" alt="ìµœì‹  ì†Œì‹">

                    <div class="h-full flex flex-col items-center justify-center gap-3">
                        <div
                            class="slot-text-body text-[18px] sm:text-[22px] font-semibold text-gray-800 leading-relaxed whitespace-pre-line">
                        </div>
                        <div class="slot-hint text-base sm:text-lg text-gray-500 font-medium">í…ìŠ¤íŠ¸ ì „ìš©</div>
                    </div>

                    <span class="slot-badge size text-sm sm:text-base">Text</span>
                    <span class="slot-badge store hidden"></span>
                </div>
            </div>

            <!-- 3) ì´ë²¤íŠ¸ ì •ë³´ -->
            <div>
                <h3 class="font-extrabold text-2xl sm:text-3xl mb-3">ì´ë²¤íŠ¸ ì •ë³´</h3>
                <div id="slot_index_sub_events" class="neo-card min-h-[180px] sm:min-h-[220px] p-6 sm:p-7 slot-banner"
                    data-position="index_sub_events" data-label="ì´ë²¤íŠ¸ ì •ë³´ ë°•ìŠ¤" data-size="í…ìŠ¤íŠ¸ ì˜ì—­">
                    <img class="slot-img hidden" alt="ì´ë²¤íŠ¸ ì •ë³´">

                    <div class="h-full flex flex-col items-center justify-center gap-3">
                        <div
                            class="slot-text-body text-[18px] sm:text-[22px] font-semibold text-gray-800 leading-relaxed whitespace-pre-line">
                        </div>
                        <div class="slot-hint text-base sm:text-lg text-gray-500 font-medium">í…ìŠ¤íŠ¸ ì „ìš©</div>
                    </div>

                    <span class="slot-badge size text-sm sm:text-base">Text</span>
                    <span class="slot-badge store hidden"></span>
                </div>
            </div>

            <!-- 4) ì¶”ì²œ ì œí’ˆ -->
            <div>
                <h3 class="font-extrabold text-2xl sm:text-3xl mb-3">ì¶”ì²œ ì œí’ˆ</h3>
                <div id="slot_index_sub_recommends"
                    class="neo-card min-h-[180px] sm:min-h-[220px] p-6 sm:p-7 slot-banner"
                    data-position="index_sub_recommends" data-label="ì¶”ì²œ ì œí’ˆ ë°•ìŠ¤" data-size="í…ìŠ¤íŠ¸ ì˜ì—­">
                    <img class="slot-img hidden" alt="ì¶”ì²œ ì œí’ˆ">

                    <div class="h-full flex flex-col items-center justify-center gap-3">
                        <div
                            class="slot-text-body text-[18px] sm:text-[22px] font-semibold text-gray-800 leading-relaxed whitespace-pre-line">
                        </div>
                        <div class="slot-hint text-base sm:text-lg text-gray-500 font-medium">í…ìŠ¤íŠ¸ ì „ìš©</div>
                    </div>

                    <span class="slot-badge size text-sm sm:text-base">Text</span>
                    <span class="slot-badge store hidden"></span>
                </div>
            </div>

        </div>
    </section>

    <!-- =========================
       â‘¦ Best Pick (ê´€ë¦¬ì ë²„ì „)
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-10">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl sm:text-3xl font-bold">Best Pick</h2>
            <span class="text-xs text-gray-500">ìµœëŒ€ 18ê°œ ìŠ¬ë¡¯</span>
        </div>

        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4">
            <div id="best_pick_grid"></div>
        </div>
    </section>

    <!-- =========================
   â‘§ ìš°ë¦¬ë™ë„¤ í•œë§ˆë””
========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-6">
        <div class="w-[73%] mx-auto">
            <div id="slot_index_oneword"
                class="neo-card h-28 sm:h-32 rounded-2xl flex flex-col items-center justify-center p-5 shadow-xl border-2 border-blue-400 slot-banner"
                data-position="index_oneword" data-label="ìš°ë¦¬ë™ë„¤ í•œë§ˆë””" data-size="í…ìŠ¤íŠ¸ ì˜ì—­">

                <img class="slot-img hidden" alt="ìš°ë¦¬ë™ë„¤ í•œë§ˆë””">

                <div class="h-full w-full flex flex-col items-center justify-center gap-2">
                    <div class="text-xl sm:text-2xl font-semibold text-blue-600">ğŸ“ ìš°ë¦¬ë™ë„¤ í•œë§ˆë””</div>

                    <div
                        class="slot-text-body text-xl sm:text-2xl md:text-3xl font-extrabold text-gray-800 text-center leading-tight whitespace-pre-line">
                    </div>
                    <div class="slot-hint text-sm sm:text-base text-gray-500 font-medium">í…ìŠ¤íŠ¸ ì „ìš©</div>
                </div>

                <span class="slot-badge size text-sm sm:text-base">Text</span>
                <span class="slot-badge store hidden"></span>
            </div>
        </div>
    </section>

    <!-- =========================
       â‘¨ ê¸°ëŠ¥ ì§„ì… ì¹´ë“œë“¤
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-10 grid grid-cols-1 lg:grid-cols-3 gap-6">

        <div class="grid grid-rows-2 gap-4">
            <div id="slot_index_food_delivery"
                class="slot-banner rounded-lg overflow-hidden min-h-28 sm:min-h-40 bg-gray-100"
                data-position="index_food_delivery" data-label="í™ë³´ì˜ ë°°ë‹¬" data-size="ììœ  / ê¶Œì¥ 16:9">
                <img class="slot-img hidden" alt="í™ë³´ì˜ ë°°ë‹¬">
                <div class="slot-default">í™ë³´ì˜ ë°°ë‹¬</div>
                <span class="slot-badge size">16:9</span>
                <span class="slot-badge store hidden"></span>
            </div>

            <div id="slot_index_all_stores"
                class="slot-banner rounded-lg overflow-hidden min-h-28 sm:min-h-40 bg-gray-100"
                data-position="index_all_stores" data-label="ìš°ë¦¬ë™ë„¤ ëª¨ë“ ê°€ê²Œ" data-size="ììœ  / ê¶Œì¥ 16:9">
                <img class="slot-img hidden" alt="ìš°ë¦¬ë™ë„¤ ëª¨ë“ ê°€ê²Œ">
                <div class="slot-default">ìš°ë¦¬ë™ë„¤ ëª¨ë“ ê°€ê²Œ</div>
                <span class="slot-badge size">16:9</span>
                <span class="slot-badge store hidden"></span>
            </div>
        </div>

        <div class="lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div id="slot_index_hot_place" class="slot-banner rounded-lg overflow-hidden bg-gray-100 aspect-[4/3]"
                data-position="index_hot_place" data-label="ê°€ì¥ HOTí•œ ìš°ë¦¬ë™ë„¤" data-size="ê¶Œì¥ 4:3">
                <img class="slot-img hidden" alt="ê°€ì¥ HOTí•œ ìš°ë¦¬ë™ë„¤">
                <div class="slot-default">ê°€ì¥ HOTí•œ ìš°ë¦¬ë™ë„¤</div>
                <span class="slot-badge size">4:3</span>
                <span class="slot-badge store hidden"></span>
            </div>

            <div id="slot_index_suggest" class="slot-banner rounded-lg overflow-hidden bg-gray-100 aspect-[4/3]"
                data-position="index_suggest" data-label="í™ë³´ì˜ ì¶”ì²œ" data-size="ê¶Œì¥ 4:3">
                <img class="slot-img hidden" alt="í™ë³´ì˜ ì¶”ì²œ">
                <div class="slot-default">í™ë³´ì˜ ì¶”ì²œ</div>
                <span class="slot-badge size">4:3</span>
                <span class="slot-badge store hidden"></span>
            </div>

            <div id="slot_index_open" class="slot-banner rounded-lg overflow-hidden bg-gray-100 aspect-[4/3]"
                data-position="index_open" data-label="ì˜¤í”ˆ ì˜ˆì •" data-size="ê¶Œì¥ 4:3">
                <img class="slot-img hidden" alt="ì˜¤í”ˆ ì˜ˆì •">
                <div class="slot-default">ì˜¤í”ˆ ì˜ˆì •</div>
                <span class="slot-badge size">4:3</span>
                <span class="slot-badge store hidden"></span>
            </div>

            <div id="slot_index_store_pride" class="slot-banner rounded-lg overflow-hidden bg-gray-100 aspect-[4/3]"
                data-position="index_store_pride" data-label="ê°€ê²Œìë‘" data-size="ê¶Œì¥ 4:3">
                <img class="slot-img hidden" alt="ê°€ê²Œìë‘">
                <div class="slot-default">ê°€ê²Œìë‘</div>
                <span class="slot-badge size">4:3</span>
                <span class="slot-badge store hidden"></span>
            </div>

            <div id="slot_index_traditional" class="slot-banner rounded-lg overflow-hidden bg-gray-100 aspect-[4/3]"
                data-position="index_traditional" data-label="ì „í†µì‹œì¥" data-size="ê¶Œì¥ 4:3">
                <img class="slot-img hidden" alt="ì „í†µì‹œì¥">
                <div class="slot-default">ì „í†µì‹œì¥</div>
                <span class="slot-badge size">4:3</span>
                <span class="slot-badge store hidden"></span>
            </div>

            <div id="slot_index_performing" class="slot-banner rounded-lg overflow-hidden bg-gray-100 aspect-[4/3]"
                data-position="index_performing" data-label="ê³µì—°/ì˜ˆìˆ , ì¶•ì œ" data-size="ê¶Œì¥ 4:3">
                <img class="slot-img hidden" alt="ê³µì—°/ì˜ˆìˆ , ì¶•ì œ">
                <div class="slot-default font-bold">ê³µì—°/ì˜ˆìˆ , ì¶•ì œ</div>
                <span class="slot-badge size">4:3</span>
                <span class="slot-badge store hidden"></span>
            </div>
        </div>
    </section>

    <!-- =========================
       â‘©â‘ª ì´ë²¤íŠ¸ / ì§€ì—­ ê²Œì‹œíŒ
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-10 grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div id="slot_index_event" class="slot-banner rounded-lg overflow-hidden bg-yellow-50 min-h-36 sm:min-h-52"
            data-position="index_event" data-label="ì´ë²¤íŠ¸" data-size="ê¶Œì¥ 16:9">
            <img class="slot-img hidden" alt="ì´ë²¤íŠ¸">
            <div class="slot-default">
                <span class="text-lg font-bold">ì´ë²¤íŠ¸</span>
            </div>
            <span class="slot-badge size">16:9</span>
            <span class="slot-badge store hidden"></span>
        </div>

        <div id="slot_index_localboard" class="slot-banner rounded-lg overflow-hidden bg-blue-50 min-h-36 sm:min-h-52"
            data-position="index_localboard" data-label="ì§€ì—­ ê²Œì‹œíŒ" data-size="ê¶Œì¥ 16:9">
            <img class="slot-img hidden" alt="ì§€ì—­ ê²Œì‹œíŒ">
            <div class="slot-default">
                <span class="text-lg font-bold">ì§€ì—­ ê²Œì‹œíŒ</span>
            </div>
            <span class="slot-badge size">16:9</span>
            <span class="slot-badge store hidden"></span>
        </div>
    </section>

    <!-- =========================
       â‘«â‘¬ ê³„ì ˆ í…Œë§ˆ / ì‹ ê·œ íšŒì› í˜œíƒ
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-10 grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div id="slot_index_season" class="slot-banner rounded-lg overflow-hidden bg-gray-100 min-h-36 sm:min-h-52"
            data-position="index_season" data-label="ê³„ì ˆí…Œë§ˆ" data-size="ê¶Œì¥ 16:9">
            <img class="slot-img hidden" alt="ê³„ì ˆí…Œë§ˆ">
            <div class="slot-default">
                <span class="text-lg font-bold">ê³„ì ˆí…Œë§ˆ</span>
            </div>
            <span class="slot-badge size">16:9</span>
            <span class="slot-badge store hidden"></span>
        </div>

        <div id="slot_index_join" class="slot-banner rounded-lg overflow-hidden bg-gray-100 min-h-36 sm:min-h-52"
            data-position="index_join" data-label="ì‹ ê·œ íšŒì› í˜œíƒ" data-size="ê¶Œì¥ 16:9">
            <img class="slot-img hidden" alt="ì‹ ê·œ íšŒì› í˜œíƒ">
            <div class="slot-default flex-col">
                <span class="text-lg font-bold">ì‹ ê·œ íšŒì› í˜œíƒ</span>
                <span class="text-xs text-gray-500 mt-1">í´ë¦­í•˜ì—¬ ì„¤ì •</span>
            </div>
            <span class="slot-badge size">16:9</span>
            <span class="slot-badge store hidden"></span>
        </div>
    </section>

    <!-- âœ… ì‡¼í•‘ëª°(ì¢Œ ë°°ë„ˆ + ìš° ì¹´ë“œ) -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-10">
        <div class="neo-card overflow-hidden flex flex-col md:flex-row">

            <div id="slot_index_d2c_banner" class="slot-banner relative flex-1 min-h-[140px] bg-gray-100"
                data-position="index_d2c_banner" data-label="ì‡¼í•‘ëª° ë°°ë„ˆ" data-size="ì¢Œ ë°°ë„ˆ(ê°€ë¡œí˜•)">
                <img class="slot-img hidden" alt="ì‡¼í•‘ëª° ë°°ë„ˆ">
                <div class="slot-default">
                    <span class="text-sm sm:text-base font-semibold text-gray-400">ì‡¼í•‘ëª° ì´ë¯¸ì§€</span>
                </div>
                <span class="slot-badge size">BANNER</span>
                <span class="slot-badge store hidden"></span>
            </div>

            <div id="slot_index_d2c_shop"
                class="slot-banner bg-white md:w-[300px] border-t md:border-t-0 md:border-l border-slate-100 p-6 flex flex-col justify-center gap-3 cursor-pointer"
                data-position="index_d2c_shop" data-label="ì‡¼í•‘ëª° ë²„íŠ¼" data-size="ìš° ë²„íŠ¼">
                <img class="slot-img hidden" alt="ì‡¼í•‘ëª° ë²„íŠ¼">
                <div class="slot-default">
                    <div class="flex items-center gap-2">
                        <div
                            class="w-9 h-9 rounded-xl bg-slate-100 flex items-center justify-center text-xs text-slate-400">
                            ğŸ›ï¸</div>
                        <div class="text-xl font-extrabold text-slate-900">ì‡¼í•‘ëª°</div>
                    </div>
                    <div class="text-sm text-slate-500">ì§€ì—­ ìƒí’ˆ/êµ¿ì¦ˆë¥¼ í•œ ë²ˆì—</div>

                    <div class="mt-1">
                        <span
                            class="inline-flex items-center gap-2 rounded-full bg-blue-600 px-4 py-2 text-white text-sm font-semibold shadow hover:bg-blue-700 select-none">
                            ì‡¼í•‘ëª° ë“¤ì–´ê°€ê¸° â†’
                        </span>
                    </div>

                    <div class="text-[11px] text-slate-400">â€» ì´ ì˜¤ë¥¸ìª½ ì¹´ë“œë„ í´ë¦­í•˜ë©´ ìŠ¬ë¡¯ ëª¨ë‹¬ì´ ì—´ë¦½ë‹ˆë‹¤.</div>
                </div>
                <span class="slot-badge size">BTN</span>
                <span class="slot-badge store hidden"></span>
            </div>

        </div>
    </section>

    <!-- =========================
       â‘® ê³ ê°ì§€ì› 3ì¹¸
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <div id="slot_index_support_review"
            class="slot-banner rounded-lg overflow-hidden bg-gray-100 min-h-28 sm:min-h-40"
            data-position="index_support_review" data-label="ë¦¬ë·°/í›„ê¸°" data-size="ê¶Œì¥ 16:9">
            <img class="slot-img hidden" alt="ë¦¬ë·°/í›„ê¸°">
            <div class="slot-default">
                <span class="text-lg font-bold">ë¦¬ë·°/í›„ê¸°</span>
            </div>
            <span class="slot-badge size">16:9</span>
            <span class="slot-badge store hidden"></span>
        </div>

        <div id="slot_index_support_empty"
            class="slot-banner rounded-lg overflow-hidden bg-gray-100 min-h-28 sm:min-h-40"
            data-position="index_support_empty" data-label="ê³ ê°ì§€ì› ì¤‘ì•™" data-size="ììœ ">
            <img class="slot-img hidden" alt="ì¤‘ì•™ ë°•ìŠ¤">
            <div class="slot-default">
                <span class="text-sm text-gray-500">ì¤‘ì•™ ì§€ì› ë°•ìŠ¤</span>
            </div>
            <span class="slot-badge size">FREE</span>
            <span class="slot-badge store hidden"></span>
        </div>

        <div id="slot_index_support_inquiry"
            class="slot-banner rounded-lg overflow-hidden bg-gray-100 min-h-28 sm:min-h-40"
            data-position="index_support_inquiry" data-label="ë¬¸ì˜ê²Œì‹œíŒ" data-size="ê¶Œì¥ 16:9">
            <img class="slot-img hidden" alt="ë¬¸ì˜ê²Œì‹œíŒ">
            <div class="slot-default flex-col">
                <span class="text-lg font-bold">ë¬¸ì˜ê²Œì‹œíŒ</span>
                <span class="text-xs text-gray-500 mt-1">í´ë¦­í•˜ì—¬ ì„¤ì •</span>
            </div>
            <span class="slot-badge size">16:9</span>
            <span class="slot-badge store hidden"></span>
        </div>
    </section>

    <!-- =========================
       íˆ´íŒ
  ========================== -->
    <div id="hoverTip"></div>

    <!-- =========================
       âœ… ê³µí†µ ëª¨ë‹¬ (êµ¬ì¡° ì •ìƒí™” ì™„ë£Œ)
  ========================== -->
    <div id="modalRoot" class="hidden" data-ad-modal="1" data-page="" data-position="">
        <div class="modal-backdrop"></div>

        <div class="modal-panel">
            <div class="modal-card">

                <!-- í—¤ë” -->
                <div class="p-6 sticky top-0 bg-white/90 backdrop-blur border-b border-slate-100 z-10">
                    <div class="flex items-start justify-between gap-4">
                        <div>
                            <h3 id="modalTitle" class="text-xl sm:text-2xl font-extrabold">ìŠ¬ë¡¯ ìˆ˜ì •</h3>
                            <p class="text-xs text-gray-500 mt-1">
                                page: <b>index</b> /
                                position: <span id="modalPositionText" class="font-semibold"></span>
                            </p>
                        </div>

                        <div class="flex items-center gap-2">
                            <!-- âœ… ì‚¬ìš©ë²• ë²„íŠ¼ -->
                            <div class="relative">
                                <button type="button" id="adHelpBtn"
                                    class="inline-flex items-center gap-2 rounded-xl border border-blue-200 bg-white/80 px-3 py-1.5 text-sm font-semibold text-blue-700 shadow-sm hover:bg-white"
                                    aria-expanded="false" aria-controls="adHelpPopover" title="ì‚¬ìš©ë²• ë³´ê¸°">
                                    <span
                                        class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-blue-600 text-white text-xs leading-none">?</span>
                                    ì‚¬ìš©ë²•
                                </button>

                                <div id="adHelpPopover"
                                    class="hidden absolute right-0 mt-2 w-[min(420px,calc(100vw-2rem))] rounded-2xl border border-blue-200 bg-white/95 p-4 shadow-xl backdrop-blur">
                                    <div class="flex items-start justify-between gap-3">
                                        <div class="font-extrabold text-slate-800">âœ… ì‚¬ìš© íë¦„</div>
                                        <button type="button" id="adHelpCloseBtn"
                                            class="rounded-lg px-2 py-1 text-xs font-bold text-slate-500 hover:bg-slate-100">ë‹«ê¸°</button>
                                    </div>

                                    <ol class="mt-3 space-y-2 text-sm text-slate-700 leading-relaxed list-decimal pl-5">
                                        <li><b>/admin/indexmanager.html</b> ì ‘ì†</li>
                                        <li>ì›í•˜ëŠ” ìŠ¬ë¡¯ í´ë¦­ â†’ <b>ëª¨ë‹¬ ì—´ë¦¼</b></li>
                                        <li>ëª¨ë‹¬ ìƒë‹¨ì—ì„œ <b>ìš°ì„ ìˆœìœ„ 1</b> ì„ íƒ â†’ ë‚´ìš©/ì´ë¯¸ì§€/ê¸°ê°„ ì…ë ¥ â†’ <b>ì €ì¥</b></li>
                                        <li>ë‹¤ì‹œ ê°™ì€ ìŠ¬ë¡¯ í´ë¦­ â†’ ëª¨ë‹¬ ì—´ê¸°</li>
                                        <li>ì´ë²ˆì—” <b>ìš°ì„ ìˆœìœ„ 2</b> ì„ íƒ â†’ ì…ë ¥ â†’ <b>ì €ì¥</b></li>
                                        <li><b>ìš°ì„ ìˆœìœ„ 3</b>ë„ ë™ì¼</li>
                                    </ol>

                                    <div class="mt-3 rounded-xl bg-blue-50 px-3 py-2 text-xs text-blue-900">
                                        â€» ì‹¤ì œ ë…¸ì¶œì€ â€œê¸°ê°„ ì¡°ê±´ì´ ë§ëŠ” í›„ë³´ë“¤ ì¤‘ ìš°ì„ ìˆœìœ„ ìˆ«ìê°€ ê°€ì¥ ì‘ì€ ê²ƒ(1)â€ì´ ì„ íƒë©ë‹ˆë‹¤.
                                    </div>

                                    <div class="mt-2 rounded-xl bg-slate-50 px-3 py-2 text-xs text-slate-600">
                                        â€» ì„œë²„ì— ìš°ì„ ìˆœìœ„(í›„ë³´) APIê°€ ì—†ìœ¼ë©´, ìš°ì„ ìˆœìœ„ ê¸°ëŠ¥ì€ ìë™ìœ¼ë¡œ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.
                                    </div>
                                </div>
                            </div>

                            <button id="btnCloseModal"
                                class="px-3 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm">
                                ë‹«ê¸°
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ë³¸ë¬¸ -->
                <div class="p-6 space-y-6">

                    <!-- âœ… í…ìŠ¤íŠ¸ ì „ìš© ì•ˆë‚´ -->
                    <div id="textOnlyHint" class="hidden rounded-2xl border border-slate-100 bg-slate-50 p-4">
                        <div class="text-sm font-bold text-slate-800">ğŸ“ ì´ ìŠ¬ë¡¯ì€ í…ìŠ¤íŠ¸ ì „ìš©ì…ë‹ˆë‹¤.</div>
                        <div class="mt-1 text-xs text-slate-500">
                            ì´ë¯¸ì§€/ê°€ê²Œì—°ê²°/ë§í¬ ì…ë ¥ì€ ìˆ¨ê¹€ ì²˜ë¦¬ë©ë‹ˆë‹¤. (ê¸€ë§Œ ì‘ì„±)
                        </div>
                    </div>

                    <!-- âœ… ëª¨ë“œ ì„ íƒ (í…ìŠ¤íŠ¸ ì „ìš©ì¼ ë•Œ ìˆ¨ê¹€) -->
                    <div id="modeBlock" class="rounded-xl border border-slate-100 bg-slate-50 p-4">
                        <p class="text-sm font-semibold mb-3">ê´‘ê³  ë°©ì‹ ì„ íƒ</p>
                        <div class="flex flex-wrap gap-4">
                            <label class="flex items-center gap-2 text-sm">
                                <input type="radio" name="slotMode" value="image" class="accent-blue-600" checked>
                                <span>ì´ë¯¸ì§€ ì…ë ¥</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm">
                                <input type="radio" name="slotMode" value="store" class="accent-emerald-600">
                                <span>ê°€ê²Œ ì—°ê²°</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm">
                                <input type="radio" name="slotMode" value="text" class="accent-indigo-600">
                                <span>í…ìŠ¤íŠ¸ ì…ë ¥</span>
                            </label>
                        </div>
                    </div>

                    <!-- âœ… í…ìŠ¤íŠ¸ ë¸”ë¡ -->
                    <div id="textBlock" class="hidden space-y-2">
                        <label class="text-sm font-semibold">ë‚´ìš© (í…ìŠ¤íŠ¸)</label>
                        <textarea id="fieldTextContent" class="field mt-2 min-h-[180px] resize-y"
                            placeholder="ì˜ˆ) í•œ ì¤„ë‹¹ 1ê°œì”© ì…ë ¥&#10;ì²«ë²ˆì§¸ ì¤„&#10;ë‘ë²ˆì§¸ ì¤„&#10;ì„¸ë²ˆì§¸ ì¤„"></textarea>
                        <p class="text-xs text-gray-500">
                            ì¤„ë°”ê¿ˆ(Enter) ê¸°ì¤€ìœ¼ë¡œ í‘œì‹œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                    </div>

                    <!-- âœ… ê³µí†µ ë§í¬ (í…ìŠ¤íŠ¸ ì „ìš©ì¼ ë•Œ ìˆ¨ê¹€) -->
                    <div id="linkBlock">
                        <label class="text-sm font-semibold">ë§í¬ URL (ì„ íƒ)</label>
                        <input id="fieldLinkUrl" class="field mt-2"
                            placeholder="/ndetail.html?id=123&type=store or https://..." />
                    </div>

                    <div id="dividerAfterLink" class="divider"></div>

                    <!-- ì´ë¯¸ì§€ ë¸”ë¡ -->
                    <div id="imageBlock" class="space-y-4">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm font-semibold">ì´ë¯¸ì§€ íŒŒì¼</label>
                                <input id="fieldImageFile" type="file" accept="image/*" class="field mt-2 bg-white" />
                                <p class="text-xs text-gray-500 mt-1">
                                    ìŠ¬ë¡¯ ë¹„ìœ¨ì— ë§ê²Œ ìë™ í¬ë¡­ë©ë‹ˆë‹¤.
                                </p>
                            </div>
                            <div>
                                <label class="text-sm font-semibold">í˜„ì¬ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°</label>
                                <div
                                    class="mt-2 rounded-lg border border-gray-100 bg-gray-50 overflow-hidden aspect-[16/9] flex items-center justify-center">
                                    <img id="currentPreviewImg" src="" alt="preview"
                                        class="w-full h-full object-cover hidden" />
                                    <span id="currentPreviewEmpty" class="text-xs text-gray-400">ì´ë¯¸ì§€ ì—†ìŒ</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ê°€ê²Œ ì—°ê²° ë¸”ë¡ -->
                    <div id="storeBlock" class="space-y-4 hidden">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm font-semibold">ì‚¬ì—…ìë²ˆí˜¸</label>
                                <input id="fieldBizNo" class="field mt-2" placeholder="ì˜ˆ) 2910802895" />
                            </div>
                            <div>
                                <label class="text-sm font-semibold">ìƒí˜¸ëª…</label>
                                <input id="fieldBizName" class="field mt-2" placeholder="ì˜ˆ) ë¯¸ë¡€í—¤ì–´" />
                            </div>
                        </div>

                        <div class="flex items-center gap-2">
                            <button id="btnSearchStore"
                                class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm">
                                ê°€ê²Œ ê²€ìƒ‰
                            </button>
                            <span id="storeSearchHint" class="text-xs text-gray-500"></span>
                        </div>

                        <div id="storeResults" class="border border-slate-100 rounded-xl overflow-hidden">
                            <div class="px-4 py-3 bg-slate-50 text-sm font-semibold">
                                ê²€ìƒ‰ ê²°ê³¼
                            </div>
                            <div id="storeResultsBody" class="p-4 text-sm text-gray-500">
                                ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ê³  â€œê°€ê²Œ ê²€ìƒ‰â€ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                            </div>
                        </div>

                        <input id="fieldStoreId" type="hidden" />
                        <input id="fieldStoreType" type="hidden" name="storeType" value="" />
                    </div>

                    <div class="divider"></div>

                    <!-- âœ… ìš°ì„ ìˆœìœ„ -->
                    <div class="mt-4 p-3 rounded-xl border border-blue-100 bg-white/70">
                        <div class="flex flex-col md:flex-row md:items-end gap-3">
                            <div class="flex-1">
                                <label class="text-sm font-semibold text-gray-700">ìš°ì„ ìˆœìœ„</label>
                                <input name="priority" id="adPriority" type="number" min="1" step="1" value="1"
                                    class="mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 outline-none focus:ring-2 focus:ring-blue-300" />
                                <p class="mt-1 text-xs text-gray-500">1ì´ ê°€ì¥ ë¨¼ì € ë…¸ì¶œë©ë‹ˆë‹¤. (1,2,3â€¦ ì—¬ëŸ¬ ê°œ ë“±ë¡ ê°€ëŠ¥)</p>
                            </div>

                            <button type="button" id="btnLoadPriority"
                                class="rounded-xl px-4 py-2 border border-blue-200 bg-blue-50 hover:bg-blue-100">
                                ì´ ìš°ì„ ìˆœìœ„ ë¶ˆëŸ¬ì˜¤ê¸°
                            </button>

                            <button type="button" id="btnDeletePriority"
                                class="rounded-xl px-4 py-2 border border-red-200 bg-red-50 hover:bg-red-100">
                                ì´ ìš°ì„ ìˆœìœ„ ì‚­ì œ
                            </button>
                        </div>

                        <details class="mt-3">
                            <summary class="cursor-pointer text-sm text-gray-700">í›„ë³´ ëª©ë¡ ë³´ê¸°</summary>
                            <div id="candidateList" class="mt-2 grid gap-2"></div>
                        </details>

                        <div id="prioritySupportHint" class="mt-3 text-xs text-slate-500"></div>
                    </div>

                    <!-- ê¸°ê°„ -->
                    <div class="rounded-xl border border-slate-100 p-4">
                        <div class="flex items-center justify-between">
                            <p class="text-sm font-semibold">ê´‘ê³  ê¸°ê°„ ì„¤ì •</p>
                            <label class="flex items-center gap-2 text-xs">
                                <input id="fieldNoEnd" type="checkbox" class="accent-blue-600">
                                <span class="text-gray-700">ê³„ì† ìœ ì§€ (ì¢…ë£Œ ì—†ìŒ)</span>
                            </label>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                            <div>
                                <label class="text-xs font-semibold text-gray-600">ì‹œì‘ ì¼ì‹œ</label>
                                <input id="fieldStartAt" type="datetime-local" class="field mt-2" />
                            </div>
                            <div>
                                <label class="text-xs font-semibold text-gray-600">ì¢…ë£Œ ì¼ì‹œ</label>
                                <input id="fieldEndAt" type="datetime-local" class="field mt-2" />
                            </div>
                        </div>
                    </div>

                    <!-- ìš”ì•½ í‘œì‹œ -->
                    <div class="rounded-xl border border-slate-100 bg-slate-50 p-4">
                        <p class="text-sm font-semibold mb-2">í˜„ì¬ ì„ íƒ ì •ë³´</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
                            <div class="flex items-center gap-2">
                                <span class="text-gray-500">ì„ íƒ ì´ë¯¸ì§€:</span>
                                <span id="textSelectedImage" class="font-semibold text-slate-800">ì—†ìŒ</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-gray-500">ì—°ê²° ê°€ê²Œ:</span>
                                <span id="textSelectedStore" class="font-semibold text-slate-800">ì—†ìŒ</span>
                            </div>
                        </div>

                        <div class="mt-2 text-xs text-slate-500">
                            í…ìŠ¤íŠ¸ ì „ìš© ìŠ¬ë¡¯ì€ â€œì„ íƒ ì´ë¯¸ì§€/ì—°ê²° ê°€ê²Œâ€ê°€ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        </div>
                    </div>

                    <!-- ì €ì¥ ë²„íŠ¼ -->
                    <div class="flex flex-col sm:flex-row gap-2 sm:justify-end">
                        <button id="btnResetModal"
                            class="px-4 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm">
                            ì…ë ¥ ì´ˆê¸°í™”
                        </button>
                        <button id="btnSaveSlot"
                            class="px-5 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold">
                            ìŠ¬ë¡¯ ì €ì¥
                        </button>
                    </div>

                </div><!-- /p-6 -->
            </div><!-- /modal-card -->
        </div><!-- /modal-panel -->
    </div><!-- /modalRoot -->

    <script>
        (() => {
            /* ============================================================
               âœ… ê¸°ë³¸ ìƒìˆ˜
            ============================================================ */
            const PAGE = "index";
            const BEST_PICK_MAX = 18;

            /* ============================================================
               âœ… ìœ í‹¸
            ============================================================ */
            function qs(sel, root = document) { return root.querySelector(sel); }
            function qsa(sel, root = document) { return Array.from(root.querySelectorAll(sel)); }

            function escapeHtml(str) {
                return String(str ?? "").replace(/[&<>"']/g, (m) => ({
                    "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;"
                }[m]));
            }

            function toAbs(u) {
                if (!u) return "";
                if (/^https?:\/\//i.test(u)) return u;
                return u.startsWith("/") ? u : ("/" + u);
            }

            function withBust(u) {
                if (!u) return "";
                const sep = u.includes("?") ? "&" : "?";
                return `${u}${sep}v=${Date.now()}`;
            }

            function safeSetImage(imgEl, rawUrl, defEl) {
                if (!imgEl) return;

                const url = rawUrl ? withBust(toAbs(rawUrl)) : "";

                const show = () => {
                    imgEl.classList.remove("hidden");
                    if (defEl) defEl.classList.add("hidden");
                };

                const hide = () => {
                    imgEl.classList.add("hidden");
                    imgEl.removeAttribute("src");
                    if (defEl) defEl.classList.remove("hidden");
                };

                imgEl.onload = null;
                imgEl.onerror = null;
                imgEl.classList.add("hidden");
                imgEl.removeAttribute("src");
                if (defEl) defEl.classList.remove("hidden");

                if (!url) return;

                imgEl.onload = () => show();
                imgEl.onerror = () => hide();
                imgEl.src = url;

                if (imgEl.complete) {
                    if (imgEl.naturalWidth > 0) show();
                    else hide();
                }
            }

            function pickOk(json) { return !!(json?.ok || json?.success); }
            function pickSlot(json) { return json?.slot || json?.data || json?.ad || null; }

            function normalizeDateTimeForInput(value) {
                if (!value) return "";
                try {
                    if (typeof value === "string" && value.includes("T") && value.length >= 16) {
                        return value.slice(0, 16);
                    }
                    const d = new Date(value);
                    if (isNaN(d.getTime())) return "";
                    const off = d.getTimezoneOffset();
                    const local = new Date(d.getTime() - off * 60000);
                    return local.toISOString().slice(0, 16);
                } catch {
                    return "";
                }
            }

            async function fetchJson(url, opts = {}) {
                const res = await fetch(url, { cache: "no-store", ...opts });
                const json = await res.json().catch(() => ({}));
                return { res, json };
            }

            /* ============================================================
               âœ… Best Pick ìŠ¬ë¡¯ ìƒì„±
            ============================================================ */
            function buildBestPickGrid() {
                const host = document.getElementById("best_pick_grid");
                if (!host) return;

                const frag = document.createDocumentFragment();

                for (let i = 1; i <= BEST_PICK_MAX; i++) {
                    const wrap = document.createElement("div");
                    wrap.innerHTML = `
          <div id="slot_best_pick_${i}"
            class="neo-card slot-banner best-circle aspect-square w-full flex items-center justify-center"
            data-position="best_pick_${i}"
            data-label="Best Pick ${i}"
            data-size="ê¶Œì¥ 1:1">
            <img class="slot-img hidden" alt="Best Pick ${i}">
            <div class="slot-default flex-col">
              <span class="font-bold text-sm">Best Pick ${i}</span>
              <span class="text-[10px] text-gray-500 mt-1">í´ë¦­í•˜ì—¬ ì„¤ì •</span>
            </div>
            <span class="slot-badge size">1:1</span>
            <span class="slot-badge store hidden"></span>
          </div>
        `.trim();
                    frag.appendChild(wrap.firstElementChild);
                }

                const nodes = Array.from(frag.childNodes);
                host.replaceWith(...nodes);
            }

            /* ============================================================
               âœ… ìŠ¬ë¡¯ ëª©ë¡ ìˆ˜ì§‘
            ============================================================ */
            function getAllSlotElements() {
                const baseIds = [
                    "slot_index_main_top",
                    "slot_index_main_visual",
                    "slot_index_promo_1",
                    "slot_index_promo_2",
                    "slot_index_promo_3",

                    "slot_index_sub_keywords",
                    "slot_index_sub_news",
                    "slot_index_sub_events",
                    "slot_index_sub_recommends",

                    "slot_index_oneword",

                    "slot_index_food_delivery",
                    "slot_index_all_stores",
                    "slot_index_hot_place",
                    "slot_index_suggest",
                    "slot_index_open",
                    "slot_index_store_pride",
                    "slot_index_traditional",
                    "slot_index_performing",
                    "slot_index_event",
                    "slot_index_localboard",
                    "slot_index_season",
                    "slot_index_join",

                    "slot_index_d2c_banner",
                    "slot_index_d2c_shop",

                    "slot_index_support_review",
                    "slot_index_support_empty",
                    "slot_index_support_inquiry",
                ];

                const bestIds = [];
                for (let i = 1; i <= BEST_PICK_MAX; i++) bestIds.push(`slot_best_pick_${i}`);

                return [...baseIds, ...bestIds]
                    .map(id => document.getElementById(id))
                    .filter(Boolean);
            }

            /* ============================================================
               âœ… ì„œë²„ í†µì‹ 
            ============================================================ */
            async function fetchSlot(position, priority = null) {
                let url = `/manager/ad/slot?page=${encodeURIComponent(PAGE)}&position=${encodeURIComponent(position)}`;
                if (priority !== null && priority !== undefined && priority !== "") {
                    url += `&priority=${encodeURIComponent(priority)}`;
                }
                const { res, json } = await fetchJson(url);
                if (!res.ok || !pickOk(json)) return null;
                return pickSlot(json);
            }

            async function fetchCandidates(position) {
                const url = `/manager/ad/slot-items?page=${encodeURIComponent(PAGE)}&position=${encodeURIComponent(position)}`;
                const { res, json } = await fetchJson(url);
                if (!res.ok || !json?.success || !Array.isArray(json.items)) {
                    return { ok: false, items: [], status: res.status };
                }
                return { ok: true, items: json.items, status: res.status };
            }

            function renderTextPreview(defEl, rawText) {
                if (!defEl) return;
                const text = (rawText ?? "").toString().trim();
                const lines = text ? text.split(/\r?\n/).map(s => s.trim()).filter(Boolean) : [];
                const previewLines = lines.slice(0, 6);
                const more = lines.length > 6 ? `\nâ€¦ (+${lines.length - 6}ì¤„)` : "";
                const finalText = (previewLines.join("\n") + more) || "ë‚´ìš© ì—†ìŒ";

                defEl.innerHTML = `
        <div class="w-full p-3 text-left">
          <div class="text-[11px] font-extrabold text-slate-600 mb-1">í…ìŠ¤íŠ¸</div>
          <div class="text-[12px] leading-relaxed text-slate-900 whitespace-pre-line">
            ${escapeHtml(finalText)}
          </div>
        </div>
      `;
            }

            function renderTextBox(slotEl, text) {
                const body = slotEl.querySelector(".slot-text-body");
                const hint = slotEl.querySelector(".slot-hint");
                const t = (text || "").trim();

                if (body) body.textContent = t;
                if (hint) hint.classList.toggle("hidden", !!t);
            }

            /* ============================================================
               âœ… ë°•ìŠ¤ì— ì ìš© (ëª¨ë“œë³„ ë¯¸ë¦¬ë³´ê¸°)
               - ì´ì œ "í…ìŠ¤íŠ¸ ì „ìš© ìŠ¬ë¡¯" ê°œë… ì—†ìŒ
               - slot_type === "text" ì¸ ê²½ìš°ë§Œ í…ìŠ¤íŠ¸ ë Œë”
            ============================================================ */
            function applySlotToBox(box, slot) {
                const img = qs(".slot-img", box);
                const def = qs(".slot-default", box);
                const storeBadge = qs(".slot-badge.store", box);

                const slotType = slot?.slot_type || slot?.slotType || "";
                const textContent = slot?.text_content || slot?.textContent || "";

                const isTextSlot = (slotType === "text");

                // í…ìŠ¤íŠ¸ ìŠ¬ë¡¯ì´ë©´ í…ìŠ¤íŠ¸ë§Œ ë Œë”(ì´ë¯¸ì§€/ê°€ê²Œ ë±ƒì§€ ìˆ¨ê¹€)
                if (isTextSlot) {
                    if (img) {
                        img.classList.add("hidden");
                        img.removeAttribute("src");
                    }
                    if (def) {
                        def.classList.remove("hidden");
                        renderTextPreview(def, textContent);
                    }
                    if (storeBadge) {
                        storeBadge.classList.add("hidden");
                        storeBadge.textContent = "";
                    }
                    renderTextBox(box, textContent);
                    return;
                }

                // ì¼ë°˜(ì´ë¯¸ì§€/ê°€ê²Œ) ìŠ¬ë¡¯
                const imageUrl =
                    slot?.image_url ||
                    slot?.image ||
                    slot?.img_url ||
                    slot?.banner_url ||
                    slot?.image_path ||
                    "";

                const mode = slot?.slot_mode || slot?.slotMode || ""; // "image" | "store" | "custom"
                const businessName = slot?.business_name || slot?.businessName || "";
                const businessNo = slot?.business_no || slot?.businessNo || "";

                safeSetImage(img, imageUrl, def);

                if (storeBadge) {
                    if (mode === "store" && (businessName || businessNo)) {
                        storeBadge.textContent = businessName ? businessName : businessNo;
                        storeBadge.classList.remove("hidden");
                    } else {
                        storeBadge.classList.add("hidden");
                        storeBadge.textContent = "";
                    }
                }

                // í…ìŠ¤íŠ¸ ë°•ìŠ¤(ìˆëŠ” ìŠ¬ë¡¯ë§Œ) ë¹„ì›Œë‘ê¸°
                renderTextBox(box, "");
            }

            async function loadAllSlotsPreview() {
                const boxes = getAllSlotElements();
                await Promise.all(boxes.map(async (box) => {
                    const position = box.dataset.position;
                    if (!position) return;
                    try {
                        const slotP1 = await fetchSlot(position, 1);
                        const slot = slotP1 || await fetchSlot(position);
                        if (slot) applySlotToBox(box, slot);
                    } catch (e) {
                        console.warn("slot preview fail:", position, e);
                    }
                }));
            }

            /* ============================================================
               âœ… ì»¤ì„œ íˆ´íŒ
            ============================================================ */
            const hoverTip = document.getElementById("hoverTip");
            function bindHoverTooltip(box) {
                const label = box.dataset.label || box.dataset.position || "ìŠ¬ë¡¯";
                box.addEventListener("mouseenter", () => {
                    if (!hoverTip) return;
                    hoverTip.textContent = label;
                    hoverTip.classList.add("show");
                });
                box.addEventListener("mousemove", (e) => {
                    if (!hoverTip) return;
                    hoverTip.style.left = e.clientX + "px";
                    hoverTip.style.top = e.clientY + "px";
                });
                box.addEventListener("mouseleave", () => {
                    if (!hoverTip) return;
                    hoverTip.classList.remove("show");
                });
            }

            /* ============================================================
               âœ… ëª¨ë‹¬ ì—˜ë¦¬ë¨¼íŠ¸
            ============================================================ */
            const modalRoot = qs("#modalRoot");
            const modalTitle = qs("#modalTitle");
            const modalPositionText = qs("#modalPositionText");
            const btnCloseModal = qs("#btnCloseModal");
            const btnSaveSlot = qs("#btnSaveSlot");
            const btnResetModal = qs("#btnResetModal");

            const textOnlyHint = qs("#textOnlyHint");

            const modeBlock = qs("#modeBlock");
            const imageBlock = qs("#imageBlock");
            const storeBlock = qs("#storeBlock");

            const textBlock = qs("#textBlock");
            const fieldTextContent = qs("#fieldTextContent");

            const linkBlock = qs("#linkBlock");
            const dividerAfterLink = qs("#dividerAfterLink");

            const fieldLinkUrl = qs("#fieldLinkUrl");
            const fieldImageFile = qs("#fieldImageFile");
            const currentPreviewImg = qs("#currentPreviewImg");
            const currentPreviewEmpty = qs("#currentPreviewEmpty");

            const fieldBizNo = qs("#fieldBizNo");
            const fieldBizName = qs("#fieldBizName");
            const fieldStoreId = qs("#fieldStoreId");
            const btnSearchStore = qs("#btnSearchStore");
            const storeResultsBody = qs("#storeResultsBody");
            const storeSearchHint = qs("#storeSearchHint");

            const fieldNoEnd = qs("#fieldNoEnd");
            const fieldStartAt = qs("#fieldStartAt");
            const fieldEndAt = qs("#fieldEndAt");

            const textSelectedImage = qs("#textSelectedImage");
            const textSelectedStore = qs("#textSelectedStore");

            const adPriority = qs("#adPriority");
            const btnLoadPriority = qs("#btnLoadPriority");
            const btnDeletePriority = qs("#btnDeletePriority");
            const candidateList = qs("#candidateList");

            const radioModes = () => qsa('input[name="slotMode"]');

            let activeBox = null;
            let activePosition = "";
            let activeLabel = "";
            let lastLoadedSlot = null;

            let __localPreviewUrl = null;

            function openModal() {
                modalRoot.classList.remove("hidden");
            }

            function closeModal() {
                modalRoot.classList.add("hidden");
                activeBox = null;
                activePosition = "";
                activeLabel = "";
                lastLoadedSlot = null;
                window.__closeAdHelp?.();
            }

            function setModeUI(mode) {
                if (mode === "store") {
                    storeBlock?.classList.remove("hidden");
                    imageBlock?.classList.add("hidden");
                    textBlock?.classList.add("hidden");
                } else if (mode === "text") {
                    textBlock?.classList.remove("hidden");
                    imageBlock?.classList.add("hidden");
                    storeBlock?.classList.add("hidden");
                } else {
                    imageBlock?.classList.remove("hidden");
                    storeBlock?.classList.add("hidden");
                    textBlock?.classList.add("hidden");
                }
            }

            function getSelectedMode() {
                const r = radioModes().find(x => x.checked);
                return r ? r.value : "image";
            }

            function setSelectedMode(mode) {
                radioModes().forEach(r => r.checked = (r.value === mode));
                setModeUI(mode);
            }

            // âœ… ì´ì œ ì „ë¶€ 3ëª¨ë“œ ì„ íƒ ê°€ëŠ¥ (í…ìŠ¤íŠ¸ ì „ìš© ì—†ìŒ)
            function setModalTypeForPosition(_position) {
                textOnlyHint?.classList.add("hidden");

                modeBlock?.classList.remove("hidden");
                linkBlock?.classList.remove("hidden");
                dividerAfterLink?.classList.remove("hidden");

                setModeUI(getSelectedMode());
                return false;
            }

            function applyNoEndState() {
                const checked = fieldNoEnd.checked;
                fieldEndAt.disabled = checked;
                if (checked) fieldEndAt.value = "";
            }

            function updateSelectedSummary() {
                const mode = getSelectedMode();

                if (mode === "text") {
                    textSelectedImage.textContent = "í…ìŠ¤íŠ¸";
                    textSelectedStore.textContent = "ì‚¬ìš© ì•ˆí•¨";
                    return;
                }

                const file = fieldImageFile?.files?.[0];
                textSelectedImage.textContent = file ? file.name : (lastLoadedSlot?.image_url ? "ê¸°ì¡´ ì´ë¯¸ì§€ ì‚¬ìš©" : "ì—†ìŒ");

                const bn = fieldBizName.value?.trim();
                const bno = fieldBizNo.value?.trim();
                if (bn) textSelectedStore.textContent = bn;
                else if (bno) textSelectedStore.textContent = bno;
                else textSelectedStore.textContent = lastLoadedSlot?.business_name || "ì—†ìŒ";
            }

            function showLocalPreview(file) {
                if (__localPreviewUrl) {
                    URL.revokeObjectURL(__localPreviewUrl);
                    __localPreviewUrl = null;
                }
                if (!file || !currentPreviewImg) return;

                __localPreviewUrl = URL.createObjectURL(file);
                currentPreviewImg.src = __localPreviewUrl;
                currentPreviewImg.classList.remove("hidden");
                currentPreviewEmpty?.classList.add("hidden");
            }

            function resetModalFields(keepMode = true) {
                if (!keepMode) setSelectedMode("image");

                if (fieldLinkUrl) fieldLinkUrl.value = "";

                if (__localPreviewUrl) {
                    URL.revokeObjectURL(__localPreviewUrl);
                    __localPreviewUrl = null;
                }

                if (fieldImageFile) fieldImageFile.value = "";
                if (currentPreviewImg) {
                    currentPreviewImg.classList.add("hidden");
                    currentPreviewImg.removeAttribute("src");
                }
                if (currentPreviewEmpty) currentPreviewEmpty.classList.remove("hidden");

                if (fieldBizNo) fieldBizNo.value = "";
                if (fieldBizName) fieldBizName.value = "";
                if (fieldStoreId) fieldStoreId.value = "";
                if (storeResultsBody) storeResultsBody.innerHTML = `<div class="text-sm text-gray-500">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ê³  â€œê°€ê²Œ ê²€ìƒ‰â€ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>`;
                if (storeSearchHint) storeSearchHint.textContent = "";

                if (fieldStartAt) fieldStartAt.value = "";
                if (fieldEndAt) fieldEndAt.value = "";
                if (fieldNoEnd) fieldNoEnd.checked = false;
                if (fieldEndAt) fieldEndAt.disabled = false;

                if (fieldTextContent) fieldTextContent.value = "";

                if (textSelectedImage) textSelectedImage.textContent = "ì—†ìŒ";
                if (textSelectedStore) textSelectedStore.textContent = "ì—†ìŒ";
            }

            function fillModalFromSlot(slot) {
                lastLoadedSlot = slot || null;

                if (adPriority) adPriority.value = String(slot?.priority ?? adPriority.value ?? 1);

                const slotType = slot?.slot_type || slot?.slotType || "";
                const modeFromServer = slot?.slot_mode || slot?.slotMode || "image";

                // í…ìŠ¤íŠ¸ëŠ” í•­ìƒ ì±„ì›Œë‘ (ëª¨ë“œ ì „í™˜ì‹œ ë°”ë¡œ ë³´ì´ê²Œ)
                if (fieldTextContent) {
                    fieldTextContent.value = (slot?.text_content ?? slot?.textContent ?? slot?.content ?? "") || "";
                }

                if (slotType === "text") setSelectedMode("text");
                else setSelectedMode(modeFromServer === "store" ? "store" : "image");

                const link = slot?.link_url || slot?.linkUrl || slot?.link || slot?.href || "";
                if (fieldLinkUrl) fieldLinkUrl.value = link || "";

                const businessName = slot?.business_name || slot?.businessName || "";
                const businessNo = slot?.business_no || slot?.businessNo || "";
                const storeId = slot?.store_id || slot?.storeId || "";

                if (fieldBizName) fieldBizName.value = businessName || "";
                if (fieldBizNo) fieldBizNo.value = businessNo || "";
                if (fieldStoreId) fieldStoreId.value = storeId ? String(storeId) : "";

                const start = slot?.start_at || slot?.startAt || slot?.start_date || slot?.startDate || "";
                const end = slot?.end_at || slot?.endAt || slot?.end_date || slot?.endDate || "";

                if (fieldStartAt) fieldStartAt.value = normalizeDateTimeForInput(start);
                if (fieldEndAt) fieldEndAt.value = normalizeDateTimeForInput(end);

                const noEnd = !!slot?.no_end || (!fieldEndAt?.value);
                if (fieldNoEnd) fieldNoEnd.checked = noEnd;
                applyNoEndState();

                const imageUrl =
                    slot?.image_url ||
                    slot?.image ||
                    slot?.img_url ||
                    slot?.banner_url ||
                    slot?.image_path ||
                    "";

                if (imageUrl && currentPreviewImg) {
                    safeSetImage(currentPreviewImg, imageUrl, currentPreviewEmpty);
                } else {
                    currentPreviewImg?.classList.add("hidden");
                    currentPreviewImg?.removeAttribute("src");
                    currentPreviewEmpty?.classList.remove("hidden");
                }

                setModalTypeForPosition(activePosition);
                updateSelectedSummary();
            }

            async function refreshCandidates() {
                if (!candidateList) return;
                candidateList.innerHTML = `<div class="text-sm text-gray-500">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>`;

                const { ok, items, status } = await fetchCandidates(activePosition);

                if (!ok) {
                    if (status === 404) {
                        candidateList.innerHTML = `<div class="text-sm text-gray-500">í›„ë³´ ëª©ë¡ API(/manager/ad/slot-items)ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</div>`;
                    } else {
                        candidateList.innerHTML = `<div class="text-sm text-gray-500">í›„ë³´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>`;
                    }
                    return;
                }

                if (items.length === 0) {
                    candidateList.innerHTML = `<div class="text-sm text-gray-500">ë“±ë¡ëœ í›„ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                    return;
                }

                candidateList.innerHTML = "";
                for (const it of items) {
                    const pr = it.priority ?? "-";
                    const isText = (it.slot_type === "text");

                    const imgHtml = it.image_url
                        ? `<img src="${escapeHtml(toAbs(it.image_url))}" class="w-12 h-12 rounded-lg object-cover border" />`
                        : `<div class="w-12 h-12 rounded-lg bg-gray-100 border"></div>`;

                    const txt = (it.text_content || "").trim();
                    const txtPreview = txt ? txt.split(/\r?\n/).slice(0, 2).join(" / ") : "";

                    const mainLine = isText
                        ? (txtPreview || "(í…ìŠ¤íŠ¸ ì—†ìŒ)")
                        : (it.business_name || it.link_url || "(ë‚´ìš© ì—†ìŒ)");

                    const periodLine = (it.start_at_local || it.end_at_local || it.no_end)
                        ? `ê¸°ê°„: ${it.start_at_local || "-"} ~ ${it.no_end ? "ë¬´ê¸°í•œ" : (it.end_at_local || "-")}`
                        : "ê¸°ê°„ ë¯¸ì„¤ì •";

                    const row = document.createElement("button");
                    row.type = "button";
                    row.className = "w-full text-left p-3 rounded-xl border border-gray-200 bg-white hover:bg-gray-50 flex gap-3 items-center";
                    row.innerHTML = `
          ${isText ? `<div class="w-12 h-12 rounded-lg bg-blue-50 border border-blue-100 flex items-center justify-center text-xs font-bold text-blue-700">TXT</div>` : imgHtml}
          <div class="flex-1">
            <div class="text-sm font-semibold text-gray-800">ìš°ì„ ìˆœìœ„ ${pr}</div>
            <div class="text-xs text-gray-600">${escapeHtml(mainLine)}</div>
            <div class="text-xs text-gray-500 mt-1">${escapeHtml(periodLine)}</div>
          </div>
        `;
                    row.addEventListener("click", async () => {
                        const p = it.priority ?? 1;
                        if (adPriority) adPriority.value = String(p);
                        const slot = await fetchSlot(activePosition, p);
                        if (slot) fillModalFromSlot(slot);
                    });

                    candidateList.appendChild(row);
                }
            }

            async function searchStores() {
                const bizNo = (fieldBizNo?.value || "").trim();
                const name = (fieldBizName?.value || "").trim();

                if (!bizNo && !name) {
                    if (storeSearchHint) {
                        storeSearchHint.textContent = "ì‚¬ì—…ìë²ˆí˜¸ ë˜ëŠ” ìƒí˜¸ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                        storeSearchHint.className = "text-xs text-red-500";
                    }
                    return;
                }

                if (storeSearchHint) {
                    storeSearchHint.textContent = "ê²€ìƒ‰ ì¤‘...";
                    storeSearchHint.className = "text-xs text-gray-500";
                }

                const params = new URLSearchParams();
                if (bizNo) params.set("bizNo", bizNo);
                if (name) { params.set("name", name); params.set("businessName", name); }

                try {
                    const { res, json } = await fetchJson(`/manager/ad/store/search?${params.toString()}`);
                    const stores = json?.stores || json?.data || json?.results || [];

                    if (!res.ok || !Array.isArray(stores) || stores.length === 0) {
                        if (storeResultsBody) storeResultsBody.innerHTML = `<div class="text-sm text-gray-500">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                        if (storeSearchHint) {
                            storeSearchHint.textContent = "ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ";
                            storeSearchHint.className = "text-xs text-gray-500";
                        }
                        return;
                    }

                    if (storeSearchHint) {
                        storeSearchHint.textContent = `${stores.length}ê±´ ê²€ìƒ‰ë¨`;
                        storeSearchHint.className = "text-xs text-emerald-600";
                    }

                    if (storeResultsBody) {
                        storeResultsBody.innerHTML = `
            <div class="space-y-2">
              ${stores.map((s, idx) => {
                            const id = s.id ?? s.store_id ?? "";
                            const bn = s.business_name ?? s.name ?? s.store_name ?? "";
                            const bno = s.business_no ?? s.biz_no ?? s.bizNo ?? "";
                            const cat = s.business_category ?? s.category ?? s.store_category ?? "";
                            return `
                  <button class="w-full text-left px-3 py-3 rounded-lg border border-slate-100 hover:border-emerald-200 hover:bg-emerald-50 transition"
                    data-store-idx="${idx}">
                    <div class="flex items-center justify-between gap-2">
                      <div class="font-semibold text-slate-800">${escapeHtml(bn || "(ìƒí˜¸ëª… ì—†ìŒ)")}</div>
                      <div class="text-[10px] text-slate-500">ID: ${escapeHtml(id || "-")}</div>
                    </div>
                    <div class="mt-1 text-xs text-slate-500">
                      <span class="mr-2">ì‚¬ì—…ìë²ˆí˜¸: <b>${escapeHtml(bno || "-")}</b></span>
                      <span>ì—…ì¢…: ${escapeHtml(cat || "-")}</span>
                    </div>
                  </button>
                `;
                        }).join("")}
            </div>
          `;

                        qsa("button[data-store-idx]", storeResultsBody).forEach(btn => {
                            btn.addEventListener("click", () => {
                                const idx = Number(btn.dataset.storeIdx);
                                const s = stores[idx];
                                if (!s) return;

                                const id = s.id ?? s.store_id ?? "";
                                const st = s.store_type ?? s.detail_type ?? s.type ?? s.storeType ?? "";
                                const bn = s.business_name ?? s.name ?? s.store_name ?? "";
                                const bno = s.business_no ?? s.biz_no ?? s.bizNo ?? "";

                                const fieldStoreType = qs("#fieldStoreType");
                                if (fieldStoreId) fieldStoreId.value = id ? String(id) : "";
                                if (fieldStoreType) fieldStoreType.value = st || "";
                                if (fieldBizName) fieldBizName.value = bn || "";
                                if (fieldBizNo) fieldBizNo.value = bno || "";

                                if (fieldLinkUrl && !fieldLinkUrl.value.trim() && id) {
                                    fieldLinkUrl.value = `/ndetail.html?id=${id}&type=store`;
                                }

                                updateSelectedSummary();
                            });
                        });
                    }
                } catch (e) {
                    if (storeResultsBody) storeResultsBody.innerHTML = `<div class="text-sm text-red-500">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>`;
                    if (storeSearchHint) {
                        storeSearchHint.textContent = "ê²€ìƒ‰ ì‹¤íŒ¨";
                        storeSearchHint.className = "text-xs text-red-500";
                    }
                }
            }

            async function saveSlot() {
                if (!activePosition) return;

                const mode = getSelectedMode(); // image | store | text

                const linkUrl = (fieldLinkUrl?.value || "").trim();

                const storeId = (fieldStoreId?.value || "").trim();
                const businessNo = (fieldBizNo?.value || "").trim();
                const businessName = (fieldBizName?.value || "").trim();

                const startAt = fieldStartAt?.value || "";
                const endAt = fieldNoEnd?.checked ? "" : (fieldEndAt?.value || "");

                const priority = Number(adPriority?.value || 1) || 1;

                const fd = new FormData();
                fd.append("page", PAGE);
                fd.append("position", activePosition);
                fd.append("priority", String(priority));

                const txt = (fieldTextContent?.value || "").trim();

                if (mode === "text") {
                    fd.append("slotType", "text");
                    fd.append("slot_type", "text");
                    fd.append("slotMode", "custom");
                    fd.append("slot_mode", "custom");
                    fd.append("textContent", txt);
                    fd.append("text_content", txt);
                } else {
                    fd.append("slotType", "banner");
                    fd.append("slot_type", "banner");
                    fd.append("slotMode", mode);   // image | store
                    fd.append("slot_mode", mode);
                }

                // âœ… ë§í¬ëŠ” ëª¨ë“  ëª¨ë“œì—ì„œ ì €ì¥ í—ˆìš©(ì›ì¹˜ ì•Šìœ¼ë©´ ì—¬ê¸° ì¡°ê±´ ë°”ê¿”)
                if (linkUrl) {
                    fd.append("linkUrl", linkUrl);
                    fd.append("link_url", linkUrl);
                    fd.append("link", linkUrl);
                }

                if (mode === "store") {
                    if (storeId) { fd.append("storeId", storeId); fd.append("store_id", storeId); }
                    if (businessNo) {
                        fd.append("businessNo", businessNo);
                        fd.append("business_no", businessNo);
                        fd.append("bizNo", businessNo);
                    }
                    if (businessName) {
                        fd.append("businessName", businessName);
                        fd.append("business_name", businessName);
                    }
                }

                if (startAt) {
                    fd.append("startAt", startAt);
                    fd.append("start_at", startAt);
                    fd.append("startDate", startAt);
                    fd.append("start_date", startAt);
                }
                if (endAt) {
                    fd.append("endAt", endAt);
                    fd.append("end_at", endAt);
                    fd.append("endDate", endAt);
                    fd.append("end_date", endAt);
                }

                fd.append("noEnd", fieldNoEnd?.checked ? "1" : "0");
                fd.append("no_end", fieldNoEnd?.checked ? "1" : "0");

                const file = fieldImageFile?.files?.[0];
                if (mode === "image" && file) {
                    fd.append("image", file);
                    fd.append("slotImage", file);
                    fd.append("imageFile", file);
                    fd.append("adImage", file);
                }

                btnSaveSlot.disabled = true;
                btnSaveSlot.textContent = "ì €ì¥ ì¤‘...";

                try {
                    const { res, json } = await fetchJson("/manager/ad/slot", { method: "POST", body: fd });
                    if (!res.ok || !pickOk(json)) {
                        alert("ì €ì¥ ì‹¤íŒ¨: ì„œë²„ ì‘ë‹µì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                        console.error("save fail:", json);
                        return;
                    }

                    const saved = await fetchSlot(activePosition, priority);
                    if (saved) {
                        fillModalFromSlot(saved);
                        if (activeBox) applySlotToBox(activeBox, saved);
                    }

                    closeModal();
                } catch (e) {
                    console.error("save error:", e);
                    alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                } finally {
                    btnSaveSlot.disabled = false;
                    btnSaveSlot.textContent = "ìŠ¬ë¡¯ ì €ì¥";
                }
            }

            async function loadPriority() {
                const p = Number(adPriority?.value || 1) || 1;
                const slot = await fetchSlot(activePosition, p);
                if (!slot) {
                    resetModalFields(true);
                    setModalTypeForPosition(activePosition);
                    updateSelectedSummary();
                    alert(`ìš°ì„ ìˆœìœ„ ${p} í›„ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.`);
                    await refreshCandidates();
                    return;
                }
                fillModalFromSlot(slot);
                await refreshCandidates();
            }

            async function deletePriority() {
                const p = Number(adPriority?.value || 1) || 1;
                if (!confirm(`ìš°ì„ ìˆœìœ„ ${p} í›„ë³´ë¥¼ ì‚­ì œí• ê¹Œìš”?`)) return;

                const url = `/manager/ad/slot?page=${encodeURIComponent(PAGE)}&position=${encodeURIComponent(activePosition)}&priority=${encodeURIComponent(p)}`;
                const { res, json } = await fetchJson(url, { method: "DELETE" });

                if (!res.ok || !json?.success) {
                    alert(json?.error || "ì‚­ì œ ì‹¤íŒ¨(DELETE API í™•ì¸ í•„ìš”)");
                    return;
                }

                resetModalFields(true);
                setModalTypeForPosition(activePosition);
                updateSelectedSummary();

                await refreshCandidates();

                const slotP1 = await fetchSlot(activePosition, 1);
                const slot = slotP1 || await fetchSlot(activePosition);
                if (slot && activeBox) applySlotToBox(activeBox, slot);
            }

            async function handleBoxClick(box) {
                activeBox = box;
                activePosition = box.dataset.position || "";
                activeLabel = box.dataset.label || activePosition;

                if (!activePosition) return;

                modalRoot.dataset.page = PAGE;
                modalRoot.dataset.position = activePosition;

                modalTitle.textContent = activeLabel || "ìŠ¬ë¡¯ ìˆ˜ì •";
                modalPositionText.textContent = activePosition;

                resetModalFields(true);
                setModalTypeForPosition(activePosition);

                if (adPriority) adPriority.value = "1";

                try {
                    const slotP1 = await fetchSlot(activePosition, 1);
                    if (slotP1) fillModalFromSlot(slotP1);
                    else {
                        const slot = await fetchSlot(activePosition);
                        if (slot) fillModalFromSlot(slot);
                        else updateSelectedSummary();
                    }
                } catch (e) {
                    console.warn("modal preload fail:", activePosition, e);
                    updateSelectedSummary();
                }

                openModal();
                await refreshCandidates();
            }

            function bindAllBoxes() {
                const boxes = getAllSlotElements();
                boxes.forEach(box => {
                    if (box.dataset.__bound === "1") return;
                    box.dataset.__bound = "1";

                    bindHoverTooltip(box);
                    box.addEventListener("click", () => handleBoxClick(box));
                });
            }

            radioModes().forEach(r => {
                r.addEventListener("change", () => {
                    setModeUI(getSelectedMode());
                    updateSelectedSummary();
                });
            });

            fieldImageFile?.addEventListener("change", () => {
                const file = fieldImageFile?.files?.[0];
                if (file) showLocalPreview(file);
                else {
                    if (__localPreviewUrl) {
                        URL.revokeObjectURL(__localPreviewUrl);
                        __localPreviewUrl = null;
                    }
                    currentPreviewImg?.classList.add("hidden");
                    currentPreviewImg?.removeAttribute("src");
                    currentPreviewEmpty?.classList.remove("hidden");
                }
                updateSelectedSummary();
            });

            [fieldBizNo, fieldBizName].forEach(el => el?.addEventListener("input", updateSelectedSummary));
            fieldNoEnd?.addEventListener("change", () => applyNoEndState());
            btnSearchStore?.addEventListener("click", searchStores);

            btnCloseModal?.addEventListener("click", closeModal);
            qs(".modal-backdrop", modalRoot)?.addEventListener("click", closeModal);

            btnResetModal?.addEventListener("click", () => resetModalFields(true));
            btnSaveSlot?.addEventListener("click", saveSlot);

            btnLoadPriority?.addEventListener("click", loadPriority);
            btnDeletePriority?.addEventListener("click", deletePriority);

            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape" && !modalRoot.classList.contains("hidden")) closeModal();
            });

            (function setupHelpPopover() {
                const btn = document.getElementById("adHelpBtn");
                const pop = document.getElementById("adHelpPopover");
                const closeBtn = document.getElementById("adHelpCloseBtn");
                if (!btn || !pop) return;

                function openHelp() {
                    pop.classList.remove("hidden");
                    btn.setAttribute("aria-expanded", "true");
                }
                function closeHelp() {
                    pop.classList.add("hidden");
                    btn.setAttribute("aria-expanded", "false");
                }
                function toggleHelp(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (pop.classList.contains("hidden")) openHelp();
                    else closeHelp();
                }

                btn.addEventListener("click", toggleHelp);
                closeBtn?.addEventListener("click", (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    closeHelp();
                });

                pop.addEventListener("click", (e) => e.stopPropagation());
                document.addEventListener("click", () => closeHelp());
                document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeHelp(); });

                window.__closeAdHelp = closeHelp;
            })();

            /* ============================================================
               âœ… ì´ˆê¸°í™” (DOMContentLoaded ë†“ì³ë„ ì‹¤í–‰ë˜ê²Œ)
            ============================================================ */
            async function init() {
                buildBestPickGrid();
                bindAllBoxes();
                await loadAllSlotsPreview();
            }

            if (document.readyState === "loading") {
                document.addEventListener("DOMContentLoaded", init);
            } else {
                init();
            }
        })();
    </script>


</body>

</html>