<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MALL HANKOOK | Index Layout Manager (indexmanager)</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: 'Noto Sans KR', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        /* =========================
       âœ… ì¹´ë“œ/ìŠ¬ë¡¯ ê¸°ë³¸ ìŠ¤íƒ€ì¼
    ========================== */
        .neo-card {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(59, 130, 246, 0.18);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 1rem;
            box-shadow:
                6px 6px 12px rgba(0, 0, 0, 0.08),
                -6px -6px 12px rgba(255, 255, 255, 0.85);
            transition: all 0.22s ease;
        }

        .neo-card:hover {
            transform: translateY(-2px);
            box-shadow:
                10px 10px 18px rgba(0, 0, 0, 0.12),
                -6px -6px 10px rgba(255, 255, 255, 0.95);
        }

        .slot-banner {
            position: relative;
            overflow: hidden;
            cursor: pointer;
            isolation: isolate;
        }

        /* âœ… ìŠ¬ë¡¯ ì´ë¯¸ì§€ ì•ˆì „ ê·œê²© */
        .slot-banner .slot-img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
            z-index: 1;
        }

        .slot-banner .slot-default {
            position: relative;
            z-index: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(107, 114, 128, 0.9);
            font-size: 0.85rem;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        }

        /* =========================
       âœ… ê´€ë¦¬ì ì˜¤ë²„ë ˆì´ ë°°ì§€
       - label(ê²€ì • ë°”íƒ• ì´ë¦„ ë°°ì§€)ì€ HTMLì—ì„œ ëª¨ë‘ ì œê±°ë¨
    ========================== */
        .slot-badge {
            position: absolute;
            z-index: 3;
            font-size: 10px;
            line-height: 1;
            padding: 6px 8px;
            border-radius: 9999px;
            background: rgba(15, 23, 42, 0.85);
            color: white;
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            letter-spacing: 0.2px;
        }

        .slot-badge.size {
            bottom: 10px;
            right: 10px;
            background: rgba(37, 99, 235, 0.9);
        }

        .slot-badge.store {
            bottom: 10px;
            left: 10px;
            background: rgba(16, 185, 129, 0.9);
        }

        /* =========================
       âœ… ì»¤ì„œ ë”°ë¼ì˜¤ëŠ” íˆ´íŒ
    ========================== */
        #hoverTip {
            position: fixed;
            z-index: 9999;
            pointer-events: none;
            transform: translate(12px, 12px);
            padding: 6px 10px;
            font-size: 11px;
            border-radius: 8px;
            background: rgba(2, 6, 23, 0.9);
            color: white;
            opacity: 0;
            transition: opacity 0.08s ease;
            white-space: nowrap;
        }

        #hoverTip.show {
            opacity: 1;
        }

        /* =========================
       âœ… ëª¨ë‹¬ ê¸°ë³¸
    ========================== */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(2, 6, 23, 0.65);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            z-index: 9998;
        }

        .modal-panel {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            z-index: 9999;
        }

        .modal-card {
            width: min(920px, 96vw);
            max-height: 92vh;
            overflow: auto;
            border-radius: 20px;
            background: white;
            border: 1px solid rgba(148, 163, 184, 0.35);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
        }

        .field {
            width: 100%;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 10px 12px;
            outline: none;
        }

        .field:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.25);
        }

        .divider {
            height: 1px;
            background: #eef2f7;
        }

        /* Best Pick ì›í˜• ìŠ¬ë¡¯ */
        .best-circle {
            position: relative;
            border-radius: 9999px;
            overflow: hidden;
        }

        .best-circle .slot-img {
            object-fit: cover;
        }
    </style>
</head>

<body class="bg-white text-gray-800">

    <!-- ìƒë‹¨ íƒ€ì´í‹€ -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 pt-10">
        <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3">
            <div>
                <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">
                    Index ë ˆì´ì•„ì›ƒ ê´€ë¦¬ì (indexmanager)
                </h1>
                <p class="text-sm text-gray-500 mt-1">
                    ê° ë°•ìŠ¤ë¥¼ í´ë¦­í•´ ì´ë¯¸ì§€ ê´‘ê³  ë˜ëŠ” ê°€ê²Œ ì—°ê²° ê´‘ê³ ë¥¼ ì„¤ì •í•˜ì„¸ìš”.
                </p>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-xs px-2 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100">
                    page = index
                </span>
                <span class="text-xs px-2 py-1 rounded-full bg-slate-50 text-slate-600 border border-slate-100">
                    /manager/ad/slot ì—°ë™
                </span>
            </div>
        </div>
    </div>

    <!-- =========================
       â‘  ìƒë‹¨ ë ë°°ë„ˆ
  ========================== -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 mt-10">
        <div id="slot_index_main_top"
            class="neo-card h-28 flex flex-col items-center justify-center text-center slot-banner"
            data-position="index_main_top" data-label="ìƒë‹¨ ë ë°°ë„ˆ" data-size="ê°€ë¡œí˜• (ê¶Œì¥ ë¹„ìœ¨ 6:1)">
            <img class="slot-img hidden" alt="ìƒë‹¨ ë ë°°ë„ˆ">
            <div class="slot-default">
                <div>
                    <p class="text-lg sm:text-xl font-bold">ìƒë‹¨ ë ë°°ë„ˆ</p>
                    <p class="text-gray-500 text-xs sm:text-sm">í´ë¦­í•˜ì—¬ ê´‘ê³  ì„¤ì •</p>
                </div>
            </div>
            <span class="slot-badge size">6:1</span>
            <span class="slot-badge store hidden"></span>
        </div>
    </div>

    <!-- =========================
       â‘¡ ë©”ì¸ ë¹„ì£¼ì–¼ + â‘¢â‘£â‘¤ í”„ë¡œëª¨
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 items-stretch">

            <!-- ë©”ì¸ ë¹„ì£¼ì–¼ -->
            <div class="lg:col-span-3">
                <div id="slot_index_main_visual"
                    class="slot-banner rounded-2xl overflow-hidden bg-gray-100 shadow-lg aspect-[21/9] w-full h-full"
                    data-position="index_main_visual" data-label="ë©”ì¸ ë¹„ì£¼ì–¼" data-size="ê¶Œì¥ ë¹„ìœ¨ 21:9">
                    <img class="slot-img hidden w-full h-full" alt="ë©”ì¸ ë¹„ì£¼ì–¼">
                    <div class="slot-default w-full h-full">
                        <div class="text-center">
                            <p class="text-lg sm:text-xl font-bold">ë©”ì¸ ë¹„ì£¼ì–¼</p>
                            <p class="text-gray-500 text-xs sm:text-sm mt-1">í´ë¦­í•˜ì—¬ ê´‘ê³  ì„¤ì •</p>
                        </div>
                    </div>
                    <span class="slot-badge size">21:9</span>
                    <span class="slot-badge store hidden"></span>
                </div>
            </div>

            <!-- í”„ë¡œëª¨ 1/2/3 ì»¬ëŸ¼ -->
            <div class="lg:col-span-1 flex flex-col gap-4 h-full">

                <div id="slot_index_promo_1"
                    class="slot-banner rounded-2xl border border-gray-100 bg-white shadow-sm overflow-hidden flex-1 min-h-[90px] aspect-[4/3]"
                    data-position="index_promo_1" data-label="í”„ë¡œëª¨ 1" data-size="ê¶Œì¥ ë¹„ìœ¨ 4:3">
                    <img class="slot-img hidden" alt="í”„ë¡œëª¨ 1">
                    <div class="slot-default">
                        <span>Promo 1</span>
                    </div>
                    <span class="slot-badge size">4:3</span>
                    <span class="slot-badge store hidden"></span>
                </div>

                <div id="slot_index_promo_2"
                    class="slot-banner rounded-2xl border border-gray-100 bg-white shadow-sm overflow-hidden flex-1 min-h-[90px] aspect-[4/3]"
                    data-position="index_promo_2" data-label="í”„ë¡œëª¨ 2" data-size="ê¶Œì¥ ë¹„ìœ¨ 4:3">
                    <img class="slot-img hidden" alt="í”„ë¡œëª¨ 2">
                    <div class="slot-default">
                        <span>Promo 2</span>
                    </div>
                    <span class="slot-badge size">4:3</span>
                    <span class="slot-badge store hidden"></span>
                </div>

                <div id="slot_index_promo_3"
                    class="slot-banner rounded-2xl border border-gray-100 bg-white shadow-sm overflow-hidden flex-1 min-h-[90px] aspect-[4/3]"
                    data-position="index_promo_3" data-label="í”„ë¡œëª¨ 3" data-size="ê¶Œì¥ ë¹„ìœ¨ 4:3">
                    <img class="slot-img hidden" alt="í”„ë¡œëª¨ 3">
                    <div class="slot-default">
                        <span>Promo 3</span>
                    </div>
                    <span class="slot-badge size">4:3</span>
                    <span class="slot-badge store hidden"></span>
                </div>

            </div>
        </div>
    </section>

    <!-- =========================
       â‘¥ ìƒë‹¨ ì„œë¸Œ ë°•ìŠ¤
       âœ… ì´ 4ê°œ(ê²€ìƒ‰ì–´/ìµœì‹  ì†Œì‹/ì´ë²¤íŠ¸ ì •ë³´/ì¶”ì²œ ì œí’ˆ)ëŠ” "í…ìŠ¤íŠ¸ ì „ìš© ëª¨ë‹¬"ë¡œ ìë™ ì „í™˜ë¨
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-4">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-center">

            <div>
                <h3 class="font-bold text-xl sm:text-2xl mb-2">ê²€ìƒ‰ì–´</h3>
                <div id="slot_index_sub_keywords" class="neo-card min-h-28 p-4 slot-banner"
                    data-position="index_sub_keywords" data-label="ê²€ìƒ‰ì–´ ë°•ìŠ¤" data-size="í…ìŠ¤íŠ¸ ì˜ì—­">
                    <img class="slot-img hidden" alt="ê²€ìƒ‰ì–´">
                    <div class="slot-default">
                        <span class="text-xs text-gray-500">í…ìŠ¤íŠ¸ ì „ìš©</span>
                    </div>
                    <span class="slot-badge size">Text</span>
                    <span class="slot-badge store hidden"></span>
                </div>
            </div>

            <div>
                <h3 class="font-bold text-xl sm:text-2xl mb-2">ìµœì‹  ì†Œì‹</h3>
                <div id="slot_index_sub_news" class="neo-card min-h-28 p-4 slot-banner" data-position="index_sub_news"
                    data-label="ìµœì‹  ì†Œì‹ ë°•ìŠ¤" data-size="í…ìŠ¤íŠ¸ ì˜ì—­">
                    <img class="slot-img hidden" alt="ìµœì‹  ì†Œì‹">
                    <div class="slot-default">
                        <span class="text-xs text-gray-500">í…ìŠ¤íŠ¸ ì „ìš©</span>
                    </div>
                    <span class="slot-badge size">Text</span>
                    <span class="slot-badge store hidden"></span>
                </div>
            </div>

            <div>
                <h3 class="font-bold text-xl sm:text-2xl mb-2">ì´ë²¤íŠ¸ ì •ë³´</h3>
                <div id="slot_index_sub_events" class="neo-card min-h-28 p-4 slot-banner"
                    data-position="index_sub_events" data-label="ì´ë²¤íŠ¸ ì •ë³´ ë°•ìŠ¤" data-size="í…ìŠ¤íŠ¸ ì˜ì—­">
                    <img class="slot-img hidden" alt="ì´ë²¤íŠ¸ ì •ë³´">
                    <div class="slot-default">
                        <span class="text-xs text-gray-500">í…ìŠ¤íŠ¸ ì „ìš©</span>
                    </div>
                    <span class="slot-badge size">Text</span>
                    <span class="slot-badge store hidden"></span>
                </div>
            </div>

            <div>
                <h3 class="font-bold text-xl sm:text-2xl mb-2">ì¶”ì²œ ì œí’ˆ</h3>
                <div id="slot_index_sub_recommends" class="neo-card min-h-28 p-4 slot-banner"
                    data-position="index_sub_recommends" data-label="ì¶”ì²œ ì œí’ˆ ë°•ìŠ¤" data-size="í…ìŠ¤íŠ¸ ì˜ì—­">
                    <img class="slot-img hidden" alt="ì¶”ì²œ ì œí’ˆ">
                    <div class="slot-default">
                        <span class="text-xs text-gray-500">í…ìŠ¤íŠ¸ ì „ìš©</span>
                    </div>
                    <span class="slot-badge size">Text</span>
                    <span class="slot-badge store hidden"></span>
                </div>
            </div>

        </div>
    </section>

    <!-- =========================
       â‘¦ Best Pick (ê´€ë¦¬ì ë²„ì „)
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-10">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl sm:text-3xl font-bold">Best Pick</h2>
            <span class="text-xs text-gray-500">ìµœëŒ€ 18ê°œ ìŠ¬ë¡¯</span>
        </div>

        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4">
            <!-- 1 ~ 18 ìƒì„± (JSê°€ ì§ì ‘ grid ìì‹ìœ¼ë¡œ ì‚½ì…í•¨) -->
            <div id="best_pick_grid"></div>
        </div>
    </section>

    <!-- =========================
       â‘¨ ê¸°ëŠ¥ ì§„ì… ì¹´ë“œë“¤
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-10 grid grid-cols-1 lg:grid-cols-3 gap-6">

        <div class="grid grid-rows-2 gap-4">
            <div id="slot_index_food_delivery"
                class="slot-banner rounded-lg overflow-hidden min-h-28 sm:min-h-40 bg-gray-100"
                data-position="index_food_delivery" data-label="í™ë³´ì˜ ë°°ë‹¬" data-size="ììœ  / ê¶Œì¥ 16:9">
                <img class="slot-img hidden" alt="í™ë³´ì˜ ë°°ë‹¬">
                <div class="slot-default">í™ë³´ì˜ ë°°ë‹¬</div>
                <span class="slot-badge size">16:9</span>
                <span class="slot-badge store hidden"></span>
            </div>

            <div id="slot_index_all_stores"
                class="slot-banner rounded-lg overflow-hidden min-h-28 sm:min-h-40 bg-gray-100"
                data-position="index_all_stores" data-label="ìš°ë¦¬ë™ë„¤ ëª¨ë“ ê°€ê²Œ" data-size="ììœ  / ê¶Œì¥ 16:9">
                <img class="slot-img hidden" alt="ìš°ë¦¬ë™ë„¤ ëª¨ë“ ê°€ê²Œ">
                <div class="slot-default">ìš°ë¦¬ë™ë„¤ ëª¨ë“ ê°€ê²Œ</div>
                <span class="slot-badge size">16:9</span>
                <span class="slot-badge store hidden"></span>
            </div>
        </div>

        <div class="lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div id="slot_index_hot_place" class="slot-banner rounded-lg overflow-hidden bg-gray-100 aspect-[4/3]"
                data-position="index_hot_place" data-label="ê°€ì¥ HOTí•œ ìš°ë¦¬ë™ë„¤" data-size="ê¶Œì¥ 4:3">
                <img class="slot-img hidden" alt="ê°€ì¥ HOTí•œ ìš°ë¦¬ë™ë„¤">
                <div class="slot-default">ê°€ì¥ HOTí•œ ìš°ë¦¬ë™ë„¤</div>
                <span class="slot-badge size">4:3</span>
                <span class="slot-badge store hidden"></span>
            </div>

            <div id="slot_index_suggest" class="slot-banner rounded-lg overflow-hidden bg-gray-100 aspect-[4/3]"
                data-position="index_suggest" data-label="í™ë³´ì˜ ì¶”ì²œ" data-size="ê¶Œì¥ 4:3">
                <img class="slot-img hidden" alt="í™ë³´ì˜ ì¶”ì²œ">
                <div class="slot-default">í™ë³´ì˜ ì¶”ì²œ</div>
                <span class="slot-badge size">4:3</span>
                <span class="slot-badge store hidden"></span>
            </div>

            <div id="slot_index_open" class="slot-banner rounded-lg overflow-hidden bg-gray-100 aspect-[4/3]"
                data-position="index_open" data-label="ì˜¤í”ˆ ì˜ˆì •" data-size="ê¶Œì¥ 4:3">
                <img class="slot-img hidden" alt="ì˜¤í”ˆ ì˜ˆì •">
                <div class="slot-default">ì˜¤í”ˆ ì˜ˆì •</div>
                <span class="slot-badge size">4:3</span>
                <span class="slot-badge store hidden"></span>
            </div>

            <div id="slot_index_store_pride" class="slot-banner rounded-lg overflow-hidden bg-gray-100 aspect-[4/3]"
                data-position="index_store_pride" data-label="ê°€ê²Œìë‘" data-size="ê¶Œì¥ 4:3">
                <img class="slot-img hidden" alt="ê°€ê²Œìë‘">
                <div class="slot-default">ê°€ê²Œìë‘</div>
                <span class="slot-badge size">4:3</span>
                <span class="slot-badge store hidden"></span>
            </div>

            <div id="slot_index_traditional" class="slot-banner rounded-lg overflow-hidden bg-gray-100 aspect-[4/3]"
                data-position="index_traditional" data-label="ì „í†µì‹œì¥" data-size="ê¶Œì¥ 4:3">
                <img class="slot-img hidden" alt="ì „í†µì‹œì¥">
                <div class="slot-default">ì „í†µì‹œì¥</div>
                <span class="slot-badge size">4:3</span>
                <span class="slot-badge store hidden"></span>
            </div>

            <div id="slot_index_performing" class="slot-banner rounded-lg overflow-hidden bg-gray-100 aspect-[4/3]"
                data-position="index_performing" data-label="ê³µì—°/ì˜ˆìˆ , ì¶•ì œ" data-size="ê¶Œì¥ 4:3">
                <img class="slot-img hidden" alt="ê³µì—°/ì˜ˆìˆ , ì¶•ì œ">
                <div class="slot-default font-bold">ê³µì—°/ì˜ˆìˆ , ì¶•ì œ</div>
                <span class="slot-badge size">4:3</span>
                <span class="slot-badge store hidden"></span>
            </div>
        </div>
    </section>

    <!-- =========================
       â‘©â‘ª ì´ë²¤íŠ¸ / ì§€ì—­ ê²Œì‹œíŒ
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-10 grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div id="slot_index_event" class="slot-banner rounded-lg overflow-hidden bg-yellow-50 min-h-36 sm:min-h-52"
            data-position="index_event" data-label="ì´ë²¤íŠ¸" data-size="ê¶Œì¥ 16:9">
            <img class="slot-img hidden" alt="ì´ë²¤íŠ¸">
            <div class="slot-default">
                <span class="text-lg font-bold">ì´ë²¤íŠ¸</span>
            </div>
            <span class="slot-badge size">16:9</span>
            <span class="slot-badge store hidden"></span>
        </div>

        <div id="slot_index_localboard" class="slot-banner rounded-lg overflow-hidden bg-blue-50 min-h-36 sm:min-h-52"
            data-position="index_localboard" data-label="ì§€ì—­ ê²Œì‹œíŒ" data-size="ê¶Œì¥ 16:9">
            <img class="slot-img hidden" alt="ì§€ì—­ ê²Œì‹œíŒ">
            <div class="slot-default">
                <span class="text-lg font-bold">ì§€ì—­ ê²Œì‹œíŒ</span>
            </div>
            <span class="slot-badge size">16:9</span>
            <span class="slot-badge store hidden"></span>
        </div>
    </section>

    <!-- =========================
       â‘«â‘¬ ê³„ì ˆ í…Œë§ˆ / ì‹ ê·œ íšŒì› í˜œíƒ
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-10 grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div id="slot_index_season" class="slot-banner rounded-lg overflow-hidden bg-gray-100 min-h-36 sm:min-h-52"
            data-position="index_season" data-label="ê³„ì ˆí…Œë§ˆ" data-size="ê¶Œì¥ 16:9">
            <img class="slot-img hidden" alt="ê³„ì ˆí…Œë§ˆ">
            <div class="slot-default">
                <span class="text-lg font-bold">ê³„ì ˆí…Œë§ˆ</span>
            </div>
            <span class="slot-badge size">16:9</span>
            <span class="slot-badge store hidden"></span>
        </div>

        <div id="slot_index_join" class="slot-banner rounded-lg overflow-hidden bg-gray-100 min-h-36 sm:min-h-52"
            data-position="index_join" data-label="ì‹ ê·œ íšŒì› í˜œíƒ" data-size="ê¶Œì¥ 16:9">
            <img class="slot-img hidden" alt="ì‹ ê·œ íšŒì› í˜œíƒ">
            <div class="slot-default flex-col">
                <span class="text-lg font-bold">ì‹ ê·œ íšŒì› í˜œíƒ</span>
                <span class="text-xs text-gray-500 mt-1">í´ë¦­í•˜ì—¬ ì„¤ì •</span>
            </div>
            <span class="slot-badge size">16:9</span>
            <span class="slot-badge store hidden"></span>
        </div>
    </section>

    <!-- =========================
       â‘® ê³ ê°ì§€ì› 3ì¹¸
  ========================== -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 py-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <div id="slot_index_support_review"
            class="slot-banner rounded-lg overflow-hidden bg-gray-100 min-h-28 sm:min-h-40"
            data-position="index_support_review" data-label="ë¦¬ë·°/í›„ê¸°" data-size="ê¶Œì¥ 16:9">
            <img class="slot-img hidden" alt="ë¦¬ë·°/í›„ê¸°">
            <div class="slot-default">
                <span class="text-lg font-bold">ë¦¬ë·°/í›„ê¸°</span>
            </div>
            <span class="slot-badge size">16:9</span>
            <span class="slot-badge store hidden"></span>
        </div>

        <div id="slot_index_support_empty"
            class="slot-banner rounded-lg overflow-hidden bg-gray-100 min-h-28 sm:min-h-40"
            data-position="index_support_empty" data-label="ê³ ê°ì§€ì› ì¤‘ì•™" data-size="ììœ ">
            <img class="slot-img hidden" alt="ì¤‘ì•™ ë°•ìŠ¤">
            <div class="slot-default">
                <span class="text-sm text-gray-500">ì¤‘ì•™ ì§€ì› ë°•ìŠ¤</span>
            </div>
            <span class="slot-badge size">FREE</span>
            <span class="slot-badge store hidden"></span>
        </div>

        <div id="slot_index_support_inquiry"
            class="slot-banner rounded-lg overflow-hidden bg-gray-100 min-h-28 sm:min-h-40"
            data-position="index_support_inquiry" data-label="ë¬¸ì˜ê²Œì‹œíŒ" data-size="ê¶Œì¥ 16:9">
            <img class="slot-img hidden" alt="ë¬¸ì˜ê²Œì‹œíŒ">
            <div class="slot-default flex-col">
                <span class="text-lg font-bold">ë¬¸ì˜ê²Œì‹œíŒ</span>
                <span class="text-xs text-gray-500 mt-1">í´ë¦­í•˜ì—¬ ì„¤ì •</span>
            </div>
            <span class="slot-badge size">16:9</span>
            <span class="slot-badge store hidden"></span>
        </div>
    </section>

    <!-- =========================
       íˆ´íŒ
  ========================== -->
    <div id="hoverTip"></div>

    <!-- =========================
       ê³µí†µ ëª¨ë‹¬
  ========================== -->
    <div id="modalRoot" class="hidden" data-ad-modal="1" data-page="" data-position="">
        <div class="modal-backdrop"></div>
        <div class="modal-panel">
            <div class="modal-card">
                <!-- í—¤ë” -->
                <div class="p-6 sticky top-0 bg-white/90 backdrop-blur border-b border-slate-100 z-10">
                    <div class="flex items-start justify-between gap-4">
                        <div>
                            <h3 id="modalTitle" class="text-xl sm:text-2xl font-extrabold">ìŠ¬ë¡¯ ìˆ˜ì •</h3>
                            <p class="text-xs text-gray-500 mt-1">
                                page: <b>index</b> /
                                position: <span id="modalPositionText" class="font-semibold"></span>
                            </p>
                        </div>

                        <div class="flex items-center gap-2">
                            <!-- âœ… ì‚¬ìš©ë²• ë²„íŠ¼ -->
                            <div class="relative">
                                <button type="button" id="adHelpBtn"
                                    class="inline-flex items-center gap-2 rounded-xl border border-blue-200 bg-white/80 px-3 py-1.5 text-sm font-semibold text-blue-700 shadow-sm hover:bg-white"
                                    aria-expanded="false" aria-controls="adHelpPopover" title="ì‚¬ìš©ë²• ë³´ê¸°">
                                    <span
                                        class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-blue-600 text-white text-xs leading-none">?</span>
                                    ì‚¬ìš©ë²•
                                </button>

                                <!-- âœ… í´ë¦­ ì‹œ ë³´ì´ëŠ” ì•ˆë‚´ ë°•ìŠ¤ -->
                                <div id="adHelpPopover"
                                    class="hidden absolute right-0 mt-2 w-[min(420px,calc(100vw-2rem))] rounded-2xl border border-blue-200 bg-white/95 p-4 shadow-xl backdrop-blur">
                                    <div class="flex items-start justify-between gap-3">
                                        <div class="font-extrabold text-slate-800">âœ… ì‚¬ìš© íë¦„</div>
                                        <button type="button" id="adHelpCloseBtn"
                                            class="rounded-lg px-2 py-1 text-xs font-bold text-slate-500 hover:bg-slate-100">ë‹«ê¸°</button>
                                    </div>

                                    <ol class="mt-3 space-y-2 text-sm text-slate-700 leading-relaxed list-decimal pl-5">
                                        <li><b>/admin/indexmanager.html</b> ì ‘ì†</li>
                                        <li>ì›í•˜ëŠ” ìŠ¬ë¡¯ í´ë¦­ â†’ <b>ëª¨ë‹¬ ì—´ë¦¼</b></li>
                                        <li>ëª¨ë‹¬ ìƒë‹¨ì—ì„œ <b>ìš°ì„ ìˆœìœ„ 1</b> ì„ íƒ â†’ ë‚´ìš©/ì´ë¯¸ì§€/ê¸°ê°„ ì…ë ¥ â†’ <b>ì €ì¥</b></li>
                                        <li>ë‹¤ì‹œ ê°™ì€ ìŠ¬ë¡¯ í´ë¦­ â†’ ëª¨ë‹¬ ì—´ê¸°</li>
                                        <li>ì´ë²ˆì—” <b>ìš°ì„ ìˆœìœ„ 2</b> ì„ íƒ â†’ ì…ë ¥ â†’ <b>ì €ì¥</b></li>
                                        <li><b>ìš°ì„ ìˆœìœ„ 3</b>ë„ ë™ì¼</li>
                                    </ol>

                                    <div class="mt-3 rounded-xl bg-blue-50 px-3 py-2 text-xs text-blue-900">
                                        â€» ì‹¤ì œ ë…¸ì¶œì€ â€œê¸°ê°„ ì¡°ê±´ì´ ë§ëŠ” í›„ë³´ë“¤ ì¤‘ ìš°ì„ ìˆœìœ„ ìˆ«ìê°€ ê°€ì¥ ì‘ì€ ê²ƒ(1)â€ì´ ì„ íƒë©ë‹ˆë‹¤.
                                    </div>

                                    <div class="mt-2 rounded-xl bg-slate-50 px-3 py-2 text-xs text-slate-600">
                                        â€» ì„œë²„ì— ìš°ì„ ìˆœìœ„(í›„ë³´) APIê°€ ì—†ìœ¼ë©´, ìš°ì„ ìˆœìœ„ ê¸°ëŠ¥ì€ ìë™ìœ¼ë¡œ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.
                                    </div>
                                </div>
                            </div>

                            <button id="btnCloseModal"
                                class="px-3 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm">
                                ë‹«ê¸°
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ë³¸ë¬¸ -->
                <div class="p-6 space-y-6">

                    <!-- âœ… í…ìŠ¤íŠ¸ ì „ìš© ì•ˆë‚´(ê²€ìƒ‰ì–´/ìµœì‹  ì†Œì‹/ì´ë²¤íŠ¸ ì •ë³´/ì¶”ì²œ ì œí’ˆì¼ ë•Œë§Œ í‘œì‹œ) -->
                    <div id="textOnlyHint" class="hidden rounded-2xl border border-slate-100 bg-slate-50 p-4">
                        <div class="text-sm font-bold text-slate-800">ğŸ“ ì´ ìŠ¬ë¡¯ì€ í…ìŠ¤íŠ¸ ì „ìš©ì…ë‹ˆë‹¤.</div>
                        <div class="mt-1 text-xs text-slate-500">
                            ì´ë¯¸ì§€/ê°€ê²Œì—°ê²°/ë§í¬ ì…ë ¥ì€ ìˆ¨ê¹€ ì²˜ë¦¬ë©ë‹ˆë‹¤. (ê¸€ë§Œ ì‘ì„±)
                        </div>
                    </div>

                    <!-- ëª¨ë“œ ì„ íƒ (í…ìŠ¤íŠ¸ ì „ìš©ì¼ ë•Œ ìˆ¨ê¹€) -->
                    <div id="modeBlock" class="rounded-xl border border-slate-100 bg-slate-50 p-4">
                        <p class="text-sm font-semibold mb-3">ê´‘ê³  ë°©ì‹ ì„ íƒ</p>
                        <div class="flex flex-wrap gap-4">
                            <label class="flex items-center gap-2 text-sm">
                                <input type="radio" name="slotMode" value="image" class="accent-blue-600" checked>
                                <span>ì´ë¯¸ì§€ ì…ë ¥</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm">
                                <input type="radio" name="slotMode" value="store" class="accent-emerald-600">
                                <span>ê°€ê²Œ ì—°ê²°</span>
                            </label>
                        </div>
                    </div>

                    <!-- âœ… í…ìŠ¤íŠ¸ ì „ìš© ë¸”ë¡ -->
                    <div id="textBlock" class="hidden space-y-2">
                        <label class="text-sm font-semibold">ë‚´ìš© (í…ìŠ¤íŠ¸)</label>
                        <textarea id="fieldTextContent" class="field mt-2 min-h-[180px] resize-y"
                            placeholder="ì˜ˆ) í•œ ì¤„ë‹¹ 1ê°œì”© ì…ë ¥&#10;ì²«ë²ˆì§¸ ì¤„&#10;ë‘ë²ˆì§¸ ì¤„&#10;ì„¸ë²ˆì§¸ ì¤„"></textarea>
                        <p class="text-xs text-gray-500">
                            ì¤„ë°”ê¿ˆ(Enter) ê¸°ì¤€ìœ¼ë¡œ í‘œì‹œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                    </div>

                    <!-- âœ… ê³µí†µ ë§í¬ (í…ìŠ¤íŠ¸ ì „ìš©ì¼ ë•Œ ìˆ¨ê¹€) -->
                    <div id="linkBlock">
                        <label class="text-sm font-semibold">ë§í¬ URL (ì„ íƒ)</label>
                        <input id="fieldLinkUrl" class="field mt-2"
                            placeholder="/ndetail.html?id=123&type=store or https://..." />
                    </div>

                    <div id="dividerAfterLink" class="divider"></div>

                    <!-- ì´ë¯¸ì§€ ë¸”ë¡ -->
                    <div id="imageBlock" class="space-y-4">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm font-semibold">ì´ë¯¸ì§€ íŒŒì¼</label>
                                <input id="fieldImageFile" type="file" accept="image/*" class="field mt-2 bg-white" />
                                <p class="text-xs text-gray-500 mt-1">
                                    ìŠ¬ë¡¯ ë¹„ìœ¨ì— ë§ê²Œ ìë™ í¬ë¡­ë©ë‹ˆë‹¤.
                                </p>
                            </div>
                            <div>
                                <label class="text-sm font-semibold">í˜„ì¬ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°</label>
                                <div
                                    class="mt-2 rounded-lg border border-gray-100 bg-gray-50 overflow-hidden aspect-[16/9] flex items-center justify-center">
                                    <img id="currentPreviewImg" src="" alt="preview"
                                        class="w-full h-full object-cover hidden" />
                                    <span id="currentPreviewEmpty" class="text-xs text-gray-400">ì´ë¯¸ì§€ ì—†ìŒ</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ê°€ê²Œ ì—°ê²° ë¸”ë¡ -->
                    <div id="storeBlock" class="space-y-4 hidden">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm font-semibold">ì‚¬ì—…ìë²ˆí˜¸</label>
                                <input id="fieldBizNo" class="field mt-2" placeholder="ì˜ˆ) 2910802895" />
                            </div>
                            <div>
                                <label class="text-sm font-semibold">ìƒí˜¸ëª…</label>
                                <input id="fieldBizName" class="field mt-2" placeholder="ì˜ˆ) ë¯¸ë¡€í—¤ì–´" />
                            </div>
                        </div>

                        <div class="flex items-center gap-2">
                            <button id="btnSearchStore"
                                class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm">
                                ê°€ê²Œ ê²€ìƒ‰
                            </button>
                            <span id="storeSearchHint" class="text-xs text-gray-500"></span>
                        </div>

                        <div id="storeResults" class="border border-slate-100 rounded-xl overflow-hidden">
                            <div class="px-4 py-3 bg-slate-50 text-sm font-semibold">
                                ê²€ìƒ‰ ê²°ê³¼
                            </div>
                            <div id="storeResultsBody" class="p-4 text-sm text-gray-500">
                                ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ê³  â€œê°€ê²Œ ê²€ìƒ‰â€ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                            </div>
                        </div>

                        <!-- ì„ íƒëœ ê°€ê²Œ hidden -->
                        <input id="fieldStoreId" type="hidden" />
                    </div>

                    <div class="divider"></div>

                    <!-- âœ… ìš°ì„ ìˆœìœ„(1ì´ ê°€ì¥ ìš°ì„ ) -->
                    <div class="mt-4 p-3 rounded-xl border border-blue-100 bg-white/70">
                        <div class="flex flex-col md:flex-row md:items-end gap-3">
                            <div class="flex-1">
                                <label class="text-sm font-semibold text-gray-700">ìš°ì„ ìˆœìœ„</label>
                                <input name="priority" id="adPriority" type="number" min="1" step="1" value="1"
                                    class="mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 outline-none focus:ring-2 focus:ring-blue-300" />
                                <p class="mt-1 text-xs text-gray-500">1ì´ ê°€ì¥ ë¨¼ì € ë…¸ì¶œë©ë‹ˆë‹¤. (1,2,3â€¦ ì—¬ëŸ¬ ê°œ ë“±ë¡ ê°€ëŠ¥)</p>
                            </div>

                            <button type="button" id="btnLoadPriority"
                                class="rounded-xl px-4 py-2 border border-blue-200 bg-blue-50 hover:bg-blue-100">
                                ì´ ìš°ì„ ìˆœìœ„ ë¶ˆëŸ¬ì˜¤ê¸°
                            </button>

                            <button type="button" id="btnDeletePriority"
                                class="rounded-xl px-4 py-2 border border-red-200 bg-red-50 hover:bg-red-100">
                                ì´ ìš°ì„ ìˆœìœ„ ì‚­ì œ
                            </button>
                        </div>

                        <details class="mt-3">
                            <summary class="cursor-pointer text-sm text-gray-700">í›„ë³´ ëª©ë¡ ë³´ê¸°</summary>
                            <div id="candidateList" class="mt-2 grid gap-2"></div>
                        </details>

                        <div id="prioritySupportHint" class="mt-3 text-xs text-slate-500"></div>
                    </div>

                    <!-- ê¸°ê°„ -->
                    <div class="rounded-xl border border-slate-100 p-4">
                        <div class="flex items-center justify-between">
                            <p class="text-sm font-semibold">ê´‘ê³  ê¸°ê°„ ì„¤ì •</p>
                            <label class="flex items-center gap-2 text-xs">
                                <input id="fieldNoEnd" type="checkbox" class="accent-blue-600">
                                <span class="text-gray-700">ê³„ì† ìœ ì§€ (ì¢…ë£Œ ì—†ìŒ)</span>
                            </label>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                            <div>
                                <label class="text-xs font-semibold text-gray-600">ì‹œì‘ ì¼ì‹œ</label>
                                <input id="fieldStartAt" type="datetime-local" class="field mt-2" />
                            </div>
                            <div>
                                <label class="text-xs font-semibold text-gray-600">ì¢…ë£Œ ì¼ì‹œ</label>
                                <input id="fieldEndAt" type="datetime-local" class="field mt-2" />
                            </div>
                        </div>
                    </div>

                    <!-- ìš”ì•½ í‘œì‹œ -->
                    <div class="rounded-xl border border-slate-100 bg-slate-50 p-4">
                        <p class="text-sm font-semibold mb-2">í˜„ì¬ ì„ íƒ ì •ë³´</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
                            <div class="flex items-center gap-2">
                                <span class="text-gray-500">ì„ íƒ ì´ë¯¸ì§€:</span>
                                <span id="textSelectedImage" class="font-semibold text-slate-800">ì—†ìŒ</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-gray-500">ì—°ê²° ê°€ê²Œ:</span>
                                <span id="textSelectedStore" class="font-semibold text-slate-800">ì—†ìŒ</span>
                            </div>
                        </div>

                        <div class="mt-2 text-xs text-slate-500">
                            í…ìŠ¤íŠ¸ ì „ìš© ìŠ¬ë¡¯ì€ â€œì„ íƒ ì´ë¯¸ì§€/ì—°ê²° ê°€ê²Œâ€ê°€ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        </div>
                    </div>

                    <!-- ì €ì¥ ë²„íŠ¼ -->
                    <div class="flex flex-col sm:flex-row gap-2 sm:justify-end">
                        <button id="btnResetModal"
                            class="px-4 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm">
                            ì…ë ¥ ì´ˆê¸°í™”
                        </button>
                        <button id="btnSaveSlot"
                            class="px-5 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold">
                            ìŠ¬ë¡¯ ì €ì¥
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        /* ============================================================
           âœ… ê¸°ë³¸ ìƒìˆ˜/ìœ í‹¸
        ============================================================ */
        const PAGE = "index";
        const BEST_PICK_MAX = 18;

        // âœ… í…ìŠ¤íŠ¸ ì „ìš© ìŠ¬ë¡¯(ëª¨ë‹¬ì´ ë‹¬ë¼ì•¼ í•˜ëŠ” 4ê°œ)
        const TEXT_ONLY_POSITIONS = new Set([
            "index_sub_keywords",
            "index_sub_news",
            "index_sub_events",
            "index_sub_recommends",
        ]);

        function qs(sel, root = document) { return root.querySelector(sel); }
        function qsa(sel, root = document) { return Array.from(root.querySelectorAll(sel)); }

        function toAbs(u) {
            if (!u) return "";
            if (/^https?:\/\//i.test(u)) return u;
            return u.startsWith("/") ? u : ("/" + u);
        }

        function withBust(u) {
            if (!u) return "";
            const sep = u.includes("?") ? "&" : "?";
            return `${u}${sep}v=${Date.now()}`;
        }

        function safeSetImage(imgEl, rawUrl, defEl) {
            if (!imgEl) return;
            const url = rawUrl ? withBust(toAbs(rawUrl)) : "";

            imgEl.classList.add("hidden");
            imgEl.removeAttribute("src");
            if (defEl) defEl.classList.remove("hidden");

            if (!url) return;

            imgEl.onload = () => {
                imgEl.classList.remove("hidden");
                if (defEl) defEl.classList.add("hidden");
            };
            imgEl.onerror = () => {
                imgEl.classList.add("hidden");
                if (defEl) defEl.classList.remove("hidden");
            };
            imgEl.src = url;
        }

        function pickOk(json) {
            return !!(json?.ok || json?.success);
        }

        function pickSlot(json) {
            return json?.slot || json?.data || json?.ad || null;
        }

        function normalizeDateTimeForInput(value) {
            if (!value) return "";
            try {
                if (typeof value === "string" && value.includes("T") && value.length >= 16) {
                    return value.slice(0, 16);
                }
                const d = new Date(value);
                if (isNaN(d.getTime())) return "";
                const off = d.getTimezoneOffset();
                const local = new Date(d.getTime() - off * 60000);
                return local.toISOString().slice(0, 16);
            } catch {
                return "";
            }
        }

        /* ============================================================
           âœ… Best Pick ê´€ë¦¬ì ìŠ¬ë¡¯ ìƒì„± (grid ìì‹ìœ¼ë¡œ ì§ì ‘ ì‚½ì…)
        ============================================================ */
        (function buildBestPickGrid() {
            const host = document.getElementById("best_pick_grid");
            if (!host) return;

            const frag = document.createDocumentFragment();

            for (let i = 1; i <= BEST_PICK_MAX; i++) {
                const wrap = document.createElement("div");
                wrap.className = "w-full";

                wrap.innerHTML = `
          <div id="slot_best_pick_${i}"
            class="neo-card slot-banner best-circle aspect-square w-full flex items-center justify-center"
            data-position="best_pick_${i}"
            data-label="Best Pick ${i}"
            data-size="ê¶Œì¥ 1:1">
            <img class="slot-img hidden" alt="Best Pick ${i}">
            <div class="slot-default flex-col">
              <span class="font-bold text-sm">Best Pick ${i}</span>
              <span class="text-[10px] text-gray-500 mt-1">í´ë¦­í•˜ì—¬ ì„¤ì •</span>
            </div>
            <span class="slot-badge size">1:1</span>
            <span class="slot-badge store hidden"></span>
          </div>
        `;
                frag.appendChild(wrap);
            }

            // hostë¥¼ ì œê±°í•˜ê³  grid ë°”ë¡œ ì•„ë˜ë¡œ ë„£ê¸°
            host.replaceWith(...frag.childNodes);
        })();

        /* ============================================================
           âœ… ìŠ¬ë¡¯ ëª©ë¡ ìˆ˜ì§‘
        ============================================================ */
        function getAllSlotElements() {
            const baseIds = [
                "slot_index_main_top",
                "slot_index_main_visual",
                "slot_index_promo_1",
                "slot_index_promo_2",
                "slot_index_promo_3",
                "slot_index_sub_keywords",
                "slot_index_sub_news",
                "slot_index_sub_events",
                "slot_index_sub_recommends",
                "slot_index_food_delivery",
                "slot_index_all_stores",
                "slot_index_hot_place",
                "slot_index_suggest",
                "slot_index_open",
                "slot_index_store_pride",
                "slot_index_traditional",
                "slot_index_performing",
                "slot_index_event",
                "slot_index_localboard",
                "slot_index_season",
                "slot_index_join",
                "slot_index_support_review",
                "slot_index_support_empty",
                "slot_index_support_inquiry",
            ];

            const bestIds = [];
            for (let i = 1; i <= BEST_PICK_MAX; i++) bestIds.push(`slot_best_pick_${i}`);

            return [...baseIds, ...bestIds]
                .map(id => document.getElementById(id))
                .filter(Boolean);
        }

        /* ============================================================
           âœ… ì„œë²„ ìŠ¬ë¡¯ ë¡œë“œ (ë¯¸ë¦¬ë³´ê¸°)
        ============================================================ */
        async function fetchSlot(position, priority = null) {
            const qs = new URLSearchParams();
            qs.set("page", PAGE);
            qs.set("position", position);
            if (priority !== null && priority !== undefined && priority !== "") {
                qs.set("priority", String(priority));
            }

            const url = `/manager/ad/slot?${qs.toString()}`;
            const res = await fetch(url, { cache: "no-store" });
            if (!res.ok) return null;
            const json = await res.json().catch(() => null);
            if (!json || !pickOk(json)) return null;
            return pickSlot(json);
        }

        function applySlotToBox(box, slot) {
            const img = qs(".slot-img", box);
            const def = qs(".slot-default", box);
            const storeBadge = qs(".slot-badge.store", box);

            const imageUrl =
                slot?.image_url ||
                slot?.image ||
                slot?.img_url ||
                slot?.banner_url ||
                slot?.image_path ||
                "";

            const mode = slot?.slot_mode || slot?.slotMode || "";
            const businessName = slot?.business_name || slot?.businessName || "";
            const businessNo = slot?.business_no || slot?.businessNo || "";

            safeSetImage(img, imageUrl, def);

            if (storeBadge) {
                if (mode === "store" && (businessName || businessNo)) {
                    storeBadge.textContent = businessName ? businessName : businessNo;
                    storeBadge.classList.remove("hidden");
                } else {
                    storeBadge.classList.add("hidden");
                    storeBadge.textContent = "";
                }
            }
        }

        async function loadAllSlotsPreview() {
            const boxes = getAllSlotElements();
            await Promise.all(boxes.map(async (box) => {
                const position = box.dataset.position;
                if (!position) return;
                try {
                    const slot = await fetchSlot(position);
                    if (slot) applySlotToBox(box, slot);
                } catch (e) {
                    console.warn("slot preview fail:", position, e);
                }
            }));
        }

        /* ============================================================
           âœ… ì»¤ì„œ íˆ´íŒ
        ============================================================ */
        const hoverTip = document.getElementById("hoverTip");
        function bindHoverTooltip(box) {
            const label = box.dataset.label || box.dataset.position || "ìŠ¬ë¡¯";

            box.addEventListener("mouseenter", () => {
                if (!hoverTip) return;
                hoverTip.textContent = label;
                hoverTip.classList.add("show");
            });
            box.addEventListener("mousemove", (e) => {
                if (!hoverTip) return;
                hoverTip.style.left = e.clientX + "px";
                hoverTip.style.top = e.clientY + "px";
            });
            box.addEventListener("mouseleave", () => {
                if (!hoverTip) return;
                hoverTip.classList.remove("show");
            });
        }

        /* ============================================================
           âœ… ëª¨ë‹¬ ìƒíƒœ/ì—˜ë¦¬ë¨¼íŠ¸
        ============================================================ */
        const modalRoot = document.getElementById("modalRoot");
        const modalTitle = document.getElementById("modalTitle");
        const modalPositionText = document.getElementById("modalPositionText");
        const btnCloseModal = document.getElementById("btnCloseModal");
        const btnSaveSlot = document.getElementById("btnSaveSlot");
        const btnResetModal = document.getElementById("btnResetModal");

        const modeBlock = document.getElementById("modeBlock");
        const linkBlock = document.getElementById("linkBlock");
        const dividerAfterLink = document.getElementById("dividerAfterLink");
        const textBlock = document.getElementById("textBlock");
        const textOnlyHint = document.getElementById("textOnlyHint");

        const fieldTextContent = document.getElementById("fieldTextContent");

        const radioModes = () => qsa('input[name="slotMode"]');
        const imageBlock = document.getElementById("imageBlock");
        const storeBlock = document.getElementById("storeBlock");

        const fieldLinkUrl = document.getElementById("fieldLinkUrl");
        const fieldImageFile = document.getElementById("fieldImageFile");
        const currentPreviewImg = document.getElementById("currentPreviewImg");
        const currentPreviewEmpty = document.getElementById("currentPreviewEmpty");

        const fieldBizNo = document.getElementById("fieldBizNo");
        const fieldBizName = document.getElementById("fieldBizName");
        const fieldStoreId = document.getElementById("fieldStoreId");
        const btnSearchStore = document.getElementById("btnSearchStore");
        const storeResultsBody = document.getElementById("storeResultsBody");
        const storeSearchHint = document.getElementById("storeSearchHint");

        const fieldNoEnd = document.getElementById("fieldNoEnd");
        const fieldStartAt = document.getElementById("fieldStartAt");
        const fieldEndAt = document.getElementById("fieldEndAt");

        const textSelectedImage = document.getElementById("textSelectedImage");
        const textSelectedStore = document.getElementById("textSelectedStore");

        const adPriority = document.getElementById("adPriority");
        const btnLoadPriority = document.getElementById("btnLoadPriority");
        const btnDeletePriority = document.getElementById("btnDeletePriority");
        const candidateList = document.getElementById("candidateList");
        const prioritySupportHint = document.getElementById("prioritySupportHint");

        let activeBox = null;
        let activePosition = "";
        let activeLabel = "";
        let activeIsTextOnly = false;
        let lastLoadedSlot = null;

        let prioritySupportedCache = null; // null=ë¯¸í™•ì¸, true/false=í™•ì •

        function openModal() {
            modalRoot.classList.remove("hidden");
        }
        function closeModal() {
            modalRoot.classList.add("hidden");
            activeBox = null;
            activePosition = "";
            activeLabel = "";
            activeIsTextOnly = false;
            lastLoadedSlot = null;

            // ëª¨ë‹¬ ë‹«ì„ ë•Œ ë„ì›€ë§ë„ ë‹«ê¸°
            if (window.__closeAdHelp) window.__closeAdHelp();
        }

        function setModeUI(mode) {
            if (mode === "store") {
                storeBlock.classList.remove("hidden");
                imageBlock.classList.add("hidden");
            } else {
                imageBlock.classList.remove("hidden");
                storeBlock.classList.add("hidden");
            }
        }

        function getSelectedMode() {
            const r = radioModes().find(x => x.checked);
            return r ? r.value : "image";
        }

        function setSelectedMode(mode) {
            radioModes().forEach(r => r.checked = (r.value === mode));
            setModeUI(mode);
        }

        function setTextOnlyUI(isTextOnly) {
            activeIsTextOnly = !!isTextOnly;

            if (activeIsTextOnly) {
                textOnlyHint.classList.remove("hidden");
                modeBlock.classList.add("hidden");
                linkBlock.classList.add("hidden");
                dividerAfterLink.classList.add("hidden");
                imageBlock.classList.add("hidden");
                storeBlock.classList.add("hidden");
                textBlock.classList.remove("hidden");

                // í…ìŠ¤íŠ¸ ì „ìš©ì€ ìš”ì•½ìš© ë¼ë²¨ì„ â€œ-â€ ì²˜ë¦¬
                textSelectedImage.textContent = "-";
                textSelectedStore.textContent = "-";
            } else {
                textOnlyHint.classList.add("hidden");
                modeBlock.classList.remove("hidden");
                linkBlock.classList.remove("hidden");
                dividerAfterLink.classList.remove("hidden");
                textBlock.classList.add("hidden");

                // modeì— ë§ì¶° image/store ë³´ì—¬ì£¼ê¸°
                setModeUI(getSelectedMode());
            }
        }

        function updateSelectedSummary() {
            if (activeIsTextOnly) {
                textSelectedImage.textContent = "-";
                textSelectedStore.textContent = "-";
                return;
            }

            const file = fieldImageFile?.files?.[0];
            textSelectedImage.textContent = file ? file.name : (lastLoadedSlot?.image_url ? "ê¸°ì¡´ ì´ë¯¸ì§€ ì‚¬ìš©" : "ì—†ìŒ");

            const bn = fieldBizName.value?.trim();
            const bno = fieldBizNo.value?.trim();
            if (bn) textSelectedStore.textContent = bn;
            else if (bno) textSelectedStore.textContent = bno;
            else textSelectedStore.textContent = lastLoadedSlot?.business_name || "ì—†ìŒ";
        }

        function resetModalFields(keepMode = true) {
            if (!keepMode) setSelectedMode("image");

            if (fieldTextContent) fieldTextContent.value = "";

            fieldLinkUrl.value = "";

            fieldImageFile.value = "";
            if (currentPreviewImg) {
                currentPreviewImg.classList.add("hidden");
                currentPreviewImg.removeAttribute("src");
            }
            if (currentPreviewEmpty) currentPreviewEmpty.classList.remove("hidden");

            fieldBizNo.value = "";
            fieldBizName.value = "";
            fieldStoreId.value = "";
            if (storeResultsBody) {
                storeResultsBody.innerHTML = `<div class="text-sm text-gray-500">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ê³  â€œê°€ê²Œ ê²€ìƒ‰â€ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>`;
            }
            if (storeSearchHint) storeSearchHint.textContent = "";

            fieldStartAt.value = "";
            fieldEndAt.value = "";
            fieldNoEnd.checked = false;
            fieldEndAt.disabled = false;

            if (adPriority) adPriority.value = "1";

            textSelectedImage.textContent = activeIsTextOnly ? "-" : "ì—†ìŒ";
            textSelectedStore.textContent = activeIsTextOnly ? "-" : "ì—†ìŒ";

            // í›„ë³´ ë¦¬ìŠ¤íŠ¸ ë¹„ìš°ê¸°
            if (candidateList) candidateList.innerHTML = "";
            if (prioritySupportHint) prioritySupportHint.textContent = "";
        }

        function applyNoEndState() {
            const checked = fieldNoEnd.checked;
            fieldEndAt.disabled = checked;
            if (checked) fieldEndAt.value = "";
        }

        /* ============================================================
           âœ… ìš°ì„ ìˆœìœ„(í›„ë³´) ê¸°ëŠ¥ ì§€ì› ì—¬ë¶€ ì²´í¬
           - ì„œë²„ì— /manager/ad/slot-items ê°€ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ë¹„í™œì„±í™”
        ============================================================ */
        async function detectPrioritySupportOnce() {
            if (prioritySupportedCache !== null) return prioritySupportedCache;

            try {
                // ì•„ë¬´ positionìœ¼ë¡œ ê°€ë³ê²Œ ì²´í¬
                const testPos = activePosition || "index_main_top";
                const r = await fetch(`/manager/ad/slot-items?page=${encodeURIComponent(PAGE)}&position=${encodeURIComponent(testPos)}`, { cache: "no-store" });
                if (!r.ok) {
                    prioritySupportedCache = false;
                    return false;
                }
                const j = await r.json().catch(() => null);
                // ì„±ê³µ í˜•íƒœê°€ ë‹¬ë¼ë„, items ë°°ì—´ì´ ìˆìœ¼ë©´ ì§€ì›ìœ¼ë¡œ ê°„ì£¼
                prioritySupportedCache = !!(j && (j.success || j.ok) && Array.isArray(j.items));
                return prioritySupportedCache;
            } catch (e) {
                prioritySupportedCache = false;
                return false;
            }
        }

        function setPriorityButtonsEnabled(enabled) {
            if (!btnLoadPriority || !btnDeletePriority) return;
            btnLoadPriority.disabled = !enabled;
            btnDeletePriority.disabled = !enabled;

            btnLoadPriority.classList.toggle("opacity-50", !enabled);
            btnDeletePriority.classList.toggle("opacity-50", !enabled);
            btnLoadPriority.classList.toggle("cursor-not-allowed", !enabled);
            btnDeletePriority.classList.toggle("cursor-not-allowed", !enabled);
        }

        async function refreshCandidates() {
            if (!candidateList) return;

            const supported = await detectPrioritySupportOnce();
            if (!supported) {
                setPriorityButtonsEnabled(false);
                prioritySupportHint.textContent = "âš ï¸ ì„œë²„ì— ìš°ì„ ìˆœìœ„(í›„ë³´) APIê°€ ì—†ì–´ í›„ë³´ ëª©ë¡/ë¶ˆëŸ¬ì˜¤ê¸°/ì‚­ì œê°€ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.";
                candidateList.innerHTML = `<div class="text-sm text-gray-500">í›„ë³´ ê¸°ëŠ¥ ë¯¸ì§€ì› ìƒíƒœì…ë‹ˆë‹¤.</div>`;
                return;
            }

            setPriorityButtonsEnabled(true);
            prioritySupportHint.textContent = "âœ… í›„ë³´ ê¸°ëŠ¥ ì§€ì›ë¨: ìš°ì„ ìˆœìœ„ë³„ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°/ì‚­ì œ ê°€ëŠ¥";

            try {
                const res = await fetch(`/manager/ad/slot-items?page=${encodeURIComponent(PAGE)}&position=${encodeURIComponent(activePosition)}`, { cache: "no-store" });
                const data = await res.json().catch(() => null);

                candidateList.innerHTML = "";

                if (!data || !(data.success || data.ok) || !Array.isArray(data.items) || data.items.length === 0) {
                    candidateList.innerHTML = `<div class="text-sm text-gray-500">ë“±ë¡ëœ í›„ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                    return;
                }

                for (const it of data.items) {
                    const pr = it.priority ?? "-";
                    const img = it.image_url
                        ? `<img src="${withBust(toAbs(it.image_url))}" class="w-12 h-12 rounded-lg object-cover border" />`
                        : `<div class="w-12 h-12 rounded-lg bg-gray-100 border"></div>`;

                    const activeHint = (it.no_end || it.end_at_local || it.start_at_local)
                        ? `<div class="text-xs text-gray-500">ê¸°ê°„: ${it.start_at_local || "-"} ~ ${it.no_end ? "ë¬´ê¸°í•œ" : (it.end_at_local || "-")}</div>`
                        : `<div class="text-xs text-gray-400">ê¸°ê°„ ë¯¸ì„¤ì •</div>`;

                    const titleLine = it.business_name || it.link_url || (it.text_content ? it.text_content.split("\n")[0] : "") || "(ë‚´ìš© ì—†ìŒ)";

                    const row = document.createElement("button");
                    row.type = "button";
                    row.className = "w-full text-left p-3 rounded-xl border border-gray-200 bg-white hover:bg-gray-50 flex gap-3 items-center";
                    row.innerHTML = `
            ${img}
            <div class="flex-1">
              <div class="text-sm font-semibold text-gray-800">ìš°ì„ ìˆœìœ„ ${pr}</div>
              <div class="text-xs text-gray-600">${escapeHtml(titleLine)}</div>
              ${activeHint}
            </div>
          `;

                    row.addEventListener("click", async () => {
                        const p = it.priority ?? 1;
                        if (adPriority) adPriority.value = String(p);
                        const slot = await fetchSlot(activePosition, p);
                        if (slot) fillModalFromSlot(slot);
                    });

                    candidateList.appendChild(row);
                }
            } catch (e) {
                candidateList.innerHTML = `<div class="text-sm text-red-500">í›„ë³´ ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>`;
            }
        }

        function escapeHtml(s) {
            return String(s || "")
                .replaceAll("&", "&amp;")
                .replaceAll("<", "&lt;")
                .replaceAll(">", "&gt;")
                .replaceAll('"', "&quot;")
                .replaceAll("'", "&#039;");
        }

        /* ============================================================
           âœ… ê¸°ì¡´ ìŠ¬ë¡¯ ë°ì´í„° â†’ ëª¨ë‹¬ í”„ë¦¬í•„
        ============================================================ */
        function fillModalFromSlot(slot) {
            lastLoadedSlot = slot;

            // priority
            const pr = slot?.priority ?? slot?.ad_priority ?? null;
            if (pr !== null && pr !== undefined && pr !== "" && adPriority) {
                adPriority.value = String(pr);
            }

            // ê¸°ê°„
            const start = slot?.start_at_local || slot?.start_at || slot?.startAt || slot?.start_date || slot?.startDate || "";
            const end = slot?.end_at_local || slot?.end_at || slot?.endAt || slot?.end_date || slot?.endDate || "";

            fieldStartAt.value = normalizeDateTimeForInput(start);
            fieldEndAt.value = normalizeDateTimeForInput(end);
            fieldNoEnd.checked = !fieldEndAt.value;
            applyNoEndState();

            if (activeIsTextOnly) {
                // í…ìŠ¤íŠ¸
                const tc = slot?.text_content ?? slot?.textContent ?? slot?.content ?? "";
                if (fieldTextContent) fieldTextContent.value = tc || "";
                updateSelectedSummary();
                return;
            }

            // ëª¨ë“œ
            const mode = slot?.slot_mode || slot?.slotMode || "image";
            setSelectedMode(mode === "store" ? "store" : "image");

            // ë§í¬
            const link = slot?.link_url || slot?.linkUrl || slot?.link || slot?.href || "";
            fieldLinkUrl.value = link || "";

            // ê°€ê²Œ ì—°ê²°
            const businessName = slot?.business_name || slot?.businessName || "";
            const businessNo = slot?.business_no || slot?.businessNo || "";
            const storeId = slot?.store_id || slot?.storeId || "";

            fieldBizName.value = businessName || "";
            fieldBizNo.value = businessNo || "";
            fieldStoreId.value = storeId || "";

            // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
            const imageUrl =
                slot?.image_url ||
                slot?.image ||
                slot?.img_url ||
                slot?.banner_url ||
                slot?.image_path ||
                "";

            if (imageUrl && currentPreviewImg) {
                currentPreviewImg.src = withBust(toAbs(imageUrl));
                currentPreviewImg.classList.remove("hidden");
                if (currentPreviewEmpty) currentPreviewEmpty.classList.add("hidden");
            } else {
                currentPreviewImg?.classList.add("hidden");
                currentPreviewEmpty?.classList.remove("hidden");
            }

            updateSelectedSummary();
        }

        /* ============================================================
           âœ… ê°€ê²Œ ê²€ìƒ‰
        ============================================================ */
        async function searchStores() {
            const bizNo = fieldBizNo.value.trim();
            const name = fieldBizName.value.trim();

            if (!bizNo && !name) {
                storeSearchHint.textContent = "ì‚¬ì—…ìë²ˆí˜¸ ë˜ëŠ” ìƒí˜¸ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                storeSearchHint.className = "text-xs text-red-500";
                return;
            }

            storeSearchHint.textContent = "ê²€ìƒ‰ ì¤‘...";
            storeSearchHint.className = "text-xs text-gray-500";

            const params = new URLSearchParams();
            if (bizNo) params.set("bizNo", bizNo);
            if (name) params.set("q", name); // âœ… ì„œë²„ ê²€ìƒ‰ì€ q ë˜ëŠ” bizNoë¡œ ë“¤ì–´ê°€ê²Œ

            try {
                const res = await fetch(`/manager/ad/store/search?${params.toString()}`, { cache: "no-store" });
                const json = await res.json().catch(() => ({}));

                const stores = json?.stores || json?.data || json?.results || [];

                if (!res.ok || !Array.isArray(stores) || stores.length === 0) {
                    storeResultsBody.innerHTML = `<div class="text-sm text-gray-500">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                    storeSearchHint.textContent = "ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ";
                    storeSearchHint.className = "text-xs text-gray-500";
                    return;
                }

                storeSearchHint.textContent = `${stores.length}ê±´ ê²€ìƒ‰ë¨`;
                storeSearchHint.className = "text-xs text-emerald-600";

                storeResultsBody.innerHTML = `
          <div class="space-y-2">
            ${stores.map((s, idx) => {
                    const id = s.id ?? s.store_id ?? "";
                    const bn = s.business_name ?? s.name ?? s.store_name ?? "";
                    const bno = s.business_no ?? s.biz_no ?? s.bizNo ?? "";
                    const cat = s.business_category ?? s.category ?? s.store_category ?? "";
                    return `
                <button
                  class="w-full text-left px-3 py-3 rounded-lg border border-slate-100 hover:border-emerald-200 hover:bg-emerald-50 transition"
                  data-store-idx="${idx}">
                  <div class="flex items-center justify-between gap-2">
                    <div class="font-semibold text-slate-800">${escapeHtml(bn || "(ìƒí˜¸ëª… ì—†ìŒ)")}</div>
                    <div class="text-[10px] text-slate-500">ID: ${escapeHtml(id || "-")}</div>
                  </div>
                  <div class="mt-1 text-xs text-slate-500">
                    <span class="mr-2">ì‚¬ì—…ìë²ˆí˜¸: <b>${escapeHtml(bno || "-")}</b></span>
                    <span>ì—…ì¢…: ${escapeHtml(cat || "-")}</span>
                  </div>
                </button>
              `;
                }).join("")}
          </div>
        `;

                qsa("button[data-store-idx]", storeResultsBody).forEach(btn => {
                    btn.addEventListener("click", () => {
                        const idx = Number(btn.dataset.storeIdx);
                        const s = stores[idx];
                        if (!s) return;

                        const id = s.id ?? s.store_id ?? "";
                        const bn = s.business_name ?? s.name ?? s.store_name ?? "";
                        const bno = s.business_no ?? s.biz_no ?? s.bizNo ?? "";

                        fieldStoreId.value = id ? String(id) : "";
                        fieldBizName.value = bn || "";
                        fieldBizNo.value = bno || "";

                        if (!fieldLinkUrl.value.trim() && id) {
                            fieldLinkUrl.value = `/ndetail.html?id=${id}&type=store`;
                        }

                        updateSelectedSummary();
                    });
                });

            } catch (e) {
                storeResultsBody.innerHTML = `<div class="text-sm text-red-500">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>`;
                storeSearchHint.textContent = "ê²€ìƒ‰ ì‹¤íŒ¨";
                storeSearchHint.className = "text-xs text-red-500";
            }
        }

        /* ============================================================
           âœ… ì €ì¥ ìš”ì²­
        ============================================================ */
        async function saveSlot() {
            if (!activePosition) return;

            const fd = new FormData();
            fd.append("page", PAGE);
            fd.append("position", activePosition);

            // priority
            const pr = Number(adPriority?.value || 1);
            if (!Number.isNaN(pr) && pr >= 1) {
                fd.append("priority", String(pr));
            }

            // ê¸°ê°„
            const startAt = fieldStartAt.value;
            const endAt = fieldNoEnd.checked ? "" : fieldEndAt.value;

            if (startAt) { fd.append("startAt", startAt); fd.append("start_at", startAt); }
            if (endAt) { fd.append("endAt", endAt); fd.append("end_at", endAt); }

            fd.append("noEnd", fieldNoEnd.checked ? "1" : "0");
            fd.append("no_end", fieldNoEnd.checked ? "1" : "0");

            // âœ… í…ìŠ¤íŠ¸ ì „ìš©
            if (activeIsTextOnly) {
                const textContent = (fieldTextContent?.value || "").trim();

                fd.append("slotType", "text");
                fd.append("slot_type", "text");
                fd.append("slotMode", "custom");
                fd.append("slot_mode", "custom");

                fd.append("textContent", textContent);
                fd.append("text_content", textContent);
            } else {
                // âœ… ì¼ë°˜ ë°°ë„ˆ
                const mode = getSelectedMode();

                fd.append("slotType", "banner");
                fd.append("slot_type", "banner");
                fd.append("slotMode", mode);
                fd.append("slot_mode", mode);

                const linkUrl = fieldLinkUrl.value.trim();
                if (linkUrl) {
                    fd.append("linkUrl", linkUrl);
                    fd.append("link_url", linkUrl);
                    fd.append("link", linkUrl);
                }

                if (mode === "store") {
                    const storeId = fieldStoreId.value.trim();
                    const businessNo = fieldBizNo.value.trim();
                    const businessName = fieldBizName.value.trim();

                    if (storeId) { fd.append("storeId", storeId); fd.append("store_id", storeId); }
                    if (businessNo) { fd.append("businessNo", businessNo); fd.append("business_no", businessNo); fd.append("bizNo", businessNo); }
                    if (businessName) { fd.append("businessName", businessName); fd.append("business_name", businessName); }
                }

                const file = fieldImageFile?.files?.[0];
                if (mode === "image" && file) {
                    fd.append("image", file);
                    fd.append("slotImage", file);
                }
            }

            btnSaveSlot.disabled = true;
            btnSaveSlot.textContent = "ì €ì¥ ì¤‘...";

            try {
                const res = await fetch("/manager/ad/slot", {
                    method: "POST",
                    body: fd
                });

                const json = await res.json().catch(() => ({}));

                if (!res.ok || !pickOk(json)) {
                    alert("ì €ì¥ ì‹¤íŒ¨: ì„œë²„ ì‘ë‹µì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                    console.error("save fail:", json);
                    return;
                }

                // ì €ì¥ í›„ ë¯¸ë¦¬ë³´ê¸° ê°±ì‹ (ê¸°ë³¸ ìŠ¬ë¡¯)
                const slot = await fetchSlot(activePosition);
                if (slot && activeBox) applySlotToBox(activeBox, slot);

                // í›„ë³´ ê¸°ëŠ¥ ì§€ì›ì´ë©´ ëª©ë¡ ê°±ì‹ 
                await refreshCandidates();

                closeModal();

            } catch (e) {
                console.error("save error:", e);
                alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            } finally {
                btnSaveSlot.disabled = false;
                btnSaveSlot.textContent = "ìŠ¬ë¡¯ ì €ì¥";
            }
        }

        /* ============================================================
           âœ… ìš°ì„ ìˆœìœ„ ë¶ˆëŸ¬ì˜¤ê¸° / ì‚­ì œ
           - ì„œë²„ ì§€ì› ì—†ìœ¼ë©´ ë¹„í™œì„±í™”
        ============================================================ */
        async function loadPriority() {
            const supported = await detectPrioritySupportOnce();
            if (!supported) return;

            const pr = Number(adPriority?.value || 1);
            const slot = await fetchSlot(activePosition, pr);
            if (slot) fillModalFromSlot(slot);
            await refreshCandidates();
        }

        async function deletePriority() {
            const supported = await detectPrioritySupportOnce();
            if (!supported) return;

            const pr = Number(adPriority?.value || 1);
            if (!confirm(`ìš°ì„ ìˆœìœ„ ${pr} í›„ë³´ë¥¼ ì‚­ì œí• ê¹Œìš”?`)) return;

            try {
                // âœ… ìš°ì„ ìˆœìœ„ ì‚­ì œëŠ” ì„œë²„ êµ¬í˜„ ë°©ì‹ì— ë”°ë¼ ë‹¬ë¼ì„œ,
                // ì—¬ê¸°ì„œëŠ” "priority ì¿¼ë¦¬ í¬í•¨ DELETE /manager/ad/slot" ë°©ì‹ ì‹œë„
                const qs = new URLSearchParams();
                qs.set("page", PAGE);
                qs.set("position", activePosition);
                qs.set("priority", String(pr));

                const res = await fetch(`/manager/ad/slot?${qs.toString()}`, { method: "DELETE" });
                const json = await res.json().catch(() => ({}));

                if (!res.ok || !pickOk(json)) {
                    alert(json?.error || "ì‚­ì œ ì‹¤íŒ¨(ì„œë²„ êµ¬í˜„ í™•ì¸ í•„ìš”)");
                    return;
                }

                await refreshCandidates();
                // ê¸°ë³¸ ìŠ¬ë¡¯ ë¯¸ë¦¬ë³´ê¸° ê°±ì‹ (ì•ˆì „)
                const slot = await fetchSlot(activePosition);
                if (slot && activeBox) applySlotToBox(activeBox, slot);

                alert("ì‚­ì œ ì™„ë£Œ");
            } catch (e) {
                alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜");
            }
        }

        /* ============================================================
           âœ… ë°•ìŠ¤ í´ë¦­ â†’ ëª¨ë‹¬ ì˜¤í”ˆ
        ============================================================ */
        async function handleBoxClick(box) {
            activeBox = box;
            activePosition = box.dataset.position || "";
            activeLabel = box.dataset.label || activePosition;

            if (!activePosition) return;

            // modal dataset ê¸°ë¡
            modalRoot.dataset.page = PAGE;
            modalRoot.dataset.position = activePosition;

            // í…ìŠ¤íŠ¸ ì „ìš© ì—¬ë¶€
            setTextOnlyUI(TEXT_ONLY_POSITIONS.has(activePosition));

            modalTitle.textContent = activeLabel || "ìŠ¬ë¡¯ ìˆ˜ì •";
            modalPositionText.textContent = activePosition;

            resetModalFields(true);

            if (!activeIsTextOnly) {
                setSelectedMode("image"); // ê¸°ë³¸ ëª¨ë“œ
            }

            try {
                const slot = await fetchSlot(activePosition);
                if (slot) fillModalFromSlot(slot);
                else updateSelectedSummary();
            } catch (e) {
                console.warn("modal preload fail:", activePosition, e);
            }

            // í›„ë³´ ëª©ë¡ì€ ëª¨ë‹¬ ì—´ ë•Œ ê°±ì‹ 
            await refreshCandidates();

            openModal();
        }

        /* ============================================================
           âœ… ì´ë²¤íŠ¸ ë°”ì¸ë”©
        ============================================================ */
        function bindAllBoxes() {
            const boxes = getAllSlotElements();
            boxes.forEach(box => {
                bindHoverTooltip(box);
                box.addEventListener("click", () => handleBoxClick(box));
            });
        }

        radioModes().forEach(r => {
            r.addEventListener("change", () => {
                if (activeIsTextOnly) return;
                setModeUI(getSelectedMode());
                updateSelectedSummary();
            });
        });

        fieldImageFile?.addEventListener("change", () => {
            if (activeIsTextOnly) return;
            const file = fieldImageFile.files?.[0];
            textSelectedImage.textContent = file ? file.name : "ì—†ìŒ";
        });

        [fieldBizNo, fieldBizName].forEach(el => {
            el?.addEventListener("input", updateSelectedSummary);
        });

        fieldNoEnd?.addEventListener("change", applyNoEndState);

        btnSearchStore?.addEventListener("click", searchStores);

        btnCloseModal?.addEventListener("click", closeModal);
        qs(".modal-backdrop", modalRoot)?.addEventListener("click", closeModal);

        btnResetModal?.addEventListener("click", () => resetModalFields(true));
        btnSaveSlot?.addEventListener("click", saveSlot);

        btnLoadPriority?.addEventListener("click", loadPriority);
        btnDeletePriority?.addEventListener("click", deletePriority);

        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && !modalRoot.classList.contains("hidden")) {
                closeModal();
            }
        });

        /* ============================================================
           âœ… ëª¨ë‹¬ ì‚¬ìš©ë²• íŒì˜¤ë²„ í† ê¸€
        ============================================================ */
        (function () {
            const btn = document.getElementById("adHelpBtn");
            const pop = document.getElementById("adHelpPopover");
            const closeBtn = document.getElementById("adHelpCloseBtn");
            if (!btn || !pop) return;

            function openHelp() {
                pop.classList.remove("hidden");
                btn.setAttribute("aria-expanded", "true");
            }
            function closeHelp() {
                pop.classList.add("hidden");
                btn.setAttribute("aria-expanded", "false");
            }
            function toggleHelp(e) {
                e.preventDefault();
                e.stopPropagation();
                if (pop.classList.contains("hidden")) openHelp();
                else closeHelp();
            }

            btn.addEventListener("click", toggleHelp);
            if (closeBtn) closeBtn.addEventListener("click", (e) => {
                e.preventDefault();
                e.stopPropagation();
                closeHelp();
            });

            pop.addEventListener("click", (e) => e.stopPropagation());
            document.addEventListener("click", () => closeHelp());
            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape") closeHelp();
            });

            window.__closeAdHelp = closeHelp;
        })();

        /* ============================================================
           âœ… ì´ˆê¸° ë¡œë“œ
        ============================================================ */
        document.addEventListener("DOMContentLoaded", async () => {
            bindAllBoxes();
            await loadAllSlotsPreview();
        });
    </script>
</body>

</html>