<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MALL HANKOOK | FOOD CATEGORY 광고 관리자</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Noto Sans KR', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .neo-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      box-shadow:
        6px 6px 16px rgba(15, 23, 42, 0.15),
        -4px -4px 12px rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(12px);
      transition: all 0.2s ease;
    }

    .neo-card:hover {
      transform: translateY(-3px);
      box-shadow:
        10px 10px 24px rgba(15, 23, 42, 0.18),
        -6px -6px 16px rgba(255, 255, 255, 0.95);
    }

    .slot-card {
      cursor: pointer;
    }

    .slot-card-header-badge {
      font-size: 11px;
      letter-spacing: 0.05em;
    }

    /* 모달 공통 */
    #modalRoot {
      position: fixed;
      inset: 0;
      z-index: 9999;
    }

    #modalRoot.hidden {
      display: none;
    }

    #modalRoot .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.55);
    }

    #modalRoot .modal-panel {
      position: relative;
      margin: 0 auto;
      width: min(960px, 100% - 32px);
      max-height: 90vh;
      top: 50%;
      transform: translateY(-50%);
      overflow: auto;
    }

    #modalRoot .modal-card {
      border-radius: 1.25rem;
      background: rgba(255, 255, 255, 0.98);
      border: 2px solid rgba(59, 130, 246, 0.18);
      box-shadow: 0 18px 60px rgba(15, 23, 42, 0.40);
      backdrop-filter: blur(16px);
      overflow: hidden;
    }

    .field {
      width: 100%;
      border-radius: 0.9rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 0.55rem 0.75rem;
      background: rgba(255, 255, 255, 0.96);
      outline: none;
      font-size: 0.9rem;
    }

    .field:focus {
      border-color: rgba(59, 130, 246, 0.7);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.18);
    }

    textarea.field {
      min-height: 120px;
      resize: vertical;
    }

    .divider {
      height: 1px;
      background: linear-gradient(90deg,
          rgba(226, 232, 240, 0),
          rgba(148, 163, 184, 0.6),
          rgba(226, 232, 240, 0));
    }

    .result-item {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 0.6rem 0.75rem;
      background: rgba(248, 250, 252, 0.9);
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease;
    }

    .result-item:hover {
      transform: translateY(-1px);
      border-color: rgba(59, 130, 246, 0.6);
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.18);
      background: #ffffff;
    }

    .badge-pill {
      border-radius: 9999px;
      padding: 0.15rem 0.55rem;
      font-size: 11px;
      font-weight: 700;
    }
  </style>
</head>

<body class="bg-gradient-to-br from-blue-50 via-white to-sky-100 min-h-screen text-slate-800">
  <!-- header.html -->
  <div id="header-placeholder"></div>

  <main class="max-w-7xl mx-auto px-4 py-6 space-y-6">
    <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <div>
        <h1 class="text-2xl sm:text-3xl font-extrabold text-blue-700">
          FOOD CATEGORY 광고 관리자
        </h1>
        <p class="text-sm text-slate-600 mt-1">
          FOOD 카테고리 페이지의 배너/파워/최고의 가게/사이드 광고를 관리합니다.
        </p>
      </div>

      <div class="flex flex-wrap gap-2 text-xs text-slate-600">
        <span class="badge-pill bg-white border border-slate-200 shadow">
          page: <span class="font-semibold text-blue-700">foodcategory</span>
        </span>
        <span class="badge-pill bg-blue-50 border border-blue-200 text-blue-700">
          슬롯 클릭 → 모달에서 설정 후 저장
        </span>
      </div>
    </header>

    <!-- 상단 안내 -->
    <section class="neo-card p-4 flex flex-col md:flex-row gap-4 items-start">
      <div class="flex-1">
        <h2 class="text-sm font-bold text-slate-800 mb-1">사용법 요약</h2>
        <ol class="text-xs text-slate-600 space-y-1 list-decimal pl-4">
          <li>아래 슬롯(카드)을 클릭하면 모달이 열립니다.</li>
          <li>광고 방식 (이미지 / 가게 연결 / 텍스트)을 선택합니다.</li>
          <li>가게 연결 시 검색 → 선택하면 <b>가게 썸네일</b>과 <b>업종</b>이 자동으로 연결됩니다.</li>
          <li>저장 후 FOOD 카테고리 페이지에서 광고가 노출됩니다.</li>
        </ol>
      </div>
      <div class="w-full md:w-64 text-xs space-y-1">
        <div class="font-bold text-slate-800">표기 예시</div>
        <div class="rounded-xl bg-blue-50/80 border border-blue-200 px-3 py-2">
          <div class="text-sm font-extrabold text-slate-900">
            하늘식당 <span class="text-[11px] text-slate-500 font-semibold">(음식점)</span>
          </div>
          <div class="text-[11px] text-slate-500 mt-1">
            가게 연결 시 이렇게 표시됩니다.
          </div>
        </div>
      </div>
    </section>

    <!-- 메인 영역 / 최고의 가게 / 사이드 광고 -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <!-- 메인 영역 & 파워 -->
      <div class="lg:col-span-2 space-y-4">
        <!-- 메인 영역 -->
        <div class="neo-card p-4 space-y-3">
          <div class="flex items-center justify-between">
            <div>
              <div class="slot-card-header-badge text-slate-500 font-semibold uppercase">Main Area</div>
              <h2 class="text-base font-extrabold text-slate-900">메인 배너 & 파워 광고</h2>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <!-- 메인 배너 -->
            <div class="slot-card neo-card p-3 space-y-2" data-page="foodcategory"
              data-position="food_main_banner" data-label="메인 배너">
              <div class="flex items-center justify-between gap-2 mb-1">
                <div>
                  <div class="text-[11px] text-slate-500 uppercase font-semibold">Hero</div>
                  <div class="text-sm font-bold text-slate-900">메인 배너</div>
                </div>
                <span class="badge-pill bg-blue-50 border border-blue-200 text-blue-700">수정</span>
              </div>
              <div class="relative rounded-xl border border-slate-200 bg-slate-50 overflow-hidden">
                <div class="aspect-[16/9] w-full relative">
                  <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="미리보기">
                  <div
                    class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[11px] text-slate-400 font-semibold">
                    아직 등록된 내용이 없습니다.
                  </div>
                </div>
                <div
                  class="border-t border-slate-100 bg-white/90 px-3 py-2 flex items-center justify-between gap-2 text-xs">
                  <div class="font-bold text-slate-800 truncate">
                    <span class="slot-preview-title">제목 없음</span>
                    <span class="slot-preview-biztype text-[11px] text-slate-500"></span>
                  </div>
                  <div class="slot-preview-meta text-[10px] text-slate-400 font-semibold">미등록</div>
                </div>
              </div>
            </div>

            <!-- MVP -->
            <div class="slot-card neo-card p-3 space-y-2" data-page="foodcategory"
              data-position="food_mvp" data-label="MVP">
              <div class="flex items-center justify-between gap-2 mb-1">
                <div>
                  <div class="text-[11px] text-slate-500 uppercase font-semibold">Top</div>
                  <div class="text-sm font-bold text-slate-900">MVP</div>
                </div>
                <span class="badge-pill bg-amber-50 border border-amber-200 text-amber-700">수정</span>
              </div>
              <div class="relative rounded-xl border border-slate-200 bg-slate-50 overflow-hidden">
                <div class="aspect-[4/3] w-full relative">
                  <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="미리보기">
                  <div
                    class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[11px] text-slate-400 font-semibold">
                    아직 등록된 내용이 없습니다.
                  </div>
                </div>
                <div
                  class="border-t border-slate-100 bg-white/90 px-3 py-2 flex items-center justify-between gap-2 text-xs">
                  <div class="font-bold text-slate-800 truncate">
                    <span class="slot-preview-title">제목 없음</span>
                    <span class="slot-preview-biztype text-[11px] text-slate-500"></span>
                  </div>
                  <div class="slot-preview-meta text-[10px] text-slate-400 font-semibold">미등록</div>
                </div>
              </div>
            </div>

            <!-- HIGHLIGHT -->
            <div class="slot-card neo-card p-3 space-y-2" data-page="foodcategory"
              data-position="food_highlight" data-label="HIGHLIGHT">
              <div class="flex items-center justify-between gap-2 mb-1">
                <div>
                  <div class="text-[11px] text-slate-500 uppercase font-semibold">Top</div>
                  <div class="text-sm font-bold text-slate-900">HIGHLIGHT</div>
                </div>
                <span class="badge-pill bg-yellow-50 border border-yellow-200 text-yellow-700">수정</span>
              </div>
              <div class="relative rounded-xl border border-slate-200 bg-slate-50 overflow-hidden">
                <div class="aspect-[4/3] w-full relative">
                  <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="미리보기">
                  <div
                    class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[11px] text-slate-400 font-semibold">
                    아직 등록된 내용이 없습니다.
                  </div>
                </div>
                <div
                  class="border-t border-slate-100 bg-white/90 px-3 py-2 flex items-center justify-between gap-2 text-xs">
                  <div class="font-bold text-slate-800 truncate">
                    <span class="slot-preview-title">제목 없음</span>
                    <span class="slot-preview-biztype text-[11px] text-slate-500"></span>
                  </div>
                  <div class="slot-preview-meta text-[10px] text-slate-400 font-semibold">미등록</div>
                </div>
              </div>
            </div>

            <!-- 파워 광고 1~9 간단 카드 -->
            <div class="neo-card p-3 space-y-2">
              <div class="flex items-center justify-between mb-1">
                <div>
                  <div class="slot-card-header-badge text-slate-500 font-semibold uppercase">Power Ads</div>
                  <div class="text-sm font-bold text-slate-900">파워 광고 1~9</div>
                </div>
              </div>
              <div class="grid grid-cols-3 gap-2 text-xs">
                <!-- 9개 파워 슬롯 -->
                <div class="slot-card neo-card p-2 space-y-1" data-page="foodcategory"
                  data-position="food_power_1" data-label="파워 광고 1">
                  <div class="flex items-center justify-between">
                    <span class="font-bold text-slate-800">POWER 1</span>
                    <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
                  </div>
                  <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                    <div class="aspect-[4/3] w-full relative">
                      <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="미리보기">
                      <div
                        class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                        미등록
                      </div>
                    </div>
                  </div>
                  <div class="text-[10px] mt-1">
                    <span class="slot-preview-title font-bold"></span>
                    <span class="slot-preview-biztype text-slate-500"></span>
                  </div>
                </div>

                <div class="slot-card neo-card p-2 space-y-1" data-page="foodcategory"
                  data-position="food_power_2" data-label="파워 광고 2">
                  <div class="flex items-center justify-between">
                    <span class="font-bold text-slate-800">POWER 2</span>
                    <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
                  </div>
                  <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                    <div class="aspect-[4/3] w-full relative">
                      <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="미리보기">
                      <div
                        class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                        미등록
                      </div>
                    </div>
                  </div>
                  <div class="text-[10px] mt-1">
                    <span class="slot-preview-title font-bold"></span>
                    <span class="slot-preview-biztype text-slate-500"></span>
                  </div>
                </div>

                <div class="slot-card neo-card p-2 space-y-1" data-page="foodcategory"
                  data-position="food_power_3" data-label="파워 광고 3">
                  <div class="flex items-center justify-between">
                    <span class="font-bold text-slate-800">POWER 3</span>
                    <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
                  </div>
                  <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                    <div class="aspect-[4/3] w-full relative">
                      <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="미리보기">
                      <div
                        class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                        미등록
                      </div>
                    </div>
                  </div>
                  <div class="text-[10px] mt-1">
                    <span class="slot-preview-title font-bold"></span>
                    <span class="slot-preview-biztype text-slate-500"></span>
                  </div>
                </div>

                <!-- 4~6 -->
                <div class="slot-card neo-card p-2 space-y-1" data-page="foodcategory"
                  data-position="food_power_4" data-label="파워 광고 4">
                  <div class="flex items-center justify-between">
                    <span class="font-bold text-slate-800">POWER 4</span>
                    <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
                  </div>
                  <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                    <div class="aspect-[4/3] w-full relative">
                      <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="미리보기">
                      <div
                        class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                        미등록
                      </div>
                    </div>
                  </div>
                  <div class="text-[10px] mt-1">
                    <span class="slot-preview-title font-bold"></span>
                    <span class="slot-preview-biztype text-slate-500"></span>
                  </div>
                </div>

                <div class="slot-card neo-card p-2 space-y-1" data-page="foodcategory"
                  data-position="food_power_5" data-label="파워 광고 5">
                  <div class="flex items-center justify-between">
                    <span class="font-bold text-slate-800">POWER 5</span>
                    <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
                  </div>
                  <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                    <div class="aspect-[4/3] w-full relative">
                      <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="미리보기">
                      <div
                        class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                        미등록
                      </div>
                    </div>
                  </div>
                  <div class="text-[10px] mt-1">
                    <span class="slot-preview-title font-bold"></span>
                    <span class="slot-preview-biztype text-slate-500"></span>
                  </div>
                </div>

                <div class="slot-card neo-card p-2 space-y-1" data-page="foodcategory"
                  data-position="food_power_6" data-label="파워 광고 6">
                  <div class="flex items-center justify-between">
                    <span class="font-bold text-slate-800">POWER 6</span>
                    <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
                  </div>
                  <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                    <div class="aspect-[4/3] w-full relative">
                      <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="미리보기">
                      <div
                        class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                        미등록
                      </div>
                    </div>
                  </div>
                  <div class="text-[10px] mt-1">
                    <span class="slot-preview-title font-bold"></span>
                    <span class="slot-preview-biztype text-slate-500"></span>
                  </div>
                </div>

                <!-- 7~9 -->
                <div class="slot-card neo-card p-2 space-y-1" data-page="foodcategory"
                  data-position="food_power_7" data-label="파워 광고 7">
                  <div class="flex items-center justify-between">
                    <span class="font-bold text-slate-800">POWER 7</span>
                    <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
                  </div>
                  <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                    <div class="aspect-[4/3] w-full relative">
                      <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="미리보기">
                      <div
                        class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                        미등록
                      </div>
                    </div>
                  </div>
                  <div class="text-[10px] mt-1">
                    <span class="slot-preview-title font-bold"></span>
                    <span class="slot-preview-biztype text-slate-500"></span>
                  </div>
                </div>

                <div class="slot-card neo-card p-2 space-y-1" data-page="foodcategory"
                  data-position="food_power_8" data-label="파워 광고 8">
                  <div class="flex items-center justify-between">
                    <span class="font-bold text-slate-800">POWER 8</span>
                    <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
                  </div>
                  <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                    <div class="aspect-[4/3] w-full relative">
                      <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="미리보기">
                      <div
                        class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                        미등록
                      </div>
                    </div>
                  </div>
                  <div class="text-[10px] mt-1">
                    <span class="slot-preview-title font-bold"></span>
                    <span class="slot-preview-biztype text-slate-500"></span>
                  </div>
                </div>

                <div class="slot-card neo-card p-2 space-y-1" data-page="foodcategory"
                  data-position="food_power_9" data-label="파워 광고 9">
                  <div class="flex items-center justify-between">
                    <span class="font-bold text-slate-800">POWER 9</span>
                    <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
                  </div>
                  <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                    <div class="aspect-[4/3] w-full relative">
                      <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="미리보기">
                      <div
                        class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                        미등록
                      </div>
                    </div>
                  </div>
                  <div class="text-[10px] mt-1">
                    <span class="slot-preview-title font-bold"></span>
                    <span class="slot-preview-biztype text-slate-500"></span>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- 최고의 가게 1~6 -->
        <div class="neo-card p-4 space-y-3">
          <div class="flex items-center justify-between">
            <div>
              <div class="slot-card-header-badge text-slate-500 font-semibold uppercase">Best Stores</div>
              <h2 class="text-base font-extrabold text-slate-900">최고의 가게 1~6</h2>
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
            <!-- BEST 1..6 -->
            <div class="slot-card neo-card p-2 space-y-2" data-page="foodcategory"
              data-position="food_best_1" data-label="최고의 가게 1">
              <div class="flex items-center justify-between">
                <span class="text-xs font-bold text-slate-800">최고의 가게 1</span>
                <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
              </div>
              <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                <div class="aspect-[4/3] w-full relative">
                  <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="BEST1">
                  <div
                    class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                    미등록
                  </div>
                </div>
              </div>
              <div class="text-[11px] font-bold text-slate-800 truncate">
                <span class="slot-preview-title">제목 없음</span>
                <span class="slot-preview-biztype text-[10px] text-slate-500"></span>
              </div>
              <div class="slot-preview-meta text-[10px] text-slate-400 font-semibold">미등록</div>
            </div>

            <div class="slot-card neo-card p-2 space-y-2" data-page="foodcategory"
              data-position="food_best_2" data-label="최고의 가게 2">
              <div class="flex items-center justify-between">
                <span class="text-xs font-bold text-slate-800">최고의 가게 2</span>
                <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
              </div>
              <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                <div class="aspect-[4/3] w-full relative">
                  <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="BEST2">
                  <div
                    class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                    미등록
                  </div>
                </div>
              </div>
              <div class="text-[11px] font-bold text-slate-800 truncate">
                <span class="slot-preview-title">제목 없음</span>
                <span class="slot-preview-biztype text-[10px] text-slate-500"></span>
              </div>
              <div class="slot-preview-meta text-[10px] text-slate-400 font-semibold">미등록</div>
            </div>

            <div class="slot-card neo-card p-2 space-y-2" data-page="foodcategory"
              data-position="food_best_3" data-label="최고의 가게 3">
              <div class="flex items-center justify-between">
                <span class="text-xs font-bold text-slate-800">최고의 가게 3</span>
                <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
              </div>
              <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                <div class="aspect-[4/3] w-full relative">
                  <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="BEST3">
                  <div
                    class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                    미등록
                  </div>
                </div>
              </div>
              <div class="text-[11px] font-bold text-slate-800 truncate">
                <span class="slot-preview-title">제목 없음</span>
                <span class="slot-preview-biztype text-[10px] text-slate-500"></span>
              </div>
              <div class="slot-preview-meta text-[10px] text-slate-400 font-semibold">미등록</div>
            </div>

            <div class="slot-card neo-card p-2 space-y-2" data-page="foodcategory"
              data-position="food_best_4" data-label="최고의 가게 4">
              <div class="flex items-center justify-between">
                <span class="text-xs font-bold text-slate-800">최고의 가게 4</span>
                <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
              </div>
              <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                <div class="aspect-[4/3] w-full relative">
                  <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="BEST4">
                  <div
                    class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                    미등록
                  </div>
                </div>
              </div>
              <div class="text-[11px] font-bold text-slate-800 truncate">
                <span class="slot-preview-title">제목 없음</span>
                <span class="slot-preview-biztype text-[10px] text-slate-500"></span>
              </div>
              <div class="slot-preview-meta text-[10px] text-slate-400 font-semibold">미등록</div>
            </div>

            <div class="slot-card neo-card p-2 space-y-2" data-page="foodcategory"
              data-position="food_best_5" data-label="최고의 가게 5">
              <div class="flex items-center justify-between">
                <span class="text-xs font-bold text-slate-800">최고의 가게 5</span>
                <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
              </div>
              <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                <div class="aspect-[4/3] w-full relative">
                  <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="BEST5">
                  <div
                    class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                    미등록
                  </div>
                </div>
              </div>
              <div class="text-[11px] font-bold text-slate-800 truncate">
                <span class="slot-preview-title">제목 없음</span>
                <span class="slot-preview-biztype text-[10px] text-slate-500"></span>
              </div>
              <div class="slot-preview-meta text-[10px] text-slate-400 font-semibold">미등록</div>
            </div>

            <div class="slot-card neo-card p-2 space-y-2" data-page="foodcategory"
              data-position="food_best_6" data-label="최고의 가게 6">
              <div class="flex items-center justify-between">
                <span class="text-xs font-bold text-slate-800">최고의 가게 6</span>
                <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
              </div>
              <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
                <div class="aspect-[4/3] w-full relative">
                  <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="BEST6">
                  <div
                    class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                    미등록
                  </div>
                </div>
              </div>
              <div class="text-[11px] font-bold text-slate-800 truncate">
                <span class="slot-preview-title">제목 없음</span>
                <span class="slot-preview-biztype text-[10px] text-slate-500"></span>
              </div>
              <div class="slot-preview-meta text-[10px] text-slate-400 font-semibold">미등록</div>
            </div>
          </div>
        </div>
      </div>

      <!-- 사이드 광고 영역 (사이드 2개 + 설명) -->
      <div class="space-y-4">
        <div class="neo-card p-4 space-y-3">
          <div class="flex items-center justify-between">
            <div>
              <div class="slot-card-header-badge text-slate-500 font-semibold uppercase">Sidebar</div>
              <h2 class="text-base font-extrabold text-slate-900">사이드 광고</h2>
            </div>
          </div>

          <!-- 사이드 광고 1 -->
          <div class="slot-card neo-card p-3 space-y-2" data-page="foodcategory"
            data-position="food_sidebar_ad" data-label="사이드 광고 1">
            <div class="flex items-center justify-between">
              <span class="text-xs font-bold text-slate-800">사이드 광고 1</span>
              <span class="badge-pill bg-slate-100 border border-slate-200 text-slate-600">수정</span>
            </div>
            <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
              <div class="aspect-[4/3] w-full relative">
                <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="사이드1">
                <div
                  class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                  미등록
                </div>
              </div>
            </div>
            <div class="text-[11px] font-bold text-slate-800 truncate">
              <span class="slot-preview-title">제목 없음</span>
              <span class="slot-preview-biztype text-[10px] text-slate-500"></span>
            </div>
            <div class="slot-preview-meta text-[10px] text-slate-400 font-semibold">미등록</div>
          </div>

          <!-- 사이드 광고 2 (추가) -->
          <div class="slot-card neo-card p-3 space-y-2" data-page="foodcategory"
            data-position="food_sidebar_ad2" data-label="사이드 광고 2">
            <div class="flex items-center justify-between">
              <span class="text-xs font-bold text-slate-800">사이드 광고 2</span>
              <span class="badge-pill bg-indigo-50 border border-indigo-200 text-indigo-700">수정</span>
            </div>
            <div class="relative rounded-lg border border-slate-200 bg-slate-50 overflow-hidden">
              <div class="aspect-[4/3] w-full relative">
                <img class="slot-preview-img absolute inset-0 w-full h-full object-cover hidden" alt="사이드2">
                <div
                  class="slot-preview-empty absolute inset-0 flex items-center justify-center text-[10px] text-slate-400 font-semibold">
                  미등록
                </div>
              </div>
            </div>
            <div class="text-[11px] font-bold text-slate-800 truncate">
              <span class="slot-preview-title">제목 없음</span>
              <span class="slot-preview-biztype text-[10px] text-slate-500"></span>
            </div>
            <div class="slot-preview-meta text-[10px] text-slate-400 font-semibold">미등록</div>
          </div>
        </div>

        <div class="neo-card p-4 text-xs text-slate-600 space-y-1">
          <div class="font-bold text-slate-800 mb-1">TIP</div>
          <p>가게 연결을 선택하고 검색 후 선택하면,</p>
          <ul class="list-disc pl-4 space-y-1">
            <li><b>가게 썸네일 이미지</b>가 슬롯 이미지로 사용됩니다.</li>
            <li>가게명 옆에 <b>(업종)</b> 이 함께 표시됩니다.</li>
            <li>업종은 <b>detail_category / business_type / business_category</b> 순으로 자동 선택됩니다.</li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <!-- footer.html -->
  <div id="footer-placeholder"></div>

  <!-- 모달 -->
  <div id="modalRoot" class="hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-panel">
      <div class="modal-card">
        <!-- 헤더 -->
        <div class="p-4 sm:p-5 border-b border-slate-100 bg-white/95 backdrop-blur sticky top-0 z-10">
          <div class="flex items-start justify-between gap-4">
            <div>
              <h3 id="modalTitle" class="text-lg sm:text-xl font-extrabold text-slate-900">슬롯 수정</h3>
              <p class="text-[11px] text-slate-500 mt-1">
                page: <b>foodcategory</b> /
                position: <span id="modalPositionText" class="font-semibold"></span>
              </p>
            </div>
            <button id="btnCloseModal"
              class="text-xs px-3 py-1.5 rounded-lg border border-slate-200 bg-slate-50 hover:bg-slate-100 text-slate-700 font-semibold">
              닫기
            </button>
          </div>
        </div>

        <!-- 본문 -->
        <div class="p-4 sm:p-6 space-y-5 text-sm">
          <!-- 광고 방식 -->
          <div class="rounded-xl border border-slate-100 bg-slate-50 px-4 py-3">
            <div class="font-semibold text-slate-800 mb-2">광고 방식</div>
            <div class="flex flex-wrap gap-4 text-xs">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="slotMode" value="image" class="accent-blue-600" checked>
                <span>이미지 광고</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="slotMode" value="store" class="accent-emerald-600">
                <span>가게 연결</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="slotMode" value="text" class="accent-indigo-600">
                <span>텍스트 전용</span>
              </label>
            </div>
          </div>

          <!-- 텍스트 -->
          <div id="textBlock" class="space-y-1 hidden">
            <label for="fieldTextContent" class="font-semibold text-slate-800">텍스트 내용</label>
            <textarea id="fieldTextContent" class="field"
              placeholder="예) 한 줄당 한 문장&#10;첫번째 줄&#10;두번째 줄"></textarea>
          </div>

          <!-- 링크 -->
          <div id="linkBlock" class="space-y-1">
            <label for="fieldLinkUrl" class="font-semibold text-slate-800">링크 URL (선택)</label>
            <input id="fieldLinkUrl" class="field" placeholder="/ndetail.html?id=123&type=store 또는 https://...">
            <p class="text-[11px] text-slate-500 mt-1">
              가게 연결을 선택하고 비워두면 자동으로 <code>/ndetail.html?id=가게ID&type=store</code>로 설정됩니다.
            </p>
          </div>

          <div class="divider"></div>

          <!-- 이미지 블록 -->
          <div id="imageBlock" class="space-y-3">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label for="fieldImageFile" class="font-semibold text-slate-800">이미지 파일</label>
                <input id="fieldImageFile" type="file" accept="image/*" class="field mt-1 bg-white">
                <p class="text-[11px] text-slate-500 mt-1">
                  업로드 시 기존 이미지를 교체합니다. (슬롯 비율에 맞게 표시)
                </p>
              </div>
              <div>
                <div class="flex items-center justify-between">
                  <span class="font-semibold text-slate-800 text-sm">미리보기</span>
                  <span id="textSelectedImage" class="text-[11px] text-slate-500">이미지 없음</span>
                </div>
                <div
                  class="mt-1 rounded-lg border border-slate-200 bg-slate-50 overflow-hidden aspect-[16/9] flex items-center justify-center">
                  <img id="currentPreviewImg" src="" alt="preview"
                    class="w-full h-full object-cover hidden">
                  <span id="currentPreviewEmpty" class="text-[11px] text-slate-400">이미지 없음</span>
                </div>
              </div>
            </div>
          </div>

          <!-- 가게 연결 -->
          <div id="storeBlock" class="space-y-3 hidden">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label for="fieldBizNo" class="font-semibold text-slate-800">사업자번호</label>
                <input id="fieldBizNo" class="field mt-1" placeholder="예) 2910802895">
              </div>
              <div>
                <label for="fieldBizName" class="font-semibold text-slate-800">상호명</label>
                <input id="fieldBizName" class="field mt-1" placeholder="예) 하늘식당">
              </div>
            </div>

            <div class="flex items-center gap-2">
              <button id="btnSearchStore"
                class="px-4 py-2 rounded-lg bg-emerald-600 text-white text-xs font-semibold hover:bg-emerald-700">
                가게 검색
              </button>
              <span id="storeSearchHint" class="text-[11px] text-slate-500"></span>
            </div>

            <div class="border border-slate-100 rounded-xl overflow-hidden">
              <div class="px-3 py-2 bg-slate-50 text-[11px] font-semibold text-slate-700">검색 결과</div>
              <div id="storeResultsBody" class="p-3 text-[12px] text-slate-500">
                사업자번호 또는 상호를 입력하고 &ldquo;가게 검색&rdquo;을 눌러주세요.
              </div>
            </div>

            <input id="fieldStoreId" type="hidden">
          </div>

          <div class="divider"></div>

          <!-- 우선순위 + 기간 -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="rounded-xl border border-blue-100 bg-blue-50/60 px-3 py-3 space-y-2">
              <div class="font-semibold text-slate-800 text-sm">우선순위</div>
              <input id="adPriority" type="number" min="1" step="1" value="1" class="field text-sm">
              <p class="text-[11px] text-slate-500 mt-1">
                여러 개 등록 시, <b>1</b>번이 가장 우선입니다.
              </p>
            </div>

            <div class="rounded-xl border border-slate-100 bg-slate-50 px-3 py-3 space-y-2">
              <div class="flex items-center justify-between">
                <span class="font-semibold text-slate-800 text-sm">광고 기간</span>
                <label class="flex items-center gap-2 text-[11px] text-slate-700">
                  <input id="fieldNoEnd" type="checkbox" class="accent-blue-600">
                  종료일 없음
                </label>
              </div>
              <div class="grid grid-cols-1 gap-2">
                <div class="space-y-1">
                  <label for="fieldStartAt" class="text-[11px] font-semibold text-slate-600">시작 일시</label>
                  <input id="fieldStartAt" type="datetime-local" class="field text-xs">
                </div>
                <div class="space-y-1">
                  <label for="fieldEndAt" class="text-[11px] font-semibold text-slate-600">종료 일시</label>
                  <input id="fieldEndAt" type="datetime-local" class="field text-xs">
                </div>
              </div>
            </div>
          </div>

          <!-- 선택 정보 요약 -->
          <div class="rounded-xl border border-slate-100 bg-slate-50 px-3 py-3 space-y-1 text-[12px]">
            <div class="font-semibold text-slate-800 mb-1">현재 선택 정보</div>
            <div class="flex flex-wrap gap-3">
              <div class="flex items-center gap-1">
                <span class="text-slate-500">가게:</span>
                <span id="textSelectedStore" class="font-semibold text-slate-800">없음</span>
              </div>
              <div class="flex items-center gap-1">
                <span class="text-slate-500">모드:</span>
                <span id="textSelectedMode" class="font-semibold text-slate-800">이미지</span>
              </div>
            </div>
          </div>

          <!-- 버튼 -->
          <div class="flex flex-col sm:flex-row gap-2 justify-end">
            <button id="btnResetModal"
              class="px-4 py-2 rounded-lg bg-slate-100 text-slate-700 text-xs font-semibold hover:bg-slate-200">
              입력 초기화
            </button>
            <button id="btnDeleteSlot"
              class="px-4 py-2 rounded-lg bg-rose-50 text-rose-700 border border-rose-200 text-xs font-semibold hover:bg-rose-100">
              이 우선순위 삭제
            </button>
            <button id="btnSaveSlot"
              class="px-5 py-2 rounded-lg bg-blue-600 text-white text-xs font-semibold hover:bg-blue-700">
              슬롯 저장
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const PAGE_ID = "foodcategory";
    const API_BASE = "/foodcategorymanager/ad";

    const $ = (id) => document.getElementById(id);
    const clean = (v) => (v === undefined || v === null) ? "" : String(v).trim();

    function slotModeToUiMode(slotMode) {
      const m = clean(slotMode).toLowerCase();
      if (m === "store") return "store";
      if (m === "text") return "text";
      return "image";
    }

    function uiModeToSlotMode(uiMode) {
      const m = clean(uiMode).toLowerCase();
      if (m === "store") return "store";
      if (m === "text") return "text";
      return "banner";
    }

    function pickBizType(slot) {
      if (!slot) return "";
      const candidates = [
        slot.category,
        slot.business_type,
        slot.businessType,
        slot.business_category,
        slot.businessCategory,
        slot.business_subcategory,
        slot.businessSubcategory,
        slot.biz_type,
        slot.bizType,
      ];
      for (const v of candidates) {
        const t = clean(v);
        if (t) return t;
      }
      return "";
    }

    const API = {
      async getSlot(page, position, priority = null) {
        const params = new URLSearchParams();
        params.set("page", page);
        params.set("position", position);
        if (priority != null && clean(priority) !== "") {
          params.set("priority", String(priority));
        }
        const res = await fetch(`${API_BASE}/slot?${params.toString()}`);
        if (!res.ok) throw new Error(`getSlot 실패: ${res.status}`);
        return res.json();
      },
      async saveSlot(formData) {
        const res = await fetch(`${API_BASE}/slot`, {
          method: "POST",
          body: formData,
        });
        if (!res.ok) throw new Error(`saveSlot 실패: ${res.status}`);
        return res.json();
      },
      async deleteSlot(page, position, priority = null) {
        const params = new URLSearchParams();
        params.set("page", page);
        params.set("position", position);
        if (priority != null && clean(priority) !== "") {
          params.set("priority", String(priority));
        }
        const res = await fetch(`${API_BASE}/slot?${params.toString()}`, {
          method: "DELETE",
        });
        if (!res.ok) throw new Error(`deleteSlot 실패: ${res.status}`);
        return res.json();
      },
      async searchStore({ bizNo, q }) {
        const params = new URLSearchParams();
        if (bizNo) params.set("bizNo", bizNo);
        if (q) params.set("q", q);
        const res = await fetch(`${API_BASE}/store/search?${params.toString()}`);
        if (!res.ok) throw new Error(`searchStore 실패: ${res.status}`);
        return res.json();
      },
    };

    // 모달 관련 상태
    let modalRoot,
      modalPositionText,
      btnCloseModal,
      textBlock,
      linkBlock,
      imageBlock,
      storeBlock,
      fieldTextContent,
      fieldLinkUrl,
      fieldImageFile,
      currentPreviewImg,
      currentPreviewEmpty,
      fieldBizNo,
      fieldBizName,
      fieldStoreId,
      storeResultsBody,
      adPriority,
      fieldNoEnd,
      fieldStartAt,
      fieldEndAt,
      textSelectedImage,
      textSelectedStore,
      textSelectedMode,
      btnSearchStore,
      btnResetModal,
      btnDeleteSlot,
      btnSaveSlot;

    let currentCardEl = null;
    let currentSlotData = null;
    let currentStoreImageUrl = "";

    function getUiMode() {
      const el = document.querySelector('input[name="slotMode"]:checked');
      return el ? el.value : "image";
    }

    function setUiMode(mode) {
      const el = document.querySelector(`input[name="slotMode"][value="${mode}"]`);
      if (el) el.checked = true;
    }

    function applySlotMode(mode) {
      if (!textBlock || !linkBlock || !imageBlock || !storeBlock) return;
      const m = clean(mode);
      textBlock.classList.toggle("hidden", m !== "text");
      imageBlock.classList.toggle("hidden", m !== "image");
      storeBlock.classList.toggle("hidden", m !== "store");
      linkBlock.classList.toggle("hidden", m === "text");
      if (textSelectedMode) {
        textSelectedMode.textContent = m === "store" ? "가게 연결" : (m === "text" ? "텍스트" : "이미지");
      }
      updateModalPreview();
    }

    function syncNoEndUI() {
      if (!fieldNoEnd || !fieldEndAt) return;
      const noEnd = !!fieldNoEnd.checked;
      fieldEndAt.disabled = noEnd;
      if (noEnd) fieldEndAt.value = "";
    }

    function resetModalFields() {
      if (fieldTextContent) fieldTextContent.value = "";
      if (fieldLinkUrl) fieldLinkUrl.value = "";
      if (fieldImageFile) fieldImageFile.value = "";
      if (fieldBizNo) fieldBizNo.value = "";
      if (fieldBizName) fieldBizName.value = "";
      if (fieldStoreId) fieldStoreId.value = "";
      if (storeResultsBody) storeResultsBody.innerHTML =
        `사업자번호 또는 상호를 입력하고 &ldquo;가게 검색&rdquo;을 눌러주세요.`;
      if (adPriority) adPriority.value = "1";
      if (fieldStartAt) fieldStartAt.value = "";
      if (fieldEndAt) fieldEndAt.value = "";
      if (fieldNoEnd) fieldNoEnd.checked = false;
      syncNoEndUI();

      currentSlotData = null;
      currentStoreImageUrl = "";
      if (textSelectedStore) textSelectedStore.textContent = "없음";
      if (textSelectedImage) textSelectedImage.textContent = "이미지 없음";
    }

    function updateModalPreview() {
      const uiMode = getUiMode();

      const file = fieldImageFile && fieldImageFile.files && fieldImageFile.files[0];
      let imgSrc = "";

      if (uiMode === "image" && file) {
        imgSrc = URL.createObjectURL(file);
      } else if (uiMode === "store" && currentStoreImageUrl) {
        imgSrc = currentStoreImageUrl;
      } else if (currentSlotData && currentSlotData.image_url) {
        imgSrc = currentSlotData.image_url;
      }

      if (currentPreviewImg && currentPreviewEmpty) {
        if (imgSrc) {
          currentPreviewImg.src = imgSrc;
          currentPreviewImg.classList.remove("hidden");
          currentPreviewEmpty.classList.add("hidden");
          if (textSelectedImage) textSelectedImage.textContent = "있음";
        } else {
          currentPreviewImg.src = "";
          currentPreviewImg.classList.add("hidden");
          currentPreviewEmpty.classList.remove("hidden");
          if (textSelectedImage) textSelectedImage.textContent = "이미지 없음";
        }
      }

      if (textSelectedStore) {
        const storeName = clean(fieldBizName && fieldBizName.value);
        textSelectedStore.textContent = storeName || "없음";
      }

      if (textSelectedMode) {
        textSelectedMode.textContent = uiMode === "store" ? "가게 연결" : (uiMode === "text" ? "텍스트" : "이미지");
      }
    }

    function renderSlotCard(cardEl, slot) {
      if (!cardEl) return;

      const imgEl = cardEl.querySelector(".slot-preview-img");
      const emptyEl = cardEl.querySelector(".slot-preview-empty");
      const titleEl = cardEl.querySelector(".slot-preview-title");
      const bizTypeEl = cardEl.querySelector(".slot-preview-biztype");
      const metaEl = cardEl.querySelector(".slot-preview-meta");

      // 초기화
      if (imgEl) {
        imgEl.src = "";
        imgEl.classList.add("hidden");
      }
      if (emptyEl) {
        emptyEl.textContent = cardEl.dataset.label ? `${cardEl.dataset.label} 미등록` : "미등록";
        emptyEl.classList.remove("hidden");
      }
      if (titleEl) titleEl.textContent = "제목 없음";
      if (bizTypeEl) bizTypeEl.textContent = "";
      if (metaEl) metaEl.textContent = "미등록";

      if (!slot) return;

      const uiMode = slotModeToUiMode(slot.slot_mode);
      const bizType = pickBizType(slot);
      const storeName = clean(slot.business_name);
      const textContent = clean(slot.text_content);
      const imageUrl = clean(slot.image_url);

      // 제목
      let title = "";
      if (storeName) {
        title = storeName;
      } else if (uiMode === "text" && textContent) {
        title = textContent.split("\n")[0].slice(0, 20);
      } else if (imageUrl) {
        title = cardEl.dataset.label || "이미지 광고";
      } else {
        title = cardEl.dataset.label || "슬롯";
      }

      if (titleEl) titleEl.textContent = title;
      if (bizTypeEl) {
        bizTypeEl.textContent = bizType ? ` (${bizType})` : "";
      }

      // 이미지
      if (imageUrl && imgEl && emptyEl) {
        imgEl.src = imageUrl;
        imgEl.classList.remove("hidden");
        emptyEl.classList.add("hidden");
      } else if (uiMode === "text" && emptyEl && textContent) {
        emptyEl.textContent = textContent.split("\n")[0].slice(0, 24);
      }

      if (metaEl) {
        const pri = slot.priority != null ? `P${slot.priority}` : "P-";
        const modeTxt = uiMode === "store" ? "가게" : (uiMode === "text" ? "텍스트" : "이미지");
        metaEl.textContent = `${pri} / ${modeTxt}`;
      }
    }

    async function hydrateAllSlots() {
      const cards = document.querySelectorAll(".slot-card[data-position]");
      for (const card of cards) {
        const pos = card.dataset.position;
        try {
          const data = await API.getSlot(PAGE_ID, pos);
          if (data && data.success && data.slot) {
            renderSlotCard(card, data.slot);
          } else {
            renderSlotCard(card, null);
          }
        } catch (e) {
          console.error("hydrateAllSlots error:", pos, e);
          renderSlotCard(card, null);
        }
      }
    }

    async function loadSlotIntoModal(page, position, priority) {
      try {
        const data = await API.getSlot(page, position, priority);
        if (!data || !data.success || !data.slot) {
          currentSlotData = null;
          currentStoreImageUrl = "";
          updateModalPreview();
          return;
        }

        const slot = data.slot;
        currentSlotData = slot;
        currentStoreImageUrl = "";

        const uiMode = slotModeToUiMode(slot.slot_mode);
        setUiMode(uiMode);
        applySlotMode(uiMode);

        if (fieldLinkUrl) fieldLinkUrl.value = clean(slot.link_url);
        if (fieldTextContent) fieldTextContent.value = clean(slot.text_content);
        if (fieldStoreId) fieldStoreId.value = clean(slot.store_id);
        if (fieldBizNo) fieldBizNo.value = clean(slot.business_no);
        if (fieldBizName) fieldBizName.value = clean(slot.business_name);

        if (adPriority && slot.priority != null) adPriority.value = String(slot.priority);

        if (fieldStartAt && slot.start_at_local) fieldStartAt.value = slot.start_at_local;
        if (fieldEndAt && slot.end_at_local) fieldEndAt.value = slot.end_at_local;
        if (fieldNoEnd) {
          fieldNoEnd.checked = !!slot.no_end;
          syncNoEndUI();
        }

        updateModalPreview();
      } catch (e) {
        console.error("loadSlotIntoModal error:", e);
        currentSlotData = null;
        currentStoreImageUrl = "";
        updateModalPreview();
      }
    }

    function openModalForCard(cardEl) {
      currentCardEl = cardEl;
      const pos = cardEl.dataset.position || "";
      const label = cardEl.dataset.label || pos;

      if (!modalRoot) return;
      modalRoot.dataset.page = PAGE_ID;
      modalRoot.dataset.position = pos;

      const modalTitle = $("modalTitle");
      if (modalTitle) modalTitle.textContent = `슬롯 수정: ${label}`;
      if (modalPositionText) modalPositionText.textContent = pos;

      resetModalFields();
      setUiMode("image");
      applySlotMode("image");
      updateModalPreview();

      modalRoot.classList.remove("hidden");

      const pri = adPriority ? Number(clean(adPriority.value) || "1") : 1;
      loadSlotIntoModal(PAGE_ID, pos, pri);
    }

    async function handleSaveSlot() {
      if (!modalRoot || !currentCardEl) return;

      const page = modalRoot.dataset.page || PAGE_ID;
      const position = modalRoot.dataset.position || "";
      const priority = adPriority ? (clean(adPriority.value) || "1") : "1";

      const uiMode = getUiMode();
      const slotMode = uiModeToSlotMode(uiMode);

      const fd = new FormData();
      fd.append("page", page);
      fd.append("position", position);
      fd.append("priority", priority);
      fd.append("slotType", "banner");
      fd.append("slotMode", slotMode);

      const linkUrl = clean(fieldLinkUrl && fieldLinkUrl.value);
      const textContent = clean(fieldTextContent && fieldTextContent.value);

      if (uiMode === "text" && textContent) {
        fd.append("textContent", textContent);
      }
      if (uiMode !== "text" && linkUrl) {
        fd.append("linkUrl", linkUrl);
      }

      if (uiMode === "store") {
        const storeId = clean(fieldStoreId && fieldStoreId.value);
        const bizNo = clean(fieldBizNo && fieldBizNo.value);
        const bizName = clean(fieldBizName && fieldBizName.value);

        if (storeId) fd.append("storeId", storeId);
        if (bizNo) fd.append("businessNo", bizNo);
        if (bizName) fd.append("businessName", bizName);

        if (currentStoreImageUrl) {
          fd.append("imageUrl", currentStoreImageUrl);
        }

        if (!linkUrl && storeId) {
          fd.append("linkUrl", `/ndetail.html?id=${storeId}&type=store`);
        }
      }

      const startAt = clean(fieldStartAt && fieldStartAt.value);
      const endAt = clean(fieldEndAt && fieldEndAt.value);
      const noEnd = !!(fieldNoEnd && fieldNoEnd.checked);

      if (startAt) fd.append("startAt", startAt);
      if (!noEnd && endAt) fd.append("endAt", endAt);
      fd.append("noEnd", noEnd ? "true" : "false");

      const file = fieldImageFile && fieldImageFile.files && fieldImageFile.files[0];
      if (uiMode === "image" && file) {
        fd.append("image", file);
      }

      try {
        const resp = await API.saveSlot(fd);
        if (!resp || !resp.success) {
          alert(`저장 실패: ${resp && resp.error ? resp.error : "unknown"}`);
          return;
        }

        const slot = resp.slot || null;
        currentSlotData = slot;
        currentStoreImageUrl = "";

        renderSlotCard(currentCardEl, slot);
        updateModalPreview();

        alert("저장 완료!");
      } catch (e) {
        console.error("saveSlot error:", e);
        alert("저장 중 오류가 발생했습니다.");
      }
    }

    async function handleDeleteSlot() {
      if (!modalRoot || !currentCardEl) return;

      const page = modalRoot.dataset.page || PAGE_ID;
      const position = modalRoot.dataset.position || "";
      const priority = adPriority ? (clean(adPriority.value) || "1") : "1";

      if (!confirm(`이 슬롯의 우선순위 ${priority} 데이터를 삭제할까요?`)) return;

      try {
        const resp = await API.deleteSlot(page, position, priority);
        if (!resp || !resp.success) {
          alert(`삭제 실패: ${resp && resp.error ? resp.error : "unknown"}`);
          return;
        }

        renderSlotCard(currentCardEl, null);
        resetModalFields();
        updateModalPreview();

        alert("삭제 완료!");
      } catch (e) {
        console.error("deleteSlot error:", e);
        alert("삭제 중 오류가 발생했습니다.");
      }
    }

    async function handleSearchStore() {
      if (!btnSearchStore) return;
      const bizNo = clean(fieldBizNo && fieldBizNo.value);
      const q = clean(fieldBizName && fieldBizName.value);

      if (storeResultsBody) {
        storeResultsBody.innerHTML = `<div class="text-[12px] text-slate-500">검색 중...</div>`;
      }

      try {
        const data = await API.searchStore({ bizNo, q });
        if (!data || !data.ok) {
          if (storeResultsBody) {
            storeResultsBody.innerHTML =
              `<div class="text-[12px] text-rose-600 font-semibold">검색 실패</div>`;
          }
          return;
        }

        const list = data.stores || [];
        if (!list.length) {
          if (storeResultsBody) {
            storeResultsBody.innerHTML =
              `<div class="text-[12px] text-slate-500 font-semibold">검색 결과가 없습니다.</div>`;
          }
          return;
        }

        if (storeResultsBody) {
          storeResultsBody.innerHTML = list.map((s) => {
            const sid = clean(s.id);
            const biz = clean(s.business_no);
            const name = clean(s.business_name);
            const cat = clean(s.category);
            const img = clean(s.image_url || "");
            const disp = cat ? `${name} (${cat})` : name;
            return `
              <div class="result-item"
                   data-id="${sid}"
                   data-biz="${biz}"
                   data-name="${name}"
                   data-cat="${cat}"
                   data-image="${img}">
                <div class="font-extrabold text-slate-900 text-[13px]">${disp || "이름 없음"}</div>
                <div class="text-[11px] text-slate-500 mt-1">
                  id: ${sid || "-"} / biz: ${biz || "-"}
                </div>
              </div>
            `;
          }).join("");

          storeResultsBody.querySelectorAll(".result-item").forEach((el) => {
            el.addEventListener("click", () => {
              const sid = el.dataset.id || "";
              const biz = el.dataset.biz || "";
              const name = el.dataset.name || "";
              const cat = el.dataset.cat || "";
              const img = el.dataset.image || "";

              if (fieldStoreId) fieldStoreId.value = sid;
              if (fieldBizNo) fieldBizNo.value = biz;
              if (fieldBizName) fieldBizName.value = name;

              currentStoreImageUrl = img;
              if (!currentSlotData) currentSlotData = {};
              currentSlotData.business_name = name;
              currentSlotData.category = cat;

              setUiMode("store");
              applySlotMode("store");
              updateModalPreview();
            });
          });
        }
      } catch (e) {
        console.error("searchStore error:", e);
        if (storeResultsBody) {
          storeResultsBody.innerHTML =
            `<div class="text-[12px] text-rose-600 font-semibold">검색 중 오류가 발생했습니다.</div>`;
        }
      }
    }

    function closeModal() {
      if (!modalRoot) return;
      modalRoot.classList.add("hidden");
      currentCardEl = null;
      currentSlotData = null;
      currentStoreImageUrl = "";
    }

    // 초기화
    document.addEventListener("DOMContentLoaded", () => {
      // header/footer 포함
      fetch("/components/header.html")
        .then((r) => r.text())
        .then((html) => {
          const el = $("header-placeholder");
          if (el) el.innerHTML = html;
        })
        .catch(() => { });

      fetch("/components/footer.html")
        .then((r) => r.text())
        .then((html) => {
          const el = $("footer-placeholder");
          if (el) el.innerHTML = html;
        })
        .catch(() => { });

      // 모달 요소 가져오기
      modalRoot = $("modalRoot");
      modalPositionText = $("modalPositionText");
      btnCloseModal = $("btnCloseModal");

      textBlock = $("textBlock");
      linkBlock = $("linkBlock");
      imageBlock = $("imageBlock");
      storeBlock = $("storeBlock");

      fieldTextContent = $("fieldTextContent");
      fieldLinkUrl = $("fieldLinkUrl");
      fieldImageFile = $("fieldImageFile");
      currentPreviewImg = $("currentPreviewImg");
      currentPreviewEmpty = $("currentPreviewEmpty");

      fieldBizNo = $("fieldBizNo");
      fieldBizName = $("fieldBizName");
      fieldStoreId = $("fieldStoreId");
      storeResultsBody = $("storeResultsBody");

      adPriority = $("adPriority");
      fieldNoEnd = $("fieldNoEnd");
      fieldStartAt = $("fieldStartAt");
      fieldEndAt = $("fieldEndAt");

      textSelectedImage = $("textSelectedImage");
      textSelectedStore = $("textSelectedStore");
      textSelectedMode = $("textSelectedMode");

      btnSearchStore = $("btnSearchStore");
      btnResetModal = $("btnResetModal");
      btnDeleteSlot = $("btnDeleteSlot");
      btnSaveSlot = $("btnSaveSlot");

      // 슬롯 카드 클릭
      document.querySelectorAll(".slot-card[data-position]").forEach((card) => {
        card.addEventListener("click", (e) => {
          if (e.target.closest("button")) return;
          openModalForCard(card);
        });
      });

      // slotMode 변경
      document.querySelectorAll('input[name="slotMode"]').forEach((el) => {
        el.addEventListener("change", () => {
          applySlotMode(el.value);
        });
      });

      if (fieldImageFile) {
        fieldImageFile.addEventListener("change", updateModalPreview);
      }
      if (fieldBizName) {
        fieldBizName.addEventListener("input", updateModalPreview);
      }
      if (fieldNoEnd) {
        fieldNoEnd.addEventListener("change", () => {
          syncNoEndUI();
          updateModalPreview();
        });
      }

      if (btnSearchStore) btnSearchStore.addEventListener("click", (e) => {
        e.preventDefault();
        handleSearchStore();
      });

      if (btnResetModal) btnResetModal.addEventListener("click", (e) => {
        e.preventDefault();
        resetModalFields();
        updateModalPreview();
      });

      if (btnDeleteSlot) btnDeleteSlot.addEventListener("click", (e) => {
        e.preventDefault();
        handleDeleteSlot();
      });

      if (btnSaveSlot) btnSaveSlot.addEventListener("click", (e) => {
        e.preventDefault();
        handleSaveSlot();
      });

      if (btnCloseModal) btnCloseModal.addEventListener("click", () => closeModal());
      if (modalRoot) {
        const backdrop = modalRoot.querySelector(".modal-backdrop");
        if (backdrop) {
          backdrop.addEventListener("click", (e) => {
            if (e.target === backdrop) closeModal();
          });
        }
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && modalRoot && !modalRoot.classList.contains("hidden")) {
          closeModal();
        }
      });

      // 초기 모드 적용 + 슬롯 데이터 불러오기
      applySlotMode(getUiMode());
      syncNoEndUI();
      hydrateAllSlots();
    });
  </script>
</body>

</html>
