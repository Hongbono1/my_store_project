<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MALL HANKOOK - INDEX 레이아웃 관리자</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .neo-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 1rem;
            box-shadow:
                6px 6px 12px rgba(0, 0, 0, 0.15),
                -6px -6px 12px rgba(255, 255, 255, 0.9);
            transition: all 0.2s ease;
        }

        .neo-card:hover {
            transform: translateY(-2px);
            box-shadow:
                10px 10px 20px rgba(0, 0, 0, 0.2),
                -6px -6px 12px rgba(255, 255, 255, 1);
        }

        .slot-box {
            position: relative;
            cursor: pointer;
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .slot-overlay-label {
            position: absolute;
            top: 8px;
            left: 8px;
            padding: 2px 8px;
            font-size: 11px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.75);
            color: #f9fafb;
            pointer-events: none;
            white-space: nowrap;
        }

        .slot-overlay-pos {
            /* ✅ 오른쪽 하단에 위치 코드 보여주던 배지 전부 숨김 */
            display: none !important;
            position: absolute;
            bottom: 8px;
            right: 8px;
            padding: 2px 8px;
            font-size: 11px;
            border-radius: 999px;
            background: rgba(148, 163, 184, 0.85);
            color: #0f172a;
            pointer-events: none;
        }

        .slot-preview-bg {
            background: linear-gradient(135deg, #eff6ff 0%, #ffffff 40%, #e0f2fe 100%);
            border: 1px solid #e5e7eb;
        }

        .slot-selected {
            outline: 3px solid #2563eb;
            outline-offset: 2px;
            box-shadow:
                0 0 0 2px rgba(59, 130, 246, 0.4),
                6px 6px 12px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 min-h-screen">

    <!-- 상단 바 -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 h-14 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <span class="text-lg font-bold text-slate-900">MALL HANKOOK</span>
                <span class="text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-600 border border-blue-100">
                    INDEX 레이아웃 관리자
                </span>
            </div>
            <div class="flex items-center gap-2 text-xs text-slate-500">
                <span>페이지: <strong class="text-slate-800">index</strong></span>
                <span class="hidden sm:inline-block">|</span>
                <span class="hidden sm:inline-block">각 박스 위치 = 실제 메인 페이지와 동일</span>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-6">
        <div class="grid grid-cols-1 xl:grid-cols-[2fr,1fr] gap-6">
            <!-- ==========================
           왼쪽: 인덱스 레이아웃 미리보기
           ========================== -->
            <section class="space-y-6">
                <!-- 상단 안내 -->
                <div class="flex items-center justify-between">
                    <h1 class="text-lg sm:text-xl font-bold text-slate-900">
                        INDEX 메인 페이지 레이아웃 미리보기
                    </h1>
                    <p class="text-xs text-slate-500">
                        원하는 영역을 클릭하면 우측에서 슬롯 정보를 수정할 수 있습니다.
                    </p>
                </div>

                <!-- ① 상단 띠배너 -->
                <div class="neo-card p-4">
                    <div id="slot_index_main_top"
                        class="slot-box slot-preview-bg h-32 sm:h-40 flex items-center justify-center"
                        data-slot-key="index_main_top"
                        data-page="index"
                        data-position="index_main_top">
                        <span class="slot-overlay-label">상단 띠배너</span>
                        <span class="slot-overlay-pos">index_main_top</span>
                        <span class="text-xs sm:text-sm text-slate-600">메인 상단 안내/광고 영역</span>
                    </div>
                </div>

                <!-- ② 메인 비주얼 + ③④⑤ 프로모 1/2/3 -->
                <section class="grid grid-cols-1 lg:grid-cols-4 gap-4 items-stretch">
                    <!-- 메인 비주얼 -->
                    <div class="lg:col-span-3">
                        <div class="slot-box slot-preview-bg rounded-2xl h-40 sm:h-56 flex items-center justify-center"
                            id="slot_index_main_visual" data-slot-key="index_main_visual"
                            data-page="index" data-position="index_main_visual">
                            <span class="slot-overlay-label">메인 비주얼</span>
                            <span class="slot-overlay-pos">index_main_visual</span>
                            <span class="text-xs sm:text-sm text-slate-600">와이드 메인 배너</span>
                        </div>
                    </div>

                    <!-- 프로모 1/2/3 -->
                    <div class="lg:col-span-1 flex flex-col gap-3">
                        <div id="slot_index_promo_1"
                            class="slot-box slot-preview-bg rounded-xl h-20 sm:h-24 flex items-center justify-center"
                            data-slot-key="index_promo_1"
                            data-page="index" data-position="index_promo_1">
                            <span class="slot-overlay-label">프로모 1</span>
                            <span class="slot-overlay-pos">index_promo_1</span>
                            <span class="text-xs text-slate-600">서브 배너 1</span>
                        </div>
                        <div id="slot_index_promo_2"
                            class="slot-box slot-preview-bg rounded-xl h-20 sm:h-24 flex items-center justify-center"
                            data-slot-key="index_promo_2"
                            data-page="index" data-position="index_promo_2">
                            <span class="slot-overlay-label">프로모 2</span>
                            <span class="slot-overlay-pos">index_promo_2</span>
                            <span class="text-xs text-slate-600">서브 배너 2</span>
                        </div>
                        <div id="slot_index_promo_3"
                            class="slot-box slot-preview-bg rounded-xl h-20 sm:h-24 flex items-center justify-center"
                            data-slot-key="index_promo_3"
                            data-page="index" data-position="index_promo_3">
                            <span class="slot-overlay-label">프로모 3</span>
                            <span class="slot-overlay-pos">index_promo_3</span>
                            <span class="text-xs text-slate-600">서브 배너 3</span>
                        </div>
                    </div>
                </section>

                <!-- ⑥ 상단 서브 박스 (검색어/최신소식/이벤트/추천) -->
                <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="neo-card p-3 space-y-2">
                        <h3 class="font-semibold text-sm">검색어</h3>
                        <div id="slot_index_sub_keywords"
                            class="slot-box slot-preview-bg min-h-[70px] rounded-xl flex items-center justify-center"
                            data-slot-key="index_sub_keywords"
                            data-page="index" data-position="index_sub_keywords">
                            <span class="slot-overlay-label">텍스트</span>
                            <span class="slot-overlay-pos">index_sub_keywords</span>
                            <span class="text-xs text-slate-600">검색어 리스트</span>
                        </div>
                    </div>
                    <div class="neo-card p-3 space-y-2">
                        <h3 class="font-semibold text-sm">최신 소식</h3>
                        <div id="slot_index_sub_news"
                            class="slot-box slot-preview-bg min-h-[70px] rounded-xl flex items-center justify-center"
                            data-slot-key="index_sub_news"
                            data-page="index" data-position="index_sub_news">
                            <span class="slot-overlay-label">텍스트</span>
                            <span class="slot-overlay-pos">index_sub_news</span>
                            <span class="text-xs text-slate-600">공지/뉴스</span>
                        </div>
                    </div>
                    <div class="neo-card p-3 space-y-2">
                        <h3 class="font-semibold text-sm">이벤트 정보</h3>
                        <div id="slot_index_sub_events"
                            class="slot-box slot-preview-bg min-h-[70px] rounded-xl flex items-center justify-center"
                            data-slot-key="index_sub_events"
                            data-page="index" data-position="index_sub_events">
                            <span class="slot-overlay-label">텍스트</span>
                            <span class="slot-overlay-pos">index_sub_events</span>
                            <span class="text-xs text-slate-600">이벤트 문구</span>
                        </div>
                    </div>
                    <div class="neo-card p-3 space-y-2">
                        <h3 class="font-semibold text-sm">추천 제품</h3>
                        <div id="slot_index_sub_recommends"
                            class="slot-box slot-preview-bg min-h-[70px] rounded-xl flex items-center justify-center"
                            data-slot-key="index_sub_recommends"
                            data-page="index" data-position="index_sub_recommends">
                            <span class="slot-overlay-label">텍스트</span>
                            <span class="slot-overlay-pos">index_sub_recommends</span>
                            <span class="text-xs text-slate-600">추천 리스트</span>
                        </div>
                    </div>
                </section>

                <!-- ⑦ Best Pick -->
                <section class="neo-card p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-sm sm:text-base font-semibold">Best Pick 영역</h2>
                        <span class="text-[11px] text-slate-500">※ 상세 슬롯(1~18)은 별도 탭에서 관리 예정</span>
                    </div>
                    <div id="slot_index_best_pick"
                        class="slot-box slot-preview-bg rounded-2xl h-32 sm:h-40 flex items-center justify-center"
                        data-slot-key="index_best_pick"
                        data-page="index" data-position="index_best_pick">
                        <span class="slot-overlay-label">Best Pick 영역</span>
                        <span class="slot-overlay-pos">best_pick_1~18</span>
                        <span class="text-xs text-slate-600">동그란 가게 카드 슬라이더</span>
                    </div>
                </section>

                <!-- ⑧ 우리동네 한마디 -->
                <section class="neo-card p-4">
                    <div class="w-full sm:w-3/4 mx-auto">
                        <div id="slot_index_oneword"
                            class="slot-box slot-preview-bg rounded-2xl h-24 sm:h-28 flex flex-col items-center justify-center"
                            data-slot-key="index_oneword"
                            data-page="index" data-position="index_oneword">
                            <span class="slot-overlay-label">우리동네 한마디</span>
                            <span class="slot-overlay-pos">index_oneword</span>
                            <p class="text-xs sm:text-sm text-slate-600 mt-2">한 줄 메시지 / 지역 한마디</p>
                        </div>
                    </div>
                </section>

                <!-- ⑨ 기능 진입 카드들 -->
                <section class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                    <!-- 왼쪽 2단 -->
                    <div class="grid grid-rows-2 gap-3">
                        <div id="slot_index_food_delivery"
                            class="slot-box slot-preview-bg rounded-xl h-24 sm:h-28 flex items-center justify-center"
                            data-slot-key="index_food_delivery"
                            data-page="index" data-position="index_food_delivery">
                            <span class="slot-overlay-label">홍보의 배달</span>
                            <span class="slot-overlay-pos">index_food_delivery</span>
                            <span class="text-xs text-slate-600">푸드/배달 진입</span>
                        </div>
                        <div id="slot_index_all_stores"
                            class="slot-box slot-preview-bg rounded-xl h-24 sm:h-28 flex items-center justify-center"
                            data-slot-key="index_all_stores"
                            data-page="index" data-position="index_all_stores">
                            <span class="slot-overlay-label">우리동네 모든가게</span>
                            <span class="slot-overlay-pos">index_all_stores</span>
                            <span class="text-xs text-slate-600">전체 가게 보기</span>
                        </div>
                    </div>

                    <!-- 오른쪽 2x3 -->
                    <div class="lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div id="slot_index_hot_place"
                            class="slot-box slot-preview-bg rounded-xl h-24 sm:h-28 flex items-center justify-center"
                            data-slot-key="index_hot_place"
                            data-page="index" data-position="index_hot_place">
                            <span class="slot-overlay-label">가장 HOT한 우리동네</span>
                            <span class="slot-overlay-pos">index_hot_place</span>
                            <span class="text-xs text-slate-600">핫플 진입</span>
                        </div>
                        <div id="slot_index_suggest"
                            class="slot-box slot-preview-bg rounded-xl h-24 sm:h-28 flex items-center justify-center"
                            data-slot-key="index_suggest"
                            data-page="index" data-position="index_suggest">
                            <span class="slot-overlay-label">홍보의 추천</span>
                            <span class="slot-overlay-pos">index_suggest</span>
                            <span class="text-xs text-slate-600">추천 코너</span>
                        </div>
                        <div id="slot_index_open"
                            class="slot-box slot-preview-bg rounded-xl h-24 sm:h-28 flex items-center justify-center"
                            data-slot-key="index_open"
                            data-page="index" data-position="index_open">
                            <span class="slot-overlay-label">오픈 예정</span>
                            <span class="slot-overlay-pos">index_open</span>
                            <span class="text-xs text-slate-600">오픈 예정 가게</span>
                        </div>
                        <div id="slot_index_store_pride"
                            class="slot-box slot-preview-bg rounded-xl h-24 sm:h-28 flex items-center justify-center"
                            data-slot-key="index_store_pride"
                            data-page="index" data-position="index_store_pride">
                            <span class="slot-overlay-label">가게자랑</span>
                            <span class="slot-overlay-pos">index_store_pride</span>
                            <span class="text-xs text-slate-600">사장님 PR</span>
                        </div>
                        <div id="slot_index_traditional"
                            class="slot-box slot-preview-bg rounded-xl h-24 sm:h-28 flex items-center justify-center"
                            data-slot-key="index_traditional"
                            data-page="index" data-position="index_traditional">
                            <span class="slot-overlay-label">전통시장</span>
                            <span class="slot-overlay-pos">index_traditional</span>
                            <span class="text-xs text-slate-600">시장 진입</span>
                        </div>
                        <div id="slot_index_performing"
                            class="slot-box slot-preview-bg rounded-xl h-24 sm:h-28 flex items-center justify-center"
                            data-slot-key="index_performing"
                            data-page="index" data-position="index_performing">
                            <span class="slot-overlay-label">공연/예술, 축제</span>
                            <span class="slot-overlay-pos">index_performing</span>
                            <span class="text-xs text-slate-600">공연/축제 진입</span>
                        </div>
                    </div>
                </section>

                <!-- ⑩⑪ 이벤트 / 지역 게시판 -->
                <section class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div id="slot_index_event"
                        class="slot-box slot-preview-bg rounded-xl h-24 sm:h-32 flex items-center justify-center"
                        data-slot-key="index_event"
                        data-page="index" data-position="index_event">
                        <span class="slot-overlay-label">이벤트</span>
                        <span class="slot-overlay-pos">index_event</span>
                        <span class="text-xs text-slate-600">이벤트 메인</span>
                    </div>
                    <div id="slot_index_localboard"
                        class="slot-box slot-preview-bg rounded-xl h-24 sm:h-32 flex items-center justify-center"
                        data-slot-key="index_localboard"
                        data-page="index" data-position="index_localboard">
                        <span class="slot-overlay-label">지역 게시판</span>
                        <span class="slot-overlay-pos">index_localboard</span>
                        <span class="text-xs text-slate-600">동네 게시판</span>
                    </div>
                </section>

                <!-- ⑫⑬ 계절테마 / 신규 회원 혜택 -->
                <section class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div id="slot_index_season"
                        class="slot-box slot-preview-bg rounded-xl h-24 sm:h-32 flex items-center justify-center"
                        data-slot-key="index_season"
                        data-page="index" data-position="index_season">
                        <span class="slot-overlay-label">계절테마</span>
                        <span class="slot-overlay-pos">index_season</span>
                        <span class="text-xs text-slate-600">시즌 배너</span>
                    </div>
                    <div id="slot_index_join"
                        class="slot-box slot-preview-bg rounded-xl h-24 sm:h-32 flex items-center justify-center"
                        data-slot-key="index_join"
                        data-page="index" data-position="index_join">
                        <span class="slot-overlay-label">신규 회원 혜택</span>
                        <span class="slot-overlay-pos">index_join</span>
                        <span class="text-xs text-slate-600">가입 혜택 안내</span>
                    </div>
                </section>

                <!-- ⑭ 쇼핑몰 (배너 + 버튼) -->
                <section class="neo-card p-4">
                    <div class="flex flex-col sm:flex-row gap-3 items-stretch">
                        <div id="slot_index_d2c_banner"
                            class="slot-box slot-preview-bg flex-1 h-24 sm:h-32 rounded-xl flex items-center justify-center"
                            data-slot-key="index_d2c_banner"
                            data-page="index" data-position="index_d2c_banner">
                            <span class="slot-overlay-label">쇼핑몰 배너</span>
                            <span class="slot-overlay-pos">index_d2c_banner</span>
                            <span class="text-xs text-slate-600">왼쪽 롱 배너</span>
                        </div>
                        <div id="slot_index_d2c_shop"
                            class="slot-box slot-preview-bg w-full sm:w-64 rounded-xl h-24 sm:h-32 flex items-center justify-center"
                            data-slot-key="index_d2c_shop"
                            data-page="index" data-position="index_d2c_shop">
                            <span class="slot-overlay-label">쇼핑몰 진입</span>
                            <span class="slot-overlay-pos">index_d2c_shop</span>
                            <span class="text-xs text-slate-600">오른쪽 버튼/문구</span>
                        </div>
                    </div>
                </section>

                <!-- ⑮ 고객지원 -->
                <section class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div id="slot_index_support_review"
                        class="slot-box slot-preview-bg rounded-xl h-24 sm:h-28 flex items-center justify-center"
                        data-slot-key="index_support_review"
                        data-page="index" data-position="index_support_review">
                        <span class="slot-overlay-label">리뷰/후기</span>
                        <span class="slot-overlay-pos">index_support_review</span>
                        <span class="text-xs text-slate-600">리뷰 진입</span>
                    </div>
                    <div id="slot_index_support_empty"
                        class="slot-box slot-preview-bg rounded-xl h-24 sm:h-28 flex items-center justify-center"
                        data-slot-key="index_support_empty"
                        data-page="index" data-position="index_support_empty">
                        <span class="slot-overlay-label">중앙 박스</span>
                        <span class="slot-overlay-pos">index_support_empty</span>
                        <span class="text-xs text-slate-600">비워두거나 공지</span>
                    </div>
                    <div id="slot_index_support_inquiry"
                        class="slot-box slot-preview-bg rounded-xl h-24 sm:h-28 flex items-center justify-center"
                        data-slot-key="index_support_inquiry"
                        data-page="index" data-position="index_support_inquiry">
                        <span class="slot-overlay-label">문의게시판</span>
                        <span class="slot-overlay-pos">index_support_inquiry</span>
                        <span class="text-xs text-slate-600">Q&amp;A 진입</span>
                    </div>
                </section>
            </section>

            <!-- ==========================
           오른쪽: 슬롯 상세 설정 패널 (고정)
           ========================== -->
            <aside class="relative">
                <!-- sticky 컨테이너: 화면 오른쪽에 고정, 내부만 스크롤 -->
                <div class="sticky top-20 space-y-4 max-h-[calc(100vh-5rem)] overflow-y-auto">

                    <div class="neo-card p-4 space-y-3">
                        <h2 class="text-base sm:text-lg font-bold text-slate-900">슬롯 상세 설정</h2>
                        <p class="text-xs text-slate-500">
                            왼쪽 레이아웃에서 박스를 클릭하면, 이 영역에서
                            <span class="font-semibold text-slate-700">page / position / 타입 / 가게 연결 / 링크 / 텍스트</span>
                            등을 수정할 수 있습니다.
                        </p>

                        <div id="slotSelectionInfo"
                            class="text-xs rounded-lg border border-dashed border-slate-200 bg-slate-50 px-3 py-2 text-slate-600">
                            아직 선택된 슬롯이 없습니다. 왼쪽에서 박스를 클릭하세요.
                        </div>

                        <form id="slotForm" class="space-y-3" onsubmit="return false;">
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="block text-[11px] font-medium text-slate-500 mb-1">page</label>
                                    <input id="inputPage" type="text"
                                        class="w-full rounded-md border border-slate-200 px-2 py-1.5 text-xs bg-slate-50"
                                        readonly>
                                </div>
                                <div>
                                    <label class="block text-[11px] font-medium text-slate-500 mb-1">position</label>
                                    <input id="inputPosition" type="text"
                                        class="w-full rounded-md border border-slate-200 px-2 py-1.5 text-xs bg-slate-50"
                                        readonly>
                                </div>
                            </div>

                            <div>
                                <label class="block text-[11px] font-medium text-slate-500 mb-1">슬롯 이름 (관리용)</label>
                                <input id="inputLabel" type="text"
                                    class="w-full rounded-md border border-slate-200 px-2 py-1.5 text-xs"
                                    placeholder="예: 상단 띠배너">
                            </div>

                            <div>
                                <label class="block text-[11px] font-medium text-slate-500 mb-1">슬롯 타입</label>
                                <select id="inputType"
                                    class="w-full rounded-md border border-slate-200 px-2 py-1.5 text-xs bg-white text-slate-800">
                                    <option value="image">이미지 + 링크</option>
                                    <option value="text">텍스트 전용</option>
                                    <option value="mixed">이미지 + 텍스트</option>
                                </select>
                            </div>

                            <!-- ==========================
                   가게 검색 / 연결
                   ========================== -->
                            <div class="border-t border-slate-200 pt-3 mt-2">
                                <div class="flex items-center justify-between mb-1">
                                    <label class="block text-[11px] font-semibold text-slate-700">가게 검색 / 연결</label>
                                    <span class="text-[10px] text-slate-400">
                                        ※ 사업자번호 기준, 이름(상호)도 검색 가능
                                    </span>
                                </div>

                                <div class="grid grid-cols-[1.1fr,0.9fr,auto] gap-1.5 mb-2">
                                    <div>
                                        <input id="inputBizNo" type="text" maxlength="11"
                                            class="w-full rounded-md border border-slate-200 px-2 py-1.5 text-[11px]"
                                            placeholder="사업자번호 (숫자만)">
                                    </div>
                                    <div>
                                        <input id="inputStoreName" type="text"
                                            class="w-full rounded-md border border-slate-200 px-2 py-1.5 text-[11px]"
                                            placeholder="상호 / 키워드">
                                    </div>
                                    <div class="flex items-center">
                                        <button type="button" id="btnStoreSearch"
                                            class="w-full rounded-md bg-slate-800 text-white text-[11px] font-semibold px-2 py-1.5 hover:bg-slate-900">
                                            검색
                                        </button>
                                    </div>
                                </div>

                                <div id="storeSearchResults"
                                    class="mt-1 max-h-40 overflow-y-auto rounded-md border border-slate-200 bg-slate-50 text-[11px] text-slate-700 p-1.5 space-y-1">
                                    <p class="text-[11px] text-slate-400">
                                        사업자번호 또는 상호를 입력 후 <span class="font-semibold">[검색]</span>을 눌러주세요.
                                    </p>
                                </div>

                                <!-- 선택된 가게 정보 표시 -->
                                <div id="selectedStoreInfo"
                                    class="mt-2 rounded-md bg-blue-50 border border-blue-100 px-2 py-1.5 text-[11px] text-slate-700 hidden">
                                </div>

                                <!-- 실제 저장용 hidden 필드 -->
                                <input id="inputStoreType" type="hidden">
                                <input id="inputStoreId" type="hidden">
                                <input id="inputBusinessNumber" type="hidden">
                            </div>

                            <div class="border-t border-slate-200 pt-3 mt-2">
                                <label class="block text-[11px] font-medium text-slate-500 mb-1">이미지 URL</label>
                                <input id="inputImageUrl" type="text"
                                    class="w-full rounded-md border border-slate-200 px-2 py-1.5 text-xs"
                                    placeholder="/uploads/파일명 또는 https://...">
                                <p class="mt-1 text-[10px] text-slate-400">
                                    ※ 나중에 업로드 기능을 붙이면 이 값은 자동으로 채워지도록 연결할 수 있습니다.
                                </p>
                            </div>

                            <div>
                                <label class="block text-[11px] font-medium text-slate-500 mb-1">링크 URL</label>
                                <input id="inputLinkUrl" type="text"
                                    class="w-full rounded-md border border-slate-200 px-2 py-1.5 text-xs"
                                    placeholder="/ndetail.html?id=1&type=food 등 (가게 선택 시 자동 생성)">
                            </div>

                            <div>
                                <label class="block text-[11px] font-medium text-slate-500 mb-1">텍스트 내용 (선택)</label>
                                <textarea id="inputTextContent" rows="4"
                                    class="w-full rounded-md border border-slate-200 px-2 py-1.5 text-xs resize-y"
                                    placeholder="검색어/이벤트 문구 등 텍스트 슬롯에 사용할 내용"></textarea>
                            </div>

                            <div class="flex items-center justify-between gap-2 pt-2">
                                <button type="button" id="btnReset"
                                    class="px-3 py-1.5 rounded-md border border-slate-200 text-xs text-slate-600 hover:bg-slate-100">
                                    입력 초기화
                                </button>
                                <button type="button" id="btnSave"
                                    class="px-4 py-1.5 rounded-md bg-blue-600 text-white text-xs font-semibold hover:bg-blue-700">
                                    (임시) 저장 테스트
                                </button>
                            </div>

                            <p class="text-[10px] text-slate-400 pt-1">
                                ※ 현재는 화면에서만 상태를 확인하는 용도입니다.<br>
                                나중에 <span class="font-semibold">/manager/ad/slot</span> 같은 API와 연결해서 실제 DB에 저장하도록 확장할 수
                                있습니다.
                            </p>
                        </form>
                    </div>

                    <div class="neo-card p-4 space-y-2 text-xs text-slate-600">
                        <h3 class="text-xs font-semibold text-slate-800">운영 메모</h3>
                        <ul class="list-disc list-inside space-y-1">
                            <li>이 페이지는 <strong>index.html 전용 레이아웃 관리자</strong>입니다.</li>
                            <li>푸드/통합/카테고리 페이지용 관리자는 별도 파일(ncategory2manager 등)로 분리합니다.</li>
                            <li>권한(마스터/에이전시/점주)은 나중에 관리자 로그인 기능과 함께 붙이면 됩니다.</li>
                        </ul>
                    </div>

                </div>
            </aside>
        </div>
    </main>

    <script>
        // ==========================
        // 슬롯 기본 정보 (page, label, type)
        // ==========================
        const SLOT_CONFIG = {
            index_main_top: { page: "index", label: "상단 띠배너", type: "image" },
            index_main_visual: { page: "index", label: "메인 비주얼", type: "image" },
            index_promo_1: { page: "index", label: "프로모 1", type: "image" },
            index_promo_2: { page: "index", label: "프로모 2", type: "image" },
            index_promo_3: { page: "index", label: "프로모 3", type: "image" },

            index_sub_keywords: { page: "index", label: "검색어", type: "text" },
            index_sub_news: { page: "index", label: "최신 소식", type: "text" },
            index_sub_events: { page: "index", label: "이벤트 정보", type: "text" },
            index_sub_recommends: { page: "index", label: "추천 제품", type: "text" },

            index_best_pick: { page: "index", label: "Best Pick 영역", type: "image" },

            index_oneword: { page: "index", label: "우리동네 한마디", type: "text" },

            index_food_delivery: { page: "index", label: "홍보의 배달", type: "image" },
            index_all_stores: { page: "index", label: "우리동네 모든가게", type: "image" },
            index_hot_place: { page: "index", label: "가장 HOT한 우리동네", type: "image" },
            index_suggest: { page: "index", label: "홍보의 추천", type: "image" },
            index_open: { page: "index", label: "오픈 예정", type: "image" },
            index_store_pride: { page: "index", label: "가게자랑", type: "image" },
            index_traditional: { page: "index", label: "전통시장", type: "image" },
            index_performing: { page: "index", label: "공연/예술, 축제", type: "image" },

            index_event: { page: "index", label: "이벤트", type: "image" },
            index_localboard: { page: "index", label: "지역 게시판", type: "image" },

            index_season: { page: "index", label: "계절테마", type: "image" },
            index_join: { page: "index", label: "신규 회원 혜택", type: "image" },

            index_d2c_banner: { page: "index", label: "쇼핑몰 배너", type: "image" },
            index_d2c_shop: { page: "index", label: "쇼핑몰 진입", type: "image" },

            index_support_review: { page: "index", label: "리뷰/후기", type: "image" },
            index_support_empty: { page: "index", label: "중앙 박스", type: "image" },
            index_support_inquiry: { page: "index", label: "문의게시판", type: "image" },
        };

        let currentSlotKey = null;

        const $ = (sel) => document.querySelector(sel);

        const selectionInfoEl = $("#slotSelectionInfo");
        const inputPage = $("#inputPage");
        const inputPosition = $("#inputPosition");
        const inputLabel = $("#inputLabel");
        const inputType = $("#inputType");
        const inputImageUrl = $("#inputImageUrl");
        const inputLinkUrl = $("#inputLinkUrl");
        const inputTextContent = $("#inputTextContent");
        const btnReset = $("#btnReset");
        const btnSave = $("#btnSave");

        const inputBizNo = $("#inputBizNo");
        const inputStoreName = $("#inputStoreName");
        const btnStoreSearch = $("#btnStoreSearch");
        const storeSearchResultsEl = $("#storeSearchResults");
        const selectedStoreInfoEl = $("#selectedStoreInfo");
        const inputStoreType = $("#inputStoreType");
        const inputStoreId = $("#inputStoreId");
        const inputBusinessNumber = $("#inputBusinessNumber");

        function clearSelectionHighlight() {
            document.querySelectorAll(".slot-box").forEach(el => {
                el.classList.remove("slot-selected");
            });
        }

        function selectSlot(slotKey) {
            currentSlotKey = slotKey;
            clearSelectionHighlight();

            const el = document.querySelector(`[data-slot-key="${slotKey}"]`);
            if (el) el.classList.add("slot-selected");

            const cfg = SLOT_CONFIG[slotKey] || { page: "index", label: slotKey, type: "image" };

            inputPage.value = cfg.page || "index";
            inputPosition.value = slotKey;
            inputLabel.value = cfg.label || slotKey;
            inputType.value = cfg.type || "image";

            // 슬롯 선택 시, 가게/링크/텍스트 값 초기화 (나중에 GET 연동 시 여기서 채우면 됨)
            inputImageUrl.value = "";
            inputLinkUrl.value = "";
            inputTextContent.value = "";

            // 가게 선택값도 초기화
            inputStoreType.value = "";
            inputStoreId.value = "";
            inputBusinessNumber.value = "";
            selectedStoreInfoEl.classList.add("hidden");
            selectedStoreInfoEl.innerHTML = "";

            selectionInfoEl.innerHTML =
                `<span class="font-semibold text-slate-800">선택된 슬롯:</span>
         <span class="ml-1 text-slate-900">${cfg.label}</span>
         <span class="ml-2 text-[11px] text-slate-500">(page: ${cfg.page}, position: ${slotKey})</span>`;
        }

        // 슬롯 박스 클릭 이벤트 바인딩
        document.querySelectorAll(".slot-box").forEach(el => {
            el.addEventListener("click", () => {
                const key = el.getAttribute("data-slot-key");
                if (!key) return;
                selectSlot(key);
            });
        });

        // 숫자만 필터
        function digitsOnly(v) {
            return String(v || "").replace(/[^\d]/g, "");
        }

        // detail 링크 자동 생성
        function buildStoreLink(store_type, store_id) {
            const id = String(store_id || "").trim();
            if (!id) return "";

            if (store_type === "food") return `/ndetail.html?id=${id}&type=food`;
            if (store_type === "combined") return `/ndetail.html?id=${id}&type=combined`;
            if (store_type === "store_info") return `/detail.html?id=${id}`;
            // 필요 시 다른 타입도 여기서 확장
            return "";
        }

        function renderStoreSearchResults(items) {
            if (!items || !items.length) {
                storeSearchResultsEl.innerHTML =
                    `<p class="text-[11px] text-slate-400">검색 결과가 없습니다. 사업자번호 또는 상호를 다시 확인해주세요.</p>`;
                return;
            }

            storeSearchResultsEl.innerHTML = "";

            items.forEach((store) => {
                const row = document.createElement("div");
                row.className =
                    "flex items-center justify-between gap-2 rounded-md bg-white px-2 py-1 hover:bg-slate-50 border border-slate-200";

                const left = document.createElement("div");
                left.className = "flex-1 min-w-0";

                const typeLabel = (store.store_type || "").toString();
                const bizNo = (store.business_number || "").toString();
                const name = (store.business_name || "").toString();
                const category = (store.business_category || "").toString();
                const id = store.id;

                left.innerHTML = `
          <div class="flex items-center flex-wrap gap-1">
            <span class="inline-flex items-center px-1.5 py-0.5 rounded-full bg-slate-800 text-white text-[10px]">
              ${typeLabel || "type?"}
            </span>
            <span class="text-[11px] font-semibold text-slate-900 truncate">${name || "(상호 없음)"}</span>
          </div>
          <div class="text-[10px] text-slate-500 mt-0.5">
            <span class="mr-2">사업자: ${bizNo || "-"}</span>
            <span>업종: ${category || "-"}</span>
          </div>
        `;

                const btnWrap = document.createElement("div");
                btnWrap.className = "flex-shrink-0";

                const btn = document.createElement("button");
                btn.type = "button";
                btn.className =
                    "px-2 py-1 rounded-md bg-blue-600 text-white text-[10px] font-semibold hover:bg-blue-700";
                btn.textContent = "선택";

                btn.addEventListener("click", () => {
                    // 선택 시 내부 상태 업데이트
                    inputStoreType.value = typeLabel;
                    inputStoreId.value = id;
                    inputBusinessNumber.value = bizNo;

                    const link = buildStoreLink(typeLabel, id);
                    if (link) {
                        inputLinkUrl.value = link;
                    }

                    selectedStoreInfoEl.innerHTML = `
            <div class="flex items-start justify-between gap-2">
              <div class="flex-1 min-w-0">
                <div class="flex items-center flex-wrap gap-1">
                  <span class="inline-flex items-center px-1.5 py-0.5 rounded-full bg-blue-600 text-white text-[10px]">
                    연결된 가게
                  </span>
                  <span class="text-[11px] font-semibold text-slate-900 truncate">${name || "(상호 없음)"}</span>
                </div>
                <div class="text-[10px] text-slate-600 mt-0.5">
                  <span class="mr-2">사업자: ${bizNo || "-"}</span>
                  <span class="mr-2">업종: ${category || "-"}</span>
                  <span class="mr-2">type: ${typeLabel || "-"}</span>
                  <span>ID: ${id ?? "-"}</span>
                </div>
                ${link
                            ? `<div class="text-[10px] text-blue-700 mt-0.5 break-all">링크: ${link}</div>`
                            : `<div class="text-[10px] text-slate-400 mt-0.5">유효한 링크 타입이 아닙니다.</div>`
                        }
              </div>
              <button type="button"
                class="flex-shrink-0 ml-2 px-1.5 py-0.5 text-[10px] rounded-md border border-blue-300 text-blue-600 hover:bg-blue-50"
                onclick="(function(){ 
                  document.getElementById('inputStoreType').value=''; 
                  document.getElementById('inputStoreId').value=''; 
                  document.getElementById('inputBusinessNumber').value=''; 
                  document.getElementById('inputLinkUrl').value=''; 
                  document.getElementById('selectedStoreInfo').classList.add('hidden'); 
                  document.getElementById('selectedStoreInfo').innerHTML=''; 
                })();">
                해제
              </button>
            </div>
          `;
                    selectedStoreInfoEl.classList.remove("hidden");
                });

                btnWrap.appendChild(btn);
                row.appendChild(left);
                row.appendChild(btnWrap);
                storeSearchResultsEl.appendChild(row);
            });
        }

        async function handleStoreSearch() {
            const bizNoRaw = inputBizNo.value;
            const nameRaw = inputStoreName.value;

            const bizNo = digitsOnly(bizNoRaw);
            const q = (nameRaw || "").trim();

            if (!bizNo && !q) {
                alert("사업자번호 또는 상호(키워드) 중 하나 이상을 입력해주세요.");
                return;
            }

            try {
                const params = new URLSearchParams();
                if (bizNo) params.set("bizNo", bizNo);
                if (q) params.set("q", q);

                const url = `${AD_API_BASE}/search-store?${params.toString()}`;
                console.log("[newindexmanager] store search:", url);

                storeSearchResultsEl.innerHTML =
                    `<p class="text-[11px] text-slate-500">검색 중입니다...</p>`;

                const res = await fetch(url, { cache: "no-store" });
                if (!res.ok) {
                    storeSearchResultsEl.innerHTML =
                        `<p class="text-[11px] text-red-500">검색 중 오류가 발생했습니다. (${res.status})</p>`;
                    return;
                }

                const json = await res.json().catch(() => ({}));
                const items = json.items || json.data || json.rows || [];
                renderStoreSearchResults(items);
            } catch (err) {
                console.error("[newindexmanager] store search error:", err);
                storeSearchResultsEl.innerHTML =
                    `<p class="text-[11px] text-red-500">검색 중 오류가 발생했습니다.</p>`;
            }
        }

        btnStoreSearch?.addEventListener("click", handleStoreSearch);

        // Enter 키로 검색
        [inputBizNo, inputStoreName].forEach((el) => {
            el?.addEventListener("keydown", (e) => {
                if (e.key === "Enter") {
                    e.preventDefault();
                    handleStoreSearch();
                }
            });
        });

        // 입력 초기화
        btnReset?.addEventListener("click", () => {
            if (!currentSlotKey) return;
            inputImageUrl.value = "";
            inputLinkUrl.value = "";
            inputTextContent.value = "";

            inputBizNo.value = "";
            inputStoreName.value = "";
            storeSearchResultsEl.innerHTML =
                `<p class="text-[11px] text-slate-400">
          사업자번호 또는 상호를 입력 후 <span class="font-semibold">[검색]</span>을 눌러주세요.
        </p>`;
            inputStoreType.value = "";
            inputStoreId.value = "";
            inputBusinessNumber.value = "";
            selectedStoreInfoEl.classList.add("hidden");
            selectedStoreInfoEl.innerHTML = "";
        });

        // (임시) 저장 버튼: 나중에 API 연결 포인트
        btnSave?.addEventListener("click", () => {
            if (!currentSlotKey) {
                alert("먼저 왼쪽에서 슬롯을 선택하세요.");
                return;
            }

            const payload = {
                page: inputPage.value.trim(),
                position: inputPosition.value.trim(),
                label: inputLabel.value.trim(),
                type: inputType.value,
                image_url: inputImageUrl.value.trim(),
                link_url: inputLinkUrl.value.trim(),
                text_content: inputTextContent.value,
                // 가게 연결 정보
                store_type: inputStoreType.value || null,
                store_id: inputStoreId.value || null,
                business_number: inputBusinessNumber.value || null,
            };

            console.log("[newindexmanager] 슬롯 저장 요청(임시):", payload);
            alert("지금은 UI 테스트 단계입니다.\n나중에 이 payload를 서버 API(/manager/ad/slot 등)에 연결하면 됩니다.");
        });


        // ✅ newindexmanager 서버 라우터 경로(너가 server.js에 등록한 것)
        const AD_API_BASE = "/manager/newindex/ad";

        // ---------------------------
        // 공통 유틸
        // ---------------------------
        function safeStr(v) {
            return (v === undefined || v === null) ? "" : String(v);
        }
        function normUrl(u) {
            const s = safeStr(u).trim();
            if (!s) return "";
            // 이미 절대경로면 그대로
            if (s.startsWith("http://") || s.startsWith("https://")) return s;
            // /uploads/... 같은 상대경로면 현재 도메인 기준으로 사용
            if (s.startsWith("/")) return s;
            // 그 외는 / 붙여서
            return "/" + s;
        }

        async function fetchJson(url) {
            const res = await fetch(url, { cache: "no-store" });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            return await res.json();
        }

        // 서버 응답이 어떤 키로 와도 최대한 흡수 (slot / data / rows / items 등)
        function pickItems(payload) {
            const p = payload || {};
            const a =
                p.items ||
                p.rows ||
                (p.data && (p.data.items || p.data.rows)) ||
                (p.slot && (p.slot.items || p.slot.rows)) ||
                [];

            if (Array.isArray(a)) return a;

            // 단일 객체로 오는 경우도 배열로 감싸기
            if (typeof a === "object" && a) return [a];
            return [];
        }

        function pickOne(payload) {
            const p = payload || {};
            return (
                p.item ||
                p.row ||
                p.slot ||
                p.data ||
                null
            );
        }

        // ---------------------------
        // 렌더
        // ---------------------------
        function renderImage(el, item) {
            const imageUrl = normUrl(item?.image_url || item?.imageUrl || item?.img || item?.image);
            const linkUrl = safeStr(item?.link_url || item?.linkUrl || item?.link).trim();

            if (!imageUrl) {
                el.innerHTML = "";
                return;
            }

            const imgHtml = `
            <img
                src="${imageUrl}"
                alt=""
                class="w-full h-full object-cover rounded-xl"
                loading="lazy"
            />
            `;

            if (linkUrl) {
                el.innerHTML = `<a href="${linkUrl}" class="block w-full h-full">${imgHtml}</a>`;
            } else {
                el.innerHTML = imgHtml;
            }
        }

        function renderText(el, item) {
            const text = safeStr(item?.text_content || item?.text || item?.content || item?.title).trim();
            const linkUrl = safeStr(item?.link_url || item?.linkUrl || item?.link).trim();

            if (!text) {
                el.innerHTML = "";
                return;
            }

            // ✅ 텍스트는 기존 디자인 유지하려면 class는 네 index.html 스타일에 맞춰 조절 가능
            const inner = `<div class="w-full">${text}</div>`;

            if (linkUrl) {
                el.innerHTML = `<a href="${linkUrl}" class="block w-full">${inner}</a>`;
            } else {
                el.innerHTML = inner;
            }
        }

        function renderSlot(el, items) {
            // items가 여러개면 “첫 번째만” 기본 출력
            // (원하면 여기서 캐러셀/랜덤/2개씩 넘기기 등 확장 가능)
            const first = items?.[0] || null;
            if (!first) {
                el.innerHTML = "";
                return;
            }

            // 타입 추정(서버가 slot_type/slotType을 준다면 그걸 우선)
            const slotType = safeStr(first?.slot_type || first?.slotType || first?.type).toLowerCase();

            if (slotType.includes("text")) return renderText(el, first);
            // 기본은 image
            return renderImage(el, first);
        }

        // ---------------------------
        // 슬롯 로드
        // ---------------------------
        async function loadOneSlot(el) {
            const page = el.getAttribute("data-page");
            const position = el.getAttribute("data-position");
            if (!page || !position) return;

            // ✅ 우선: slot-items (여러 아이템 지원)
            // ✅ fallback: slot (단일 슬롯)
            const qs = new URLSearchParams({ page, position });

            try {
                const itemsPayload = await fetchJson(`${AD_API_BASE}/slot-items?${qs.toString()}`);
                const items = pickItems(itemsPayload);
                if (items.length) {
                    renderSlot(el, items);
                    return;
                }
            } catch (e) {
                // 무시하고 fallback
            }

            try {
                const slotPayload = await fetchJson(`${AD_API_BASE}/slot?${qs.toString()}`);
                const one = pickOne(slotPayload);
                if (!one) {
                    el.innerHTML = "";
                    return;
                }
                // 단일도 items 형태로 처리
                renderSlot(el, [one]);
            } catch (e) {
                el.innerHTML = "";
                // 콘솔에서만 확인
                console.warn("slot load failed:", position, e?.message || e);
            }
        }

        async function loadAllSlots() {
            const slots = Array.from(document.querySelectorAll("[data-page][data-position]"));
            // 병렬 로드
            await Promise.allSettled(slots.map(loadOneSlot));
        }

        document.addEventListener("DOMContentLoaded", loadAllSlots);

    </script>
</body>

</html>