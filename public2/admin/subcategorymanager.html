<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>ì„œë¸Œì¹´í…Œê³ ë¦¬ ë§¤ë‹ˆì €</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
        }

        .neo {
            background: rgba(255, 255, 255, .92);
            border: 1px solid rgba(59, 130, 246, .18);
            border-radius: 1rem;
            box-shadow: 10px 10px 24px rgba(0, 0, 0, .08), -10px -10px 24px rgba(255, 255, 255, .7);
            backdrop-filter: blur(12px);
        }

        .soft {
            background: rgba(255, 255, 255, .75);
            border: 1px solid rgba(148, 163, 184, .35);
            border-radius: .9rem;
            backdrop-filter: blur(10px);
        }

        .chip {
            border: 1px solid rgba(59, 130, 246, .25);
            background: rgba(59, 130, 246, .08);
            padding: .25rem .55rem;
            border-radius: 999px;
            font-size: .75rem;
            color: rgb(30 64 175);
            display: inline-flex;
            gap: .35rem;
            align-items: center;
            white-space: nowrap;
        }

        .btn {
            border-radius: .85rem;
            padding: .6rem .85rem;
            font-weight: 900;
            transition: .15s;
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn-primary {
            background: rgb(37 99 235);
            color: white;
        }

        .btn-primary:hover {
            background: rgb(29 78 216);
        }

        .btn-ghost {
            background: rgba(255, 255, 255, .7);
            border: 1px solid rgba(148, 163, 184, .45);
        }

        .btn-ghost:hover {
            background: rgba(255, 255, 255, .92);
        }

        .btn-danger {
            background: rgb(220 38 38);
            color: white;
        }

        .btn-danger:hover {
            background: rgb(185 28 28);
        }

        .btn-disabled {
            opacity: .45;
            cursor: not-allowed;
        }

        .input {
            width: 100%;
            border-radius: .85rem;
            border: 1px solid rgba(148, 163, 184, .5);
            background: rgba(255, 255, 255, .9);
            padding: .65rem .8rem;
            outline: none;
        }

        .input:focus {
            border-color: rgba(37, 99, 235, .8);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, .15);
        }

        .label {
            font-size: .85rem;
            color: rgb(71 85 105);
            margin-bottom: .35rem;
            font-weight: 900;
        }

        .hint {
            font-size: .75rem;
            color: rgb(100 116 139);
        }

        .seg {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: .5rem;
        }

        .seg button {
            border-radius: .95rem;
            padding: .7rem .6rem;
            font-weight: 900;
            border: 1px solid rgba(148, 163, 184, .45);
            background: rgba(255, 255, 255, .75);
            transition: .15s;
        }

        .seg button:hover {
            background: rgba(255, 255, 255, .95);
        }

        .seg button[data-active="1"] {
            border-color: rgba(37, 99, 235, .75);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, .12);
            background: rgba(37, 99, 235, .10);
            color: rgb(30 64 175);
        }

        .banner-box {
            background: linear-gradient(180deg, rgba(37, 99, 235, .08), rgba(255, 255, 255, .0));
            border: 1px solid rgba(37, 99, 235, .18);
            border-radius: 1.2rem;
        }

        .result-item:hover {
            background: rgba(59, 130, 246, .06);
        }

        /* ìƒíƒœë°” */
        .statusbar {
            border-radius: 1rem;
            padding: .85rem 1rem;
            border: 1px solid rgba(148, 163, 184, .45);
            background: rgba(255, 255, 255, .75);
        }

        .status-ok {
            border-color: rgba(34, 197, 94, .45);
        }

        .status-bad {
            border-color: rgba(239, 68, 68, .45);
        }

        .status-warn {
            border-color: rgba(245, 158, 11, .45);
        }

        /* ë°°ë„ˆ ë©”ì‹œì§€(ë²„íŠ¼ ë°”ë¡œ ì•„ë˜ í‘œì‹œ) */
        .banner-msg {
            border-radius: .9rem;
            padding: .75rem .85rem;
            border: 1px solid rgba(148, 163, 184, .45);
            background: rgba(255, 255, 255, .85);
            font-weight: 900;
            font-size: .85rem;
        }

        .banner-msg.ok {
            border-color: rgba(34, 197, 94, .45);
        }

        .banner-msg.bad {
            border-color: rgba(239, 68, 68, .45);
        }

        .banner-msg.warn {
            border-color: rgba(245, 158, 11, .45);
        }

        /* ë§ˆì§€ë§‰ ì…ë ¥(ìƒíƒœ+ë²„íŠ¼) í•­ìƒ ë³´ì´ê²Œ */
        .sticky-actions {
            position: sticky;
            bottom: 0;
            z-index: 30;
            padding-top: .75rem;
            margin-top: 1rem;
            background: linear-gradient(to top, rgba(241, 245, 249, 0.98), rgba(241, 245, 249, 0.60), rgba(241, 245, 249, 0));
            backdrop-filter: blur(10px);
        }
    </style>
</head>

<body class="min-h-screen bg-slate-50 text-slate-800">
    <div id="header-placeholder"></div>

    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- managerModeëŠ” JSì—ì„œ ìƒíƒœ ê´€ë¦¬ìš©ìœ¼ë¡œë§Œ ì‚¬ìš© (hidden) -->
        <input type="hidden" id="managerMode" value="food" />

        <!-- ìƒë‹¨ ë°°ë„ˆ -->
        <section class="banner-box p-4 md:p-5">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                <div>
                    <div class="text-lg md:text-xl font-black tracking-tight">ì„œë¸Œì¹´í…Œê³ ë¦¬ ë§¤ë‹ˆì €</div>
                    <div class="text-sm text-slate-600 mt-1">
                        ì´ë¯¸ì§€/ê°€ê²Œì—°ê²°/í…ìŠ¤íŠ¸ ì„ íƒì— ë”°ë¼ ì…ë ¥ì°½ì´ ì „í™˜ë©ë‹ˆë‹¤.
                    </div>
                </div>

                <div class="flex flex-wrap items-center gap-2">
                    <span class="chip" id="chipApiBase">API: -</span>
                    <span class="chip" id="chipMode">ëª¨ë“œ: -</span>
                    <span class="chip" id="chipPosition">ì„ íƒ: -</span>
                </div>
            </div>

            <!-- âœ… ë°°ë„ˆ ëª¨ë“œ: í‘¸ë“œ ê³ ì • (hidden selectë§Œ ìœ ì§€) -->
            <select class="input hidden" id="bannerMode">
                <option value="food" selected>í‘¸ë“œ ë°°ë„ˆ</option>
            </select>

            <!-- ë°°ë„ˆ 2ì¹¸ ë ˆì´ì•„ì›ƒ: ì´ë¯¸ì§€ / í…ìŠ¤íŠ¸ -->
            <div class="mt-4 grid grid-cols-1 lg:grid-cols-2 gap-4">
                
                <!-- ì™¼ìª½: ì´ë¯¸ì§€ ë°°ë„ˆ (idx=1) -->
                <div class="neo p-4">
                    <div class="font-extrabold text-blue-700">ğŸ–¼ï¸ ì´ë¯¸ì§€ ë°°ë„ˆ</div>
                    <div class="hint mt-1">idx=1 | ì´ë¯¸ì§€ + ë§í¬</div>

                    <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
                    <div class="mt-3 soft p-3">
                        <img id="imageBannerPreview" src="/uploads/no-image.png" alt="image-banner"
                            class="w-full h-[280px] object-cover rounded-xl bg-white" />
                    </div>

                    <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
                    <div class="mt-3">
                        <div class="label">ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                        <input class="input" id="imageBannerFile" type="file" accept="image/*" />
                        <div class="hint mt-1">ê¶Œì¥ í¬ê¸°: 1200x400px</div>
                    </div>

                    <!-- ë§í¬ URL -->
                    <div class="mt-3">
                        <div class="label">ë§í¬ URL (ì„ íƒ)</div>
                        <input class="input" id="imageBannerLink" placeholder="https://..." />
                    </div>

                    <!-- ë²„íŠ¼ -->
                    <div class="mt-3 flex gap-2">
                        <button class="btn btn-primary flex-1" id="btnImageBannerSave">ì €ì¥</button>
                        <button class="btn btn-danger flex-1" id="btnImageBannerDelete">ì‚­ì œ</button>
                        <button class="btn btn-ghost" id="btnImageClear">ì·¨ì†Œ</button>
                    </div>

                    <!-- ìƒíƒœ ë©”ì‹œì§€ -->
                    <div class="mt-3 hidden" id="imageBannerMsg"></div>
                </div>

                <!-- ì˜¤ë¥¸ìª½: í…ìŠ¤íŠ¸ ë°°ë„ˆ (idx=2) -->
                <div class="neo p-4">
                    <div class="font-extrabold text-green-700">ğŸ’¬ í…ìŠ¤íŠ¸ ë°°ë„ˆ</div>
                    <div class="hint mt-1">idx=2 | ë¬¸êµ¬ + ìŠ¤íƒ€ì¼</div>

                    <!-- í…ìŠ¤íŠ¸ ë¯¸ë¦¬ë³´ê¸° -->
                    <div class="mt-3 soft p-3">
                        <div class="w-full h-[280px] rounded-xl bg-white flex flex-col items-center justify-center p-4"
                            style="background-color: #f9fafb;">
                            <!-- Title (heroTitle) -->
                            <h1 id="textBannerPreview" 
                                class="text-3xl md:text-4xl font-bold mb-4"
                                style="font-size: 24px; font-weight: 700; color: #1e293b;">
                                í…ìŠ¤íŠ¸ ë¯¸ë¦¬ë³´ê¸°
                            </h1>
                            <!-- Subtitle (heroSubtitle) -->
                            <p id="textBannerSubtitlePreview" 
                                class="text-slate-600 text-sm md:text-base mt-2 px-3 py-1 rounded"
                                style="background-color: #ffffff;">
                                í‘¸ë“œ ì„œë¸Œì¹´í…Œê³ ë¦¬
                            </p>
                        </div>
                    </div>

                    <!-- ë¬¸êµ¬ ì…ë ¥ -->
                    <div class="mt-3">
                        <div class="label">ë¬¸êµ¬</div>
                        <textarea class="input" id="textBannerText" rows="3" 
                            placeholder="ë°°ë„ˆ ë¬¸êµ¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>

                    <!-- ìŠ¤íƒ€ì¼ ì˜µì…˜ -->
                    <div class="mt-3 grid grid-cols-2 gap-3">
                        <div>
                            <div class="label">ê¸€ì í¬ê¸°</div>
                            <select class="input" id="textFontSize">
                                <option value="16">16px (ì†Œ)</option>
                                <option value="20">20px</option>
                                <option value="24" selected>24px (ì¤‘)</option>
                                <option value="28">28px</option>
                                <option value="32">32px (ëŒ€)</option>
                                <option value="36">36px</option>
                                <option value="40">40px (íŠ¹ëŒ€)</option>
                            </select>
                        </div>
                        <div>
                            <div class="label">ê¸€ì êµµê¸°</div>
                            <select class="input" id="textFontWeight">
                                <option value="400">ë³´í†µ (400)</option>
                                <option value="500">ì¤‘ê°„ (500)</option>
                                <option value="600">ì¤‘êµµ (600)</option>
                                <option value="700" selected>êµµê²Œ (700)</option>
                                <option value="800">ë” êµµê²Œ (800)</option>
                                <option value="900">ìµœê³  (900)</option>
                            </select>
                        </div>
                    </div>

                    <div class="mt-3 grid grid-cols-2 gap-3">
                        <div>
                            <div class="label">ê¸€ì ìƒ‰ìƒ</div>
                            <input class="input" id="textColor" type="color" value="#1e293b" />
                        </div>
                        <div>
                            <div class="label">ë°°ê²½ ìƒ‰ìƒ</div>
                            <input class="input" id="textBgColor" type="color" value="#ffffff" />
                        </div>
                    </div>

                    <!-- ë²„íŠ¼ -->
                    <div class="mt-3 flex gap-2">
                        <button class="btn btn-primary flex-1" id="btnTextBannerSave">ì €ì¥</button>
                        <button class="btn btn-danger flex-1" id="btnTextBannerDelete">ì‚­ì œ</button>
                        <button class="btn btn-ghost" id="btnTextPreview">ë¯¸ë¦¬ë³´ê¸°</button>
                    </div>

                    <!-- ìƒíƒœ ë©”ì‹œì§€ -->
                    <div class="mt-3 hidden" id="textBannerMsg"></div>
                </div>
            </div>
        </section>

        <!-- í•˜ë‹¨ -->
        <section class="mt-6 grid grid-cols-1 lg:grid-cols-12 gap-4">
            <!-- ì¢Œ: ê²€ìƒ‰ -->
            <aside class="lg:col-span-6 neo p-4">
                <div class="mb-3">
                    <div class="label">ê²€ìƒ‰ ê¸°ì¤€</div>
                    <select class="input" id="searchType">
                        <option value="auto" selected>ìë™</option>
                        <option value="biz">ì‚¬ì—…ìë²ˆí˜¸</option>
                        <option value="name">ìƒí˜¸</option>
                    </select>
                    <div class="hint mt-1">ì´ ë§¤ë‹ˆì €ëŠ” í‘¸ë“œ ëª¨ë“œì—ì„œë§Œ ê²€ìƒ‰ë©ë‹ˆë‹¤.</div>
                </div>

                <div class="font-extrabold">ê°€ê²Œ ê²€ìƒ‰</div>

                <div class="hint mt-1">
                    ì‚¬ì—…ìë²ˆí˜¸ë¡œ ê²€ìƒ‰ / ë¹„ì›Œë‘ê³  ê²€ìƒ‰í•˜ë©´ ì „ì²´(ì¼ë¶€) í‘œì‹œ
                </div>

                <div class="mt-3">
                    <div class="label">ì‚¬ì—…ìë²ˆí˜¸ (ë¹„ìš°ë©´ ì „ì²´ ë³´ê¸°)</div>
                    <div class="flex gap-2">
                        <input class="input" id="q" placeholder="ì˜ˆ: 0000000003 (ë˜ëŠ” ë¹„ì›€)" inputmode="numeric" />
                        <button class="btn btn-primary" id="btnSearch" type="button">ê°€ê²Œ ê²€ìƒ‰</button>
                    </div>
                    <div class="hint mt-1">
                        - ìˆ«ìë§Œ ë¹„êµ(í•˜ì´í”ˆ/ê³µë°± ìë™ ì œê±°)<br />
                        - ë¹„ì›Œë‘ê³  ê²€ìƒ‰ â†’ q=__all__ (ì„œë²„ ì œí•œ ìˆ˜ ë§Œí¼)
                    </div>
                </div>

                <!-- ê²€ìƒ‰ í›„ í‘œì‹œ: í•­ìƒ ë³´ì´ê²Œ -->
                <div class="mt-4 grid grid-cols-1 md:grid-cols-12 gap-3" id="storePanelWrap">
                    <!-- ê°€ê²Œ ì •ë³´ -->
                    <div class="md:col-span-5 soft p-3">
                        <div class="text-sm font-black">ê°€ê²Œ ì •ë³´</div>
                        <div class="mt-2">
                            <img id="storeThumb" src="/uploads/no-image.png"
                                class="w-full h-[120px] rounded-xl object-cover bg-white border" alt="thumb" />
                        </div>
                        <div class="mt-2">
                            <div class="text-sm font-black" id="storeNameMini">ì„ íƒëœ ê°€ê²Œ ì—†ìŒ</div>
                            <div class="text-xs text-slate-600 mt-0.5" id="storeTypeMini">-</div>
                            <div class="text-xs text-slate-500 mt-0.5" id="storeBizMini">-</div>
                            <div class="text-xs text-blue-700 font-black mt-2" id="storeLocMini">í•˜ìœ„: -</div>
                        </div>
                    </div>

                    <!-- ê²€ìƒ‰ ê²°ê³¼ -->
                    <div class="md:col-span-7 soft p-3">
                        <div class="text-sm font-black mb-2">ê²€ìƒ‰ ê²°ê³¼</div>
                        <div id="searchResults" class="space-y-2"></div>
                    </div>

                    <!-- í˜„ì¬ ë“±ë¡ ìœ„ì¹˜ -->
                    <div class="md:col-span-12 soft p-3">
                        <div class="text-sm font-black mb-2">í˜„ì¬ ë“±ë¡ ìœ„ì¹˜(ì‚¬ì—…ìë²ˆí˜¸ ê¸°ì¤€)</div>
                        <div id="whereResults" class="space-y-2 text-sm text-slate-700">
                            <div class="text-slate-500">ê°€ê²Œë¥¼ ì„ íƒí•˜ë©´ ìë™ ì¡°íšŒë©ë‹ˆë‹¤.</div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- ìš°: í¸ì§‘ -->
            <section class="lg:col-span-6 neo p-4 flex flex-col" id="editPanel">
                <div>
                    <div class="font-extrabold">í¸ì§‘</div>
                    <div class="hint mt-1">
                        ì´ ë§¤ë‹ˆì €ëŠ” subcategory.html ì¶œë ¥ ê·œê²©(section/idx)ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
                    </div>
                </div>

                <!-- ë°°ì¹˜ ìœ„ì¹˜ ì„ íƒ -->
                <div class="mt-4 soft p-3" id="placementPanel">
                    <div class="flex items-center justify-between gap-2">
                        <div class="font-black">ë°°ì¹˜ ìœ„ì¹˜ ì„ íƒ</div>
                        <button class="btn btn-ghost" id="btnLoadGrid" type="button">ë°°ì¹˜í˜„í™© ìƒˆë¡œê³ ì¹¨</button>
                    </div>

                    <!-- ë°°ì¹˜í˜„í™© ìƒë‹¨ í•„í„°: ìƒìœ„ â†’ í•˜ìœ„ -->
                    <div class="mt-3 mb-2 grid grid-cols-1 md:grid-cols-12 gap-2 items-end">
                        <div class="md:col-span-5">
                            <label class="text-sm text-gray-600 font-black">ìƒìœ„ ì¹´í…Œê³ ë¦¬</label>
                            <select id="placementCatFilter" class="input">
                                <option value="">ì „ì²´</option>
                                <option value="í•œì‹">í•œì‹</option>
                                <option value="ì¤‘ì‹">ì¤‘ì‹</option>
                                <option value="ì¼ì‹">ì¼ì‹</option>
                                <option value="ì–‘ì‹">ì–‘ì‹</option>
                                <option value="ë¶„ì‹">ë¶„ì‹</option>
                                <option value="ì¹˜í‚¨">ì¹˜í‚¨</option>
                                <option value="í”¼ì">í”¼ì</option>
                                <option value="ì¹´í˜/ë””ì €íŠ¸">ì¹´í˜/ë””ì €íŠ¸</option>
                                <option value="ì•¼ì‹">ì•¼ì‹</option>
                                <option value="íŒ¨ìŠ¤íŠ¸í‘¸ë“œ">íŒ¨ìŠ¤íŠ¸í‘¸ë“œ</option>
                                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                            </select>
                        </div>

                        <div class="md:col-span-7">
                            <label class="text-sm text-gray-600 font-black">í•˜ìœ„ ì¹´í…Œê³ ë¦¬</label>
                            <select id="placementSubFilter" class="input" disabled>
                                <option value="">(ìƒìœ„ ì¹´í…Œê³ ë¦¬ë¥¼ ë¨¼ì € ì„ íƒ)</option>
                            </select>
                        </div>

                        <div class="md:col-span-12">
                            <div class="hint">
                                ìƒìœ„ ì¹´í…Œê³ ë¦¬ë¥¼ ê³ ë¥´ë©´ í•˜ìœ„ ì¹´í…Œê³ ë¦¬ ëª©ë¡ì´ ìë™ìœ¼ë¡œ ë°”ë€ë‹ˆë‹¤. (ì „ì²´=í•„í„° ì—†ìŒ)
                            </div>
                        </div>
                    </div>

                    <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div>
                            <div class="label">ì„¹ì…˜</div>
                            <select class="input" id="section">
                                <option value="all_items">All of the items</option>
                                <option value="best_seller">Best Seller</option>
                                <option value="new_registration">New registration</option>
                            </select>
                        </div>

                        <div>
                            <div class="label">í˜ì´ì§€</div>
                            <div class="flex gap-2">
                                <button class="btn btn-ghost" id="btnPrevPage" type="button">-</button>
                                <input class="input" id="pageNo" type="number" min="1" value="1" />
                                <button class="btn btn-ghost" id="btnNextPage" type="button">+</button>
                            </div>
                            <div class="hint mt-1">í•´ë‹¹ ì„¹ì…˜ì˜ í˜ì´ì§€ ë²ˆí˜¸</div>
                        </div>
                    </div>

                    <!-- ë°°ì¹˜í˜„í™©(12ì¹¸) + ì„ íƒì •ë³´(íŒŒë€ë°•ìŠ¤) -->
                    <div class="mt-3">
                        <div class="label">ë°°ì¹˜ í˜„í™© (12ì¹¸)</div>
                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 items-start">
                            <!-- ì™¼ìª½: 12ì¹¸ ê·¸ë¦¬ë“œ -->
                            <div class="lg:col-span-9">
                                <div id="grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3"></div>
                                <div class="hint mt-2">ë¹ˆì¹¸ì€ íšŒìƒ‰, ì‚¬ìš©ì¤‘ì€ íŒŒë€ìƒ‰ í…Œë‘ë¦¬ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</div>
                            </div>

                            <!-- ì˜¤ë¥¸ìª½: ì„ íƒ ì •ë³´(íŒŒë€ìƒ‰) -->
                            <div class="lg:col-span-3">
                                <div class="sticky top-4 rounded-xl border border-blue-200 bg-blue-50 p-4 shadow-sm">
                                    <div class="text-sm font-semibold text-blue-700">
                                        ì•„ë˜ ê·¸ë¦¬ë“œì—ì„œ í´ë¦­í•˜ì—¬ ì„ íƒ
                                    </div>

                                    <div class="mt-3 text-sm">
                                        <div class="text-blue-600/80">ìƒí˜¸</div>
                                        <div id="selectedBusinessName" class="mt-1 text-base font-bold text-blue-900">
                                            -
                                        </div>
                                    </div>

                                    <div class="mt-4 text-sm">
                                        <div class="text-blue-600/80">ì‚¬ì—…ì</div>
                                        <div id="selectedBusinessNo"
                                            class="mt-1 font-mono text-base font-bold text-blue-900">
                                            -
                                        </div>
                                    </div>

                                    <div class="mt-4 text-xs text-blue-700/80">
                                        ì„ íƒ ë°•ìŠ¤: <span id="selectedBoxNo">-</span>
                                    </div>

                                    <div class="hidden">
                                        <span id="pickedBoxText">-</span>
                                        <span id="pickedBoxPos">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- í¸ì§‘ ìœ„ì¹˜ ì„ íƒ -->
                <div class="mt-4">
                    <div class="label">í¸ì§‘ ìœ„ì¹˜ ì„ íƒ</div>
                    <select class="input" id="slotArea">
                        <option value="top">ìƒë‹¨ ë°°ë„ˆ(í˜ì´ì§€ ë§¨ ìœ„)</option>
                        <option value="all_items" selected>All of the items (12ì¹¸)</option>
                        <option value="best_seller">Best Seller (12ì¹¸)</option>
                        <option value="new_registration">New registration (12ì¹¸)</option>
                    </select>
                    <div class="hint mt-1">
                        ìƒë‹¨ ë°°ë„ˆëŠ” ê°€ê²Œ ì„ íƒ ì—†ì´ ì €ì¥ ê°€ëŠ¥. ê·¸ ì™¸ëŠ” 12ì¹¸ì—ì„œ idx ì„ íƒ í›„ ì €ì¥í•©ë‹ˆë‹¤.
                    </div>
                </div>

                <!-- íƒ€ì… ì„ íƒ -->
                <div class="mt-4">
                    <div class="label">ì‘ì—… ìœ í˜• ì„ íƒ</div>
                    <div class="seg">
                        <button type="button" id="btnPickImage" data-active="1">ì´ë¯¸ì§€</button>
                        <button type="button" id="btnPickStore" data-active="0">ê°€ê²Œì—°ê²°</button>
                        <button type="button" id="btnPickText" data-active="0">í…ìŠ¤íŠ¸</button>
                    </div>
                </div>

                <!-- ê°€ê²Œì—°ê²° -->
                <div class="mt-4 soft p-3" id="storeLinkInputs">
                    <div class="flex items-center justify-between gap-3">
                        <div class="font-black">ê°€ê²Œ ì—°ê²°</div>
                        <span class="chip" id="storeLocChip">í•˜ìœ„: -</span>
                    </div>

                    <div class="mt-3 grid grid-cols-12 gap-3 items-start">
                        <div class="col-span-5">
                            <img id="storeImage" src="/uploads/no-image.png"
                                class="w-full h-[120px] object-cover rounded-xl bg-white border" alt="store" />
                        </div>
                        <div class="col-span-7">
                            <div class="text-base font-black leading-tight" id="storeName">ì„ íƒëœ ê°€ê²Œ ì—†ìŒ</div>
                            <div class="text-sm text-slate-600 mt-1" id="storeType">-</div>
                            <div class="text-sm text-slate-500 mt-1" id="storeBiz">-</div>
                            <div class="text-sm text-blue-700 font-black mt-2" id="storeLocText">í•˜ìœ„: -</div>

                            <div class="mt-3 flex flex-wrap gap-2">
                                <button class="btn btn-ghost" id="btnUseStore" type="button">ì´ ê°€ê²Œë¡œ ì—°ê²°</button>
                                <button class="btn btn-ghost" id="btnUseStoreImage" type="button">ê°€ê²Œ ì´ë¯¸ì§€ë¡œ ë°°ë„ˆ</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- í…ìŠ¤íŠ¸ -->
                <div class="mt-4 soft p-3 hidden" id="textInputs">
                    <div class="font-black">í…ìŠ¤íŠ¸ ì…ë ¥</div>
                    <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <div class="label">í…ìŠ¤íŠ¸ ì œëª©</div>
                            <input class="input" id="textTitle" placeholder="ì œëª©" />
                        </div>
                        <div>
                            <div class="label">í…ìŠ¤íŠ¸ ì„¤ëª…</div>
                            <input class="input" id="textDesc" placeholder="ì„¤ëª…" />
                        </div>
                    </div>
                </div>

                <!-- ê³µí†µ ì˜µì…˜ -->
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <div class="label">ê¸°ê°„ ì‹œì‘(ì„ íƒ)</div>
                        <input class="input" id="startAt" type="datetime-local" />
                    </div>
                    <div>
                        <div class="label">ê¸°ê°„ ì¢…ë£Œ(ì„ íƒ)</div>
                        <input class="input" id="endAt" type="datetime-local" />
                    </div>
                    <div class="md:col-span-2">
                        <label class="inline-flex items-center gap-2 select-none">
                            <input id="noEnd" type="checkbox" class="h-4 w-4" />
                            <span class="text-sm text-slate-700 font-black">ì¢…ë£Œ ì—†ìŒ(no_end)</span>
                        </label>
                    </div>
                </div>

                <input type="hidden" id="storeId" />
                <input type="hidden" id="storeBusinessNumber" />
                <input type="hidden" id="storeNameHidden" />
                <input type="hidden" id="storeTypeHidden" />
                <input type="hidden" id="storeImageUrl" />
                <input type="hidden" id="priorityHidden" value="1" />

                <!-- ë§ˆì§€ë§‰ ì…ë ¥ ì˜ì—­: í•­ìƒ ë³´ì´ê²Œ sticky -->
                <div class="sticky-actions">
                    <div class="space-y-3">
                        <div id="statusBar" class="statusbar status-warn">
                            <div class="text-sm font-black" id="statusText">ëŒ€ê¸° ì¤‘: 12ì¹¸ì—ì„œ idxë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
                            <div class="text-xs text-slate-600 mt-1" id="statusSub">-</div>
                        </div>

                        <div class="flex items-center justify-end gap-2">
                            <button class="btn btn-primary" id="btnSave" type="button">ì €ì¥</button>
                            <button class="btn btn-danger" id="btnDelete" type="button">ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            </section>
        </section>
    </main>

    <div id="footer-placeholder"></div>

    <script>
        const PAGE_NAME = "subcategory";
        const DEFAULT_PRIORITY = 1;

        // âœ… í‘¸ë“œ ê³ ì •
        const MODE = "food";
        const API_BASE = "/subcategorymanager_food/ad";

        // ë‚´ë¶€ ìƒíƒœ
        let uiPick = "image";
        let selectedStore = null;

        // section/idx ê¸°ë°˜ íƒ€ê²Ÿ
        let selectedTarget = {
            section: "all_items",
            pageNo: 1,
            idx: null,          // 1~12
            priority: DEFAULT_PRIORITY
        };

        // í—¤ë” ì‚½ì… í›„ id ì¶©ëŒ ë°©ì§€: main ë‚´ë¶€ë¥¼ ë¨¼ì € ì°¾ê³ , ì—†ìœ¼ë©´ documentì—ì„œ ì°¾ê¸°
        const MAIN_ROOT = document.querySelector("main");
        function $(id) {
            if (MAIN_ROOT) {
                const el = MAIN_ROOT.querySelector(`#${id}`);
                if (el) return el;
            }
            return document.getElementById(id);
        }

        function nowStr() {
            const d = new Date();
            const pad = (n) => String(n).padStart(2, "0");
            return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
        }

        function setStatus(type, text, sub = "") {
            const bar = $("statusBar");
            bar.classList.remove("status-ok", "status-bad", "status-warn");
            bar.classList.add(type === "ok" ? "status-ok" : type === "bad" ? "status-bad" : "status-warn");
            $("statusText").textContent = text;
            $("statusSub").textContent = sub || "-";
        }

        function setBusy(on, msg) {
            const save = $("btnSave");
            const del = $("btnDelete");
            const search = $("btnSearch");
            const bsave = $("btnBannerSave");
            const bdel = $("btnBannerDelete");

            [save, del, search, bsave, bdel].forEach((el) => {
                if (!el) return;
                el.disabled = !!on;
                el.classList.toggle("opacity-60", !!on);
            });

            if (on && msg) setStatus("warn", msg, `ì‹œê°„: ${nowStr()}`);
        }

        function digitsOnly(v) { return String(v ?? "").replace(/[^\d]/g, ""); }

        // ìƒìœ„ ì¹´í…Œê³ ë¦¬ â†’ í•˜ìœ„ ì¹´í…Œê³ ë¦¬ ë§¤í•‘
        const SUB_BY_CATEGORY = {
            "í•œì‹": ["ë°¥", "ì°Œê°œ/íƒ•", "ê³ ê¸°/êµ¬ì´", "ìƒì„ ", "ì¡±ë°œ/ë³´ìŒˆ", "êµ­ë°¥", "ë°˜ì°¬", "ê¸°íƒ€"],
            "ì¤‘ì‹": ["ì§œì¥", "ì§¬ë½•", "íƒ•ìˆ˜ìœ¡", "ë§ˆë¼", "ë”¤ì„¬", "ê¸°íƒ€"],
            "ì¼ì‹": ["ì´ˆë°¥", "ë¼ë©˜", "ëˆì¹´ì¸ ", "ìš°ë™/ì†Œë°”", "ê¸°íƒ€"],
            "ì–‘ì‹": ["íŒŒìŠ¤íƒ€", "ìŠ¤í…Œì´í¬", "ìƒëŸ¬ë“œ", "í”¼ì(ì–‘ì‹)", "ê¸°íƒ€"],
            "ë¶„ì‹": ["ë–¡ë³¶ì´", "ê¹€ë°¥", "ìˆœëŒ€", "íŠ€ê¹€", "ë¼ë©´", "ê¸°íƒ€"],
            "ì¹˜í‚¨": ["í›„ë¼ì´ë“œ", "ì–‘ë…", "ê°„ì¥", "íŒŒë‹­", "ê¸°íƒ€"],
            "í”¼ì": ["ì˜¤ë¦¬ì§€ë„", "ì”¬", "í”„ë¦¬ë¯¸ì—„", "ê¸°íƒ€"],
            "ì¹´í˜/ë””ì €íŠ¸": ["ì»¤í”¼", "ìŒë£Œ", "ì¼€ì´í¬", "ë¹µ", "ë¹™ìˆ˜", "ê¸°íƒ€"],
            "ì•¼ì‹": ["ì¡±ë°œ/ë³´ìŒˆ(ì•¼ì‹)", "ì°œ/íƒ•(ì•¼ì‹)", "ë¶„ì‹(ì•¼ì‹)", "ê¸°íƒ€"],
            "íŒ¨ìŠ¤íŠ¸í‘¸ë“œ": ["ë²„ê±°", "ì¹˜í‚¨(íŒ¨í‘¸)", "ìƒŒë“œìœ„ì¹˜", "ê¸°íƒ€"],
            "ê¸°íƒ€": ["ê¸°íƒ€"],
        };

        function setSubcategoryOptionsByCategory(cat) {
            const subSel = $("placementSubFilter");
            if (!subSel) return;

            subSel.innerHTML = "";

            if (!cat) {
                subSel.disabled = true;
                subSel.innerHTML = `<option value="">(ìƒìœ„ ì¹´í…Œê³ ë¦¬ë¥¼ ë¨¼ì € ì„ íƒ)</option>`;
                return;
            }

            const subs = SUB_BY_CATEGORY[cat] || [];
            subSel.disabled = false;

            const optAll = document.createElement("option");
            optAll.value = "";
            optAll.textContent = "ì „ì²´";
            subSel.appendChild(optAll);

            for (const s of subs) {
                const opt = document.createElement("option");
                opt.value = s;
                opt.textContent = s;
                subSel.appendChild(opt);
            }
        }

        function initCategoryFilterUI() {
            const catSel = $("placementCatFilter");
            const subSel = $("placementSubFilter");
            if (!catSel || !subSel) return;

            setSubcategoryOptionsByCategory(catSel.value || "");

            catSel.addEventListener("change", () => {
                const cat = catSel.value || "";
                setSubcategoryOptionsByCategory(cat);
                if (subSel && !subSel.disabled) subSel.value = "";
                loadGrid();
            });

            subSel.addEventListener("change", () => {
                loadGrid();
            });
        }

        async function tryFetchJson(url, options) {
            const res = await fetch(url, options);
            let data = null;
            try { data = await res.json(); } catch (_e) { }
            if (!res.ok) {
                const msg = data?.error || data?.message || `HTTP ${res.status}`;
                throw new Error(msg);
            }
            return data;
        }

        async function apiFetch(path, options) {
            return await tryFetchJson(`${API_BASE}${path}`, options);
        }

        function syncChips() {
            $("chipApiBase").textContent = `API: ${API_BASE}`;
            $("chipMode").textContent = `ëª¨ë“œ: food(ê³ ì •)`;
            const s = selectedTarget.section || "-";
            const p = selectedTarget.pageNo || "-";
            const i = selectedTarget.idx || "-";
            $("chipPosition").textContent = `ì„ íƒ: ${s} / p${p} / idx ${i}`;
        }

        // ë°°ë„ˆ ë©”ì‹œì§€(ë²„íŠ¼ ë°”ë¡œ ì•„ë˜)
        function showBannerMsg(type, text) {
            const box = $("bannerMsg");
            box.className = `banner-msg ${type}`;
            box.textContent = text;
            box.classList.remove("hidden");
        }

        function hideBannerMsg() {
            const box = $("bannerMsg");
            box.classList.add("hidden");
            box.textContent = "";
        }

        function setBannerPreview(src) {
            $("bannerPreview").src = src || "/uploads/no-image.png";
        }

        function setPick(next) {
            uiPick = next;

            const btnImage = $("btnPickImage");
            const btnStore = $("btnPickStore");
            const btnText = $("btnPickText");
            
            if (btnImage) btnImage.setAttribute("data-active", uiPick === "image" ? "1" : "0");
            if (btnStore) btnStore.setAttribute("data-active", uiPick === "store" ? "1" : "0");
            if (btnText) btnText.setAttribute("data-active", uiPick === "text" ? "1" : "0");

            const storeLinkInputs = $("storeLinkInputs");
            const textInputs = $("textInputs");
            
            if (storeLinkInputs) storeLinkInputs.classList.toggle("hidden", uiPick !== "store");
            if (textInputs) textInputs.classList.toggle("hidden", uiPick !== "text");
        }

        $("btnPickImage").addEventListener("click", () => setPick("image"));
        $("btnPickStore").addEventListener("click", () => setPick("store"));
        $("btnPickText").addEventListener("click", () => setPick("text"));

        // ë°°ë„ˆ: section=top idx=1 ê³ ì •
        function syncBannerUI() {
            // í‘¸ë“œ ì „ìš© ë°°ë„ˆëŠ” section=top, idx=1 ê³ ì •
        }

        // ========== ì´ë¯¸ì§€ ë°°ë„ˆ (idx=1) ==========
        function showImageBannerMsg(type, msg) {
            const el = $("imageBannerMsg");
            el.className = `mt-3 banner-msg ${type}`;
            el.textContent = msg;
            el.classList.remove("hidden");
        }
        function hideImageBannerMsg() {
            $("imageBannerMsg").classList.add("hidden");
        }

        async function loadImageBanner(silent = false) {
            try {
                if (!silent) setStatus("warn", "ì´ë¯¸ì§€ ë°°ë„ˆ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...", `ì‹œê°„: ${nowStr()}`);
                const qs = new URLSearchParams({
                    page: PAGE_NAME,
                    mode: MODE,
                    section: "top",
                    idx: "1"
                }).toString();
                const data = await apiFetch(`/slot?${qs}`);
                const slot = data?.slot || null;

                if (!slot) {
                    $("imageBannerPreview").src = "/uploads/no-image.png";
                    $("imageBannerLink").value = "";
                    if (!silent) setStatus("warn", "ì´ë¯¸ì§€ ë°°ë„ˆ ì—†ìŒ", `ì‹œê°„: ${nowStr()}`);
                    return;
                }

                if (slot.image_url) $("imageBannerPreview").src = slot.image_url;
                $("imageBannerLink").value = slot.link_url || "";
                if (!silent) setStatus("ok", "ì´ë¯¸ì§€ ë°°ë„ˆ ë¡œë“œ ì™„ë£Œ", `ì‹œê°„: ${nowStr()}`);
            } catch (e) {
                if (!silent) setStatus("bad", "ì´ë¯¸ì§€ ë°°ë„ˆ ë¡œë“œ ì‹¤íŒ¨", `${e.message}`);
            }
        }

        async function saveImageBanner() {
            try {
                hideImageBannerMsg();
                setBusy(true, "ì´ë¯¸ì§€ ë°°ë„ˆ ì €ì¥ ì¤‘...");

                const linkUrl = $("imageBannerLink").value || "";
                const fileInput = $("imageBannerFile");
                const file = fileInput?.files?.[0] || null;

                if (!file) throw new Error("ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”");

                const fd = new FormData();
                fd.append("page", PAGE_NAME);
                fd.append("mode", MODE);
                fd.append("section", "top");
                fd.append("idx", "1");
                fd.append("priority", "1");
                fd.append("adMode", "banner");
                fd.append("slotMode", "custom");
                if (linkUrl) fd.append("linkUrl", linkUrl);
                fd.append("image", file);

                const data = await apiFetch(`/update`, { method: "POST", body: fd });
                if (!data.success) throw new Error(data.error || "ì €ì¥ ì‹¤íŒ¨");

                const slot = data.slot || null;
                if (slot?.image_url) $("imageBannerPreview").src = slot.image_url;

                $("imageBannerFile").value = "";
                showImageBannerMsg("ok", `ì´ë¯¸ì§€ ë°°ë„ˆ ì €ì¥ ì™„ë£Œ âœ… (${nowStr()})`);
                setStatus("ok", "ì´ë¯¸ì§€ ë°°ë„ˆ ì €ì¥ ì™„ë£Œ", `ì‹œê°„: ${nowStr()}`);
            } catch (e) {
                showImageBannerMsg("bad", `ì €ì¥ ì‹¤íŒ¨ âŒ: ${e.message}`);
                setStatus("bad", "ì´ë¯¸ì§€ ë°°ë„ˆ ì €ì¥ ì‹¤íŒ¨", e.message);
            } finally {
                setBusy(false);
            }
        }

        async function deleteImageBanner() {
            try {
                hideImageBannerMsg();
                setBusy(true, "ì´ë¯¸ì§€ ë°°ë„ˆ ì‚­ì œ ì¤‘...");

                const qs = new URLSearchParams({
                    page: PAGE_NAME,
                    mode: MODE,
                    section: "top",
                    idx: "1"
                }).toString();

                const data = await apiFetch(`/delete?${qs}`, { method: "DELETE" });
                if (!data.success) throw new Error(data.error || "ì‚­ì œ ì‹¤íŒ¨");

                $("imageBannerPreview").src = "/uploads/no-image.png";
                $("imageBannerLink").value = "";
                $("imageBannerFile").value = "";

                showImageBannerMsg("ok", `ì´ë¯¸ì§€ ë°°ë„ˆ ì‚­ì œ ì™„ë£Œ âœ… (${nowStr()})`);
                setStatus("ok", "ì´ë¯¸ì§€ ë°°ë„ˆ ì‚­ì œ ì™„ë£Œ", `ì‹œê°„: ${nowStr()}`);
            } catch (e) {
                showImageBannerMsg("bad", `ì‚­ì œ ì‹¤íŒ¨ âŒ: ${e.message}`);
                setStatus("bad", "ì´ë¯¸ì§€ ë°°ë„ˆ ì‚­ì œ ì‹¤íŒ¨", e.message);
            } finally {
                setBusy(false);
            }
        }

        // ========== í…ìŠ¤íŠ¸ ë°°ë„ˆ (idx=2) ==========
        function showTextBannerMsg(type, msg) {
            const el = $("textBannerMsg");
            el.className = `mt-3 banner-msg ${type}`;
            el.textContent = msg;
            el.classList.remove("hidden");
        }
        function hideTextBannerMsg() {
            $("textBannerMsg").classList.add("hidden");
        }

        function updateTextPreview() {
            const textInput = $("textBannerText");
            const fontSizeInput = $("textFontSize");
            const fontWeightInput = $("textFontWeight");
            const colorInput = $("textColor");
            const bgColorInput = $("textBgColor");

            const text = textInput?.value || "í…ìŠ¤íŠ¸ ë¯¸ë¦¬ë³´ê¸°";
            const fontSize = fontSizeInput?.value || "24";
            const fontWeight = fontWeightInput?.value || "700";
            const color = colorInput?.value || "#1e293b";
            const bgColor = bgColorInput?.value || "#ffffff";

            // Title ì—…ë°ì´íŠ¸
            const preview = $("textBannerPreview");
            if (preview) {
                preview.textContent = text;
                preview.style.fontSize = `${fontSize}px`;
                preview.style.fontWeight = fontWeight;
                preview.style.color = color;
            }

            // Subtitle ì—…ë°ì´íŠ¸ (ë°°ê²½ìƒ‰ ì ìš©)
            const subtitlePreview = $("textBannerSubtitlePreview");
            if (subtitlePreview) {
                subtitlePreview.style.backgroundColor = bgColor;
            }
        }

        async function loadTextBanner(silent = false) {
            try {
                if (!silent) setStatus("warn", "í…ìŠ¤íŠ¸ ë°°ë„ˆ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...", `ì‹œê°„: ${nowStr()}`);
                const qs = new URLSearchParams({
                    page: PAGE_NAME,
                    mode: MODE,
                    section: "top",
                    idx: "2"
                }).toString();
                const data = await apiFetch(`/slot?${qs}`);
                const slot = data?.slot || null;

                if (!slot) {
                    $("textBannerText").value = "";
                    updateTextPreview(); // âœ… ê¸°ë³¸ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                    if (!silent) setStatus("warn", "í…ìŠ¤íŠ¸ ë°°ë„ˆ ì—†ìŒ", `ì‹œê°„: ${nowStr()}`);
                    return;
                }

                $("textBannerText").value = slot.title || slot.text || "";
                
                // ìŠ¤íƒ€ì¼ ì •ë³´ íŒŒì‹± (subtitleì— JSON ì €ì¥)
                try {
                    const style = JSON.parse(slot.subtitle || "{}");
                    $("textFontSize").value = style.fontSize || "24";
                    $("textFontWeight").value = style.fontWeight || "700";
                    $("textColor").value = style.color || "#1e293b";
                    $("textBgColor").value = style.bgColor || "#ffffff";
                } catch {}

                updateTextPreview(); // âœ… ë¡œë“œëœ ê°’ìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
                if (!silent) setStatus("ok", "í…ìŠ¤íŠ¸ ë°°ë„ˆ ë¡œë“œ ì™„ë£Œ", `ì‹œê°„: ${nowStr()}`);
            } catch (e) {
                updateTextPreview(); // âœ… ì˜¤ë¥˜ ì‹œì—ë„ ê¸°ë³¸ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                if (!silent) setStatus("bad", "í…ìŠ¤íŠ¸ ë°°ë„ˆ ë¡œë“œ ì‹¤íŒ¨", `${e.message}`);
            }
        }

        async function saveTextBanner() {
            try {
                hideTextBannerMsg();
                setBusy(true, "í…ìŠ¤íŠ¸ ë°°ë„ˆ ì €ì¥ ì¤‘...");

                const text = $("textBannerText").value || "";
                if (!text.trim()) throw new Error("í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”");

                const fontSize = $("textFontSize").value || "24";
                const fontWeight = $("textFontWeight").value || "700";
                const color = $("textColor").value || "#1e293b";
                const bgColor = $("textBgColor").value || "#ffffff";

                const styleJson = JSON.stringify({ fontSize, fontWeight, color, bgColor });

                const fd = new FormData();
                fd.append("page", PAGE_NAME);
                fd.append("mode", MODE);
                fd.append("section", "top");
                fd.append("idx", "2");
                fd.append("priority", "1");
                fd.append("adMode", "text");
                fd.append("slotMode", "custom");
                fd.append("title", text);
                fd.append("subtitle", styleJson); // ìŠ¤íƒ€ì¼ ì •ë³´ ì €ì¥

                const data = await apiFetch(`/update`, { method: "POST", body: fd });
                if (!data.success) throw new Error(data.error || "ì €ì¥ ì‹¤íŒ¨");

                updateTextPreview();
                showTextBannerMsg("ok", `í…ìŠ¤íŠ¸ ë°°ë„ˆ ì €ì¥ ì™„ë£Œ âœ… (${nowStr()})`);
                setStatus("ok", "í…ìŠ¤íŠ¸ ë°°ë„ˆ ì €ì¥ ì™„ë£Œ", `ì‹œê°„: ${nowStr()}`);
            } catch (e) {
                showTextBannerMsg("bad", `ì €ì¥ ì‹¤íŒ¨ âŒ: ${e.message}`);
                setStatus("bad", "í…ìŠ¤íŠ¸ ë°°ë„ˆ ì €ì¥ ì‹¤íŒ¨", e.message);
            } finally {
                setBusy(false);
            }
        }

        async function deleteTextBanner() {
            try {
                hideTextBannerMsg();
                setBusy(true, "í…ìŠ¤íŠ¸ ë°°ë„ˆ ì‚­ì œ ì¤‘...");

                const qs = new URLSearchParams({
                    page: PAGE_NAME,
                    mode: MODE,
                    section: "top",
                    idx: "2"
                }).toString();

                const data = await apiFetch(`/delete?${qs}`, { method: "DELETE" });
                if (!data.success) throw new Error(data.error || "ì‚­ì œ ì‹¤íŒ¨");

                $("textBannerText").value = "";
                $("textFontSize").value = "24";
                $("textFontWeight").value = "700";
                $("textColor").value = "#1e293b";
                $("textBgColor").value = "#ffffff";
                updateTextPreview();

                showTextBannerMsg("ok", `í…ìŠ¤íŠ¸ ë°°ë„ˆ ì‚­ì œ ì™„ë£Œ âœ… (${nowStr()})`);
                setStatus("ok", "í…ìŠ¤íŠ¸ ë°°ë„ˆ ì‚­ì œ ì™„ë£Œ", `ì‹œê°„: ${nowStr()}`);
            } catch (e) {
                showTextBannerMsg("bad", `ì‚­ì œ ì‹¤íŒ¨ âŒ: ${e.message}`);
                setStatus("bad", "í…ìŠ¤íŠ¸ ë°°ë„ˆ ì‚­ì œ ì‹¤íŒ¨", e.message);
            } finally {
                setBusy(false);
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        $("btnImageBannerSave").addEventListener("click", saveImageBanner);
        $("btnImageBannerDelete").addEventListener("click", deleteImageBanner);
        $("btnImageClear").addEventListener("click", () => {
            $("imageBannerFile").value = "";
            $("imageBannerPreview").src = "/uploads/no-image.png";
            showImageBannerMsg("warn", "ì´ë¯¸ì§€ ì·¨ì†Œë¨");
        });

        $("btnTextBannerSave").addEventListener("click", saveTextBanner);
        $("btnTextBannerDelete").addEventListener("click", deleteTextBanner);
        $("btnTextPreview").addEventListener("click", updateTextPreview);

        $("imageBannerFile").addEventListener("change", (e) => {
            const f = e.target.files?.[0];
            if (!f) return;
            hideImageBannerMsg();
            $("imageBannerPreview").src = URL.createObjectURL(f);
        });

        function toIsoLocalInputValue(iso) {
            if (!iso) return "";
            const d = new Date(iso);
            if (Number.isNaN(d.getTime())) return "";
            const pad = (n) => String(n).padStart(2, "0");
            return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
        }

        // âœ… í•˜ìœ„ì¹´í…Œê³ ë¦¬ í‘œì‹œ ìš°ì„ : business_subcategory
        function subLabel(store) {
            const sub = store?.business_subcategory || store?.detail_category || "";
            return sub ? `í•˜ìœ„: ${sub}` : "í•˜ìœ„: -";
        }

        function setMiniStoreInfo(store) {
            if (!store) {
                $("storeThumb").src = "/uploads/no-image.png";
                $("storeNameMini").textContent = "ì„ íƒëœ ê°€ê²Œ ì—†ìŒ";
                $("storeTypeMini").textContent = "-";
                $("storeBizMini").textContent = "-";
                $("storeLocMini").textContent = "í•˜ìœ„: -";
                return;
            }
            $("storeThumb").src = store.image_url || "/uploads/no-image.png";
            $("storeNameMini").textContent = store.business_name || "-";
            $("storeTypeMini").textContent = store.business_type || "-";
            $("storeBizMini").textContent = store.business_number ? `ì‚¬ì—…ìë²ˆí˜¸: ${store.business_number}` : "-";
            $("storeLocMini").textContent = subLabel(store);
        }

        function setStoreBox(store) {
            if (!store) {
                $("storeName").textContent = "ì„ íƒëœ ê°€ê²Œ ì—†ìŒ";
                $("storeType").textContent = "-";
                $("storeBiz").textContent = "-";
                $("storeImage").src = "/uploads/no-image.png";
                $("storeLocChip").textContent = "í•˜ìœ„: -";
                $("storeLocText").textContent = "í•˜ìœ„: -";
                return;
            }
            $("storeName").textContent = store.business_name || "-";
            $("storeType").textContent = `${store.business_type || "-"} / ìƒìœ„:${store.business_category || "-"} / í•˜ìœ„:${store.business_subcategory || "-"}`;
            $("storeBiz").textContent = store.business_number ? `ì‚¬ì—…ìë²ˆí˜¸: ${store.business_number}` : "-";
            $("storeImage").src = store.image_url || "/uploads/no-image.png";
            $("storeLocChip").textContent = subLabel(store);
            $("storeLocText").textContent = subLabel(store);
        }

        function getSlotModeByPick() { return uiPick === "store" ? "store" : "custom"; }
        function getSlotTypeByPick() { return uiPick === "text" ? "text" : "banner"; }

        // âœ… subcategory.html ê·œê²©: section + idx ê¸°ë°˜ ìŠ¬ë¡¯ ë¡œë“œ
        async function loadSlot(silent = false) {
            try {
                const section = selectedTarget.section || $("section")?.value || "all_items";
                const idx = selectedTarget.idx;
                const priority = String(selectedTarget.priority || DEFAULT_PRIORITY);
                const pageNo = String(selectedTarget.pageNo || Number($("pageNo")?.value || 1));
                const category = $("placementCatFilter")?.value || "";
                const subcategory = $("placementSubFilter")?.disabled ? "" : ($("placementSubFilter")?.value || "");

                if (!idx) return;

                if (!silent) {
                    syncChips();
                    setStatus("warn", "ìŠ¬ë¡¯ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...", `section:${section} idx:${idx} / ì‹œê°„: ${nowStr()}`);
                }

                const qs = new URLSearchParams({
                    page: PAGE_NAME,
                    mode: MODE,
                    section,
                    idx: String(idx),
                    priority,
                    pageNo,
                });

                if (category) qs.append("category", category);
                if (subcategory) qs.append("subcategory", subcategory);

                const data = await apiFetch(`/slot?${qs.toString()}`);
                const slot = data?.slot || null;

                if (!slot) {
                    if (!silent) setStatus("warn", "ì €ì¥ëœ ìŠ¬ë¡¯ì´ ì—†ìŠµë‹ˆë‹¤", "ê°€ê²Œ ì—°ê²°/ì´ë¯¸ì§€/í…ìŠ¤íŠ¸ ì„¤ì • í›„ ì €ì¥í•˜ë©´ ìƒì„±ë©ë‹ˆë‹¤.");
                    return;
                }

                $("linkUrl").value = slot.link_url || "";
                $("textTitle").value = slot.text_title || "";
                $("textDesc").value = slot.text_desc || "";
                $("noEnd").checked = !!slot.no_end;
                $("startAt").value = toIsoLocalInputValue(slot.start_at);
                $("endAt").value = toIsoLocalInputValue(slot.end_at);

                if (slot.image_url) setBannerPreview(slot.image_url);

                $("storeId").value = slot.store_id ?? "";
                $("storeBusinessNumber").value = slot.store_business_number ?? slot.business_number ?? "";
                $("storeNameHidden").value = slot.store_name ?? slot.business_name ?? "";
                $("storeTypeHidden").value = slot.store_type ?? slot.business_type ?? "";
                $("storeImageUrl").value = slot.store_image_url ?? slot.store_image ?? "";

                if (slot.slot_type === "text") setPick("text");
                else if (slot.slot_mode === "store") setPick("store");
                else setPick("image");

                if (!silent) setStatus("ok", "ìŠ¬ë¡¯ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ", `section:${section} idx:${idx} / ì‹œê°„: ${nowStr()}`);
            } catch (e) {
                if (!silent) setStatus("bad", "ìŠ¬ë¡¯ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", `${e.message} / ì‹œê°„: ${nowStr()}`);
            }
        }

        async function saveSlot() {
            try {
                const section = selectedTarget.section || $("section")?.value || "all_items";
                const idx = selectedTarget.idx;
                const priority = String(selectedTarget.priority || DEFAULT_PRIORITY);
                const pageNo = String(selectedTarget.pageNo || Number($("pageNo")?.value || 1));
                const category = $("placementCatFilter")?.value || "";
                const subcategory = $("placementSubFilter")?.disabled ? "" : ($("placementSubFilter")?.value || "");

                if (!idx) {
                    setStatus("bad", "ì €ì¥ ì‹¤íŒ¨", "ë¨¼ì € 12ì¹¸ì—ì„œ ë°•ìŠ¤ë¥¼ í´ë¦­í•´ì„œ idxë¥¼ ì„ íƒí•˜ì„¸ìš”.");
                    return;
                }

                setBusy(true, "ì €ì¥ ì¤‘...");
                syncChips();

                const fd = new FormData();
                fd.append("page", PAGE_NAME);
                fd.append("mode", MODE);
                fd.append("section", section);
                fd.append("idx", String(idx));
                fd.append("priority", priority);
                fd.append("pageNo", pageNo);

                if (category) fd.append("category", category);
                if (subcategory) fd.append("subcategory", subcategory);

                fd.append("adMode", getSlotTypeByPick());
                fd.append("slotMode", getSlotModeByPick());

                fd.append("linkUrl", $("linkUrl").value || "");
                fd.append("textTitle", $("textTitle").value || "");
                fd.append("textDesc", $("textDesc").value || "");

                fd.append("noEnd", $("noEnd").checked ? "true" : "false");
                fd.append("startAt", $("startAt").value || "");
                fd.append("endAt", $("endAt").value || "");

                if (uiPick === "store") {
                    if ($("storeId").value) fd.append("storeId", $("storeId").value);
                    if ($("storeBusinessNumber").value) fd.append("storeBusinessNumber", $("storeBusinessNumber").value);
                    if ($("storeNameHidden").value) fd.append("storeName", $("storeNameHidden").value);
                    if ($("storeTypeHidden").value) fd.append("storeType", $("storeTypeHidden").value);
                }

                const storeImageUrl = $("storeImageUrl").value || "";
                if (storeImageUrl) fd.append("storeImageUrl", storeImageUrl);

                const f = $("bannerFile").files?.[0];
                if (uiPick !== "text" && f) fd.append("image", f);

                const data = await apiFetch(`/update`, { method: "POST", body: fd });
                if (!data.success) throw new Error(data.error || "ì €ì¥ ì‹¤íŒ¨");

                const slot = data.slot || null;
                if (slot?.image_url && uiPick !== "text") setBannerPreview(slot.image_url);
                $("bannerFile").value = "";

                await loadGrid();

                setStatus("ok", "ì €ì¥ ì™„ë£Œ âœ…", `section:${section} / p${pageNo} / idx:${idx} / ì‹œê°„: ${nowStr()}`);
            } catch (e) {
                setStatus("bad", "ì €ì¥ ì‹¤íŒ¨ âŒ", `${e.message} / ì‹œê°„: ${nowStr()}`);
            } finally {
                setBusy(false);
            }
        }

        async function deleteSlot() {
            try {
                const section = selectedTarget.section || $("section")?.value || "all_items";
                const idx = selectedTarget.idx;
                const priority = String(selectedTarget.priority || DEFAULT_PRIORITY);
                const pageNo = String(selectedTarget.pageNo || Number($("pageNo")?.value || 1));
                const category = $("placementCatFilter")?.value || "";
                const subcategory = $("placementSubFilter")?.disabled ? "" : ($("placementSubFilter")?.value || "");

                if (!idx) {
                    setStatus("bad", "ì‚­ì œ ì‹¤íŒ¨", "ë¨¼ì € 12ì¹¸ì—ì„œ ë°•ìŠ¤ë¥¼ í´ë¦­í•´ì„œ idxë¥¼ ì„ íƒí•˜ì„¸ìš”.");
                    return;
                }

                setBusy(true, "ì‚­ì œ ì¤‘...");
                syncChips();

                const qs = new URLSearchParams({
                    page: PAGE_NAME,
                    mode: MODE,
                    section,
                    idx: String(idx),
                    priority,
                    pageNo,
                });

                if (category) qs.append("category", category);
                if (subcategory) qs.append("subcategory", subcategory);

                const data = await apiFetch(`/delete?${qs.toString()}`, { method: "DELETE" });
                if (!data.success) throw new Error(data.error || "ì‚­ì œ ì‹¤íŒ¨");

                const delCount = Number(data.deleted || 0);
                if (delCount === 0) {
                    setStatus("bad", "ì‚­ì œ ì‹¤íŒ¨ âŒ", `ì„œë²„ì—ì„œ ì‚­ì œëœ í–‰ì´ 0ê°œ(í‚¤ ë¶ˆì¼ì¹˜). section=${section}, idx=${idx}, priority=${priority}`);
                    return;
                }

                await loadSlot(true);
                await loadGrid();

                setStatus("ok", "ì‚­ì œ ì™„ë£Œ âœ…", `deleted=${delCount} / section:${section} idx:${idx} / ì‹œê°„:${nowStr()}`);
            } catch (e) {
                setStatus("bad", "ì‚­ì œ ì‹¤íŒ¨ âŒ", `${e.message} / ì‹œê°„: ${nowStr()}`);
            } finally {
                setBusy(false);
            }
        }

        $("btnSave").addEventListener("click", saveSlot);
        $("btnDelete").addEventListener("click", deleteSlot);

        async function hydrateLayout() {
            try {
                const h = await fetch("/components/header.html").then(r => r.text());
                $("header-placeholder").innerHTML = h;
            } catch (_e) { }
            try {
                const f = await fetch("/components/footer.html").then(r => r.text());
                $("footer-placeholder").innerHTML = f;
            } catch (_e) { }
        }

        // âœ… ê²€ìƒ‰ì€ food ê³ ì •
        function renderSearchResults(results) {
            const list = $("searchResults");
            list.innerHTML = "";

            if (!results || results.length === 0) {
                list.innerHTML = `<div class="text-sm text-slate-500">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div>`;
                return;
            }

            for (const r of results) {
                const btn = document.createElement("button");
                btn.type = "button";
                btn.className = "result-item w-full text-left soft p-3";
                btn.innerHTML = `
          <div class="flex items-start justify-between gap-2">
            <div>
              <div class="font-black">${r.business_name || ""}</div>
              <div class="text-sm text-slate-600 mt-0.5">${r.business_type || ""}</div>
              <div class="text-xs text-blue-700 font-black mt-1">
                ìƒìœ„: ${r.business_category || "-"} / í•˜ìœ„: ${r.business_subcategory || "-"}
              </div>
              <div class="text-[11px] text-slate-500 mt-1 break-all">
                ì‚¬ì—…ì: <b>${r.business_number || "-"}</b>
              </div>
            </div>
            <div class="shrink-0">
              <img src="${r.image_url || "/uploads/no-image.png"}"
                   class="w-12 h-12 rounded-xl object-cover border bg-white" alt="thumb">
            </div>
          </div>
        `;

                btn.addEventListener("click", async () => {
                    selectedStore = r;

                    setMiniStoreInfo(r);
                    setStoreBox(r);

                    $("storeId").value = r.id || "";
                    $("storeBusinessNumber").value = r.business_number || "";
                    $("storeNameHidden").value = r.business_name || "";
                    $("storeTypeHidden").value = r.business_type || "";
                    $("storeImageUrl").value = r.image_url || "";

                    setStatus("ok", "ê°€ê²Œ ì„ íƒë¨", `í•˜ìœ„:${r.business_subcategory || "-"} / ì‹œê°„:${nowStr()}`);

                    // ì„ íƒë§Œ í•˜ê³ , ì‹¤ì œ ì €ì¥ ìœ„ì¹˜ëŠ” 12ì¹¸(idx)ì—ì„œ ê²°ì •
                    await loadWhere();
                });

                list.appendChild(btn);
            }
        }

        async function doSearch() {
            try {
                const qRaw = String($("q").value || "").trim();
                const qDigits = digitsOnly(qRaw);
                const qParam = qRaw ? (qDigits ? qDigits : qRaw) : "__all__";

                syncChips();
                setStatus("warn", "ê²€ìƒ‰ ì¤‘...", `q: ${qParam} / ì‹œê°„: ${nowStr()}`);

                const qs = new URLSearchParams({
                    mode: MODE,
                    q: qParam,
                    pageSize: "12",
                }).toString();

                let data;
                try {
                    data = await apiFetch(`/search?${qs}`);
                } catch (_e) {
                    data = await apiFetch(`/search-store?${qs}`);
                }

                if (!data.success) throw new Error(data.error || "ê²€ìƒ‰ ì‹¤íŒ¨");

                renderSearchResults(data.results || []);
                setStatus("ok", "ê²€ìƒ‰ ì™„ë£Œ", `ê²°ê³¼: ${(data.results || []).length}ê°œ / ì‹œê°„: ${nowStr()}`);
            } catch (e) {
                setStatus("bad", "ê²€ìƒ‰ ì‹¤íŒ¨", `${e.message} / ì‹œê°„: ${nowStr()}`);
            }
        }

        $("btnSearch").addEventListener("click", doSearch);
        $("q").addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                e.preventDefault();
                doSearch();
            }
        });

        $("btnUseStore").addEventListener("click", () => {
            if (!selectedStore) return setStatus("bad", "ê°€ê²Œ ì—°ê²° ì‹¤íŒ¨", `ê°€ê²Œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš” / ì‹œê°„: ${nowStr()}`);
            setPick("store");

            $("storeId").value = selectedStore.id || "";
            $("storeBusinessNumber").value = selectedStore.business_number || "";
            $("storeNameHidden").value = selectedStore.business_name || "";
            $("storeTypeHidden").value = selectedStore.business_type || "";
            $("storeImageUrl").value = selectedStore.image_url || "";

            if (!$("bannerFile").files?.length && $("storeImageUrl").value) {
                setBannerPreview($("storeImageUrl").value);
            }

            setStatus("ok", "ê°€ê²Œ ì—°ê²° ì¤€ë¹„ ì™„ë£Œ", `12ì¹¸(idx) ì„ íƒ í›„ ì €ì¥í•˜ì„¸ìš” / ì‹œê°„: ${nowStr()}`);
        });

        $("btnUseStoreImage").addEventListener("click", () => {
            if (!selectedStore) return setStatus("bad", "ì ìš© ì‹¤íŒ¨", `ê°€ê²Œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš” / ì‹œê°„: ${nowStr()}`);
            if (selectedStore.image_url) {
                $("bannerFile").value = "";
                $("storeImageUrl").value = selectedStore.image_url;
                setBannerPreview(selectedStore.image_url);
                showBannerMsg("warn", `ê°€ê²Œ ì´ë¯¸ì§€ë¡œ ë¯¸ë¦¬ë³´ê¸° ì ìš© (${nowStr()})`);
                setStatus("ok", "ê°€ê²Œ ì´ë¯¸ì§€ë¡œ ë°°ë„ˆ ë¯¸ë¦¬ë³´ê¸° ì ìš©", `ì‹œê°„: ${nowStr()}`);
            } else {
                showBannerMsg("bad", `ê°€ê²Œ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤ (${nowStr()})`);
                setStatus("bad", "ì ìš© ì‹¤íŒ¨", `ê°€ê²Œ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤ / ì‹œê°„: ${nowStr()}`);
            }
        });

        // where: ì„œë²„ê°€ ì§€ì›í•˜ë©´ í‘œì‹œ, ì—†ìœ¼ë©´ ì‹¤íŒ¨ ë¬¸êµ¬
        async function loadWhere() {
            try {
                const biz = String($("storeBusinessNumber").value || "").trim();
                const bizDigits = digitsOnly(biz);
                const box = $("whereResults");
                if (!box) return;

                if (!bizDigits) {
                    box.innerHTML = `<div class="text-slate-500">ì‚¬ì—…ìë²ˆí˜¸ê°€ ì—†ì–´ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>`;
                    return;
                }

                const qs = new URLSearchParams({
                    q: bizDigits,
                    page: PAGE_NAME,
                    limit: "100",
                    mode: MODE,
                }).toString();

                const data = await apiFetch(`/where?${qs}`);
                const items = data?.items || [];

                if (!items.length) {
                    box.innerHTML = `<div class="text-slate-500">í˜„ì¬ ë“±ë¡ëœ ìŠ¬ë¡¯ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                    return;
                }

                box.innerHTML = items.map((it) => {
                    const p = it.parsed || {};
                    return `
        <div class="soft p-2">
          <div class="font-black">${p.section_label || "(unknown section)"}</div>
          <div class="text-xs text-slate-600 mt-1">
            ${it.page} / p${p.page_number || "?"} / idx ${p.index_in_page || "?"} / priority ${it.priority}
          </div>
          <div class="text-[11px] text-slate-500 break-all mt-1">key: <b>${it.position || it.key || "-"}</b></div>
        </div>
      `;
                }).join("");
            } catch (e) {
                const box = $("whereResults");
                if (box) box.innerHTML = `<div class="text-red-600">ì¡°íšŒ ì‹¤íŒ¨: ${e.message}</div>`;
            }
        }

        let selectedBoxNo = null;

        function fillSelectedStoreInfo(item) {
            const nameEl = $("selectedBusinessName");
            const bizEl = $("selectedBusinessNo");
            const boxEl = $("selectedBoxNo");

            const name = item?.business_name || item?.store_name || "";
            const biz = item?.business_number || item?.business_no || "";
            const boxNo = item?.boxNo ?? null;

            if (nameEl) nameEl.textContent = name || (item?.occupied ? "(ì‚¬ìš©ì¤‘)" : "-");
            if (bizEl) bizEl.textContent = biz || "-";
            if (boxEl) boxEl.textContent = boxNo ? String(boxNo) : "-";

            selectedBoxNo = boxNo;
            highlightSelectedBox();
        }

        function highlightSelectedBox() {
            document.querySelectorAll("[data-box]").forEach((el) => {
                const n = Number(el.getAttribute("data-box"));
                if (n && selectedBoxNo === n) el.classList.add("ring-2", "ring-blue-500");
                else el.classList.remove("ring-2", "ring-blue-500");
            });
        }

        // âœ… grid: ì„œë²„ê°€ subcategory.html ì²˜ëŸ¼ items ëª©ë¡(ìµœëŒ€ 12ê°œ)ì„ ì£¼ë©´ -> 12ì¹¸ìœ¼ë¡œ ë³€í™˜
        async function loadGrid() {
            try {
                const section = $("section").value || "all_items";
                const pageNo = Math.max(Number($("pageNo").value || "1"), 1);
                const category = $("placementCatFilter")?.value || "";
                const subcategory = $("placementSubFilter")?.disabled ? "" : ($("placementSubFilter")?.value || "");

                selectedTarget.section = section;
                selectedTarget.pageNo = pageNo;

                syncChips();

                const params = {
                    page: PAGE_NAME,
                    section,
                    mode: MODE,
                    pageNo: String(pageNo),
                };

                if (category) params.category = category;
                if (subcategory) params.subcategory = subcategory;

                const qs = new URLSearchParams(params).toString();
                const data = await apiFetch(`/grid?${qs}`);

                const list = Array.isArray(data.items) ? data.items : [];
                const pageSize = Number(data.pageSize || 12) || 12;

                // 12ì¹¸ ê³ ì •
                const boxes = [];
                for (let i = 1; i <= 12; i++) {
                    const store = list[i - 1] || null;
                    boxes.push({
                        boxNo: i,
                        occupied: !!store,
                        priority: DEFAULT_PRIORITY,
                        store,
                        label: store ? `${store.business_name || "(ìƒí˜¸ì—†ìŒ)"} / í•˜ìœ„:${store.business_subcategory || "-"}` : "(ë¹„ì—ˆìŒ)"
                    });
                }

                const grid = $("grid");
                grid.innerHTML = "";

                for (const it of boxes) {
                    const btn = document.createElement("button");
                    btn.type = "button";
                    btn.setAttribute("data-box", String(it.boxNo));

                    btn.className =
                        "text-left soft p-2 rounded-xl border transition " +
                        (it.occupied
                            ? "border-blue-500 bg-white"
                            : "border-slate-200 bg-white/60");

                    btn.innerHTML = `
          <div class="flex items-start justify-between gap-2">
            <div>
              <div class="text-xs text-slate-500 font-black">IDX ${it.boxNo}</div>
              <div class="text-sm font-black mt-0.5">${it.label}</div>
              <div class="text-[11px] text-slate-500 mt-1">priority: ${it.priority}</div>
            </div>
          </div>
        `;

                    btn.addEventListener("click", async (e) => {
                        e.preventDefault();
                        e.stopPropagation();

                        selectedTarget.section = section;
                        selectedTarget.pageNo = pageNo;
                        selectedTarget.idx = Number(it.boxNo);
                        selectedTarget.priority = DEFAULT_PRIORITY;

                        $("pickedBoxText").textContent = `${section} / p${pageNo} / idx ${it.boxNo}`;
                        $("pickedBoxPos").textContent = `${section}|p${pageNo}|idx${it.boxNo}`;

                        fillSelectedStoreInfo({
                            boxNo: it.boxNo,
                            business_name: it.store?.business_name || "",
                            business_number: it.store?.business_number || "",
                            occupied: it.occupied
                        });

                        syncChips();
                        setStatus("warn", "ë°°ì¹˜ ìœ„ì¹˜ ì„ íƒë¨", `section:${section} p${pageNo} idx:${it.boxNo} / ì‹œê°„:${nowStr()}`);

                        await loadSlot();
                    });

                    grid.appendChild(btn);
                }
            } catch (e) {
                setStatus("bad", "ê·¸ë¦¬ë“œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", `${e.message} / ì‹œê°„:${nowStr()}`);
            }
        }

        $("btnLoadGrid").addEventListener("click", loadGrid);

        $("section").addEventListener("change", () => {
            selectedTarget.idx = null;
            selectedBoxNo = null;
            highlightSelectedBox();
            syncChips();
            loadGrid();
        });

        $("slotArea").addEventListener("change", () => {
            const v = $("slotArea").value;
            if (v === "top") {
                setStatus("warn", "ìƒë‹¨ ë°°ë„ˆëŠ” ìœ„ì˜ 'ë°°ë„ˆ ì €ì¥/ì‚­ì œ'ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.", `ì‹œê°„: ${nowStr()}`);
                return;
            }
            $("section").value = v;
            selectedTarget.idx = null;
            selectedBoxNo = null;
            highlightSelectedBox();
            syncChips();
            loadGrid();
        });

        $("pageNo").addEventListener("change", () => loadGrid());
        $("btnPrevPage").addEventListener("click", () => {
            const v = Math.max(Number($("pageNo").value || "1") - 1, 1);
            $("pageNo").value = String(v);
            loadGrid();
        });
        $("btnNextPage").addEventListener("click", () => {
            const v = Math.max(Number($("pageNo").value || "1") + 1, 1);
            $("pageNo").value = String(v);
            loadGrid();
        });

        // âœ… í‘¸ë“œ ê³ ì • UI ì´ˆê¸°í™”
        (async function init() {
            hydrateLayout();

            $("managerMode").value = "food";
            syncBannerUI();
            setPick("image");

            initCategoryFilterUI();

            syncChips();
            hideImageBannerMsg();
            hideTextBannerMsg();

            // âœ… í…ìŠ¤íŠ¸ ë¯¸ë¦¬ë³´ê¸° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë°”ì¸ë”©
            const textBannerText = $("textBannerText");
            const textFontSize = $("textFontSize");
            const textFontWeight = $("textFontWeight");
            const textColor = $("textColor");
            const textBgColor = $("textBgColor");

            if (textBannerText) textBannerText.addEventListener("input", updateTextPreview);
            if (textFontSize) textFontSize.addEventListener("change", updateTextPreview);
            if (textFontWeight) textFontWeight.addEventListener("change", updateTextPreview);
            if (textColor) textColor.addEventListener("input", updateTextPreview);
            if (textBgColor) textBgColor.addEventListener("input", updateTextPreview);

            // âœ… í…ìŠ¤íŠ¸ ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™”
            updateTextPreview();

            await loadImageBanner(true);
            await loadTextBanner(true);
            await loadGrid();

            setStatus("ok", "í‘¸ë“œ ì „ìš© ë§¤ë‹ˆì € ì¤€ë¹„ ì™„ë£Œ âœ…", `API:${API_BASE} / ì‹œê°„:${nowStr()}`);
        })();
    </script>
</body>

</html>