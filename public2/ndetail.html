<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í†µí•© ì •ë³´ ìƒì„¸</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ì¹´ì¹´ì˜¤ ì•±í‚¤ -->
    <meta name="kakao-appkey" content="6286d4d9bc1d503495b03f46622b5dc8">
    <script id="kakao-sdk"
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&autoload=false&libraries=services"
        defer></script>

    <style>
        .menu-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .menu-card {
            display: grid;
            grid-template-columns: 64px 1fr auto;
            /* ì¸ë„¤ì¼ / ë³¸ë¬¸ / ìš°ì¸¡ì˜ì—­ */
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #fff;
            border: 1px solid #e5e7eb;
            /* gray-200 */
            border-radius: 12px;
        }

        .menu-thumb {
            width: 64px;
            height: 64px;
            object-fit: cover;
            border-radius: 8px;
        }

        .menu-main {
            min-width: 0;
        }

        /* ë§ì¤„ì„ì— í•„ìˆ˜ */
        .menu-cat {
            font-size: 12px;
            color: #6b7280;
        }

        /* gray-500 */
        .menu-name {
            font-weight: 600;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            /* í•œ ì¤„ ë§ì¤„ì„ */
        }

        .menu-right {
            text-align: right;
            white-space: nowrap;
        }

        .menu-price {
            font-weight: 700;

            .menuList * {
                min-width: 0;
            }
        }
    </style>

</head>

<body class="bg-gradient-to-br from-blue-50 via-white to-blue-100 min-h-screen">

    <div id="header-placeholder"></div>

    <main class="flex flex-col lg:flex-row gap-8 max-w-7xl mx-auto p-4 items-stretch">
        <!-- 1) ì™¼ìª½: ì´ë¯¸ì§€/ì§€ë„/ê´‘ê³  (ëª¨ë‘ ê³ ì •, ìŠ¤í¬ë¡¤ ì—†ìŒ) -->
        <section id="leftCol" class="flex-1 flex flex-col gap-6 self-stretch h-full">
            <!-- ê°€ê²Œ ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” -->
            <div class="rounded-3xl bg-white shadow-xl p-6 flex flex-col items-center overflow-hidden flex-shrink-0">
                <div class="w-full relative">
                    <div id="sliderWrapper"
                        class="relative w-full h-80 rounded-2xl overflow-hidden shadow flex-shrink-0">
                        <div id="sliderImages" class="flex transition-transform duration-500 ease-in-out h-full"></div>
                        <button id="prevBtn"
                            class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/70 text-white rounded-full px-3 py-1 opacity-80 hover:opacity-100 z-10">â€¹</button>
                        <button id="nextBtn"
                            class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/70 text-white rounded-full px-3 py-1 opacity-80 hover:opacity-100 z-10">â€º</button>
                    </div>
                    <div id="thumbBox" class="flex gap-2 justify-center mt-3"></div>
                </div>
                <div class="text-center font-bold mt-2">ëŒ€í‘œ ì´ë¯¸ì§€</div>
            </div>

            <!-- ì§€ë„ -->
            <div class="rounded-3xl bg-white shadow-xl p-6 overflow-hidden flex-shrink-0">
                <div class="text-xl font-bold mb-2 border-b border-gray-200 pb-1">ìœ„ì¹˜/ì§€ë„</div>
                <div id="addressText" class="mb-2 text-lg"></div>
                <div id="map" class="w-full h-[244px] bg-gray-100 rounded-xl overflow-hidden flex-shrink-0"></div>
            </div>

            <!-- ê´‘ê³  1/2 -->
            <div class="flex flex-col gap-4">
                <div class="rounded-3xl bg-white shadow-xl p-3 overflow-hidden flex-shrink-0">
                    <img src="/images/ad-1.jpg" alt="ê´‘ê³ 1" class="rounded-xl w-full h-60 object-cover select-none" />
                </div>
                <div class="rounded-3xl bg-white shadow-xl p-3 overflow-hidden flex-shrink-0">
                    <img src="/images/ad-2.jpg" alt="ê´‘ê³ 2" class="rounded-xl w-full h-60 object-cover select-none" />
                </div>
            </div>
        </section>

        <!-- 2) ê°€ìš´ë°: ìƒì„¸ì •ë³´ -->
        <section id="middleCol" class="flex-[1.1] flex flex-col gap-6">
            <div class="rounded-3xl bg-white shadow-xl p-6 overflow-hidden flex-shrink-0">
                <h2 id="businessNameHeader" class="text-3xl font-bold text-center mb-2"></h2>
                <div class="flex justify-center mt-2">
                    <button id="reserveBtn"
                        class="bg-blue-500 text-white px-5 py-2 rounded-lg shadow hover:bg-blue-700 transition">ì˜ˆì•½
                        ì‹ ì²­</button>
                </div>
            </div>

            <div class="rounded-3xl bg-white shadow-xl p-6 overflow-hidden flex-shrink-0">
                <div class="text-xl font-bold mb-3 border-b border-gray-200 pb-1">ê¸°ë³¸ ì •ë³´</div>
                <dl class="grid grid-cols-2 gap-x-3 gap-y-1 text-xl">
                    <dt class="font-bold text-gray-700">ì—… ì¢…</dt>
                    <dd id="businessType" class="font-bold text-gray-900"></dd>

                    <dt class="font-bold text-gray-700">ì¹´í…Œê³ ë¦¬</dt>
                    <dd id="businessCategory" class="font-bold text-gray-900"></dd>

                    <dt class="font-bold text-gray-700">ë°° ë‹¬</dt>
                    <dd id="deliveryOption" class="font-bold text-gray-900"></dd>

                    <dt class="font-bold text-gray-700">ì˜ì—…ì‹œê°„</dt>
                    <dd id="businessHours" class="font-bold text-gray-900"></dd>
                </dl>
            </div>

            <!-- ì„œë¹„ìŠ¤ ë‚´ìš© (ë‚´ìš©ë§Œ ìŠ¤í¬ë¡¤) -->
            <div class="rounded-2xl bg-blue-50 shadow p-6 flex flex-col h-48 overflow-hidden">
                <div class="text-xl font-bold mb-2 border-b border-gray-200 pb-1">ì„œë¹„ìŠ¤ ë‚´ìš©</div>
                <div id="serviceDetails" class="flex-1 overflow-auto text-lg"></div>
                <div class="text-right mt-2">
                    <button class="openTextModal px-3 py-1 bg-blue-600 text-white rounded text-sm"
                        data-target="serviceDetails" data-title="ì„œë¹„ìŠ¤ ë‚´ìš©">
                        ìì„¸íˆ ë³´ê¸°
                    </button>
                </div>
            </div>

            <div class="rounded-2xl bg-yellow-50 shadow p-6 overflow-hidden flex-shrink-0">
                <div class="text-xl font-bold mb-2 border-b border-gray-200 pb-1">ì´ë²¤íŠ¸</div>
                <ul id="eventsList" class="list-disc ml-5 text-lg"></ul>
            </div>

            <div class="rounded-2xl bg-gray-50 shadow p-6 overflow-hidden flex-shrink-0">
                <div class="text-xl font-bold mb-2 border-b border-gray-200 pb-1">ê¸°íƒ€ ì •ë³´</div>
                <ul id="infoEtcList" class="list-disc pl-5 text-lg"></ul>
            </div>

            <!-- ì¶”ê°€ ì„¤ëª… (ë‚´ìš©ë§Œ ìŠ¤í¬ë¡¤) -->
            <div class="rounded-2xl bg-blue-50 shadow p-6 flex flex-col h-48 overflow-hidden">
                <div class="text-xl font-bold mb-2 border-b border-gray-200 pb-1">ì¶”ê°€ ì„¤ëª…</div>
                <div id="additionalDesc" class="flex-1 overflow-auto text-lg"></div>
                <div class="text-right mt-2">
                    <button class="openTextModal px-3 py-1 bg-blue-600 text-white rounded text-sm"
                        data-target="additionalDesc" data-title="ì¶”ê°€ ì„¤ëª…">
                        ìì„¸íˆ ë³´ê¸°
                    </button>
                </div>
            </div>

            <div class="rounded-2xl bg-gray-50 shadow p-6 lg:pb-10 overflow-hidden flex-shrink-0">
                <div class="text-xl font-bold mb-2 border-b border-gray-200 pb-1">ì—°ë½ì²˜</div>
                <div id="contactGrid" class="grid grid-cols-2 gap-3 text-lg"></div>
            </div>
        </section>

        <!-- 3) ì˜¤ë¥¸ìª½: ë©”ë‰´/ì¥ë°”êµ¬ë‹ˆ (ê³ ì •, ìŠ¤í¬ë¡¤ ì—†ìŒ) -->
        <section id="rightCol" class="flex-[1.3] flex flex-col gap-6 min-h-0">
            <div class="rounded-3xl bg-white shadow-xl p-6 overflow-hidden flex flex-col min-h-0 flex-1">
                <div class="text-xl font-bold mb-4 text-center">ë©”ë‰´</div>

                <!-- âœ… menuListëŠ” ë‹¨ í•˜ë‚˜! (í´ë˜ìŠ¤ í•©ì¹˜ê¸°) -->
                <div id="menuList" class="menu-list flex-1 flex flex-col gap-3 overflow-y-auto pr-1"></div>
            </div>

            <div class="rounded-2xl bg-yellow-50 shadow p-6 overflow-hidden flex-shrink-0">
                <div class="text-xl font-bold mb-2">ì¥ë°”êµ¬ë‹ˆ</div>
                <ul id="cartItems" class="space-y-2 text-base"></ul>
                <div class="flex justify-between items-center mt-4">
                    <span class="font-bold text-gray-800">í•©ê³„:</span>
                    <span id="cartTotal" class="text-2xl font-bold text-blue-700">0ì›</span>
                </div>
                <button class="mt-3 w-full bg-blue-600 text-white py-2 rounded-lg shadow">ê²°ì œí•˜ê¸°</button>
            </div>
        </section>
    </main>
    <div id="footer-placeholder"></div>

    <!-- ì˜¤ë¥¸ìª½ í•˜ë‹¨ ì„¸ë¡œ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="fixed bottom-6 right-6 flex flex-col items-center gap-4 z-50">

        <!-- ì´ì „ -->
        <div class="flex flex-col items-center">
            <button onclick="goBack()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-gray-100 to-gray-200 text-gray-700 shadow hover:from-gray-200 hover:to-gray-300 transition">
                â†
            </button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">ì´ì „</span>
        </div>

        <!-- ë‹¤ìŒ -->
        <div class="flex flex-col items-center">
            <button onclick="goNext()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-gray-100 to-gray-200 text-gray-700 shadow hover:from-gray-200 hover:to-gray-300 transition">
                â†’
            </button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">ë‹¤ìŒ</span>
        </div>

        <!-- í™ˆ -->
        <div class="flex flex-col items-center">
            <a href="/index.html"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow hover:from-blue-600 hover:to-blue-700 transition">
                ğŸ 
            </a>
            <span class="text-xs mt-1 text-gray-600 font-semibold">í™ˆ</span>
        </div>
    </div>

    <!-- í…ìŠ¤íŠ¸ ëª¨ë‹¬ -->
    <div id="textModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-xl max-w-2xl w-full p-6 relative">
            <h3 id="textModalTitle" class="text-2xl font-bold mb-4"></h3>
            <div id="textModalBody" class="max-h-[60vh] overflow-auto text-lg leading-relaxed"></div>
            <button id="textModalClose"
                class="absolute -top-4 -right-4 bg-white text-black rounded-full text-3xl w-10 h-10 flex items-center justify-center hover:bg-gray-200">Ã—</button>
        </div>
    </div>

    <!-- ì´ë¯¸ì§€ ëª¨ë‹¬ -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="relative">
            <img id="modalImage" class="w-[600px] h-[400px] object-contain rounded shadow-xl" />
            <button id="closeModal"
                class="absolute -top-4 -right-4 bg-white text-black rounded-full text-3xl w-10 h-10 flex items-center justify-center z-60 hover:bg-gray-200">Ã—</button>
        </div>
    </div>

    <script type="module">
        // === í—¤ë”/í‘¸í„° ë™ì  í¬í•¨ ===
        async function loadPartial(targetId, url) {
            const el = document.getElementById(targetId);
            if (!el) return;
            try {
                const res = await fetch(url + `?v=${Date.now()}`, { cache: "no-cache" });
                el.innerHTML = await res.text();
                // partial ì•ˆ <script> ì‹¤í–‰
                el.querySelectorAll("script").forEach(old => {
                    const s = document.createElement("script");
                    [...old.attributes].forEach(a => s.setAttribute(a.name, a.value));
                    s.textContent = old.textContent || "";
                    old.replaceWith(s);
                });
            } catch (e) {
                console.warn("partial load failed:", url, e);
            }
        }

        // ë ˆì§€ìŠ¤í„°ì™€ ë™ì¼í•œ ê²½ë¡œ ì‚¬ìš©
        await loadPartial("header-placeholder", "/components/header.html");
        await loadPartial("footer-placeholder", "/components/footer.html");

        document.getElementById("header-placeholder")?.style.setProperty("display", "contents");
        document.getElementById("footer-placeholder")?.style.setProperty("display", "contents");

        requestAnimationFrame(syncRightColHeight);
        setTimeout(syncRightColHeight, 300);

        // ========== ìœ í‹¸ ==========
        const $ = (id) => document.getElementById(id);

        function normalizeSrc(src) {
            if (!src) return "";
            if (src.startsWith("http") || src.startsWith("/")) return src;
            return `/uploads/${src}`;
        }

        function escapeHtml(s = "") {
            s = String(s ?? "");
            return s.replace(/[&<>\"']/g, (m) => ({
                "&": "&amp;",
                "<": "&lt;",
                ">": "&gt;",
                '"': "&quot;",
                "'": "&#39;",
            }[m]));
        }

        const nl2br = (s = "") => escapeHtml(String(s)).replace(/\r?\n/g, "<br>");

        // ê°’ ì• ë¼ë²¨ ì œê±°
        function onlyValue(v) {
            if (v == null || v === "") return "-";
            return String(v).replace(/^\s*(ì—…ì¢…|ì¹´í…Œê³ ë¦¬|ë°°ë‹¬|ì˜ì—…ì‹œê°„)\s*[:ï¼š]\s*/, "").trim();
        }

        // ========== ì´ë¯¸ì§€ ëª¨ë‹¬ ==========
        function openModal(src) {
            $("modalImage").src = src;
            $("imageModal").classList.remove("hidden");
        }
        function closeModal() {
            $("imageModal").classList.add("hidden");
        }

        // ========== ìŠ¬ë¼ì´ë” ==========
        const slider = {
            imgs: [],
            idx: 0,
            init(arr) {
                this.imgs = (arr || [])
                    .filter((s) => typeof s === "string" && s.trim() !== "")
                    .map((s) => normalizeSrc(s.trim()));

                $("sliderImages").innerHTML = this.imgs
                    .map((u, i) => {
                        const n = normalizeSrc(u);
                        return `
              <div class="min-w-full h-full">
                <img src="${n}" data-index="${i}" class="w-full h-full object-cover cursor-pointer select-none" />
              </div>`;
                    })
                    .join("");

                $("sliderImages").onclick = (e) => {
                    const img = e.target.closest("img[data-index]");
                    if (img) {
                        this.idx = Number(img.dataset.index);
                        this.update();
                        openModal(this.imgs[this.idx]);
                    }
                };

                this.renderThumbs();
                this.update();

                $("prevBtn").onclick = () => this.move(-1);
                $("nextBtn").onclick = () => this.move(1);
            },
            renderThumbs() {
                const box = $("thumbBox");
                box.innerHTML = "";
                this.imgs.forEach((src, i) => {
                    const t = document.createElement("img");
                    t.src = src;
                    t.alt = `ì´ë¯¸ì§€ ${i + 1}`;
                    t.className = "w-14 h-14 object-cover rounded cursor-pointer border hover:opacity-80";
                    t.addEventListener("click", () => {
                        this.idx = i;
                        this.update();
                        openModal(src);
                    });
                    box.appendChild(t);
                });
            },
            move(step) {
                if (!this.imgs.length) return;
                this.idx = (this.idx + step + this.imgs.length) % this.imgs.length;
                this.update();
            },
            update() {
                const hasImg = this.imgs.length > 0;
                $("sliderImages").style.transform = `translateX(${-this.idx * 100}%)`;
                [...$("thumbBox").children].forEach((el, i) => {
                    el.classList.toggle("ring-2", i === this.idx);
                    el.classList.toggle("ring-blue-300", i === this.idx);
                });
                $("prevBtn").classList.toggle("hidden", !hasImg);
                $("nextBtn").classList.toggle("hidden", !hasImg);
                $("thumbBox").classList.toggle("hidden", !hasImg);
            },
        };

        // ëª¨ë‹¬ í‚¤ í•¸ë“¤ëŸ¬
        (function enableModalKeys() {
            const modal = $("imageModal");
            modal.addEventListener("click", (e) => {
                if (e.target === modal) closeModal();
            });
            window.addEventListener("keydown", (e) => {
                if (modal.classList.contains("hidden")) return;
                if (e.key === "Escape") closeModal();
                if (e.key === "ArrowLeft") {
                    slider.move(-1);
                    $("modalImage").src = slider.imgs[slider.idx];
                }
                if (e.key === "ArrowRight") {
                    slider.move(1);
                    $("modalImage").src = slider.imgs[slider.idx];
                }
            });
            $("closeModal").addEventListener("click", closeModal);
        })();

        // ========== ì¥ë°”êµ¬ë‹ˆ ==========
        const cart = [];
        function addToCart(item) {
            const found = cart.find((c) => c.name === item.name);
            if (found) found.quantity += item.quantity;
            else cart.push({ ...item });
            renderCart();
        }
        function renderCart() {
            const ul = $("cartItems");
            if (!ul) return;
            ul.innerHTML = "";
            let sum = 0;
            cart.forEach((item, index) => {
                const price = Number(item.price) || 0;
                const qty = Number(item.quantity) || 1;
                const total = price * qty;
                sum += total;
                const li = document.createElement("li");
                li.className = "flex justify-between items-center text-lg py-2";
                li.innerHTML = `
          <span>${item.name} Ã— ${qty}</span>
          <span class="text-xl font-bold">${total.toLocaleString()}ì›</span>
          <button class="removeBtn bg-red-100 text-red-600 px-2 py-1 rounded text-sm ml-2" data-index="${index}">ì‚­ì œ</button>`;
                ul.appendChild(li);
            });
            ul.querySelectorAll(".removeBtn").forEach((btn) => {
                btn.onclick = () => {
                    cart.splice(btn.dataset.index, 1);
                    renderCart();
                };
            });
            $("cartTotal").textContent = sum.toLocaleString() + "ì›";
        }

        // ===== í…ìŠ¤íŠ¸ ëª¨ë‹¬ =====
        (function initTextModal() {
            const modal = $("textModal");
            const body = $("textModalBody");
            const title = $("textModalTitle");
            const closeBtn = $("textModalClose");

            function openTextModal(srcId, label) {
                const el = $(srcId);
                if (!el) return;
                title.textContent = label;
                body.innerHTML = el.innerHTML || "-";
                modal.classList.remove("hidden");
            }

            function closeTextModal() {
                modal.classList.add("hidden");
            }

            document.addEventListener("click", (e) => {
                const btn = e.target.closest(".openTextModal");
                if (!btn) return;
                openTextModal(btn.dataset.target, btn.dataset.title);
            });

            closeBtn.addEventListener("click", closeTextModal);
            modal.addEventListener("click", (e) => {
                if (e.target === modal) closeTextModal();
            });
        })();

        // ë ˆì´ì•„ì›ƒ ë†’ì´ ë™ê¸°í™”
        function syncRightColHeight() {
            const mq = window.matchMedia("(min-width: 1024px)"); // lg ì´ìƒì—ì„œë§Œ ë™ê¸°í™”
            const right = $("rightCol");
            if (!right) return;

            if (!mq.matches) {
                right.style.height = "";
                return;
            }

            const leftH = $("leftCol")?.offsetHeight || 0;
            const midH = $("middleCol")?.offsetHeight || 0;

            const base = midH || leftH;
            right.style.height = base + "px";
        }

        window.addEventListener("resize", syncRightColHeight);
        window.addEventListener("load", syncRightColHeight);

        // ========== Kakao ì§€ë„ ë²„íŠ¼(ì¹´ì¹´ì˜¤ë§µ ì—´ê¸°/ê¸¸ì°¾ê¸°) ==========
        function renderMapActions(lat, lng, name, address) {
            const parent = $("map").parentElement;
            let box = document.getElementById("mapActions");
            if (!box) {
                box = document.createElement("div");
                box.id = "mapActions";
                box.className = "mt-3 flex gap-2";
                parent.appendChild(box);
            } else {
                box.innerHTML = "";
            }

            const place = name || "ëª©ì ì§€";

            const openBtn = document.createElement("button");
            openBtn.className = "px-3 py-1 rounded bg-blue-600 text-white text-sm";
            openBtn.textContent = "ì¹´ì¹´ì˜¤ë§µ ì—´ê¸°";
            openBtn.onclick = () => {
                const url =
                    lat && lng
                        ? `https://map.kakao.com/link/map/${encodeURIComponent(place)},${lat},${lng}`
                        : `https://map.kakao.com/link/search/${encodeURIComponent(address || place)}`;
                window.open(url, "_blank", "noopener");
            };

            const dirBtn = document.createElement("button");
            dirBtn.className = "px-3 py-1 rounded bg-emerald-600 text-white text-sm";
            dirBtn.textContent = "ê¸¸ì°¾ê¸°";
            dirBtn.onclick = () => {
                const url =
                    lat && lng
                        ? `https://map.kakao.com/link/to/${encodeURIComponent(place)},${lat},${lng}`
                        : `https://map.kakao.com/link/search/${encodeURIComponent(address || place)}`;
                window.open(url, "_blank", "noopener");
            };

            box.append(openBtn, dirBtn);
        }

        // ì¹´ì¹´ì˜¤ ì§€ë„ìš© ì£¼ì†Œ ì •ì œ
        // ì¹´ì¹´ì˜¤ ì§€ë„ìš© ì£¼ì†Œ ì •ì œ
        function refineAddress(address, name = "") {
            if (!address) return "";

            let a = String(address);

            // "ìƒí˜¸: í•˜ëŠ˜ì‹ë‹¹" ì´ëŸ° ë¶€ë¶„ ì œê±°
            a = a.replace(/ìƒí˜¸\s*:.*/g, "");

            // ê´„í˜¸ë¡œ ëœ ì°¸ê³ ì •ë³´ ì œê±°
            a = a.replace(/\(.*?\)/g, "");

            // "ì§€í•˜ 160" -> "160"  (ìˆ«ìëŠ” ì‚´ë¦°ë‹¤)
            a = a.replace(/ì§€í•˜\s*(\d+)/g, "$1");

            // "ì§€í•˜ 1ì¸µ", "B1ì¸µ", "3ì¸µ" ê°™ì€ ì¸µ ì •ë³´ ì œê±°
            a = a.replace(/ì§€í•˜\s*\d+ì¸µ/g, "");
            a = a.replace(/\bB\d+ì¸µ\b/gi, "");
            a = a.replace(/\b\d+ì¸µ\b/g, "");

            // âœ… ëì— ë¶™ì€ ê¸´ ìˆ«ì(ì˜ˆ: "10 1111") ìë¥´ê¸°
            // - ë§ˆì§€ë§‰ ë‘ í† í°ì´ ëª¨ë‘ ìˆ«ì
            // - ë§ˆì§€ë§‰ í† í°ì´ 3ìë¦¬ ì´ìƒì¼ ë•Œ
            //   ì˜ˆ) "ì„œìš¸ ê°•ë‚¨êµ¬ ê°€ë¡œìˆ˜ê¸¸ 10 1111" -> "ì„œìš¸ ê°•ë‚¨êµ¬ ê°€ë¡œìˆ˜ê¸¸ 10"
            a = a.replace(/(\d+)\s+(\d{3,})(\s*)$/, "$1");

            // ê³µë°± ì •ë¦¬
            a = a.replace(/\s+/g, " ").trim();

            return a;
        }

        // âœ… ìµœì¢… Kakao ì§€ë„ initMap (í•œ ë²ˆë§Œ ì„ ì–¸!)
        async function initMap(address, name = "") {
            return new Promise(async (resolve) => {
                if (!address) {
                    $("addressText").textContent = "ğŸ“ ì£¼ì†Œ ì •ë³´ ì—†ìŒ";
                    $("map").innerHTML =
                        "<div class='flex items-center justify-center h-full text-gray-500'>ì£¼ì†Œ ì—†ìŒ</div>";
                    renderMapActions(null, null, name, address);
                    resolve();
                    return;
                }

                // í™”ë©´ì—ëŠ” ìƒì„¸ì£¼ì†Œ ê·¸ëŒ€ë¡œ í‘œì‹œ
                $("addressText").textContent = `ğŸ“ ${address}`;
                console.log("ì§€ë„ ì£¼ì†Œ ê²€ìƒ‰ ì‹œì‘ (ì›ë³¸):", address, "ìƒí˜¸:", name);

                if (!window.kakao || !window.kakao.maps) {
                    console.error("Kakao SDK tag missing");
                    renderMapActions(null, null, name, address);
                    resolve();
                    return;
                }

                await new Promise((r) => kakao.maps.load(r));
                const geocoder = new kakao.maps.services.Geocoder();

                const cleaned = refineAddress(address, name);
                console.log("ì •ì œ í›„ ì£¼ì†Œ:", cleaned);

                function onSuccess(result) {
                    const lat = Number(result[0].y);
                    const lng = Number(result[0].x);
                    const coords = new kakao.maps.LatLng(lat, lng);

                    const map = new kakao.maps.Map($("map"), { center: coords, level: 3 });
                    const marker = new kakao.maps.Marker({ map, position: coords });

                    const infowindow = new kakao.maps.InfoWindow({
                        content: `<div style="padding:5px;font-size:13px;">${escapeHtml(name)}<br>${escapeHtml(
                            address
                        )}</div>`,
                    });
                    infowindow.open(map, marker);

                    renderMapActions(lat, lng, name, address);
                    resolve();
                }

                // 1ì°¨: ì •ì œ ì£¼ì†Œë¡œ ê²€ìƒ‰
                geocoder.addressSearch(cleaned, (result, status) => {
                    console.log("ì£¼ì†Œê²€ìƒ‰ ê²°ê³¼(ì •ì œ):", result, "status:", status);

                    if (status === kakao.maps.services.Status.OK && result && result.length) {
                        onSuccess(result);
                        return;
                    }

                    // 2ì°¨: ì •ì œ ì‹¤íŒ¨í•˜ë©´ ì›ë³¸ ì£¼ì†Œë¡œ ì¬ì‹œë„
                    console.warn("ì •ì œ ì£¼ì†Œ ê²€ìƒ‰ ì‹¤íŒ¨, ì›ë³¸ ì£¼ì†Œë¡œ ì¬ì‹œë„:", address);
                    geocoder.addressSearch(address, (result2, status2) => {
                        console.log("ì£¼ì†Œê²€ìƒ‰ ê²°ê³¼(ì›ë³¸):", result2, "status:", status2);

                        if (status2 === kakao.maps.services.Status.OK && result2 && result2.length) {
                            onSuccess(result2);
                        } else {
                            $("map").innerHTML =
                                "<div class='flex items-center justify-center h-full text-gray-500'>ì§€ë„ ë¡œë”© ì‹¤íŒ¨</div>";
                            renderMapActions(null, null, name, address);
                            resolve();
                        }
                    });
                });
            });
        }

        // ========== ë°ì´í„° í‘œì¤€í™” + ìƒì„¸ ë Œë”ë§ ==========
        (async () => {
            try {
                const params = new URLSearchParams(location.search);
                const id = params.get("id");
                let type = (params.get("type") || "combined").trim();

                // âœ… ê³¼ê±° ë§í¬ í˜¸í™˜ (ë‚¨ì•„ìˆìœ¼ë©´ ì‚¬ê³  ë°©ì§€)
                if (type === "store") type = "combined";

                if (!id) throw new Error("No id provided");

                let api = "";
                if (type === "store_info") {
                    api = `/store/${id}/full`;      // foodregister (store_info í…Œì´ë¸”)
                } else {
                    api = `/combined/${id}/full`;   // ncombinedregister (combined_store_info í…Œì´ë¸”)
                }

                console.log("[DETAIL] Using type:", type, "API:", api);

                const res = await fetch(api, { cache: "no-store" });
                if (!res.ok) throw new Error(`HTTP ${res.status} from ${api}`);

                const json = await res.json();
                console.log("[DETAIL] API response:", json);

                const store = json.store ?? json.data ?? {};

                // images: ë‹¤ì–‘í•œ í¬ë§· í—ˆìš©
                const rawImagesCand = json.images ?? store.images ?? json.data?.images ?? [];
                const rawImages = Array.isArray(rawImagesCand)
                    ? rawImagesCand
                        .map((i) => {
                            if (!i && i !== 0) return "";
                            if (typeof i === "string") return i;
                            if (typeof i === "object")
                                return i.url || i.image_url || i.path || i.filename || i.src || "";
                            return "";
                        })
                        .filter(Boolean)
                    : [];
                const imagesFixed = rawImages.map(normalizeSrc).filter(Boolean);
                slider.init(imagesFixed);

                // menus: í•­ìƒ ì •ì˜ (ë‹¤ì–‘í•œ ìŠ¤í‚¤ë§ˆ í—ˆìš©)
                const rawMenusCandidate =
                    json.menus ?? json.storeMenus ?? json.menuList ?? json.menu ?? json.data?.menus ?? [];
                let rawList = [];
                if (Array.isArray(rawMenusCandidate)) rawList = rawMenusCandidate;
                else if (rawMenusCandidate && typeof rawMenusCandidate === "object") {
                    rawList = Object.values(rawMenusCandidate).flatMap((v) =>
                        Array.isArray(v) ? v : Array.isArray(v?.items) ? v.items : []
                    );
                }
                const toNumber = (v) => Number(String(v ?? 0).replace(/[^\d.-]/g, "")) || 0;
                const menus = rawList.map((m) => ({
                    category: m?.category ?? m?.category_name ?? m?.cat ?? "ê¸°íƒ€",
                    name: m?.name ?? m?.menu_name ?? m?.title ?? "",
                    price: toNumber(m?.price ?? m?.menu_price ?? m?.cost),
                    image_url: m?.image_url ?? m?.imageUrl ?? m?.image ?? "",
                    description: m?.description ?? m?.desc ?? "",
                }));

                // ê¸°ë³¸ ì •ë³´ ë Œë”
                $("businessNameHeader").textContent = store.business_name ?? store.name ?? "ìƒí˜¸ëª… ì—†ìŒ";
                $("businessType").textContent = onlyValue(store.business_type);
                $("businessCategory").textContent = onlyValue(
                    store.business_category ?? store.category
                );
                $("deliveryOption").textContent = onlyValue(store.delivery_option);
                $("businessHours").textContent = onlyValue(store.business_hours);

                $("serviceDetails").innerHTML = store.service_details
                    ? nl2br(store.service_details)
                    : "-";
                $("additionalDesc").innerHTML = store.additional_desc
                    ? nl2br(store.additional_desc)
                    : "-";

                // events: ë°©ì–´ì  íŒŒì‹±
                const rawEvents =
                    json.events ??
                    store.events ??
                    json.eventList ??
                    json.eventsList ??
                    json.data?.events ??
                    [];
                const eventsArr = [];
                if (Array.isArray(rawEvents)) {
                    for (const ev of rawEvents) {
                        if (ev === null || ev === undefined) continue;
                        if (typeof ev === "string") eventsArr.push(ev);
                        else if (typeof ev === "object")
                            eventsArr.push(ev.content ?? ev.text ?? ev.body ?? ev.name ?? "");
                        else eventsArr.push(String(ev));
                    }
                }
                const events = eventsArr.filter(Boolean).map(escapeHtml);
                $("eventsList").innerHTML = events.length
                    ? events.map((e) => `<li>${e}</li>`).join("")
                    : `<li>-</li>`;

                console.log("[DEBUG] images:", imagesFixed, "menus:", menus, "events:", events);

                $("infoEtcList").innerHTML = `
      <li>ì¥ì• ì¸ í¸ì˜ì‹œì„¤: ${escapeHtml(store.facilities ?? "-")}</li>
      <li>ë°˜ë ¤ë™ë¬¼ ì¶œì…: ${store.pets_allowed === true
                        ? "ê°€ëŠ¥"
                        : store.pets_allowed === false
                            ? "ë¶ˆê°€"
                            : "-"
                    }</li>
      <li>ì£¼ì°¨ ì •ë³´: ${escapeHtml(store.parking ?? "-")}</li>
    `;

                // ì—°ë½ì²˜
                const phoneNum = store.phone ?? "";
                const contactLinks = [];
                if (phoneNum) {
                    const tel = `tel:${phoneNum.replace(/[^0-9]/g, "")}`;
                    contactLinks.push(
                        `<a href="${tel}" class="block w-full text-center px-3 py-2 rounded-lg border bg-white hover:bg-gray-50">${escapeHtml(
                            phoneNum
                        )}</a>`
                    );
                }
                const linkOrNull = (url, label) =>
                    url
                        ? `<a href="${/^https?:\/\//i.test(url) ? url : "http://" + url
                        }" target="_blank" rel="noopener" class="block w-full text-center px-3 py-2 rounded-lg border bg-white hover:bg-gray-50">${escapeHtml(
                            label ?? url
                        )}</a>`
                        : null;
                [
                    [store.homepage, "í™ˆí˜ì´ì§€"],
                    [store.instagram, "ì¸ìŠ¤íƒ€ê·¸ë¨"],
                    [store.facebook, "í˜ì´ìŠ¤ë¶"],
                ].forEach(([u, l]) => {
                    const h = linkOrNull(u, l);
                    if (h) contactLinks.push(h);
                });
                const grid = $("contactGrid");
                if (!contactLinks.length)
                    grid.innerHTML =
                        `<div class="col-span-2 text-gray-500 text-center">-</div>`;
                else if (contactLinks.length === 1)
                    grid.innerHTML = `<div class="col-span-2">${contactLinks[0]}</div>`;
                else grid.innerHTML = contactLinks.map((x) => `<div>${x}</div>`).join("");

                // ë©”ë‰´ ë Œë”
                const menuList = $("menuList");
                menuList.innerHTML = "";
                if (!menus.length) {
                    menuList.innerHTML =
                        `<div class="text-center text-gray-500 py-4">ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                } else {
                    const byCat = new Map();
                    menus.forEach((it) => {
                        const cat = (it.category || "").toString().trim() || "ê¸°íƒ€";
                        if (!byCat.has(cat)) byCat.set(cat, []);
                        byCat.get(cat).push(it);
                    });
                    byCat.forEach((groupItems, cat) => {
                        const group = document.createElement("div");
                        const title = document.createElement("h3");
                        title.textContent = "ğŸ± " + cat;
                        title.className = "text-xl font-bold mt-6 mb-2 text-gray-800";
                        group.appendChild(title);
                        groupItems.forEach((it) => {
                            const box = document.createElement("div");
                            box.className =
                                "flex items-center gap-4 p-4 bg-white rounded-lg shadow-sm border";
                            const imgSrc = normalizeSrc(it.image_url || "");
                            box.innerHTML = `
          <img src="${imgSrc}" class="w-24 h-24 object-cover rounded-md" />
          <div class="flex-1 min-w-0">
            <div class="text-lg font-bold mb-1 truncate">${escapeHtml(
                                it.name || "-"
                            )}</div>
            <div class="text-base font-medium text-gray-700">${Number(
                                it.price || 0
                            ).toLocaleString()}ì›</div>
            ${it.description
                                    ? `<div class="text-sm text-gray-500 mt-1">${escapeHtml(
                                        it.description
                                    )}</div>`
                                    : ""
                                }
          </div>
          <div class="flex flex-col items-center gap-1 shrink-0">
            <div class="flex items_center gap-1">
              <button class="decrease px-2 py-1 bg-gray-200 rounded">ï¼</button>
              <span class="quantity w-6 text-center">1</span>
              <button class="increase px-2 py-1 bg-gray-200 rounded">ï¼‹</button>
            </div>
            <button class="addBtn px-3 py-1 bg-blue-600 text-white text-sm rounded">ë‹´ê¸°</button>
          </div>`;
                            let qty = 1;
                            const qtySpan = box.querySelector(".quantity");
                            box.querySelector(".decrease").onclick = () => {
                                if (qty > 1) qtySpan.textContent = --qty;
                            };
                            box.querySelector(".increase").onclick = () => {
                                qtySpan.textContent = ++qty;
                            };
                            box.querySelector(".addBtn").onclick = () =>
                                addToCart({
                                    name: it.name,
                                    price: it.price,
                                    quantity: qty,
                                });
                            group.appendChild(box);
                        });
                        menuList.appendChild(group);
                    });
                }

                // ì§€ë„, ì˜ˆì•½, ë ˆì´ì•„ì›ƒ
                const mapAddress = store.road_address ?? store.address ?? "";

                initMap(
                    mapAddress,
                    store.business_name ?? store.name ?? ""
                ).catch(() => { });
                $("reserveBtn")?.addEventListener("click", () =>
                    alert("ì˜ˆì•½ ì‹ ì²­ ê¸°ëŠ¥ì€ ê³§ ì œê³µë©ë‹ˆë‹¤!")
                );
                syncRightColHeight();
                setTimeout(syncRightColHeight, 300);
            } catch (err) {
                console.error("ìƒì„¸ ë¡œë”© ì‹¤íŒ¨:", err);
                $("businessNameHeader").textContent =
                    "ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
            }
        })();

        const params = new URLSearchParams(window.location.search);
        const storeId = params.get("id");
        console.log("ê°€ì ¸ì˜¨ storeId:", storeId);
    </script>

    <script>
        function goBack() {
            if (document.referrer && document.referrer !== location.href) {
                window.history.back();
            } else {
                window.location.href = "/category.html";
            }
        }

        function goNext() {
            window.history.forward();
        }
    </script>
</body>

</html>