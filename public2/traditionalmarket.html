<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìš°ë¦¬ë™ë„¤ ì „í†µì‹œì¥</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* ë°°ê²½ ê¸€ë¡œìš° */
    .bg-glow {
      position: fixed;
      inset: 0;
      z-index: -1;
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(99, 102, 241, 0.20), transparent 60%),
        radial-gradient(900px 500px at 85% 20%, rgba(59, 130, 246, 0.18), transparent 60%),
        radial-gradient(900px 500px at 50% 90%, rgba(14, 165, 233, 0.14), transparent 60%),
        linear-gradient(135deg, #eff6ff 0%, #eef2ff 40%, #f8fafc 100%);
    }

    /* ê¸€ë˜ìŠ¤ ì¹´ë“œ */
    .glass {
      background: rgba(255, 255, 255, 0.70);
      border: 1px solid rgba(148, 163, 184, 0.35);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }

    /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
    .soft-shadow {
      box-shadow: 0 22px 60px rgba(15, 23, 42, 0.10);
    }

    /* ì¹´ë“œ hover */
    .lift {
      transition: transform .25s ease, box-shadow .25s ease;
    }

    .lift:hover {
      transform: translateY(-6px);
      box-shadow: 0 30px 80px rgba(15, 23, 42, 0.16);
    }

    /* í…ìŠ¤íŠ¸ ê·¸ë¼ë°ì´ì…˜ */
    .title-grad {
      background: linear-gradient(135deg, #2563eb 0%, #6366f1 60%, #7c3aed 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
  </style>
</head>

<body class="text-slate-900">
  <div class="bg-glow"></div>

  <!-- í—¤ë” (ì™¸ë¶€ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°) -->
  <div id="header"></div>

  <!-- ë©”ì¸ ì»¨í…ì¸  -->
  <main class="max-w-7xl mx-auto px-4 py-10 md:py-14">

    <!-- ìƒë‹¨ íˆì–´ë¡œ -->
    <section class="relative overflow-hidden rounded-3xl glass soft-shadow p-8 md:p-12">
      <div class="absolute -top-24 -right-24 w-72 h-72 rounded-full bg-blue-300/30 blur-3xl"></div>
      <div class="absolute -bottom-24 -left-24 w-72 h-72 rounded-full bg-indigo-300/25 blur-3xl"></div>

      <div class="relative flex flex-col gap-6">
        <div class="flex items-center gap-3 justify-center md:justify-start">
          <span class="px-3 py-1 rounded-full text-xs font-semibold bg-white/70 border border-slate-200">
            ğŸ® TRADITIONAL MARKET
          </span>
          <span class="px-3 py-1 rounded-full text-xs font-semibold bg-white/70 border border-slate-200">
            ì§€ì—­ ìƒê¶Œ í™œì„±í™”
          </span>
        </div>

        <h2 class="text-4xl md:text-5xl font-extrabold leading-tight text-center md:text-left">
          ì „í†µì„ í’ˆì€ ì‹œì¥, <span class="title-grad">ê·¸ ê°€ì¹˜ë¥¼ ì‡ë‹¤</span>
        </h2>

        <p class="text-base md:text-lg text-slate-700 text-center md:text-left max-w-3xl">
          ì˜¤ëœ ì—­ì‚¬ë¥¼ ìë‘í•˜ëŠ” ì „í†µì‹œì¥ì—ì„œ í˜„ëŒ€ì˜ ê°ê°ì„ ë”í•´,
          íŠ¹ë³„í•œ ê²½í—˜ì„ ì„ ì‚¬í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ ìš°ë¦¬ë™ë„¤ ì‹œì¥ì„ í•œ ë²ˆ ë‘˜ëŸ¬ë³´ì„¸ìš”.
        </p>
      </div>
    </section>

    <!-- ì „í†µì‹œì¥ ì„¹ì…˜ -->
    <section id="market" class="mt-10 md:mt-14 glass soft-shadow rounded-3xl p-6 md:p-10">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
        <div>
          <h3 class="text-2xl md:text-3xl font-extrabold">
            ìš°ë¦¬ë™ë„¤ <span class="title-grad">ì „í†µì‹œì¥</span>
          </h3>
          <p class="text-slate-600 mt-1">ì‚¬ì§„ì„ ëˆŒëŸ¬ ìƒì„¸ë¡œ ë“¤ì–´ê°€ê±°ë‚˜, ìì„¸íˆ ë³´ê¸°ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
        </div>

        <a href="/traditionalmarketregister.html"
          class="inline-flex items-center justify-center gap-2 rounded-2xl px-6 py-3 font-semibold text-white
                 bg-gradient-to-r from-blue-600 to-indigo-600 shadow-lg hover:shadow-xl hover:scale-[1.02] transition whitespace-nowrap">
          <span>ğŸ“</span>
          <span>ë“±ë¡í•˜ê¸°</span>
        </a>
      </div>

      <!-- ì¹´ë“œ ì˜ì—­ -->
      <div id="market-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>

      <!-- ë” ë³´ê¸° -->
      <div class="text-center mt-10">
        <button id="loadMoreBtn" class="inline-flex items-center justify-center gap-2 rounded-2xl px-8 py-3 text-lg font-bold text-white
                 bg-gradient-to-r from-blue-600 to-indigo-600 shadow-lg hover:shadow-xl hover:scale-[1.02] transition">
          <span>â•</span>
          <span>ë” ë³´ê¸°</span>
        </button>
      </div>
    </section>

  </main>

  <!-- í‘¸í„° (ì™¸ë¶€ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°) -->
  <div id="footer"></div>

  <!-- ìš°ì¸¡ í•˜ë‹¨ ê³ ì • ë„¤ë¹„ -->
  <div class="fixed bottom-6 right-6 flex flex-col items-center gap-4 z-50">
    <div class="flex flex-col items-center">
      <button onclick="goBack()"
        class="w-14 h-14 flex items-center justify-center rounded-full glass soft-shadow text-slate-900 hover:scale-105 transition">
        â†
      </button>
      <span class="text-xs mt-1 text-slate-700 font-semibold">ì´ì „</span>
    </div>
    <div class="flex flex-col items-center">
      <button onclick="goNext()"
        class="w-14 h-14 flex items-center justify-center rounded-full glass soft-shadow text-slate-900 hover:scale-105 transition">
        â†’
      </button>
      <span class="text-xs mt-1 text-slate-700 font-semibold">ë‹¤ìŒ</span>
    </div>
    <div class="flex flex-col items-center">
      <a href="/index.html"
        class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-xl hover:scale-105 transition">
        ğŸ 
      </a>
      <span class="text-xs mt-1 text-slate-700 font-semibold">í™ˆ</span>
    </div>
  </div>

  <script>
    // í—¤ë” & í‘¸í„° ë¡œë“œ
    fetch('components/header.html')
      .then(r => r.text())
      .then(html => { document.getElementById('header').innerHTML = html; })
      .catch(err => console.error('í—¤ë” ë¡œë”© ì‹¤íŒ¨:', err));

    fetch('components/footer.html')
      .then(r => r.text())
      .then(html => { document.getElementById('footer').innerHTML = html; })
      .catch(err => console.error('í‘¸í„° ë¡œë”© ì‹¤íŒ¨:', err));

    // ì‹¤ì œ ì„œë²„ ë°ì´í„°ë¡œ ì¹´ë“œ ë Œë”
    let traditionalMarkets = [];
    let currentIndex = 6; // âœ… ì²˜ìŒì—” 6ê°œê°€ ë” ë³´ê¸° ëŠë‚Œ ì¢‹ìŒ(ì›í•˜ë©´ 4ë¡œ ë‹¤ì‹œ)

    async function fetchMarkets() {
      try {
        const res = await fetch('/api/market');
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        traditionalMarkets = data.map((m) => {
          let imgPath = "/uploads/traditionalmarket/default.jpg";

          if (m.main_img) {
            let raw = String(m.main_img).trim();

            if (raw.startsWith("http://") || raw.startsWith("https://")) imgPath = raw;
            else if (raw.startsWith("/uploads")) imgPath = raw;
            else if (raw.includes("/uploads/traditionalmarket/")) imgPath = raw;
            else imgPath = `/uploads/traditionalmarket/${raw}`;
          }

          return {
            id: m.id,
            name: m.market_name,
            address: m.address,
            phone: m.phone || "",
            img: imgPath,
            event: m.event_info || "",
            accessibility: m.facilities || "",
            parking: m.parking_available || ""
          };
        });

        renderTraditionalMarkets(currentIndex);
      } catch (e) {
        console.error("ì‹œì¥ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜:", e);
        alert("ì‹œì¥ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
      }
    }

    function safeText(v) {
      return String(v || "").replace(/[<>"']/g, (ch) => ({
        "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;"
      }[ch]));
    }

    function renderTraditionalMarkets(limit) {
      const container = document.getElementById("market-container");
      container.innerHTML = "";

      traditionalMarkets.slice(0, limit).forEach((market) => {
        const card = document.createElement("div");
        card.className = "glass soft-shadow rounded-3xl overflow-hidden lift";

        const phoneLine = market.phone
          ? `<div class="flex items-center gap-2 text-slate-700">
               <span class="w-7 h-7 rounded-full bg-emerald-500/15 flex items-center justify-center">ğŸ“</span>
               <span class="font-semibold">${safeText(market.phone)}</span>
             </div>`
          : "";

        card.innerHTML = `
          <a href="/traditionalmarketdetail.html?id=${market.id}" class="block">
            <div class="relative">
              <img class="h-52 w-full object-cover" src="${market.img}" alt="${safeText(market.name)}" loading="lazy">
              <div class="absolute inset-0 bg-gradient-to-t from-slate-900/55 via-slate-900/10 to-transparent"></div>

              <div class="absolute left-4 top-4 flex gap-2">
                <span class="px-3 py-1 rounded-full text-xs font-bold text-white bg-white/15 border border-white/20 backdrop-blur">
                  ì „í†µì‹œì¥
                </span>
                ${market.parking ? `
                <span class="px-3 py-1 rounded-full text-xs font-bold text-white bg-white/15 border border-white/20 backdrop-blur">
                  ğŸš— ì£¼ì°¨
                </span>` : ``}
              </div>

              <div class="absolute left-4 bottom-4 right-4">
                <h4 class="text-xl font-extrabold text-white drop-shadow-sm">${safeText(market.name)}</h4>
                <p class="text-white/90 text-sm mt-1 line-clamp-2">${safeText(market.address)}</p>
              </div>
            </div>
          </a>

          <div class="p-5">
            <div class="flex flex-col gap-3">
              <div class="flex items-start gap-2 text-slate-700">
                <span class="w-7 h-7 rounded-full bg-blue-600/10 flex items-center justify-center">ğŸ“</span>
                <span class="text-sm leading-relaxed">${safeText(market.address)}</span>
              </div>
              ${phoneLine}

              ${market.event ? `
              <div class="flex items-start gap-2 text-slate-700">
                <span class="w-7 h-7 rounded-full bg-indigo-600/10 flex items-center justify-center">ğŸ‰</span>
                <span class="text-sm leading-relaxed line-clamp-2">${safeText(market.event)}</span>
              </div>` : ``}

              <div class="pt-2 flex items-center justify-between gap-3">
                <a href="/traditionalmarketdetail.html?id=${market.id}"
                  class="inline-flex items-center justify-center gap-2 rounded-2xl px-4 py-2 font-bold text-white
                         bg-gradient-to-r from-blue-600 to-indigo-600 shadow hover:shadow-lg hover:scale-[1.02] transition">
                  <span>ìì„¸íˆ ë³´ê¸°</span>
                  <span>â†’</span>
                </a>

                <button type="button"
                  class="inline-flex items-center justify-center gap-2 rounded-2xl px-4 py-2 font-bold
                         bg-white/70 border border-slate-200 hover:bg-white transition"
                  onclick="copyAddress('${safeText(market.address)}')">
                  ğŸ“‹ ì£¼ì†Œë³µì‚¬
                </button>
              </div>
            </div>
          </div>
        `;
        container.appendChild(card);
      });

      if (limit >= traditionalMarkets.length) {
        document.getElementById("loadMoreBtn").style.display = "none";
      } else {
        document.getElementById("loadMoreBtn").style.display = "";
      }
    }

    document.addEventListener("DOMContentLoaded", fetchMarkets);

    document.getElementById("loadMoreBtn").addEventListener("click", () => {
      currentIndex += 3; // âœ… 2ë³´ë‹¤ 3ì´ ì²´ê°ì´ ì¢‹ìŒ(ì›í•˜ë©´ 2ë¡œ)
      renderTraditionalMarkets(currentIndex);
    });

    function goBack() { window.history.back(); }
    function goNext() { window.history.forward(); }

    async function copyAddress(text) {
      try {
        await navigator.clipboard.writeText(text);
        alert("ì£¼ì†Œë¥¼ ë³µì‚¬í–ˆì–´ìš”!");
      } catch (e) {
        // clipboard ë¶ˆê°€ ë¸Œë¼ìš°ì € fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        alert("ì£¼ì†Œë¥¼ ë³µì‚¬í–ˆì–´ìš”!");
      }
    }
  </script>
</body>

</html>