<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>이달의 제철 음식</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ✅ 긴 설명 줄임 표시 */
    .clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>

<body class="bg-gray-50 text-gray-800">

  <!-- 1단계: 대표 제철 음식 (재료 설명) -->
  <section class="max-w-5xl mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold text-center mb-6">🥗 이달의 제철 음식</h1>
    <div id="season-food" class="bg-white/70 backdrop-blur-xl rounded-3xl border border-gray-200 
             shadow-md grid md:grid-cols-2 gap-6 overflow-hidden min-h-[250px]">
      <!-- JS 데이터 삽입 -->
    </div>
  </section>

  <!-- 2단계: 제철 음식 목록 -->
  <section class="max-w-5xl mx-auto px-4 py-10">
    <h2 class="text-3xl font-bold text-center mb-6">😋 이달의 제철 음식 목록</h2>
    <div id="food-buttons" class="flex flex-wrap justify-center gap-3 mb-8"></div>

    <!-- 선택된 음식 상세 (간단 표시) -->
    <div id="food-detail" class="bg-white/70 backdrop-blur-xl rounded-3xl border border-gray-200
             shadow-md grid md:grid-cols-2 gap-6 overflow-hidden min-h-[250px]">
      <div>
        <img src="https://via.placeholder.com/600x400?text=제철음식" alt="제철 음식" class="w-full h-64 object-cover md:h-full">
      </div>
      <div class="p-6 flex flex-col justify-center text-center md:text-left">
        <h3 id="food-text" class="text-2xl font-bold mb-3 break-keep">이달의 제철 음식을 선택해보세요</h3>
      </div>
    </div>
  </section>

  <!-- 3단계: 우리동네 제철 음식 가게 -->
  <section class="max-w-6xl mx-auto px-4 py-10">
    <h2 class="text-2xl font-bold text-center mb-6">📢 우리동네 제철 음식 가게</h2>
    <div id="ad-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8 mb-8"></div>
    <div class="flex justify-center gap-2" id="pagination"></div>
  </section>

  <script>
    /* ✅ 제철 음식 데이터 (재료 설명 포함 → 상단 전용) */
    const monthlyFoods = [
      {
        name: "전어",
        desc: "전어는 가을철에 살이 올라 고소하고 담백한 맛이 절정에 달하는 대표적인 제철 생선입니다. 특히 구워 먹을 때 퍼지는 향은 가을철 미식가들의 입맛을 사로잡으며, 남도 지방에서는 회로도 즐깁니다. 오메가3 지방산이 풍부해 건강에도 좋으며, 술안주로도 인기가 높습니다.",
        img: "https://via.placeholder.com/600x400?text=전어"
      },
      {
        name: "꽃게",
        desc: "꽃게는 9~11월 사이 살이 가장 꽉 차고 맛이 뛰어난 제철 해산물입니다. 찜이나 탕으로 조리하면 담백하면서도 깊은 맛을 즐길 수 있고, 매콤한 꽃게탕은 가을철 별미로 손꼽힙니다. 단백질과 아연이 풍부하여 면역력 강화에도 도움을 줍니다.",
        img: "https://via.placeholder.com/600x400?text=꽃게"
      },
      {
        name: "송이버섯",
        desc: "송이버섯은 향긋한 향과 독특한 식감을 지닌 가을철 최고급 버섯입니다. 그 자체의 풍미가 강해 구이, 전골, 죽 등 간단한 조리만으로도 깊은 맛을 냅니다. 예로부터 귀한 선물로 쓰였으며, 면역력 증진과 항산화 효과가 있는 것으로 알려져 있습니다.",
        img: "https://via.placeholder.com/600x400?text=송이버섯"
      },
      {
        name: "대하",
        desc: "대하는 가을에 알이 차고 살이 단단해져 최고의 맛을 자랑하는 새우입니다. 소금구이, 버터구이, 튀김 등 다양한 방식으로 즐길 수 있으며, 특히 대하구이는 가을 축제의 대표 메뉴로 사랑받습니다. 단백질이 풍부하고 칼로리가 낮아 영양식으로도 좋습니다.",
        img: "https://via.placeholder.com/600x400?text=대하"
      }
    ];

    /* ✅ 가게 데이터 (예시 50개 생성 → 이 중 24개 랜덤 추출) */
    let adsData = Array.from({ length: 50 }, (_, i) => ({
      id: i + 1,
      title: `제철 가게 ${i + 1}`,
      image_url: `https://via.placeholder.com/300x200?text=가게${i + 1}`,
      category: "제철음식"
    }));

    /* 24개 랜덤 추출 */
    function getRandomAds() {
      const shuffled = [...adsData].sort(() => 0.5 - Math.random());
      return shuffled.slice(0, 24);
    }
    let randomAds = getRandomAds();

    let currentPage = 1;
    const adsPerPage = 8;
    const maxPages = 3;
    let currentFood = null;


    /* ✅ 대표 음식 + 버튼 표시 */
    function loadSeasonFood() {
      const data = monthlyFoods[0];
      const el = document.getElementById("season-food");
      el.innerHTML = `
        <div>
          <img src="${data.img}" alt="${data.name}" class="w-full h-64 object-cover md:h-full">
        </div>
        <div class="p-6 flex flex-col justify-center">
          <h3 class="text-2xl font-bold mb-3">${data.name}</h3>
          <p id="season-desc" class="text-gray-600 mb-4 clamp-3">${data.desc}</p>
          <div class="flex items-center gap-4 mb-4">
            <button id="desc-toggle" class="text-blue-600 text-sm font-semibold">더 보기</button>
          </div>
          <!-- ✅ 버튼들 상단에도 배치 -->
          <div id="season-buttons" class="flex flex-wrap gap-2 mt-2"></div>
        </div>
      `;
      renderFoodButtons("season-buttons");
      addDescToggle("season-desc", "desc-toggle");
    }

    /* ✅ 버튼 렌더링 */
    function renderFoodButtons(targetId) {
      const box = document.getElementById(targetId);
      box.innerHTML = monthlyFoods.map(food => `
        <button class="food-btn bg-blue-100 px-3 py-1 rounded-full hover:bg-blue-200"
                data-food="${food.name}">
          ${food.name}
        </button>
      `).join("");

      box.querySelectorAll(".food-btn").forEach(btn => {
        btn.addEventListener("click", () => selectFood(btn.dataset.food));
      });
    }

    /* ✅ 설명 더보기 버튼 */
    function addDescToggle(descId, btnId) {
      const desc = document.getElementById(descId);
      const btn = document.getElementById(btnId);
      let expanded = false;
      btn.addEventListener("click", () => {
        expanded = !expanded;
        if (expanded) {
          desc.classList.remove("clamp-3");
          btn.textContent = "접기";
        } else {
          desc.classList.add("clamp-3");
          btn.textContent = "더 보기";
        }
      });
    }

    /* ✅ 음식 선택 처리 (아래는 간단 표시만) */
    function selectFood(foodName) {
      currentFood = foodName;
      const food = monthlyFoods.find(f => f.name === currentFood);

      // 상세 영역 갱신 (간단하게만 표시)
      const box = document.getElementById("food-detail");
      box.innerHTML = `
        <div>
          <img src="${food.img}" alt="${food.name}" class="w-full h-64 object-cover md:h-full">
        </div>
        <div class="p-6 flex flex-col justify-center text-center md:text-left">
          <h3 class="text-2xl font-bold mb-3 break-keep">${food.name}</h3>
          <p class="text-gray-600">선택된 제철 음식입니다.</p>
        </div>
      `;

      // 가게 목록 갱신
      renderAds(1);
    }

    /* ✅ 광고 렌더링 */
    /* ✅ 광고 렌더링 */
    function renderAds(page = 1) {
      currentPage = page;
      const grid = document.getElementById("ad-grid");
      grid.innerHTML = "";

      // 음식 필터 (선택된 음식이 있으면 해당 가게만)
      let filteredAds = currentFood ? randomAds.filter(ad => ad.food === currentFood) : randomAds;

      const start = (page - 1) * adsPerPage;
      const end = start + adsPerPage;
      const pageAds = filteredAds.slice(start, end);

      // 항상 8개 채우기
      while (pageAds.length < adsPerPage) {
        pageAds.push({
          id: 0,
          title: "광고 준비중",
          image_url: "https://via.placeholder.com/300x200?text=빈자리",
          category: ""
        });
      }

      pageAds.forEach(ad => {
        grid.innerHTML += `
      <div class="relative bg-white/70 backdrop-blur-xl rounded-3xl border border-gray-200 
                  shadow-md flex flex-col overflow-hidden p-4">
        <div class="w-full h-40 bg-gray-100 rounded-xl mb-4 overflow-hidden">
          <img src="${ad.image_url}" alt="${ad.title}" class="w-full h-full object-cover">
        </div>
        <h4 class="font-extrabold text-lg text-gray-800 mb-2 text-center">${ad.title}</h4>
        ${ad.id ? `<a href="detail.html?id=${ad.id}" 
             class="mt-auto inline-block text-center bg-gradient-to-r from-yellow-400 to-pink-400 
                    text-white font-semibold px-4 py-2 rounded-full shadow hover:opacity-90 transition">
             더보기</a>` : ""}
      </div>
    `;
      });

      renderPagination();
    }

    /* ✅ 페이지네이션 (3페이지 고정) */
    function renderPagination() {
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";

      for (let i = 1; i <= maxPages; i++) {
        pagination.innerHTML += `
      <button onclick="renderAds(${i})" 
        class="px-3 py-1 rounded-md ${i === currentPage ? "bg-blue-500 text-white" : "bg-gray-200 hover:bg-gray-300"}">
        ${i}
      </button>
    `;
      }
    }

    /* ✅ 초기 실행 */
    document.addEventListener("DOMContentLoaded", () => {
      loadSeasonFood();           // 상단 대표 + 설명
      renderFoodButtons("food-buttons"); // 중간 버튼
      renderAds();
    });
  </script>
</body>

</html>