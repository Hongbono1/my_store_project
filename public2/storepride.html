<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í† ì–´ í”„ë¼ì´ë“œ ëª¨ìŒ | MALL HANKOOK</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            /* ğŸ”¹ íŒŒë€ í†¤ ì œê±°í•˜ê³  ì¤‘ë¦½ì ì¸ ê·¸ë ˆì´ ê³„ì—´ë¡œ ë³€ê²½ */
            background: linear-gradient(135deg, #f9fafb, #f3f4f6, #e5e7eb);
            font-family: Pretendard, -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
        }

        /* ğŸ”¥ ë„¤ì˜¤ëª¨í”¼ì¦˜ ê³µí†µ */
        .neo-box {
            background: #f3f4f6;
            border-radius: 22px;
            box-shadow:
                10px 10px 20px #d1d5db,
                -10px -10px 20px #ffffff;
        }

        /* ğŸ”¥ ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ */
        .glass {
            backdrop-filter: blur(15px);
            background: rgba(255, 255, 255, 0.32);
            border: 1px solid rgba(255, 255, 255, 0.42);
        }

        /* 3D Hover */
        .card-3d {
            transition: all 0.25s ease;
            transform-style: preserve-3d;
        }

        .card-3d:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, .15);
        }

        .badge-open {
            font-size: 0.65rem;
            letter-spacing: 0.04em;
        }
    </style>
</head>

<body>

    <!-- Header -->
    <div id="header"></div>

    <div class="max-w-screen-xl mx-auto px-4 sm:px-8 mt-12 mb-24">

        <!-- ğŸŸ¦ íƒ€ì´í‹€ ì˜ì—­ -->
        <section class="glass neo-box p-10 mb-10 relative">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 text-center tracking-tight drop-shadow-md">
                âœ¨ ìš°ë¦¬ê°€ê²Œ ìë‘ ëª¨ìŒ
            </h1>

            <p class="mt-4 text-center text-gray-600 text-base md:text-lg">
                ìš°ë¦¬ ë™ë„¤ ì‚¬ì¥ë‹˜ë“¤ì´ ì§ì ‘ ì†Œê°œí•˜ëŠ” ìë‘ê±°ë¦¬ë“¤ì„ í•œ ê³³ì— ëª¨ì•˜ì–´ìš”.
            </p>

            <a href="/storeprideregister.html"
                class="absolute right-6 top-6 bg-blue-600 text-white px-5 py-2 rounded-xl shadow-lg hover:bg-blue-700 transition text-sm font-semibold">
                + ë“±ë¡í•˜ê¸°
            </a>
        </section>

        <!-- ğŸ” í•„í„°ë°” (ì¹´í…Œê³ ë¦¬ / ì§€ì—­) -->
        <section class="neo-box glass p-5 mb-12">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div class="font-semibold text-gray-800 text-base">
                    ğŸ” ì›í•˜ëŠ” ê°€ê²Œë§Œ ê³¨ë¼ë³´ê¸°
                </div>
                <div class="flex flex-wrap gap-3">
                    <select id="filterCategory"
                        class="px-3 py-2 rounded-full bg-white/80 border border-gray-300 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-400">
                        <option value="all">ì¹´í…Œê³ ë¦¬ ì „ì²´</option>
                    </select>

                    <select id="filterRegion"
                        class="px-3 py-2 rounded-full bg-white/80 border border-gray-300 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-400">
                        <option value="all">ì§€ì—­ ì „ì²´</option>
                    </select>

                    <button id="filterReset"
                        class="px-3 py-2 rounded-full bg-gray-800 text-white text-xs font-semibold shadow hover:bg-gray-900">
                        ì´ˆê¸°í™”
                    </button>
                </div>
            </div>
        </section>

        <!-- ğŸŸ¦ ìš°ë¦¬ê°€ê²Œ ìë‘ ë°•ìŠ¤ ê·¸ë£¹ (2ê°œì”© ë¬¶ìŒ) -->
        <section class="neo-box glass p-8 mb-16">
            <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">ê°€ê²Œ ìë‘ BEST</h2>

            <div id="hotNeighborhoodBoxes" class="flex flex-col gap-8"></div>
        </section>

        <!-- ğŸŸ¦ ìºëŸ¬ì…€ ìŠ¬ë¼ì´ë“œ -->
        <section class="neo-box glass p-4 mb-20">
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-6">ì˜¤ëŠ˜ì˜ ì¶”ì²œ</h2>

            <div class="flex items-center gap-4 justify-center">
                <!-- ì™¼ìª½ ë²„íŠ¼ -->
                <button id="prevBtn"
                    class="bg-white backdrop-blur px-4 py-3 rounded-full shadow-lg hover:bg-gray-50 hover:scale-110 transition z-10 text-2xl flex-shrink-0">
                    â—€
                </button>

                <!-- ìŠ¬ë¼ì´ë” ì»¨í…Œì´ë„ˆ (ì¹´ë“œ 3ê°œ ì˜ì—­) -->
                <div class="relative overflow-hidden w-full max-w-4xl">
                    <div id="sliderContainer"
                        class="flex transition-transform duration-500 h-60 items-center w-max mx-auto"></div>
                </div>

                <!-- ì˜¤ë¥¸ìª½ ë²„íŠ¼ -->
                <button id="nextBtn"
                    class="bg-white backdrop-blur px-4 py-3 rounded-full shadow-lg hover:bg-gray-50 hover:scale-110 transition z-10 text-2xl flex-shrink-0">
                    â–¶
                </button>
            </div>
        </section>

        <!-- ğŸŸ¦ ì¶”ê°€ ê°€ê²Œ ì¹´ë“œ ì„¹ì…˜ (ë‚¨ëŠ” ìë‘ë“¤ ì±„ìš°ê¸°) -->
        <section class="neo-box glass p-8">
            <!-- â›”ï¸ ì œëª© â€œê¸ˆì£¼ì˜ ì¶”ì²œ ê°€ê²Œâ€ ì‚­ì œ ìš”ì²­ â†’ ì œê±° -->
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 items-stretch">

                <!-- ì™¼ìª½ ì´ë¯¸ì§€ 2ê°œëŠ” ìœ ì§€ (ë¶„ìœ„ê¸°ìš©) -->
                <div class="lg:col-span-1 flex flex-col gap-6">
                    <div class="flex-1 neo-box overflow-hidden">
                        <img src="/assets/images/no-thumb.png"
                            class="w-full h-full object-cover rounded-xl" alt="placeholder 1">
                    </div>
                    <div class="flex-1 neo-box overflow-hidden">
                        <img src="/assets/images/no-thumb.png"
                            class="w-full h-full object-cover rounded-xl" alt="placeholder 2">
                    </div>
                </div>

                <!-- ì˜¤ë¥¸ìª½ ì¶”ì²œ ê°€ê²Œ ì¹´ë“œ (ìë‘ì´ ë§ì•„ì§€ë©´ ì—¬ê¸°ê¹Œì§€ ì±„ì›€) -->
                <div id="recommendedStoreContainer"
                    class="lg:col-span-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>

            </div>
        </section>

    </div>

    <!-- ìš°ì¸¡ í•˜ë‹¨ ê³ ì • ë„¤ë¹„ (ì´ì „ / ë‹¤ìŒ / í™ˆ) -->
    <div class="fixed bottom-6 right-6 flex flex-col items-center gap-4 z-50">
        <div class="flex flex-col items-center">
            <button onclick="goBack()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gray-100 text-gray-800 border border-gray-200 shadow hover:bg-gray-50 transition">
                â†
            </button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">ì´ì „</span>
        </div>
        <div class="flex flex-col items-center">
            <button onclick="goNext()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gray-100 text-gray-800 border border-gray-200 shadow hover:bg-gray-50 transition">
                â†’
            </button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">ë‹¤ìŒ</span>
        </div>
        <div class="flex flex-col items-center">
            <button onclick="goHome()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-blue-600 text-white shadow hover:bg-blue-700 transition">
                ğŸ 
            </button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">í™ˆ</span>
        </div>
    </div>

    <div id="footer"></div>

    <!-- ========== JS ë¡œì§ ========== -->

    <script>
        /* Header/Footer */
        fetch('components/header.html').then(r => r.text()).then(d => header.innerHTML = d);
        fetch('components/footer.html').then(r => r.text()).then(d => footer.innerHTML = d);

        // ë¸Œë¼ìš°ì € ë„¤ë¹„
        function goBack() { window.history.back(); }
        function goNext() { window.history.forward(); }
        function goHome() { window.location.href = "/index.html"; }

        // ========= ê³µí†µ ìœ í‹¸ =========
        function extractRegionFromAddress(addr) {
            if (!addr) return "";
            const tokens = addr.trim().replace(/\s+/g, " ").split(" ");
            // ì˜ˆ: "ê²½ê¸° ì˜ì •ë¶€ì‹œ ë¶€ìš©ë¡œ213ë²ˆê¸¸ 16" â†’ "ê²½ê¸° ì˜ì •ë¶€ì‹œ"
            return tokens.slice(0, 2).join(" ");
        }

        // ========= ì¹´ë“œ ìƒì„± =========
        function createAdCard(ad) {
            if (!ad) return createEmptyAdCard();

            const adBox = document.createElement("div");
            adBox.className =
                "neo-box glass p-6 rounded-2xl shadow flex flex-col card-3d flex-1";

            // ì´ë¯¸ì§€ ê²½ë¡œ ì²˜ë¦¬
            let imgSrc = '/assets/images/no-thumb.png';
            if (ad.main_image) {
                imgSrc = ad.main_image.startsWith('/uploads/') || ad.main_image.startsWith('http')
                    ? ad.main_image
                    : `/uploads/${ad.main_image}`;
            }

            const hasOpenBadge = ad.open_id || ad.is_open_soon;

            adBox.innerHTML = `
        <div class="relative mb-4">
          <img src="${imgSrc}"
               class="h-40 w-full object-cover rounded-xl shadow"
               alt="${ad.store_name || 'ê°€ê²Œ ì´ë¯¸ì§€'}">
          ${hasOpenBadge ? `
            <span class="badge-open absolute left-3 top-3 inline-flex items-center gap-1 px-3 py-1 rounded-full bg-amber-500 text-white font-semibold shadow">
              ğŸ”” ì˜¤í”ˆ ì˜ˆì •
            </span>
          ` : ``}
        </div>
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-1">${ad.store_name || '-'}</h2>
        <p class="text-center text-lg text-blue-600 font-bold mb-1">${ad.category || ''}</p>
        <p class="text-center text-gray-600 text-sm mb-3">${ad.phone || ''}</p>
        <a href="/substorepride.html?id=${ad.pride_id}"
           class="mt-auto bg-blue-600 text-white text-center py-2 rounded-xl shadow hover:bg-blue-700 transition text-sm font-semibold">
           ìì„¸íˆ ë³´ê¸°
        </a>
      `;
            return adBox;
        }

        function createEmptyAdCard() {
            const div = document.createElement("div");
            div.className = "neo-box glass p-6 opacity-50 rounded-xl flex flex-col flex-1";
            div.innerHTML = `
        <div class="w-full h-40 bg-gray-200 rounded-xl mb-4"></div>
        <p class="text-center text-gray-400">ì •ë³´ ì—†ìŒ</p>
      `;
            return div;
        }

        // ìœ„ìª½ BEST ì˜ì—­ (2ê°œì”© ë¬¶ìŒ)
        function renderAdBoxes(containerId, ads, perBox = 2) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";

            if (!ads || !ads.length) {
                container.innerHTML = `<p class="text-center text-gray-400 py-10">ë“±ë¡ëœ ê°€ê²Œ ìë‘ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
                return;
            }

            const data = [...ads];

            for (let i = 0; i < data.length; i += perBox) {
                const box = document.createElement("div");
                box.className = "neo-box glass p-5 rounded-2xl flex flex-col md:flex-row gap-6 card-3d";

                for (let j = 0; j < perBox; j++) {
                    const item = data[i + j];
                    box.appendChild(createAdCard(item || null));
                }
                container.appendChild(box);
            }
        }

        // ì•„ë˜ìª½ ì¶”ê°€ ì„¹ì…˜ (ê·¸ëƒ¥ ì¹´ë“œ ë‚˜ì—´)
        function renderAds(containerId, ads) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";

            if (!ads || !ads.length) {
                return; // ì•„ë˜ëŠ” ë¹„ì–´ ìˆì–´ë„ ë¨
            }

            ads.forEach(ad => container.appendChild(createAdCard(ad)));
        }

        async function safeFetch(url) {
            try {
                const r = await fetch(url);
                if (r.ok) return await r.json();
            } catch (e) {
                console.error("fetch ì˜¤ë¥˜:", e);
                return [];
            }
            return [];
        }

        // ========= ìŠ¬ë¼ì´ë“œ ì¹´ë“œ =========
        function createSimpleSlideAdCard(ad) {
            const div = document.createElement("div");
            div.className = "flex-shrink-0 w-72 mx-2 cursor-pointer card-3d";

            const hasOpenBadge = ad && (ad.open_id || ad.is_open_soon);

            // ì´ë¯¸ì§€ ê²½ë¡œ ì²˜ë¦¬
            let imgSrc = '/assets/images/no-thumb.png';
            if (ad && ad.main_image) {
                imgSrc = ad.main_image.startsWith('/uploads/') || ad.main_image.startsWith('http')
                    ? ad.main_image
                    : `/uploads/${ad.main_image}`;
            }

            div.innerHTML = `
        <div class="neo-box glass p-4 rounded-2xl shadow flex flex-col items-center relative">
          <div class="relative w-full mb-3">
            <img src="${imgSrc}"
                 class="w-full h-44 object-cover rounded-xl"
                 alt="${(ad && ad.store_name) || 'ê°€ê²Œ ì´ë¯¸ì§€'}">
            ${hasOpenBadge ? `
              <span class="badge-open absolute left-3 top-3 inline-flex items-center gap-1 px-3 py-1 rounded-full bg-amber-500 text-white font-semibold shadow">
                ğŸ”” ì˜¤í”ˆ ì˜ˆì •
              </span>
            ` : ``}
          </div>
          <h3 class="font-bold text-center text-gray-700 text-lg">${(ad && ad.store_name) || 'ê°€ê²Œ ì´ë¦„ ë¯¸ì •'}</h3>
          <p class="text-base text-blue-600 font-semibold text-center">${(ad && ad.category) || ''}</p>
        </div>
      `;

            if (ad && ad.pride_id) {
                div.onclick = () => location.href = `/substorepride.html?id=${ad.pride_id}`;
            }

            return div;
        }

        async function renderSliderAds() {
            const slider = document.getElementById("sliderContainer");

            let ads = await safeFetch("/storepride/api");
            if (!Array.isArray(ads) || !ads.length) ads = Array(5).fill({});

            slider.innerHTML = "";
            ads.forEach(ad => slider.appendChild(createSimpleSlideAdCard(ad)));

            let idx = 0, total = ads.length;

            const update = () => {
                // 19rem ì •ë„ ê°„ê²©ìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ
                slider.style.transform = `translateX(-${idx * 19}rem)`;
            };

            const prevBtn = document.getElementById("prevBtn");
            const nextBtn = document.getElementById("nextBtn");

            prevBtn.onclick = () => { idx = (idx - 1 + total) % total; update(); resetAutoSlide(); };
            nextBtn.onclick = () => { idx = (idx + 1) % total; update(); resetAutoSlide(); };

            // ìë™ ìŠ¬ë¼ì´ë“œ - 7ì´ˆë§ˆë‹¤ 2ì¹¸ì”© ì´ë™
            let autoSlideInterval;

            const startAutoSlide = () => {
                autoSlideInterval = setInterval(() => {
                    idx = (idx + 2) % total;
                    update();
                }, 7000);
            };

            const resetAutoSlide = () => {
                clearInterval(autoSlideInterval);
                startAutoSlide();
            };

            update();
            startAutoSlide();
        }

        // ========= í•„í„° & ë Œë”ë§ =========
        let originalPrideList = [];
        let filteredPrideList = [];

        function setupFilterOptions(list) {
            const catSelect = document.getElementById("filterCategory");
            const regionSelect = document.getElementById("filterRegion");
            if (!catSelect || !regionSelect) return;

            const categories = Array.from(
                new Set(list.map(v => v.category).filter(Boolean))
            ).sort();

            const regions = Array.from(
                new Set(list.map(v => extractRegionFromAddress(v.address)).filter(Boolean))
            ).sort();

            // ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì±„ìš°ê¸°
            categories.forEach(cat => {
                const opt = document.createElement("option");
                opt.value = cat;
                opt.textContent = cat;
                catSelect.appendChild(opt);
            });

            // ì§€ì—­ ì˜µì…˜ ì±„ìš°ê¸°
            regions.forEach(r => {
                const opt = document.createElement("option");
                opt.value = r;
                opt.textContent = r;
                regionSelect.appendChild(opt);
            });

            document.getElementById("filterReset").addEventListener("click", () => {
                catSelect.value = "all";
                regionSelect.value = "all";
                applyFilterAndRender();
            });

            catSelect.addEventListener("change", applyFilterAndRender);
            regionSelect.addEventListener("change", applyFilterAndRender);
        }

        function applyFilterAndRender() {
            const catSelect = document.getElementById("filterCategory");
            const regionSelect = document.getElementById("filterRegion");
            const cat = catSelect ? catSelect.value : "all";
            const region = regionSelect ? regionSelect.value : "all";

            filteredPrideList = originalPrideList.filter(item => {
                let ok = true;
                if (cat !== "all") ok = ok && item.category === cat;
                if (region !== "all") ok = ok && extractRegionFromAddress(item.address) === region;
                return ok;
            });

            // ìœ„ìª½ BEST: ìµœëŒ€ 8ê°œ
            const topList = filteredPrideList.slice(0, 8);
            const bottomList = filteredPrideList.slice(8); // ë‚¨ëŠ” ê±´ ì•„ë˜ ì¶”ì²œ ì»¨í…Œì´ë„ˆë¡œ

            renderAdBoxes("hotNeighborhoodBoxes", topList, 2);
            renderAds("recommendedStoreContainer", bottomList);
        }

        /* ë©”ì¸ ë¡œë”© */
        document.addEventListener("DOMContentLoaded", async () => {
            const prideList = await safeFetch("/storepride/list");

            if (Array.isArray(prideList)) {
                originalPrideList = prideList;
                filteredPrideList = prideList;
            } else {
                originalPrideList = [];
                filteredPrideList = [];
            }

            setupFilterOptions(originalPrideList);
            applyFilterAndRender();

            // ìŠ¬ë¼ì´ë”: ì‹¤ì œ ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ë‹¤ì‹œ ë Œë”
            renderSliderAds();
        });

    </script>

</body>

</html>
