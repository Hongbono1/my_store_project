<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í† ì–´ í”„ë¼ì´ë“œ ëª¨ìŒ | MALL HANKOOK</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            /* íŒŒë€ ë°°ê²½ ì‚­ì œ â†’ ì¤‘ë¦½ì ì¸ ê·¸ë ˆì´ ê³„ì—´ */
            background: linear-gradient(135deg, #f9fafb, #f3f4f6, #e5e7eb);
            font-family: Pretendard, -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
        }

        /* ğŸ”¥ ë„¤ì˜¤ëª¨í”¼ì¦˜ ê³µí†µ */
        .neo-box {
            background: #f3f4f6;
            border-radius: 22px;
            box-shadow:
                10px 10px 20px #d1d5db,
                -10px -10px 20px #ffffff;
        }

        /* ğŸ”¥ ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ */
        .glass {
            backdrop-filter: blur(15px);
            background: rgba(255, 255, 255, 0.32);
            border: 1px solid rgba(255, 255, 255, 0.42);
        }

        /* 3D Hover */
        .card-3d {
            transition: all 0.25s ease;
            transform-style: preserve-3d;
        }

        .card-3d:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, .15);
        }
    </style>
</head>

<body>

    <!-- Header -->
    <div id="header"></div>

    <div class="max-w-screen-xl mx-auto px-4 sm:px-8 mt-12 mb-24">

        <!-- ğŸŸ¦ íƒ€ì´í‹€ ì˜ì—­ -->
        <section class="glass neo-box p-10 mb-12 relative">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 text-center tracking-tight drop-shadow-md">
                âœ¨ ìš°ë¦¬ê°€ê²Œ ìë‘ ëª¨ìŒ
            </h1>

            <p class="mt-4 text-center text-gray-600 text-base md:text-lg">
                ìš°ë¦¬ ë™ë„¤ ì‚¬ì¥ë‹˜ë“¤ì´ ì§ì ‘ ì†Œê°œí•˜ëŠ” ìë‘ê±°ë¦¬ë“¤ì„ í•œ ê³³ì— ëª¨ì•˜ì–´ìš”.
            </p>

            <a href="/storeprideregister.html"
                class="absolute right-6 top-6 bg-blue-600 text-white px-5 py-2 rounded-xl shadow-lg hover:bg-blue-700 transition text-sm font-semibold">
                + ë“±ë¡í•˜ê¸°
            </a>
        </section>

        <!-- ğŸŸ¦ ìš°ë¦¬ê°€ê²Œ ìë‘ ë°•ìŠ¤ ê·¸ë£¹ (2ê°œì”© ë¬¶ìŒ) -->
        <section class="neo-box glass p-8 mb-16">
            <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">ê°€ê²Œ ìë‘ BEST</h2>

            <div id="hotNeighborhoodBoxes" class="flex flex-col gap-8"></div>
        </section>

        <!-- ğŸŸ¦ ìºëŸ¬ì…€ ìŠ¬ë¼ì´ë“œ -->
        <section class="neo-box glass p-4 mb-20">
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-6">ì˜¤ëŠ˜ì˜ ì¶”ì²œ</h2>

            <div class="flex items-center gap-4 justify-center">
                <!-- ì™¼ìª½ ë²„íŠ¼ -->
                <button id="prevBtn"
                    class="bg-white backdrop-blur px-4 py-3 rounded-full shadow-lg hover:bg-gray-50 hover:scale-110 transition z-10 text-2xl flex-shrink-0">
                    â—€
                </button>

                <!-- ìŠ¬ë¼ì´ë” ì»¨í…Œì´ë„ˆ -->
                <div class="relative overflow-hidden w-full max-w-4xl">
                    <div id="sliderContainer"
                        class="flex transition-transform duration-500 h-60 items-center w-max mx-auto"></div>
                </div>

                <!-- ì˜¤ë¥¸ìª½ ë²„íŠ¼ -->
                <button id="nextBtn"
                    class="bg-white backdrop-blur px-4 py-3 rounded-full shadow-lg hover:bg-gray-50 hover:scale-110 transition z-10 text-2xl flex-shrink-0">
                    â–¶
                </button>
            </div>
        </section>

        <!-- ğŸŸ¦ ì¶”ê°€ ê°€ê²Œ ì¹´ë“œ ì„¹ì…˜ (ìë‘ ë§ì•„ì§€ë©´ ì—¬ê¸°ë¡œë„ ì±„ìš°ê¸°) -->
        <section class="neo-box glass p-8">
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 items-stretch">

                <!-- ì™¼ìª½ ì´ë¯¸ì§€ 2ê°œ -->
                <div class="lg:col-span-1 flex flex-col gap-6">
                    <div class="flex-1 neo-box overflow-hidden">
                        <img src="/assets/images/no-thumb.png" class="w-full h-full object-cover rounded-xl"
                            alt="placeholder 1">
                    </div>
                    <div class="flex-1 neo-box overflow-hidden">
                        <img src="/assets/images/no-thumb.png" class="w-full h-full object-cover rounded-xl"
                            alt="placeholder 2">
                    </div>
                </div>

                <!-- ì˜¤ë¥¸ìª½ ì¶”ì²œ ê°€ê²Œ ì¹´ë“œ (ì¶”ê°€ ìë‘ë“¤) -->
                <div id="recommendedStoreContainer"
                    class="lg:col-span-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>

            </div>
        </section>

    </div>

    <!-- ìš°ì¸¡ í•˜ë‹¨ ê³ ì • ë„¤ë¹„ (ì´ì „ / ë‹¤ìŒ / í™ˆ) -->
    <div class="fixed bottom-6 right-6 flex flex-col items-center gap-4 z-50">
        <div class="flex flex-col items-center">
            <button onclick="goBack()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gray-100 text-gray-800 border border-gray-200 shadow hover:bg-gray-50 transition">
                â†
            </button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">ì´ì „</span>
        </div>
        <div class="flex flex-col items-center">
            <button onclick="goNext()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-gray-100 text-gray-800 border border-gray-200 shadow hover:bg-gray-50 transition">
                â†’
            </button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">ë‹¤ìŒ</span>
        </div>
        <div class="flex flex-col items-center">
            <button onclick="goHome()"
                class="w-14 h-14 flex items-center justify-center rounded-full bg-blue-600 text-white shadow hover:bg-blue-700 transition">
                ğŸ 
            </button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">í™ˆ</span>
        </div>
    </div>

    <div id="footer"></div>

    <script>
        /* Header/Footer */
        fetch('components/header.html').then(r => r.text()).then(d => header.innerHTML = d);
        fetch('components/footer.html').then(r => r.text()).then(d => footer.innerHTML = d);

        // ë¸Œë¼ìš°ì € ë„¤ë¹„
        function goBack() { window.history.back(); }
        function goNext() { window.history.forward(); }
        function goHome() { window.location.href = "/index.html"; }

        /* ì¹´ë“œ ìƒì„± */
        function createAdCard(ad) {
            if (!ad) return createEmptyAdCard();

            const adBox = document.createElement("div");
            adBox.className =
                "neo-box glass p-6 rounded-2xl shadow flex flex-col card-3d flex-1";

            // ì´ë¯¸ì§€ ê²½ë¡œ ì²˜ë¦¬
            let imgSrc = '/assets/images/no-thumb.png';
            if (ad.main_image) {
                imgSrc = ad.main_image.startsWith('/uploads/') || ad.main_image.startsWith('http')
                    ? ad.main_image
                    : `/uploads/${ad.main_image}`;
            }

            adBox.innerHTML = `
        <img src="${imgSrc}"
             class="h-40 w-full object-cover rounded-xl mb-4 shadow"
             alt="${ad.store_name || 'ê°€ê²Œ ì´ë¯¸ì§€'}">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-1">${ad.store_name || '-'}</h2>
        <p class="text-center text-lg text-blue-600 font-bold mb-2">${ad.category || ''}</p>
        <p class="text-center text-gray-600 text-sm mb-3">${ad.phone || ''}</p>
        <a href="/substorepride.html?id=${ad.pride_id}"
           class="mt-auto bg-blue-600 text-white text-center py-2 rounded-xl shadow hover:bg-blue-700 transition text-sm font-semibold">
           ìì„¸íˆ ë³´ê¸°
        </a>
      `;
            return adBox;
        }

        function createEmptyAdCard() {
            const div = document.createElement("div");
            div.className = "neo-box glass p-6 opacity-50 rounded-xl flex flex-col flex-1";
            div.innerHTML = `
        <div class="w-full h-40 bg-gray-200 rounded-xl mb-4"></div>
        <p class="text-center text-gray-400">ì •ë³´ ì—†ìŒ</p>
      `;
            return div;
        }

        // ìœ„ìª½ BEST ì˜ì—­ (2ê°œì”© ë¬¶ìŒ)
        function renderAdBoxes(containerId, ads, perBox = 2) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";

            if (!ads || !ads.length) {
                container.innerHTML = `<p class="text-center text-gray-400 py-10">ë“±ë¡ëœ ê°€ê²Œ ìë‘ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
                return;
            }

            const data = [...ads];

            for (let i = 0; i < data.length; i += perBox) {
                const box = document.createElement("div");
                box.className = "neo-box glass p-5 rounded-2xl flex flex-col md:flex-row gap-6 card-3d";

                for (let j = 0; j < perBox; j++) {
                    const item = data[i + j];
                    box.appendChild(createAdCard(item || null));
                }
                container.appendChild(box);
            }
        }

        // ì•„ë˜ìª½ ì¶”ê°€ ì„¹ì…˜
        function renderAds(containerId, ads) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";

            if (!ads || !ads.length) return;

            ads.forEach(ad => container.appendChild(createAdCard(ad)));
        }

        async function safeFetch(url) {
            try {
                const r = await fetch(url);
                if (r.ok) return await r.json();
            } catch (e) {
                console.error("fetch ì˜¤ë¥˜:", e);
                return [];
            }
            return [];
        }

        /* ìŠ¬ë¼ì´ë“œ ì¹´ë“œ */
        function createSimpleSlideAdCard(ad) {
            const div = document.createElement("div");
            div.className = "flex-shrink-0 w-72 mx-2 cursor-pointer card-3d";

            // ì´ë¯¸ì§€ ê²½ë¡œ ì²˜ë¦¬
            let imgSrc = '/assets/images/no-thumb.png';
            if (ad && ad.main_image) {
                imgSrc = ad.main_image.startsWith('/uploads/') || ad.main_image.startsWith('http')
                    ? ad.main_image
                    : `/uploads/${ad.main_image}`;
            }

            div.innerHTML = `
        <div class="neo-box glass p-4 rounded-2xl shadow flex flex-col items-center">
          <img src="${imgSrc}"
               class="w-full h-44 object-cover rounded-xl mb-3"
               alt="${(ad && ad.store_name) || 'ê°€ê²Œ ì´ë¯¸ì§€'}">
          <h3 class="font-bold text-center text-gray-700 text-lg">${(ad && ad.store_name) || 'ê°€ê²Œ ì´ë¦„ ë¯¸ì •'}</h3>
          <p class="text-base text-blue-600 font-semibold text-center">${(ad && ad.category) || ''}</p>
        </div>
      `;

            if (ad && ad.pride_id) {
                div.onclick = () => location.href = `/substorepride.html?id=${ad.pride_id}`;
            }

            return div;
        }

        async function renderSliderAds() {
            const slider = document.getElementById("sliderContainer");

            let ads = await safeFetch("/storepride/api");
            if (!Array.isArray(ads) || !ads.length) ads = Array(5).fill({});

            slider.innerHTML = "";
            ads.forEach(ad => slider.appendChild(createSimpleSlideAdCard(ad)));

            let idx = 0, total = ads.length;

            const update = () => {
                slider.style.transform = `translateX(-${idx * 19}rem)`;
            };

            const prevBtn = document.getElementById("prevBtn");
            const nextBtn = document.getElementById("nextBtn");

            prevBtn.onclick = () => { idx = (idx - 1 + total) % total; update(); resetAutoSlide(); };
            nextBtn.onclick = () => { idx = (idx + 1) % total; update(); resetAutoSlide(); };

            let autoSlideInterval;

            const startAutoSlide = () => {
                autoSlideInterval = setInterval(() => {
                    idx = (idx + 2) % total;
                    update();
                }, 7000);
            };

            const resetAutoSlide = () => {
                clearInterval(autoSlideInterval);
                startAutoSlide();
            };

            update();
            startAutoSlide();
        }

        /* ë©”ì¸ ë¡œë”© */
        document.addEventListener("DOMContentLoaded", async () => {
            const prideList = await safeFetch("/storepride/list");
            const list = Array.isArray(prideList) ? prideList : [];

            // ìœ„ìª½ BEST: ìµœëŒ€ 8ê°œ
            const topList = list.slice(0, 8);
            // ë‚¨ì€ ê²ƒë“¤ì€ ì•„ë˜ ì¹¸ìœ¼ë¡œ
            const bottomList = list.slice(8);

            renderAdBoxes("hotNeighborhoodBoxes", topList, 2);
            renderAds("recommendedStoreContainer", bottomList);

            // ìŠ¬ë¼ì´ë” ë Œë”
            renderSliderAds();
        });

    </script>

</body>

</html>