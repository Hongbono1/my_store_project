<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>가장 핫한 우리동네</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 text-gray-800">

  <div id="header"></div>
  <style>
    /* 네오모피즘 + 글래스 공통 */
    .neo-glass {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(20px);
      box-shadow: 8px 8px 16px rgba(163, 177, 198, 0.6),
        -8px -8px 16px rgba(255, 255, 255, 0.9);
    }

    /* 버튼 3D 효과 */
    .btn-3d {
      background: linear-gradient(145deg, #4f8cff, #1e40af);
      box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.3),
        -2px -2px 6px rgba(255, 255, 255, 0.8);
    }

    .btn-3d:hover {
      transform: translateY(-2px);
      box-shadow: 6px 6px 14px rgba(0, 0, 0, 0.4),
        -3px -3px 8px rgba(255, 255, 255, 0.9);
    }

    .btn-3d:active {
      transform: translateY(2px);
      box-shadow: inset 2px 2px 6px rgba(0, 0, 0, 0.3),
        inset -2px -2px 6px rgba(255, 255, 255, 0.8);
    }
  </style>

  <!-- ✅ Main -->
  <main class="flex-grow">

    <!-- 상단 제목 -->
    <section class="text-center py-10">
      <h1 class="text-3xl font-bold mb-2">가장 핫(HOT)한 우리동네</h1>
      <p class="text-gray-600">우리동네 핫(HOT)한 가게를 소개합니다</p>
    </section>

    <!-- 메인 히어로 카드 -->
    <section class="max-w-5xl mx-auto px-4 mb-16">
      <div class="neo-glass grid md:grid-cols-2 overflow-hidden rounded-2xl p-6">

        <!-- 이미지 -->
        <div class="rounded-2xl overflow-hidden">
          <img src="/uploads/main-banner.jpg" alt="메인 이미지"
            class="w-full h-full object-cover hover:scale-105 transition duration-500">
        </div>

        <!-- 텍스트 -->
        <div class="p-6 flex flex-col justify-center items-center text-center">
          <h2 class="text-3xl font-extrabold mb-4 drop-shadow">
            우리동네 대표 Hot Place
          </h2>
          <p class="text-gray-700 mb-6 leading-relaxed">
            지금 가장 인기 있는 우리동네를 소개합니다.<br>
            이벤트, 리뷰, 사진으로 생생하게 즐겨보세요.
          </p>
          <a href="/hotplace.html" class="btn-3d px-6 py-2 text-white rounded-full text-sm font-semibold transition">
            더보기
          </a>
        </div>
      </div>
    </section>

    <!-- 본문 카드 그룹 -->
    <section class="max-w-5xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
      <!-- 좌측 큰 카드 -->
      <div class="md:col-span-2 bg-white rounded-lg shadow-md p-6 grid md:grid-cols-2 gap-6 items-center">
        <!-- 이미지 (왼쪽) -->
        <div>
          <img src="/uploads/hot-place.jpg" alt="추천" class="w-full h-full object-cover rounded-lg">
        </div>

        <!-- 텍스트 (오른쪽, 가운데 정렬) -->
        <div class="flex flex-col justify-center items-center text-center p-4">
          <h3 class="text-xl font-bold mb-3">금주의 추천 장소</h3>
          <p class="text-gray-600 mb-4">
            신규 오픈, 이벤트, 랜덤 Pick까지 매일 새롭게 만나보세요.
          </p>
          <a href="/hotplace.html#weekly-recommend"
            class="inline-block bg-blue-600 text-white text-sm w-24 text-center py-2 rounded hover:bg-blue-700 transition">
            더보기
          </a>
        </div>
      </div>

      <!-- 우측 작은 카드 (하나로 합침) -->
      <div class="grid grid-rows-1 gap-6 h-full text-center">
        <!-- 할인 & 이벤트 소식으로 연결 -->
        <a href="event.html#news" class="block bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition">
          <h4 class="text-xl font-bold mb-3">추천 소식</h4>
          <p class="text-gray-600 mb-4">할인 & 이벤트 정보</p>
        </a>
      </div>
    </section>

    <!-- 🔥 랭킹 + 추천 섹션 -->
    <section class="max-w-6xl mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-8 mb-16">

      <!-- 많이 찾아본 가게 -->
      <div class="bg-white rounded-lg shadow-md p-6 h-56">
        <h3 class="text-xl font-bold mb-4 text-center">🔥 많이 찾아본 가게</h3>
        <ul id="popular-list" class="space-y-3 text-gray-700 text-sm text-left">
          <!-- JS에서 데이터로 채워짐 -->
        </ul>
      </div>

      <!-- 많이 찜한 가게 -->
      <div class="bg-white rounded-lg shadow-md p-6 h-56">
        <h3 class="text-xl font-bold mb-4 text-center">⭐ 많이 찜한 가게</h3>
        <ul id="bookmark-list" class="space-y-3 text-gray-700 text-sm text-left">
          <!-- JS에서 데이터로 채워짐 -->
        </ul>
      </div>

      <!-- 오늘의 추천 가게 -->
      <div class="bg-white rounded-lg shadow-md p-6 h-56">
        <h3 class="text-xl font-bold mb-4 text-center">🌟 오늘의 추천 가게</h3>
        <ul id="recommend-list" class="space-y-3 text-gray-700 text-sm text-left">
          <!-- JS에서 데이터로 채워짐 -->
        </ul>
      </div>

      <!-- 이번 주 주목받는 가게 -->
      <div class="bg-white rounded-lg shadow-md p-6 h-56">
        <h3 class="text-xl font-bold mb-4 text-center">📈 주목받는 가게</h3>
        <ul id="trend-list" class="space-y-3 text-gray-700 text-sm text-left">
          <!-- JS에서 데이터로 채워짐 -->
        </ul>
      </div>

    </section>

    <!-- ⚡ 파워 광고 -->
    <section class="max-w-6xl mx-auto px-4 mb-20">
      <div class="bg-yellow-50 border-l-4 border-yellow-400 rounded-lg shadow-md p-6 relative">
        <h3 class="text-2xl font-bold mb-4 text-yellow-700">⚡ 파워 광고</h3>

        <!-- 광고 슬라이더 컨테이너 -->
        <div class="overflow-hidden relative">
          <div id="ad-slider" class="flex transition-transform duration-700 ease-in-out">

            <!-- 세트1 -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 flex-shrink-0 w-full">
              <a href="https://example.com/ad1" target="_blank"
                class="bg-white rounded-lg shadow p-4 text-center h-64 flex items-center justify-center hover:shadow-lg transition">
                광고1
              </a>
              <a href="https://example.com/ad2" target="_blank"
                class="bg-white rounded-lg shadow p-4 text-center h-64 flex items-center justify-center hover:shadow-lg transition">
                광고2
              </a>
              <a href="https://example.com/ad3" target="_blank"
                class="bg-white rounded-lg shadow p-4 text-center h-64 flex items-center justify-center hover:shadow-lg transition">
                광고3
              </a>
              <a href="https://example.com/ad4" target="_blank"
                class="bg-white rounded-lg shadow p-4 text-center h-64 flex items-center justify-center hover:shadow-lg transition">
                광고4
              </a>
            </div>

            <!-- 세트2 -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 flex-shrink-0 w-full">
              <a href="https://example.com/ad5" target="_blank"
                class="bg-white rounded-lg shadow p-4 text-center h-64 flex items-center justify-center hover:shadow-lg transition">
                광고5
              </a>
              <a href="https://example.com/ad6" target="_blank"
                class="bg-white rounded-lg shadow p-4 text-center h-64 flex items-center justify-center hover:shadow-lg transition">
                광고6
              </a>
              <a href="https://example.com/ad7" target="_blank"
                class="bg-white rounded-lg shadow p-4 text-center h-64 flex items-center justify-center hover:shadow-lg transition">
                광고7
              </a>
              <a href="https://example.com/ad8" target="_blank"
                class="bg-white rounded-lg shadow p-4 text-center h-64 flex items-center justify-center hover:shadow-lg transition">
                광고8
              </a>
            </div>

            <!-- 세트3 -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 flex-shrink-0 w-full">
              <a href="https://example.com/ad9" target="_blank"
                class="bg-white rounded-lg shadow p-4 text-center h-64 flex items-center justify-center hover:shadow-lg transition">
                광고9
              </a>
              <a href="https://example.com/ad10" target="_blank"
                class="bg-white rounded-lg shadow p-4 text-center h-64 flex items-center justify-center hover:shadow-lg transition">
                광고10
              </a>
              <a href="https://example.com/ad11" target="_blank"
                class="bg-white rounded-lg shadow p-4 text-center h-64 flex items-center justify-center hover:shadow-lg transition">
                광고11
              </a>
              <a href="https://example.com/ad12" target="_blank"
                class="bg-white rounded-lg shadow p-4 text-center h-64 flex items-center justify-center hover:shadow-lg transition">
                광고12
              </a>
            </div>

          </div>
        </div>

        <!-- ✅ 하단 고정 버튼 -->
        <div class="flex justify-center gap-6 mt-6">
          <button id="prev-btn"
            class="bg-white text-black px-6 py-2 rounded-full shadow hover:bg-yellow-600 transition">
            &lt;
          </button>
          <button id="next-btn"
            class="bg-white text-black px-6 py-2 rounded-full shadow hover:bg-yellow-600 transition">
            &gt;
          </button>
        </div>
    </section>
    </div>

    <!-- 오늘도 우리동네에서 특별한 순간을! -->
    <section class="text-center my-12">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">
        오늘도 우리동네에서 특별한 순간을!
      </h2>

      <!-- 하단 박스 2개 -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-6xl mx-auto px-4">

        <!-- 오늘의 테마 추천 (관리자 페이지에서 랜덤+승인 형식)-->
        <div class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-xl font-bold mb-4">🌦️ 오늘의 테마 추천</h3>
          <p class="text-gray-600 mb-4">
            {{theme_text}} <!-- DB에서 가져온 문구 -->
          </p>
          <!-- 오늘의 테마 버튼: 항상 hotsubcategory로 이동하도록 id 부여(파일 내 이미 있으면 그대로 사용) -->
          <a id="today-theme-btn" href="/hotsubcategory.html?category=theme" class="inline-block px-3 py-1 bg-yellow-400 text-sm rounded" role="button" aria-label="오늘의 테마">
            오늘의 테마
          </a>
        </div>

        <!-- 오늘의 랜덤 추천 -->
        <div class="bg-white rounded-lg shadow-md p-6 h-64">
          <h3 class="text-xl font-bold mb-4">🎲 오늘의 계절메뉴 추천</h3>
          <p class="text-gray-600 mb-4">
            어떤 계절메뉴가 선택되었을까요?
          </p>
          <a href="randomselection.html"
            class="inline-block bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
            자세히 보기
          </a>
        </div>

        <!-- ✅ 우측 하단 고정 네비게이션 -->
        <div class="fixed bottom-6 right-6 flex flex-col items-center gap-4 z-50">

          <!-- 이전 -->
          <div class="flex flex-col items-center">
            <button onclick="goBack()"
              class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-gray-100 to-gray-200 text-gray-700 shadow hover:from-gray-200 hover:to-gray-300 transition">
              ←
            </button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">이전</span>
          </div>

          <!-- 다음 -->
          <div class="flex flex-col items-center">
            <button onclick="goNext()"
              class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-gray-100 to-gray-200 text-gray-700 shadow hover:from-gray-200 hover:to-gray-300 transition">
              →
            </button>
            <span class="text-xs mt-1 text-gray-600 font-semibold">다음</span>
          </div>

          <!-- 홈 -->
          <div class="flex flex-col items-center">
            <a href="/index.html"
              class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow hover:from-blue-600 hover:to-blue-700 transition">
              🏠
            </a>
            <span class="text-xs mt-1 text-gray-600 font-semibold">홈</span>
          </div>
        </div>
  </main>

  <div id="footer"></div>

  <script>
    fetch('components/header.html')
      .then(r => r.text())
      .then(d => { document.getElementById('header').innerHTML = d; });

    fetch('components/footer.html')
      .then(r => r.text())
      .then(d => { document.getElementById('footer').innerHTML = d; });

    document.addEventListener("DOMContentLoaded", async () => {
      let index = 0;
      let interval;

      const slider = document.getElementById("ad-slider");

      function showSlide(i) {
        const totalSets = slider.children.length;
        if (totalSets === 0) return;
        index = (i + totalSets) % totalSets;
        slider.style.transform = `translateX(-${index * 100}%)`;
      }

      function startAutoSlide() {
        interval = setInterval(() => {
          showSlide(index + 1);
        }, 5000);
      }

      function stopAutoSlide() {
        clearInterval(interval);
      }

      // ✅ 광고 불러오기
      async function loadPowerAds() {
        try {
          const res = await fetch("/api/ads/power");
          const ads = await res.json();

          slider.innerHTML = ads.map(ad => `
        <a href="${ad.link}" class="flex-shrink-0 w-full h-64">
          <img src="${ad.image_url}" 
               alt="${ad.title}" 
               class="w-full h-full object-cover cursor-pointer hover:scale-105 transition">
        </a>
      `).join("");

          showSlide(0);
          startAutoSlide();
        } catch (e) {
          console.error("파워 광고 불러오기 실패:", e);
        }
      }

      // ✅ 추천 가게 불러오기
      async function loadRecommendations() {
        try {
          const res = await fetch("/api/recommend");
          const data = await res.json();
          const list = document.getElementById("recommend-list");
          list.innerHTML = "";

          data.recommendations.slice(0, 5).forEach((store, idx) => {
            const li = document.createElement("li");
            li.innerHTML = `
          ${idx + 1}.
          <a href="detail.html?id=${store.id}" 
             class="text-blue-600 hover:underline font-medium">
            ${store.name}
          </a> – ${store.category}
        `;
            list.appendChild(li);
          });
        } catch (err) {
          console.error("추천 가게 불러오기 실패:", err);
        }
      }

      // ✅ 랜덤 블로그 불러오기
      async function loadRandomBlog() {
        try {
          const res = await fetch("/api/random-hotblog");
          const data = await res.json();
          const linkEl = document.getElementById("randomBlogLink");
          if (data.ok && data.blog) {
            linkEl.href = `hotblogdetail.html?id=${data.blog.id}`;
            linkEl.innerText = data.blog.title || "블로그에서 보기";
          } else {
            linkEl.innerText = "추천 글 없음";
          }
        } catch (e) {
          console.error("랜덤 추천 로드 실패:", e);
          document.getElementById("randomBlogLink").innerText = "불러오기 실패";
        }
      }

      // 버튼 이벤트
      document.getElementById("prev-btn").addEventListener("click", () => {
        stopAutoSlide();
        showSlide(index - 1);
        startAutoSlide();
      });
      document.getElementById("next-btn").addEventListener("click", () => {
        stopAutoSlide();
        showSlide(index + 1);
        startAutoSlide();
      });

      // 초기 실행
      await loadPowerAds();
      await loadRecommendations();
      await loadRandomBlog();
    });

    // ✅ 네비게이션 버튼
    function goBack() { window.history.back(); }
    function goNext() { window.history.forward(); }

  </script>

</body>

</html>

<!-- 아래 스크립트는 페이지 로드 시 data-store-id를 검사하여 안전하게 href를 설정합니다 -->
<script>
  (function(){
    document.querySelectorAll('a.hotblog-link[data-store-id]').forEach(a => {
      const raw = a.getAttribute('data-store-id') || "";
      // 플레이스홀더가 남아있으면 링크 비활성화
      if (!raw || /\{\{.+\}\}/.test(raw)) {
        a.removeAttribute('href');
        a.classList.add('opacity-50','pointer-events-none');
        return;
      }
      // 정상 id이면 href 설정
      const id = raw;
      a.href = `hotblogdetail.html?id=${encodeURIComponent(id)}`;
    });
  })();
</script>
<script>
  // 페이지에 남은 "{{store_id}}" 플레이스홀더를 안전 처리
  (function fixPlaceholderLinks(){
    document.querySelectorAll('a[href*="{{store_id}}"]').forEach(a=>{
      // 우선 data-store-id 또는 data-id가 있으면 그것으로 치환
      const storeId = a.dataset.storeId || a.dataset.id || null;
      if (storeId && !/^\{\{.+\}\}$/.test(storeId)) {
        a.href = a.href.replace(/\{\{store_id\}\}/g, encodeURIComponent(storeId));
        return;
      }

      // 주변 요소에 data-store-id 속성(카드 등)이 있으면 사용
      let parent = a.closest('[data-store-id], [data-id]');
      if (parent) {
        const pid = parent.dataset.storeId || parent.dataset.id;
        if (pid && !/^\{\{.+\}$/.test(pid)) {
          a.href = a.href.replace(/\{\{store_id\}\}/g, encodeURIComponent(pid));
          return;
        }
      }

      // 치환할 값이 없으면 링크 비활성화(클릭 무시) — 잘못된 네비게이션 방지
      a.dataset._origHref = a.getAttribute('href');
      a.removeAttribute('href');
      a.style.opacity = "0.6";
      a.title = "링크 데이터가 없어 이동할 수 없습니다.";
    });

    // URL 자체에 플레이스홀더가 남아있으면 제거 (예: ?id={{store_id}})
    try {
      if (location.search && location.search.includes("{{store_id}}")) {
        const cleaned = location.search.replace(/\{\{store_id\}\}/g, "");
        history.replaceState(null, "", location.pathname + cleaned);
        console.warn("Removed template placeholder from URL");
      }
    } catch (e) { /* ignore */ }
  })();
</script>
<script>
  // 오늘의 테마 버튼 href를 안전하게 설정
  (function(){
    const el = document.querySelector('a[href*="hotsubcategory.html?category=theme"]');
    if (!el) return;
    // 백엔드(로컬 개발)는 보통 포트 3000에서 동작
    const backendOrigin = "http://localhost:3000";

    // 백엔드 헬스체크 시도 (빠르게)
    fetch(`${backendOrigin}/__ping`, { method: "GET", mode: "cors", cache: "no-store" })
      .then(r => {
        if (r.ok) {
          // 백엔드가 있으면 백엔드에서 제공하는 경로로 연결
          el.href = `${backendOrigin}/hotsubcategory.html?category=theme`;
        } else {
          // 응답이 정상이 아니면 상대경로 사용
          el.href = "/hotsubcategory.html?category=theme";
        }
      })
      .catch(() => {
        // 백엔드에 접근 불가하면 현재 호스트 기준(relative)로 연결
        el.href = "/hotsubcategory.html?category=theme";
      });
  })();
</script>
<script>
  // 오늘의 테마 버튼: 항상 hotsubcategory로 이동하도록 id 부여(파일 내 이미 있으면 그대로 사용)
  (function(){
    const btn = document.getElementById('today-theme-btn');
    if (!btn) return;
    // 우선 href를 명시적으로 설정
    btn.href = "/hotsubcategory.html?category=theme";
    // 클릭 시 강제 이동 (다른 스크립트가 preventDefault 해도 이 핸들러가 우선 실행되도록)
    btn.addEventListener('click', function(e){
      e.preventDefault();
      location.href = "/hotsubcategory.html?category=theme";
    }, { passive: false });
  })();
</script>
<!-- 아래 기존 여러 스크립트(플레이스홀더 치환 / 헬스체크 / 중복 핸들러 등)를 하나로 정리 -->
<script>
  (function(){
    const TARGET = "/hotsubcategory.html?category=theme";
    // 강제: 버튼이 반드시 서브카테고리로 이동
    const btn = document.getElementById('today-theme-btn');
    if (btn) {
      btn.setAttribute('href', TARGET);
      btn.removeAttribute('onclick');
      btn.addEventListener('click', function(e){
        e.preventDefault();
        location.href = TARGET;
      }, { passive: false });
    }

    // 플레이스홀더가 남은 링크들 비활성화(방어)
    document.querySelectorAll('a[href*="{{"]').forEach(a=>{
      a.dataset._origHref = a.getAttribute('href');
      a.removeAttribute('href');
      a.classList.add('opacity-60', 'pointer-events-none');
      a.title = "잘못된 링크(데이터 누락)";
    });

    // URL에 플레이스홀더가 남아있으면 제거
    try {
      if (location.search && location.search.includes("{{")) {
        const cleaned = location.search.replace(/\{\{.*?\}\}/g, "");
        history.replaceState(null, "", location.pathname + cleaned);
        console.warn("Removed template placeholder from URL");
      }
    } catch(e){}
  })();
</script>
<script>
(function(){
  const TARGET = `${location.origin}/hotsubcategory.html?category=theme`;
  const btn = document.getElementById('today-theme-btn');
  if (!btn) return;

  // 항상 절대경로로 설정
  btn.setAttribute('href', TARGET);

  // 클릭을 강제 처리(다른 핸들러보다 우선)
  btn.addEventListener('click', function(e){
    e.preventDefault();
    e.stopImmediatePropagation();
    console.log('[hot] today-theme ->', TARGET);
    location.assign(TARGET);
  }, { capture: true, passive: false });

  // 다른 스크립트가 덮어쓰면 복원
  const iv = setInterval(()=> {
    if (btn.href !== TARGET) btn.href = TARGET;
  }, 300);

  window.addEventListener('beforeunload', ()=> clearInterval(iv));
})();
</script>