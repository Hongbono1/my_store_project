<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „í†µì‹œì¥ ìƒì„¸ë³´ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&libraries=services"></script>

    <style>
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.7;
            letter-spacing: -0.02em;
        }

        h1 {
            font-size: 1.875rem;
            line-height: 1.3;
            letter-spacing: -0.03em;
        }

        h2 {
            font-size: 1.25rem;
            line-height: 1.4;
            letter-spacing: -0.02em;
        }

        .info-label {
            font-size: 0.9375rem;
            line-height: 1.5;
        }

        .info-value {
            font-size: 1rem;
            line-height: 1.6;
        }

        .content-text {
            font-size: 1rem;
            line-height: 1.8;
        }

        /* ë„¤ì˜¤+ê¸€ë˜ìŠ¤ ë©”ì¸ ì¹´ë“œ */
        .neo-shell {
            background: radial-gradient(circle at top left,
                    rgba(255, 255, 255, 0.95),
                    rgba(241, 245, 249, 0.9));
            border-radius: 28px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            box-shadow:
                0 24px 60px rgba(15, 23, 42, 0.18),
                0 0 0 1px rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(20px);
        }

        .neo-section {
            background: linear-gradient(135deg,
                    rgba(255, 255, 255, 0.96),
                    rgba(241, 245, 249, 0.95));
            border-radius: 18px;
            border: 1px solid rgba(148, 163, 184, 0.3);
            box-shadow:
                10px 10px 30px rgba(148, 163, 184, 0.35),
                -6px -6px 20px rgba(255, 255, 255, 0.9);
        }

        .pill-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.35rem 0.9rem;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 600;
            background: radial-gradient(circle at 0% 0%,
                    rgba(59, 130, 246, 0.18),
                    rgba(129, 140, 248, 0.09));
            border: 1px solid rgba(59, 130, 246, 0.35);
            color: #1d4ed8;
            box-shadow:
                0 0 0 1px rgba(255, 255, 255, 0.6),
                0 10px 25px rgba(37, 99, 235, 0.25);
        }

        .divider-soft {
            height: 1px;
            background: linear-gradient(to right,
                    transparent,
                    rgba(148, 163, 184, 0.5),
                    transparent);
        }

        /* ì˜¤ë¥¸ìª½ í”Œë¡œíŒ… ë™ê·¸ë€ ë²„íŠ¼ */
        .float-nav-btn {
            width: 44px;
            height: 44px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.7);
            box-shadow:
                0 12px 28px rgba(15, 23, 42, 0.25),
                0 0 0 1px rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(16px);
            color: #0f172a;
            transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
        }

        .float-nav-btn:hover {
            background: rgba(248, 250, 252, 0.98);
            transform: translateY(-1px);
            box-shadow:
                0 16px 32px rgba(15, 23, 42, 0.32),
                0 0 0 1px rgba(255, 255, 255, 0.9);
        }

        .float-nav-btn.disabled {
            opacity: 0.35;
            cursor: default;
            pointer-events: none;
            box-shadow: none;
            transform: none;
        }
    </style>
</head>

<body
    class="min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 flex items-start md:items-center justify-center py-10 px-4">

    <div class="max-w-4xl w-full mx-auto neo-shell p-6 md:p-8 mb-10">

        <!-- ìƒë‹¨ í—¤ë” / íƒ€ì´í‹€ -->
        <header class="mb-6 md:mb-8 text-center space-y-3">
            <div class="pill-badge mx-auto">
                <span>ğŸ¬ ìš°ë¦¬ë™ë„¤ ì „í†µì‹œì¥</span>
                <span class="text-[11px] text-sky-700/90">MARKET DETAIL</span>
            </div>
            <h1 id="market_name"
                class="font-extrabold text-slate-900 mt-2 bg-clip-text text-transparent bg-gradient-to-r from-sky-500 via-indigo-500 to-violet-500">
            </h1>
            <p class="text-sm md:text-base text-slate-500">
                ë”°ëœ»í•œ ì‚¬ëŒê³¼ ì´ì•¼ê¸°ê°€ ìˆëŠ” ìš°ë¦¬ë™ë„¤ ì‹œì¥ì˜ ì •ë³´ë¥¼ í•œëˆˆì— í™•ì¸í•´ ë³´ì„¸ìš”.
            </p>
        </header>

        <div class="divider-soft mb-8"></div>

        <!-- ìƒë‹¨ ë ˆì´ì•„ì›ƒ: ëŒ€í‘œ ì´ë¯¸ì§€ + ê¸°ë³¸ ì •ë³´ ìš”ì•½ -->
        <section class="grid md:grid-cols-2 gap-6 md:gap-8 mb-8 md:mb-10">
            <!-- ëŒ€í‘œ ì´ë¯¸ì§€ (ë†’ì´ ì¤„ì„ + 3D ì¹´ë“œ) -->
            <div
                class="neo-section relative overflow-hidden p-3 md:p-4 bg-slate-50/80 flex items-center justify-center group">
                <div
                    class="absolute inset-0 bg-gradient-to-br from-sky-100/50 via-transparent to-indigo-100/50 pointer-events-none">
                </div>
                <img id="main_img"
                    class="relative w-full h-52 md:h-64 object-cover rounded-2xl shadow-[0_18px_30px_rgba(15,23,42,0.25)] border border-white/70 transition-transform duration-500 group-hover:scale-105"
                    alt="ì‹œì¥ ëŒ€í‘œ ì´ë¯¸ì§€">
            </div>

            <!-- ê¸°ë³¸ ì •ë³´ ìš”ì•½ ì¹´ë“œ -->
            <div class="neo-section p-5 md:p-6 space-y-4">
                <div>
                    <p class="info-label font-semibold text-slate-500 mb-1">ì‹œì¥ëª…</p>
                    <p id="market_name_2" class="info-value font-bold text-slate-900"></p>
                </div>
                <div>
                    <p class="info-label font-semibold text-slate-500 mb-1">ì£¼ì†Œ</p>
                    <p id="address" class="info-value font-medium text-slate-900"></p>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <p class="info-label font-semibold text-slate-500 mb-1">ì „í™”ë²ˆí˜¸</p>
                        <p id="phone" class="info-value font-medium text-slate-900"></p>
                    </div>
                    <div>
                        <p class="info-label font-semibold text-slate-500 mb-1">ì£¼ìš” í’ˆëª©</p>
                        <p id="main_products" class="info-value font-medium text-slate-900"></p>
                    </div>
                </div>
                <div class="pt-2 border-t border-slate-200/70 mt-2">
                    <p class="info-label font-semibold text-slate-500 mb-1 text-center">ìš´ì˜ ì‹œê°„</p>
                    <p id="opening_hours"
                        class="info-value font-semibold text-indigo-600 text-base md:text-lg text-center tracking-tight">
                    </p>
                </div>
            </div>
        </section>

        <!-- ì§€ë„ -->
        <section class="neo-section p-5 md:p-6 mb-8 md:mb-10">
            <h2 class="font-bold mb-3 md:mb-4 text-center text-slate-800">
                ğŸ—ºï¸ ì‹œì¥ ìœ„ì¹˜
            </h2>
            <p class="text-xs md:text-sm text-slate-500 text-center mb-3">
                ì§€ë„ë¥¼ ëˆŒëŸ¬ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ê³  ì£¼ë³€ì„ ë‘˜ëŸ¬ë³´ì„¸ìš”.
            </p>
            <div id="map"
                class="w-full h-60 md:h-72 rounded-2xl border border-white/70 bg-slate-100/80 shadow-[0_20px_40px_rgba(15,23,42,0.18)] overflow-hidden">
            </div>
        </section>

        <!-- ì´ë²¤íŠ¸ / ì¶•ì œ & í¸ì˜ì‹œì„¤ -->
        <section class="grid md:grid-cols-2 gap-6 md:gap-8 mb-8 md:mb-10">
            <div class="neo-section p-5 md:p-6">
                <h2 class="font-bold mb-3 md:mb-4 text-center text-slate-800">
                    ğŸ‰ ì´ë²¤íŠ¸ / ì¶•ì œ
                </h2>
                <p id="event_info"
                    class="content-text whitespace-pre-line text-slate-700 text-sm md:text-base leading-relaxed"></p>
            </div>

            <div class="neo-section p-5 md:p-6">
                <h2 class="font-bold mb-3 md:mb-4 text-center text-slate-800">
                    ğŸ§© í¸ì˜ì‹œì„¤
                </h2>
                <p id="facilities"
                    class="content-text whitespace-pre-line text-slate-700 text-sm md:text-base leading-relaxed"></p>
            </div>
        </section>

        <!-- ì£¼ì°¨ / ëŒ€ì¤‘êµí†µ -->
        <section class="grid md:grid-cols-2 gap-6 md:gap-8 mb-8 md:mb-10">
            <!-- ì£¼ì°¨ ì •ë³´ -->
            <div class="neo-section p-5 md:p-6">
                <h2 class="font-bold mb-3 md:mb-4 text-center text-slate-800">
                    ğŸš— ì£¼ì°¨ ì •ë³´
                </h2>
                <p class="content-text text-slate-700 mb-2 text-sm md:text-base">
                    <strong class="font-semibold">ìœ ë¬´ :</strong>
                    <span id="parking_available"></span>
                </p>

                <div id="parking_img_wrap" class="hidden mt-4">
                    <img id="parking_img"
                        class="w-full max-h-72 object-cover rounded-2xl border border-white/70 bg-slate-50/90 shadow-[0_16px_30px_rgba(15,23,42,0.22)]"
                        alt="ì£¼ì°¨ ì´ë¯¸ì§€">
                </div>
            </div>

            <!-- ëŒ€ì¤‘êµí†µ ì•ˆë‚´ -->
            <div class="neo-section p-5 md:p-6">
                <h2 class="font-bold mb-3 md:mb-4 text-center text-slate-800">
                    ğŸšŒ ëŒ€ì¤‘êµí†µ ì•ˆë‚´
                </h2>
                <p id="transport_info"
                    class="content-text whitespace-pre-line text-slate-700 text-sm md:text-base leading-relaxed"></p>

                <div id="transport_img_wrap" class="hidden mt-4">
                    <img id="transport_img"
                        class="w-full max-h-72 object-cover rounded-2xl border border-white/70 bg-slate-50/90 shadow-[0_16px_30px_rgba(15,23,42,0.22)]"
                        alt="ëŒ€ì¤‘êµí†µ ì•ˆë‚´ ì´ë¯¸ì§€">
                </div>
            </div>
        </section>

        <!-- Q&A -->
        <section class="neo-section p-5 md:p-6 mb-8 md:mb-10">
            <h2 class="font-bold mb-3 md:mb-4 text-center text-slate-800">
                â“ Q&A
            </h2>
            <div id="qa_list" class="space-y-5 md:space-y-6"></div>
        </section>

        <!-- ìš´ì˜ì í•œë§ˆë”” -->
        <section class="neo-section p-5 md:p-6 mb-4 md:mb-6">
            <h2 class="font-bold mb-3 md:mb-4 text-center text-slate-800">
                ğŸ’¬ ìš´ì˜ì í•œë§ˆë””
            </h2>
            <p id="free_pr"
                class="content-text whitespace-pre-line text-slate-700 break-words text-sm md:text-base leading-relaxed">
            </p>
        </section>

        <!-- âœ… ì˜¤ë¥¸ìª½ í”Œë¡œíŒ… ë™ê·¸ë€ ì´ì „ / í™ˆ / ë‹¤ìŒ ë²„íŠ¼ -->
        <div
            class="fixed right-3 bottom-1/3 md:right-6 md:bottom-1/3 z-40 flex flex-col items-center gap-2 md:gap-3 select-none">
            <!-- ì´ì „ -->
            <a id="navPrev" href="javascript:void(0)" aria-label="ì´ì „" class="float-nav-btn">
                â€¹
            </a>

            <!-- í™ˆ (ëª©ë¡) -->
            <a href="/traditionalmarket.html" aria-label="ëª©ë¡ìœ¼ë¡œ" class="float-nav-btn text-base">
                âŒ‚
            </a>

            <!-- ë‹¤ìŒ -->
            <a id="navNext" href="javascript:void(0)" aria-label="ë‹¤ìŒ" class="float-nav-btn">
                â€º
            </a>
        </div>

    </div>

    <script>
        const params = new URLSearchParams(location.search);
        const id = params.get("id");

        if (!id) {
            alert("ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤. IDê°€ í•„ìš”í•©ë‹ˆë‹¤.");
            location.href = "/";
        }

        const numericId = Number.parseInt(id, 10);

        async function loadDetail() {
            try {
                const res = await fetch(`/api/market/${id}`);
                const json = await res.json();

                if (!json.success || !json.data) {
                    alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                const data = json.data;

                // ê¸°ë³¸ ì •ë³´
                market_name.textContent = data.market_name;
                market_name_2.textContent = data.market_name;
                address.textContent = data.address;
                phone.textContent = data.phone || "-";
                opening_hours.textContent = data.opening_hours || "";
                main_products.textContent = data.main_products || "";

                // ëŒ€í‘œ ì´ë¯¸ì§€ ê²½ë¡œ ë³´ì •
                let mainImgPath = "/uploads/traditionalmarket/default.jpg";
                if (data.main_img) {
                    const raw = String(data.main_img).trim();
                    if (raw.startsWith("http://") || raw.startsWith("https://") || raw.startsWith("/uploads")) {
                        mainImgPath = raw;
                    } else {
                        mainImgPath = `/uploads/traditionalmarket/${raw}`;
                    }
                }
                main_img.src = mainImgPath;

                // í…ìŠ¤íŠ¸ ì •ë³´
                event_info.textContent = data.event_info || "";
                facilities.textContent = data.facilities || "";
                parking_available.textContent = data.parking_available || "";
                transport_info.textContent = data.transport_info || "";

                // ì£¼ì°¨ ì´ë¯¸ì§€
                if (data.parking_img) {
                    parking_img_wrap.classList.remove("hidden");
                    parking_img.src = data.parking_img;
                }

                // êµí†µ ì´ë¯¸ì§€
                if (data.transport_img) {
                    transport_img_wrap.classList.remove("hidden");
                    transport_img.src = data.transport_img;
                }

                // ìš´ì˜ì í•œë§ˆë””
                free_pr.textContent = data.free_pr || "";

                // Q&A - ì•ˆì „í•œ íŒŒì‹±
                let qaList = [];
                try {
                    if (data.qa_list) {
                        qaList = typeof data.qa_list === 'string' ? JSON.parse(data.qa_list) : data.qa_list;
                    }
                } catch (e) {
                    console.error("Q&A íŒŒì‹± ì˜¤ë¥˜:", e);
                }
                renderQA(qaList);

                // ì§€ë„ - ì¢Œí‘œê°€ ìˆì„ ë•Œë§Œ
                if (data.lat && data.lng) {
                    drawMap(data.lat, data.lng);
                } else if (data.address) {
                    // ì¢Œí‘œê°€ ì—†ìœ¼ë©´ ì£¼ì†Œë¡œ ê²€ìƒ‰
                    drawMapByAddress(data.address);
                } else {
                    document.getElementById("map").innerHTML =
                        '<p class="text-slate-500 text-center py-10 text-sm md:text-base">ì§€ë„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (err) {
                console.error("ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:", err);
                alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        }

        function renderQA(list) {
            const wrap = qa_list;

            if (!list.length) {
                wrap.innerHTML = "<p class='text-slate-500 text-center text-sm md:text-base'>ë“±ë¡ëœ Q&Aê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
                return;
            }

            wrap.innerHTML = list.map(item => `
        <div class="border border-slate-200/80 rounded-2xl p-4 md:p-5 bg-slate-50/90 shadow-[0_14px_30px_rgba(15,23,42,0.12)]">
          <p class="info-value font-bold mb-2 text-slate-900">Q. ${item.q}</p>
          <p class="content-text whitespace-pre-line text-slate-700 text-sm md:text-base">${item.a}</p>
          ${item.img
                    ? `<img src="${item.img}" class="mt-3 rounded-2xl w-full max-h-[420px] object-contain border border-white/80 bg-white shadow-[0_14px_30px_rgba(15,23,42,0.18)]">`
                    : ""
                }
        </div>
      `).join("");
        }

        function drawMap(lat, lng) {
            kakao.maps.load(() => {
                const map = new kakao.maps.Map(document.getElementById("map"), {
                    center: new kakao.maps.LatLng(lat, lng),
                    level: 3,
                });
                new kakao.maps.Marker({
                    map,
                    position: new kakao.maps.LatLng(lat, lng),
                });
            });
        }

        function drawMapByAddress(address) {
            kakao.maps.load(() => {
                const geocoder = new kakao.maps.services.Geocoder();
                geocoder.addressSearch(address, (result, status) => {
                    if (status === kakao.maps.services.Status.OK) {
                        const lat = parseFloat(result[0].y);
                        const lng = parseFloat(result[0].x);
                        drawMap(lat, lng);
                    } else {
                        document.getElementById("map").innerHTML =
                            '<p class="text-slate-500 text-center py-10 text-sm md:text-base">ì£¼ì†Œë¡œ ì§€ë„ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                });
            });
        }

        // âœ… ì˜¤ë¥¸ìª½ í”Œë¡œíŒ… ë™ê·¸ë€ ì´ì „ / í™ˆ / ë‹¤ìŒ ë²„íŠ¼ ë™ì‘
        document.addEventListener("DOMContentLoaded", () => {
            const prevLink = document.getElementById("navPrev");
            const nextLink = document.getElementById("navNext");

            if (!prevLink || !nextLink) return;

            if (!Number.isFinite(numericId)) {
                [prevLink, nextLink].forEach(btn => btn.classList.add("disabled"));
                return;
            }

            const prevId = numericId - 1;
            const nextId = numericId + 1;

            // ì´ì „ ê¸€
            if (prevId > 0) {
                prevLink.href = `/traditionalmarketdetail.html?id=${prevId}`;
            } else {
                prevLink.classList.add("disabled");
            }

            // ë‹¤ìŒ ê¸€ (ìµœëŒ€ id ì²´í¬ëŠ” ë‚˜ì¤‘ì— APIë¡œ ë³´ì™„ ê°€ëŠ¥)
            nextLink.href = `/traditionalmarketdetail.html?id=${nextId}`;
        });

        loadDetail();
    </script>

</body>

</html>