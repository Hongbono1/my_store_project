<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì „í†µì‹œì¥ ìƒì„¸ë³´ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- âœ… ì¹´ì¹´ì˜¤ë§µ: autoload=false + defer ë¡œ ì•ˆì „í•˜ê²Œ ë¡œë“œ -->
  <script id="kakao-sdk" defer
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&autoload=false&libraries=services"></script>

  <style>
    body {
      font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      line-height: 1.7;
      letter-spacing: -0.02em;
    }

    .neo-shell {
      background: radial-gradient(circle at top left,
          rgba(255, 255, 255, 0.95),
          rgba(241, 245, 249, 0.9));
      border-radius: 28px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow:
        0 24px 60px rgba(15, 23, 42, 0.18),
        0 0 0 1px rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(20px);
    }

    .neo-section {
      background: linear-gradient(135deg,
          rgba(255, 255, 255, 0.96),
          rgba(241, 245, 249, 0.95));
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      box-shadow:
        10px 10px 30px rgba(148, 163, 184, 0.35),
        -6px -6px 20px rgba(255, 255, 255, 0.9);
    }

    .pill-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      background: radial-gradient(circle at 0% 0%,
          rgba(59, 130, 246, 0.18),
          rgba(129, 140, 248, 0.09));
      border: 1px solid rgba(59, 130, 246, 0.35);
      color: #1d4ed8;
      box-shadow:
        0 0 0 1px rgba(255, 255, 255, 0.6),
        0 10px 25px rgba(37, 99, 235, 0.25);
    }

    .divider-soft {
      height: 1px;
      background: linear-gradient(to right,
          transparent,
          rgba(148, 163, 184, 0.5),
          transparent);
    }

    .content-text {
      font-size: 1rem;
      line-height: 1.8;
    }

    .info-label {
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .info-value {
      font-size: 1.05rem;
      line-height: 1.6;
    }

    .tile {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 0.75rem;
      padding: 1rem 1.1rem;
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: rgba(255, 255, 255, 0.75);
      box-shadow: 0 14px 28px rgba(15, 23, 42, 0.10);
    }
  </style>
</head>

<body
  class="min-h-screen bg-gradient-to-br from-slate-100 via-sky-50 to-indigo-100 flex items-start md:items-center justify-center py-10 px-4">

  <div class="max-w-4xl w-full mx-auto neo-shell p-6 md:p-8 mb-10">

    <!-- ìƒë‹¨ í—¤ë” / íƒ€ì´í‹€ -->
    <header class="mb-6 md:mb-8 text-center space-y-3">
      <div class="pill-badge mx-auto">
        <span>ğŸ¬ ìš°ë¦¬ë™ë„¤ ì „í†µì‹œì¥</span>
        <span class="text-[11px] text-sky-700/90">MARKET DETAIL</span>
      </div>

      <!-- âœ… ì‹œì¥ëª… í¬ê²Œ -->
      <h1 id="market_name"
        class="text-4xl md:text-5xl font-extrabold text-slate-900 mt-2 bg-clip-text text-transparent bg-gradient-to-r from-sky-500 via-indigo-500 to-violet-500 leading-tight">
      </h1>

      <p class="text-sm md:text-base text-slate-500">
        ë”°ëœ»í•œ ì‚¬ëŒê³¼ ì´ì•¼ê¸°ê°€ ìˆëŠ” ìš°ë¦¬ë™ë„¤ ì‹œì¥ì˜ ì •ë³´ë¥¼ í•œëˆˆì— í™•ì¸í•´ ë³´ì„¸ìš”.
      </p>
    </header>

    <div class="divider-soft mb-8"></div>

    <!-- âœ… ìƒë‹¨ ë ˆì´ì•„ì›ƒ: ëŒ€í‘œ ì´ë¯¸ì§€(ì¢Œ) + ì •ë³´ ë¸”ë¡(ìš°) -->
    <section class="grid md:grid-cols-2 gap-6 md:gap-8 mb-8 md:mb-10">

      <!-- ì¢Œì¸¡: ëŒ€í‘œ ì´ë¯¸ì§€ + (ì´ë¯¸ì§€ í•˜ë‹¨) ì „í™”ë²ˆí˜¸/ìš´ì˜ì‹œê°„ -->
      <div class="space-y-4">
        <div class="neo-section relative overflow-hidden p-3 md:p-4 bg-slate-50/80 flex items-center justify-center group">
          <div class="absolute inset-0 bg-gradient-to-br from-sky-100/50 via-transparent to-indigo-100/50 pointer-events-none"></div>
          <img id="main_img"
            class="relative w-full h-52 md:h-64 object-cover rounded-2xl shadow-[0_18px_30px_rgba(15,23,42,0.25)] border border-white/70 transition-transform duration-500 group-hover:scale-105"
            alt="ì‹œì¥ ëŒ€í‘œ ì´ë¯¸ì§€">
        </div>

        <!-- âœ… ì „í™”ë²ˆí˜¸/ìš´ì˜ì‹œê°„: ì´ë¯¸ì§€ í•˜ë‹¨ ë°°ì¹˜ (ì•„ì´ì½˜/ì „í™”í•˜ê¸°/ë³µì‚¬ ì œê±°) -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="tile">
            <div class="flex-1">
              <div class="text-sm font-extrabold text-slate-700">ì „í™”ë²ˆí˜¸</div>
              <div id="phone" class="text-lg font-extrabold text-slate-900 mt-1">-</div>
            </div>
          </div>

          <div class="tile">
            <div class="flex-1">
              <div class="text-sm font-extrabold text-slate-700">ìš´ì˜ ì‹œê°„</div>
              <div id="opening_hours" class="text-lg font-extrabold text-indigo-600 mt-1">-</div>
              <div class="text-xs text-slate-500 mt-2">í˜„ì¥ ì‚¬ì •ì— ë”°ë¼ ë³€ë™ë  ìˆ˜ ìˆì–´ìš”.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- ìš°ì¸¡: âœ… ìš”ì²­í•œ ì •ë³´ ë¸”ë¡(ğŸ·ï¸/ğŸ“/ğŸ§º + ì•ˆë‚´ë¬¸) â†’ ì´ë¯¸ì§€ ì˜† -->
      <div class="neo-section p-5 md:p-6">
        <div class="space-y-5">
          <div class="flex items-start gap-3">
            <div class="text-2xl leading-none mt-0.5">ğŸ·ï¸</div>
            <div class="min-w-0">
              <div class="text-xs font-black text-slate-500">ì‹œì¥ëª…</div>
              <div id="market_name_2" class="text-2xl md:text-3xl font-extrabold text-slate-900 leading-tight break-words"></div>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <div class="text-2xl leading-none mt-0.5">ğŸ“</div>
            <div class="min-w-0">
              <div class="text-xs font-black text-slate-500">ì£¼ì†Œ</div>
              <div id="address" class="text-base md:text-lg font-bold text-slate-900 leading-snug break-words">-</div>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <div class="text-2xl leading-none mt-0.5">ğŸ§º</div>
            <div class="min-w-0">
              <div class="text-xs font-black text-slate-500">ì£¼ìš” í’ˆëª©</div>
              <div id="main_products" class="text-base md:text-lg font-bold text-slate-900 leading-snug break-words">-</div>
            </div>
          </div>

          <div class="pt-4 border-t border-slate-200/70 text-sm md:text-base text-slate-600">
            ì•„ë˜ ì„¹ì…˜ì—ì„œ <span class="font-extrabold text-slate-800">ì´ë²¤íŠ¸/ì‹œì„¤/êµí†µ ì•ˆë‚´</span>ê¹Œì§€ í™•ì¸í•´ ë³´ì„¸ìš”.
          </div>
        </div>
      </div>
    </section>

    <!-- ì§€ë„ -->
    <section class="neo-section p-5 md:p-6 mb-8 md:mb-10">
      <h2 class="text-lg md:text-xl font-extrabold mb-3 md:mb-4 text-center text-slate-800">
        ğŸ—ºï¸ ì‹œì¥ ìœ„ì¹˜
      </h2>
      <p class="text-xs md:text-sm text-slate-500 text-center mb-3">
        ì§€ë„ë¥¼ ëˆŒëŸ¬ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ê³  ì£¼ë³€ì„ ë‘˜ëŸ¬ë³´ì„¸ìš”.
      </p>

      <!-- âœ… ë†’ì´ í™•ì‹¤íˆ -->
      <div id="map"
        class="w-full h-64 md:h-80 rounded-2xl border border-white/70 bg-slate-100/80 shadow-[0_20px_40px_rgba(15,23,42,0.18)] overflow-hidden"
        style="min-height: 260px;"></div>
    </section>

    <!-- ì´ë²¤íŠ¸ / ì¶•ì œ & í¸ì˜ì‹œì„¤ -->
    <section class="grid md:grid-cols-2 gap-6 md:gap-8 mb-8 md:mb-10">
      <div class="neo-section p-5 md:p-6">
        <h2 class="text-lg md:text-xl font-extrabold mb-3 md:mb-4 text-center text-slate-800">
          ğŸ‰ ì´ë²¤íŠ¸ / ì¶•ì œ
        </h2>
        <p id="event_info" class="content-text whitespace-pre-line text-slate-700 text-sm md:text-base leading-relaxed"></p>
      </div>

      <div class="neo-section p-5 md:p-6">
        <h2 class="text-lg md:text-xl font-extrabold mb-3 md:mb-4 text-center text-slate-800">
          ğŸ§© í¸ì˜ì‹œì„¤
        </h2>
        <p id="facilities" class="content-text whitespace-pre-line text-slate-700 text-sm md:text-base leading-relaxed"></p>
      </div>
    </section>

    <!-- ì£¼ì°¨ / ëŒ€ì¤‘êµí†µ -->
    <section class="grid md:grid-cols-2 gap-6 md:gap-8 mb-8 md:mb-10">
      <div class="neo-section p-5 md:p-6">
        <h2 class="text-lg md:text-xl font-extrabold mb-3 md:mb-4 text-center text-slate-800">
          ğŸš— ì£¼ì°¨ ì •ë³´
        </h2>
        <p class="content-text text-slate-700 mb-2 text-sm md:text-base">
          <strong class="font-semibold">ìœ ë¬´ :</strong>
          <span id="parking_available"></span>
        </p>

        <div id="parking_img_wrap" class="hidden mt-4">
          <img id="parking_img"
            class="w-full max-h-72 object-cover rounded-2xl border border-white/70 bg-slate-50/90 shadow-[0_16px_30px_rgba(15,23,42,0.22)]"
            alt="ì£¼ì°¨ ì´ë¯¸ì§€">
        </div>
      </div>

      <div class="neo-section p-5 md:p-6">
        <h2 class="text-lg md:text-xl font-extrabold mb-3 md:mb-4 text-center text-slate-800">
          ğŸšŒ ëŒ€ì¤‘êµí†µ ì•ˆë‚´
        </h2>
        <p id="transport_info"
          class="content-text whitespace-pre-line text-slate-700 text-sm md:text-base leading-relaxed"></p>

        <div id="transport_img_wrap" class="hidden mt-4">
          <img id="transport_img"
            class="w-full max-h-72 object-cover rounded-2xl border border-white/70 bg-slate-50/90 shadow-[0_16px_30px_rgba(15,23,42,0.22)]"
            alt="ëŒ€ì¤‘êµí†µ ì•ˆë‚´ ì´ë¯¸ì§€">
        </div>
      </div>
    </section>

    <!-- Q&A -->
    <section class="neo-section p-5 md:p-6 mb-8 md:mb-10">
      <h2 class="text-lg md:text-xl font-extrabold mb-3 md:mb-4 text-center text-slate-800">
        â“ Q&A
      </h2>
      <div id="qa_list" class="space-y-5 md:space-y-6"></div>
    </section>

    <!-- ìš´ì˜ì í•œë§ˆë”” -->
    <section class="neo-section p-5 md:p-6 mb-4 md:mb-6">
      <h2 class="text-lg md:text-xl font-extrabold mb-3 md:mb-4 text-center text-slate-800">
        ğŸ’¬ ìš´ì˜ì í•œë§ˆë””
      </h2>
      <p id="free_pr" class="content-text whitespace-pre-line text-slate-700 break-words text-sm md:text-base leading-relaxed"></p>
    </section>

  </div>

  <!-- ìš°ì¸¡ í•˜ë‹¨ ê³ ì • ë„¤ë¹„ -->
  <div class="fixed bottom-6 right-6 flex flex-col items-center gap-4 z-50">
    <div class="flex flex-col items-center">
      <button onclick="goBack()"
        class="w-14 h-14 flex items-center justify-center rounded-full bg-gray-100 text-gray-800 border border-gray-200 shadow hover:bg-gray-50 transition">â†</button>
      <span class="text-xs mt-1 text-gray-600 font-semibold">ì´ì „</span>
    </div>
    <div class="flex flex-col items-center">
      <button onclick="goNext()"
        class="w-14 h-14 flex items-center justify-center rounded-full bg-gray-100 text-gray-800 border border-gray-200 shadow hover:bg-gray-50 transition">â†’</button>
      <span class="text-xs mt-1 text-gray-600 font-semibold">ë‹¤ìŒ</span>
    </div>
    <div class="flex flex-col items-center">
      <a href="/index.html"
        class="w-14 h-14 flex items-center justify-center rounded-full bg-blue-600 text-white shadow hover:bg-blue-700 transition">ğŸ </a>
      <span class="text-xs mt-1 text-gray-600 font-semibold">í™ˆ</span>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const params = new URLSearchParams(location.search);
    const id = params.get("id");

    if (!id) {
      alert("ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤. IDê°€ í•„ìš”í•©ë‹ˆë‹¤.");
      location.href = "/";
    }

    // âœ… ì¹´ì¹´ì˜¤ë§µ ë¡œë”: ì§€ë„ ì•ˆ ë³´ì´ëŠ” ë¬¸ì œ(autoload/ë¡œë“œ íƒ€ì´ë°) í•´ê²°
    function waitKakaoMaps() {
      return new Promise((resolve, reject) => {
        try {
          if (window.kakao && kakao.maps && kakao.maps.load) {
            kakao.maps.load(resolve);
            return;
          }

          const s = $("kakao-sdk");
          if (!s) {
            reject(new Error("Kakao SDK script tag not found"));
            return;
          }

          s.addEventListener("load", () => {
            if (window.kakao && kakao.maps && kakao.maps.load) {
              kakao.maps.load(resolve);
            } else {
              reject(new Error("Kakao maps not available after script load"));
            }
          }, { once: true });

          s.addEventListener("error", () => reject(new Error("Kakao SDK load error")), { once: true });
        } catch (e) {
          reject(e);
        }
      });
    }

    async function loadDetail() {
      try {
        const res = await fetch(`/api/market/${id}`);
        const json = await res.json();

        if (!json.success || !json.data) {
          alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          return;
        }

        const data = json.data;

        // ê¸°ë³¸ ì •ë³´
        $("market_name").textContent = data.market_name || "-";
        $("market_name_2").textContent = data.market_name || "-";
        $("address").textContent = data.address || "-";
        $("phone").textContent = data.phone || "-";
        $("opening_hours").textContent = data.opening_hours || "-";
        $("main_products").textContent = data.main_products || "-";

        // ëŒ€í‘œ ì´ë¯¸ì§€ ê²½ë¡œ ë³´ì •
        let mainImgPath = "/uploads/traditionalmarket/default.jpg";
        if (data.main_img) {
          const raw = String(data.main_img).trim();
          if (raw.startsWith("http://") || raw.startsWith("https://") || raw.startsWith("/uploads")) {
            mainImgPath = raw;
          } else {
            mainImgPath = `/uploads/traditionalmarket/${raw}`;
          }
        }
        $("main_img").src = mainImgPath;

        // í…ìŠ¤íŠ¸ ì •ë³´
        $("event_info").textContent = data.event_info || "";
        $("facilities").textContent = data.facilities || "";
        $("parking_available").textContent = data.parking_available || "";
        $("transport_info").textContent = data.transport_info || "";
        $("free_pr").textContent = data.free_pr || "";

        // ì£¼ì°¨ ì´ë¯¸ì§€
        if (data.parking_img) {
          $("parking_img_wrap").classList.remove("hidden");
          $("parking_img").src = data.parking_img;
        }

        // êµí†µ ì´ë¯¸ì§€
        if (data.transport_img) {
          $("transport_img_wrap").classList.remove("hidden");
          $("transport_img").src = data.transport_img;
        }

        // Q&A - ì•ˆì „í•œ íŒŒì‹±
        let qaList = [];
        try {
          if (data.qa_list) qaList = typeof data.qa_list === "string" ? JSON.parse(data.qa_list) : data.qa_list;
        } catch (e) {
          console.error("Q&A íŒŒì‹± ì˜¤ë¥˜:", e);
        }
        renderQA(qaList);

        // ì§€ë„
        if (data.lat && data.lng) {
          drawMap(data.lat, data.lng);
        } else if (data.address) {
          drawMapByAddress(data.address);
        } else {
          $("map").innerHTML =
            '<p class="text-slate-500 text-center py-10 text-sm md:text-base">ì§€ë„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }
      } catch (err) {
        console.error("ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:", err);
        alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    }

    function renderQA(list) {
      const wrap = $("qa_list");

      if (!list || !list.length) {
        wrap.innerHTML = "<p class='text-slate-500 text-center text-sm md:text-base'>ë“±ë¡ëœ Q&Aê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
        return;
      }

      wrap.innerHTML = list.map(item => `
        <div class="border border-slate-200/80 rounded-2xl p-4 md:p-5 bg-slate-50/90 shadow-[0_14px_30px_rgba(15,23,42,0.12)]">
          <p class="text-base md:text-lg font-extrabold mb-2 text-slate-900">Q. ${item.q || ""}</p>
          <p class="content-text whitespace-pre-line text-slate-700 text-sm md:text-base">${item.a || ""}</p>
          ${item.img
            ? `<img src="${item.img}" class="mt-3 rounded-2xl w-full max-h-[420px] object-contain border border-white/80 bg-white shadow-[0_14px_30px_rgba(15,23,42,0.18)]">`
            : ""
          }
        </div>
      `).join("");
    }

    function drawMap(lat, lng) {
      const mapEl = $("map");
      waitKakaoMaps().then(() => {
        const pos = new kakao.maps.LatLng(lat, lng);
        const map = new kakao.maps.Map(mapEl, { center: pos, level: 3 });
        new kakao.maps.Marker({ map, position: pos });

        // âœ… ë ˆì´ì•„ì›ƒ/ë¦¬ì‚¬ì´ì¦ˆ íƒ€ì´ë° ë³´ì •(ì§€ë„ ì•ˆ ë³´ì´ëŠ” ì¼€ì´ìŠ¤ ëŒ€ì‘)
        setTimeout(() => {
          map.relayout();
          map.setCenter(pos);
        }, 0);
      }).catch(err => {
        console.error("ì¹´ì¹´ì˜¤ë§µ ë¡œë“œ ì‹¤íŒ¨:", err);
        mapEl.innerHTML = '<p class="text-slate-500 text-center py-10 text-sm md:text-base">ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
      });
    }

    function drawMapByAddress(address) {
      const mapEl = $("map");
      waitKakaoMaps().then(() => {
        const geocoder = new kakao.maps.services.Geocoder();
        geocoder.addressSearch(address, (result, status) => {
          if (status === kakao.maps.services.Status.OK && result && result[0]) {
            const lat = parseFloat(result[0].y);
            const lng = parseFloat(result[0].x);
            drawMap(lat, lng);
          } else {
            mapEl.innerHTML =
              '<p class="text-slate-500 text-center py-10 text-sm md:text-base">ì£¼ì†Œë¡œ ì§€ë„ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
          }
        });
      }).catch(err => {
        console.error("ì¹´ì¹´ì˜¤ë§µ ë¡œë“œ ì‹¤íŒ¨:", err);
        mapEl.innerHTML = '<p class="text-slate-500 text-center py-10 text-sm md:text-base">ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
      });
    }

    function goBack() { window.history.back(); }
    function goNext() { window.history.forward(); }

    document.addEventListener("DOMContentLoaded", loadDetail);
  </script>

</body>
</html>
