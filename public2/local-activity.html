<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ë¦¬ë™ë„¤ í™œë™ ë­í‚¹ | MALL HANKOOK</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .neo-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border-radius: 1rem;
            box-shadow:
                6px 6px 12px rgba(0, 0, 0, 0.15),
                -6px -6px 12px rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
    </style>
</head>

<body class="bg-gray-50">

    <!-- Header -->
    <div id="header"></div>

    <main class="max-w-4xl mx-auto px-4 pt-24 pb-16">
        <h1 class="text-4xl font-bold mb-8 text-center">ìš°ë¦¬ë™ë„¤ í™œë™ ë­í‚¹</h1>

        <!-- ë‚´ ë™ë„¤ ìˆœìœ„ -->
        <div id="myTownBox" class="neo-card p-8 mb-12 text-center"></div>

        <!-- ì „êµ­ Top 10 -->
        <div class="neo-card p-8">
            <h2 class="text-3xl font-bold mb-6 text-center">ì „êµ­ Top 10 í™œë™ ì§€ì—­</h2>
            <ul id="top10List" class="space-y-3"></ul>
        </div>
    </main>

    <!-- Footer -->
    <div id="footer"></div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            // Header/Footer ë¡œë“œ
            fetch("/components/header.html")
                .then(res => res.text())
                .then(html => document.getElementById("header").innerHTML = html);

            fetch("/components/footer.html")
                .then(res => res.text())
                .then(html => document.getElementById("footer").innerHTML = html);

            await loadRanking();
        });

        async function loadRanking() {
            try {
                // ë‚´ ë™ë„¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (localStorage ë˜ëŠ” ê¸°ë³¸ê°’)
                const myTown = localStorage.getItem("userRegion") || "ê²½ê¸° ì˜ì •ë¶€ì‹œ ê°€ëŠ¥ë™";

                // API í˜¸ì¶œ
                const [myData, top10Data] = await Promise.all([
                    fetch(`/api/local-rank/mytown?town=${encodeURIComponent(myTown)}`).then(r => r.json()),
                    fetch(`/api/local-rank/top10`).then(r => r.json())
                ]);

                // ë‚´ ë™ë„¤ ìˆœìœ„ í‘œì‹œ
                const myBox = document.getElementById("myTownBox");
                if (myData.rank) {
                    myBox.innerHTML = `
                        <p class="text-2xl font-bold text-gray-800">${myData.town}</p>
                        <p class="text-4xl font-extrabold text-indigo-600 mt-4">
                            ì „êµ­ ${myData.rank}ìœ„
                        </p>
                        <p class="text-sm text-gray-500 mt-2">ì „ì²´ ${myData.total_town}ê°œ ì§€ì—­ ì¤‘</p>
                    `;
                } else {
                    myBox.innerHTML = `
                        <p class="text-2xl font-bold text-gray-800">${myData.town}</p>
                        <p class="text-lg text-gray-500 mt-4">ì•„ì§ í™œë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    `;
                }

                // Top 10 ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
                const list = document.getElementById("top10List");
                list.innerHTML = "";

                if (top10Data.length === 0) {
                    list.innerHTML = '<li class="text-center text-gray-500">ì•„ì§ ë“±ë¡ëœ ì§€ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
                } else {
                    top10Data.forEach((item, i) => {
                        const rank = i + 1;
                        let medalEmoji = "";
                        if (rank === 1) medalEmoji = "ğŸ¥‡";
                        else if (rank === 2) medalEmoji = "ğŸ¥ˆ";
                        else if (rank === 3) medalEmoji = "ğŸ¥‰";

                        const li = document.createElement("li");
                        li.className = "flex items-center justify-between p-4 bg-white rounded-lg shadow hover:shadow-md transition";
                        li.innerHTML = `
                            <span class="text-xl font-bold text-gray-700">${rank}ìœ„ ${medalEmoji}</span>
                            <span class="text-lg text-gray-800">${item.town_name}</span>
                        `;
                        list.appendChild(li);
                    });
                }

            } catch (error) {
                console.error("ë­í‚¹ ë¡œë“œ ì˜¤ë¥˜:", error);
                document.getElementById("myTownBox").innerHTML = '<p class="text-red-500">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }
    </script>

</body>

</html>
