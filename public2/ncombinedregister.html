<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í†µí•© ì •ë³´ ë“±ë¡</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Daum ìš°í¸ë²ˆí˜¸ / Kakao ì§€ë„ -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6286d4d9bc1d503495b03f46622b5dc8&autoload=false&libraries=services"></script>
  <style>
    /* ë„¤ì˜¤ëª¨í”¼ì¦˜+ê¸€ë˜ìŠ¤+3D íš¨ê³¼ ë°•ìŠ¤ */
    .neo-glass-3d {
      background: rgba(255, 255, 255, 0.85);
      border-radius: 2rem;
      box-shadow:
        8px 8px 32px #e5e8f0,
        -8px -8px 32px #fff,
        0 4px 32px 0 rgba(80, 130, 255, 0.07);
      backdrop-filter: blur(18px) saturate(120%);
      -webkit-backdrop-filter: blur(18px) saturate(120%);
      border: 1.5px solid rgba(180, 200, 255, 0.10);
      transition: box-shadow .23s, border-color .2s;
    }

    .neo-glass-3d:focus-within,
    .neo-glass-3d:hover {
      box-shadow:
        4px 4px 18px #dae3f6,
        -4px -4px 18px #fff,
        0 8px 48px 0 rgba(80, 130, 255, 0.10);
      border-color: #60a5fa55;
    }

    /* 3D ë²„íŠ¼ */
    .btn-3d {
      background: linear-gradient(90deg, #6dd5fa 0%, #2980b9 100%);
      box-shadow: 0 4px 0 #2393b3, 0 8px 18px rgba(0, 64, 128, 0.14);
      color: white;
      font-weight: 700;
      border-radius: 1.3rem;
      padding: .75rem 2.5rem;
      font-size: 1.1rem;
      border: none;
      outline: none;
      transition: all .15s cubic-bezier(.21, .82, .69, .98);
    }

    .btn-3d:active {
      box-shadow: 0 1.5px 0 #2393b3, 0 2px 6px rgba(0, 64, 128, 0.16);
      transform: translateY(2px) scale(.98);
    }

    /* ì…ì²´ ì…ë ¥ */
    .input-neo {
      background: #f6f9fd;
      border-radius: .8rem;
      box-shadow:
        1.5px 1.5px 6px #e4e9f2,
        -1.5px -1.5px 6px #ffffff;
      border: 1px solid #d3e4f7;
      transition: box-shadow .14s, border-color .13s;
      font-size: 1.06rem;
    }

    .input-neo:focus {
      border-color: #60a5fa;
      box-shadow:
        0 0 0 1.5px #60a5fa44,
        1.5px 1.5px 6px #e4e9f2,
        -1.5px -1.5px 6px #ffffff;
      outline: none;
    }

    /* ë°•ìŠ¤ë³„ section title */
    .section-label {
      background: linear-gradient(90deg, #bae6fd 0%, #f0f7ff 100%);
      color: #2b445c;
      box-shadow:
        0 2px 12px 2px #f3f9ff,
        0 0px 0 #bae6fd;
      border-radius: 1.2rem 1.2rem 0 0;
      padding: 1.1rem 2.2rem .9rem 2.2rem;
      font-size: 1.16rem;
      font-weight: 800;
      letter-spacing: .05em;
      border-bottom: 2px solid #cde3fa;
      margin-bottom: 2.1rem;
      text-shadow: 0 1.5px 0 #b2e4ff38;
    }
  </style>
</head>

<body class="bg-white flex flex-col min-h-screen">
  <div id="header-placeholder"></div>
  <main class="flex-grow container mx-auto px-2 py-8">
    <div class="neo-glass-3d max-w-2xl mx-auto p-5 sm:p-8">
      <h2 class="text-3xl font-bold text-center mb-8 drop-shadow">ì •ë³´ ë“±ë¡</h2>
      <form id="businessForm" class="space-y-7" enctype="multipart/form-data" autocomplete="off">
        <input type="hidden" id="storeId" name="storeId">
        <input type="hidden" id="businessCategoryCombined" name="businessCategory">
        <input type="hidden" id="addressCombined" name="address">

        <!-- 1. ì‚¬ì—…ì ì¸ì¦ -->
        <section class="rounded-2xl p-5 bg-yellow-50/80 mb-5 shadow-inner">
          <div class="section-label">ì‚¬ì—…ì ë“±ë¡ ì¸ì¦</div>
          <div class="flex flex-col md:flex-row gap-4">
            <label class="w-36 font-medium flex items-center justify-center">ì‚¬ì—…ì ë²ˆí˜¸</label>
            <div class="flex flex-nowrap items-center gap-2 w-full">
              <input id="bizNumber1" name="bizNumber1" maxlength="4" placeholder="123"
                class="w-[90px] input-neo px-2 py-2" inputmode="numeric" />
              <span>-</span>
              <input id="bizNumber2" name="bizNumber2" maxlength="2" placeholder="45"
                class="w-[60px] input-neo px-2 py-2" inputmode="numeric" />
              <span>-</span>
              <input id="bizNumber3" name="bizNumber3" maxlength="5" placeholder="67890"
                class="w-[100px] input-neo px-2 py-2" inputmode="numeric" />
              <button type="button" onclick="verifyBizNumber()" class="btn-3d ml-2">ì¸ì¦</button>
            </div>
            <input type="hidden" id="businessNumber" name="businessNumber">
          </div>
          <div class="flex flex-col md:flex-row md:items-center gap-2 mt-3">
            <label class="w-32 font-medium shrink-0" for="businessCertImage">ë“±ë¡ì¦ ì´ë¯¸ì§€</label>
            <input type="file" id="businessCertImage" name="businessCertImage" accept="image/*,application/pdf"
              class="flex-1 input-neo px-3 py-2">
          </div>
          <p class="text-sm text-center mt-2">*ì‚¬ì—…ì ë“±ë¡ì¦ì€ <span class="text-red-600">3ê°œì›” ì´ë‚´</span> ë°œê¸‰ë¶„ë§Œ ì¸ì •</p>
          <p id="bizVerifyResult" class="text-sm text-center"></p>
        </section>

        <!-- 2. ëŒ€í‘œ ì •ë³´ -->
        <section class="rounded-2xl p-5 bg-indigo-50/80 mb-5 shadow-inner">
          <div class="section-label">ëŒ€í‘œ ì •ë³´</div>
          <div class="flex flex-col md:flex-row items-center gap-2 mb-3">
            <label class="w-32 font-medium" for="ownerName">ì„±í•¨</label>
            <input id="ownerName" name="ownerName" class="flex-1 input-neo px-3 py-2" required>
          </div>
          <div class="flex flex-col md:flex-row items-center gap-2 mb-3">
            <label class="w-32 font-medium" for="birthDate">ìƒë…„ì›”ì¼</label>
            <input type="date" id="birthDate" name="birthDate" class="flex-1 input-neo px-3 py-2" required>
          </div>
          <div class="flex flex-col md:flex-row items-center gap-2 mb-3">
            <label class="w-32 font-medium" for="emailId">ì´ë©”ì¼</label>
            <div class="flex flex-wrap items-center gap-2 flex-1 min-w-0">
              <input id="emailId" placeholder="ì•„ì´ë””" oninput="updateEmail()" class="flex-1 min-w-0 input-neo px-3 py-2">
              <span>@</span>
              <select id="emailDomainSelect" onchange="handleDomainChange(this)"
                class="flex-1 min-w-0 input-neo px-3 py-2">
                <option value="">ì„ íƒ</option>
                <option value="naver.com">naver.com</option>
                <option value="gmail.com">gmail.com</option>
                <option value="daum.net">daum.net</option>
                <option value="custom">ì§ì ‘ì…ë ¥</option>
              </select>
              <input id="customDomainInput" placeholder="ë„ë©”ì¸" oninput="updateEmail()"
                class="hidden flex-1 min-w-0 input-neo px-3 py-2">
            </div>
            <input type="hidden" id="ownerEmail" name="ownerEmail">
          </div>
          <!-- ì£¼ì†Œ + ê²€ìƒ‰ ë²„íŠ¼ -->
          <div class="flex flex-col md:flex-row items-center gap-2 mb-3">
            <label class="w-32 font-medium" for="ownerAddress">ì£¼ì†Œ</label>
            <div class="flex flex-1 gap-2">
              <input id="ownerAddress" name="ownerAddress" class="flex-1 input-neo px-3 py-2" readonly>
              <button type="button" class="btn-3d min-w-[120px]" onclick="searchAddress()">ì£¼ì†Œ ê²€ìƒ‰</button>
            </div>
          </div>

          <!-- âœ… ìƒì„¸ ì£¼ì†Œ ì…ë ¥ë€ ì¶”ê°€ -->
          <div class="flex flex-col md:flex-row items-center gap-2 mb-3">
            <label class="w-32 font-medium" for="ownerAddressDetail">ìƒì„¸ ì£¼ì†Œ</label>
            <input id="ownerAddressDetail" name="ownerAddressDetail" class="flex-1 input-neo px-3 py-2"
              placeholder="ë™Â·í˜¸ìˆ˜ / ê±´ë¬¼ëª… ë“±">
          </div>

          <!-- â†“ íœ´ëŒ€í° ì…ë ¥ë€ì„ ì£¼ì†Œ ë°‘ì— ìœ„ì¹˜ -->
          <div class="flex flex-col md:flex-row  items-center gap-2 mb-3">
            <label class="w-32 font-medium" for="ownerPhone">íœ´ëŒ€í°</label>
            <input id="ownerPhone" name="ownerPhone" class="flex-1 input-neo px-3 py-2" required>
            <button type="button" id="verifyPhoneButton" class="btn-3d min-w-[120px] w-auto">ì¸ì¦ë²ˆí˜¸ ìš”ì²­</button>
          </div>

          <div class="flex flex-col md:flex-row items-center gap-2 mt-2">
            <label class="w-32 font-medium" for="phoneAuth">ì¸ì¦ë²ˆí˜¸</label>
            <input id="phoneAuth" name="phoneAuth" class="flex-1 input-neo px-3 py-2">
          </div>
          <p id="phoneVerifyResult" class="text-sm text-center"></p>
        </section>

        <!-- 3. ê¸°ë³¸ ì •ë³´ (ìœ„ë¡œ ì´ë™) -->
        <section class="rounded-2xl p-5 bg-white/90 mb-5 shadow-inner">
          <div class="section-label">ê¸°ë³¸ ì •ë³´</div>

          <!-- âœ… ê°€ê²Œ ì´ë¯¸ì§€ ì—…ë¡œë“œ (ìµœëŒ€ 3ì¥ + ë©”ì¸ ì„ íƒ) -->
          <div class="flex flex-col gap-2 mb-3">
            <div class="flex flex-col md:flex-row items-center gap-2">
              <label class="w-32 font-medium" for="storeImages">ê°€ê²Œ ì´ë¯¸ì§€</label>
              <input type="file" id="storeImages" name="storeImages" accept="image/*" multiple
                class="flex-1 input-neo px-3 py-2">
            </div>

            <!-- ë©”ì¸ ì´ë¯¸ì§€ ì¸ë±ìŠ¤(0~2) ì„œë²„ë¡œ ì „ì†¡ -->
            <input type="hidden" id="mainImageIndex" name="mainImageIndex" value="0">

            <!-- ë¯¸ë¦¬ë³´ê¸° + ë©”ì¸ ì„ íƒ -->
            <div id="storeImagePreview" class="grid grid-cols-3 gap-3 mt-2"></div>

            <p class="text-xs text-gray-500 ml-1">
              * ê°€ê²Œ ì´ë¯¸ì§€ëŠ” ìµœëŒ€ 3ì¥ê¹Œì§€ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤. (ë©”ì¸ ì´ë¯¸ì§€ëŠ” ì•„ë˜ì—ì„œ ì„ íƒ)
            </p>
          </div>

          <!-- ìƒí˜¸ -->
          <div class="flex flex-col md:flex-row items-center gap-2 mb-3">
            <label class="w-32 font-medium" for="businessName">ìƒí˜¸</label>
            <input id="businessName" name="businessName" class="flex-1 input-neo px-3 py-2" required>
          </div>

          <!-- âœ… ì—…ì¢… -->
          <div class="flex flex-col md:flex-row items-center gap-2 mb-3">
            <label class="w-32 font-medium" for="businessType">ì—…ì¢…</label>
            <input id="businessType" name="businessType" class="flex-1 input-neo px-3 py-2"
              placeholder="ì˜ˆ: ë¯¸ìš©/ì´ë°œ, ë³‘ì›, í•™ì› ë“±" required>
          </div>

          <!-- ì˜ì—…ì‹œê°„ -->
          <div class="flex flex-col md:flex-row items-center gap-2 mb-3">
            <label class="w-32 font-medium" for="businessHours">ì˜ì—…ì‹œê°„</label>
            <input id="businessHours" name="businessHours" class="flex-1 input-neo px-3 py-2">
          </div>

          <!-- ë°°ë‹¬ ì—¬ë¶€ -->
          <div class="flex flex-col md:flex-row items-center gap-2 mb-3">
            <label class="w-32 font-medium" for="deliveryOption">ë°°ë‹¬</label>
            <select id="deliveryOption" name="deliveryOption" class="flex-1 input-neo px-3 py-2">
              <option value="">ì„ íƒ</option>
              <option value="ê°€ëŠ¥">ê°€ëŠ¥</option>
              <option value="ë¶ˆê°€">ë¶ˆê°€</option>
            </select>
          </div>
        </section>

        <!-- 4. ì—…ì¢…(ì¹´í…Œê³ ë¦¬) ì„ íƒ (ê¸°ë³¸ ì •ë³´ ì•„ë˜ë¡œ ì´ë™) -->
        <section class="rounded-2xl p-5 bg-gray-50/90 mb-5 shadow-inner">
          <div class="section-label">ì—…ì¢…(ì¹´í…Œê³ ë¦¬) ì„ íƒ</div>
          <div class="flex flex-col md:flex-row items-center gap-2 mb-2">
            <label class="w-32 font-medium">ì¹´í…Œê³ ë¦¬</label>
            <select id="mainCategory" name="mainCategory" class="flex-1 input-neo px-3 py-2" required></select>
          </div>
          <div class="flex flex-col md:flex-row items-center gap-2">
            <label class="w-32 font-medium">ì„œë¸Œì¹´í…Œê³ ë¦¬</label>
            <select id="subCategory" name="subCategory" class="flex-1 input-neo px-3 py-2" required></select>
          </div>
        </section>

        <!-- ë©”ë‰´ ì…ë ¥ í† ê¸€ ë²„íŠ¼(ì²˜ìŒë§Œ ë…¸ì¶œ) -->
        <button type="button" id="showMenuSectionBtn" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded">
          ë©”ë‰´ ì…ë ¥
        </button>

        <!-- ë©”ë‰´ ì…ë ¥ ì˜ì—­ (ì´ˆê¸° ìˆ¨ê¹€) -->
        <div id="menu-section" class="hidden mt-6">
          <div class="flex items-center justify-between mb-3">
            <div class="font-semibold text-lg">ë©”ë‰´ ì…ë ¥</div>
            <div class="flex gap-2">
              <button type="button" id="addCategoryBtn" class="bg-blue-500 text-white px-3 py-1 rounded">+
                ì¹´í…Œê³ ë¦¬
                ì¶”ê°€</button>
              <button type="button" id="closeMenuSectionBtn" class="bg-gray-400 text-white px-3 py-1 rounded">ë©”ë‰´
                ë‹«ê¸°</button>
            </div>
          </div>
          <!-- ì—¬ê¸°ì— ì¹´í…Œê³ ë¦¬ë³„ ë©”ë‰´ë°•ìŠ¤ê°€ ì¶”ê°€ë¨ -->
          <div id="menuCategoryContainer" class="space-y-5"></div>
        </div>

        <!-- ë©”ë‰´ ì¹´í…Œê³ ë¦¬ (ë“œë¡­ë‹¤ìš´) -->
        <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3 relative hidden">
          <label class="w-32 font-medium shrink-0" for="subcategoryDisplay">ë©”ë‰´ ì¹´í…Œê³ ë¦¬</label>

          <!-- ì„ íƒëœ ê°’ í‘œì‹œ -->
          <input id="subcategoryDisplay" readonly placeholder="ì„ íƒ"
            class="flex-1 border rounded px-3 py-2 bg-gray-100 cursor-pointer">

          <!-- í† ê¸€ ë²„íŠ¼ -->
          <button type="button" id="subcategoryToggle" class="shrink-0 bg-gray-300 px-3 py-2 rounded">â–¼</button>

          <!-- ì‹¤ì œ ì„œë²„ë¡œ ë³´ë‚¼ ê°’ -->
          <input type="hidden" id="businessSubcategory" name="businessSubcategory">
        </div>

        <section class="rounded-2xl p-5 bg-white/90 mb-5 shadow-inner">
          <div class="section-label">ê³ ê° ì´ë²¤íŠ¸</div>
          <div class="flex flex-col gap-3">
            <div class="flex flex-col md:flex-row items-center gap-2">
              <label for="event1" class="w-32 font-medium">ì´ë²¤íŠ¸ 1</label>
              <input id="event1" name="event1" class="flex-1 input-neo px-3 py-2" placeholder="ì˜ˆ: ì‹ ê·œê°€ì… ì¿ í° ì¦ì •">
            </div>
            <div class="flex flex-col md:flex-row items-center gap-2">
              <label for="event2" class="w-32 font-medium">ì´ë²¤íŠ¸ 2</label>
              <input id="event2" name="event2" class="flex-1 input-neo px-3 py-2" placeholder="ì˜ˆ: 2+1 í–‰ì‚¬">
            </div>
          </div>
        </section>

        <section class="rounded-2xl p-5 bg-white/90 mb-5 shadow-inner">
          <div class="section-label">ì„œë¹„ìŠ¤ ë‚´ìš©</div>
          <div class="flex flex-col md:flex-row items-start gap-2">
            <textarea id="serviceDetails" name="serviceDetails" class="flex-1 input-neo min-h-[90px] px-3 py-2"
              placeholder="ì„œë¹„ìŠ¤Â·ë©”ë‰´Â·ì˜ˆì•½ ì •ë³´ ë“±ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
          </div>
        </section>

        <section class="rounded-2xl p-5 bg-white/90 mb-5 shadow-inner">
          <div class="section-label">ê¸°íƒ€ ì •ë³´</div>
          <div class="flex flex-col gap-3">
            <div class="flex flex-col md:flex-row items-center gap-2">
              <label for="facility" class="w-32 font-medium">ì¥ì• ì¸ í¸ì˜ì‹œì„¤</label>
              <input id="facility" name="facilities" class="flex-1 input-neo px-3 py-2" placeholder="ì˜ˆ: ìˆìŒ/ì—†ìŒ">
            </div>
            <div class="flex flex-col md:flex-row items-center gap-2">
              <label for="pets" class="w-32 font-medium">ë°˜ë ¤ë™ë¬¼</label>
              <select id="petsAllowed" name="petsAllowed" class="flex-1 input-neo px-3 py-2">
                <option value="">ì„ íƒ</option>
                <option value="true">ê°€ëŠ¥</option>
                <option value="false">ë¶ˆê°€</option>
              </select>
            </div>
            <div class="flex flex-col md:flex-row items-center gap-2">
              <label for="parking" class="w-32 font-medium">ì£¼ì°¨</label>
              <input id="parking" name="parking" class="flex-1 input-neo px-3 py-2" placeholder="ì˜ˆ: ì „ìš©/ìœ ë£Œ">
            </div>
          </div>
        </section>

        <section class="rounded-2xl p-5 bg-white/90 mb-5 shadow-inner">
          <div class="section-label">ì—°ë½ì²˜ / SNS</div>
          <div class="flex flex-col gap-3">
            <div class="flex flex-col md:flex-row items-center gap-2">
              <label for="phoneNumber" class="w-32 font-medium">ëŒ€í‘œì „í™”</label>
              <input id="phoneNumber" name="phone" class="flex-1 input-neo px-3 py-2" placeholder="ì˜ˆ: 02-123-4567">
            </div>
            <div class="flex flex-col md:flex-row items-center gap-2">
              <label for="homepage" class="w-32 font-medium">í™ˆí˜ì´ì§€</label>
              <input id="homepage" name="homepage" class="flex-1 input-neo px-3 py-2" placeholder="URL ì…ë ¥">
            </div>
            <div class="flex flex-col md:flex-row items-center gap-2">
              <label for="instagram" class="w-32 font-medium">Instagram</label>
              <input id="instagram" name="instagram" class="flex-1 input-neo px-3 py-2" placeholder="Instagram URL">
            </div>
            <div class="flex flex-col md:flex-row items-center gap-2">
              <label for="facebook" class="w-32 font-medium">Facebook</label>
              <input id="facebook" name="facebook" class="flex-1 input-neo px-3 py-2" placeholder="Facebook URL">
            </div>
            <!-- ì•ˆë‚´ë¬¸ -->
            <p class="text-sm text-gray-500 mt-1 ml-1">
              â€» Instagram / Facebookì€ ì˜ˆì‹œì¼ ë¿ì´ë©°, ì†Œìœ í•œ SNS (ì˜ˆ: Twitter, YouTube, TikTok, ë¸”ë¡œê·¸ ë“±)
              ì˜ URLì„ ììœ ë¡­ê²Œ ì…ë ¥í•˜ì…”ë„ ë©ë‹ˆë‹¤.
            </p>
          </div>
        </section>

        <!-- 9. ì¶”ê°€ ì„¤ëª… -->
        <section class="rounded-2xl p-5 bg-white/90 mb-5 shadow-inner">
          <div class="section-label">ì¶”ê°€ ì„¤ëª…</div>
          <textarea id="additionalDesc" name="additionalDesc" class="input-neo w-full min-h-[90px] px-3 py-2"
            placeholder="ì¶”ê°€ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
        </section>

        <!-- 2-1. ê°€ê²Œ ì£¼ì†Œ -->
        <section class="rounded-2xl p-5 bg-blue-50/80 mb-5 shadow-inner">
          <div class="section-label">ê°€ê²Œ ì£¼ì†Œ</div>
          <div class="flex flex-col md:flex-row items-center gap-2 mb-3">
            <label class="w-32 font-medium" for="postalCode">ìš°í¸ë²ˆí˜¸</label>
            <div class="flex flex-1 gap-2">
              <input id="postalCode" name="postalCode" class="flex-1 input-neo px-3 py-2" readonly>
              <button type="button" class="btn-3d min-w-[120px]" onclick="searchStoreAddress()">ì£¼ì†Œ ê²€ìƒ‰</button>
            </div>
          </div>
          <div class="flex flex-col md:flex-row items-center gap-2 mb-3">
            <label class="w-32 font-medium" for="roadAddress">ë„ë¡œëª… ì£¼ì†Œ</label>
            <input id="roadAddress" name="roadAddress" class="flex-1 input-neo px-3 py-2" readonly>
          </div>
          <div class="flex flex-col md:flex-row items-center gap-2 mb-3">
            <label class="w-32 font-medium" for="detailAddress">ìƒì„¸ ì£¼ì†Œ</label>
            <input id="detailAddress" name="detailAddress" class="flex-1 input-neo px-3 py-2" placeholder="ê±´ë¬¼ëª…, ë™Â·í˜¸ìˆ˜">
          </div>
          <div id="map" class="w-full h-64 mt-3 border rounded-lg"></div>
        </section>

        <!-- 5. ë“±ë¡ ë²„íŠ¼ -->
        <div class="text-center space-x-4 mt-8">
          <button type="submit" class="btn-3d">ì…ë ¥ ì™„ë£Œ</button>
          <button type="button" onclick="updateData()"
            class="btn-3d bg-gradient-to-r from-green-400 to-green-700 hover:from-green-600 hover:to-green-900 ml-2">ìˆ˜ì •</button>
        </div>
      </form>
    </div>
  </main>

  <!-- âœ… ê³µí†µ ì˜¤ë²„ë ˆì´ ì¶”ê°€ -->
  <div id="overlay" style="display:none;
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.4);z-index:2000;">
  </div>

  <!-- ëŒ€í‘œ ì •ë³´ ì£¼ì†Œ ê²€ìƒ‰ ë ˆì´ì–´ -->
  <div id="addrLayerOwner" style="display:none;position:fixed;overflow:hidden;z-index:2001;
    -webkit-overflow-scrolling:touch;border:5px solid #60a5fa;
    left:50%;top:50%;transform:translate(-50%,-50%);
    width:500px;height:600px;background:white;">
  </div>

  <!-- ê°€ê²Œ ì£¼ì†Œ ê²€ìƒ‰ ë ˆì´ì–´ -->
  <div id="addrLayerStore" style="display:none;position:fixed;overflow:hidden;z-index:2001;
    -webkit-overflow-scrolling:touch;border:5px solid #60a5fa;
    left:50%;top:50%;transform:translate(-50%,-50%);
    width:500px;height:600px;background:white;">
  </div>

  <!-- âœ… ìš°ì¸¡ í•˜ë‹¨ ê³ ì • ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
  <div class="fixed bottom-6 right-6 flex flex-col items-center space-y-3 z-50">

    <!-- ì´ì „ -->
    <button onclick="history.back()"
      class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-200 to-gray-400 shadow-lg flex items-center justify-center hover:scale-105 transition">
      â†
    </button>

    <!-- ë‹¤ìŒ -->
    <button onclick="history.forward()"
      class="w-12 h-12 rounded-full bg-gradient-to-br from-green-400 to-blue-500 text-white shadow-lg flex items-center justify-center hover:scale-105 transition">
      â†’
    </button>

    <!-- í™ˆ -->
    <a href="/index.html"
      class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 text-white shadow-lg flex items-center justify-center hover:scale-105 transition">
      ğŸ 
    </a>
  </div>

  <div id="footer-placeholder"></div>

  <script>
    // í—¤ë”/í‘¸í„° ë¶ˆëŸ¬ì˜¤ê¸°
    fetch("/components/header.html")
      .then(r => r.text())
      .then(d => (document.getElementById('header-placeholder').innerHTML = d));

    fetch("/components/footer.html")
      .then(r => r.text())
      .then(d => (document.getElementById('footer-placeholder').innerHTML = d));

    // ì´ë©”ì¼ ì…ë ¥ ìœ í‹¸
    function updateEmail() {
      const id = document.getElementById('emailId').value.trim();
      const domainSel = document.getElementById('emailDomainSelect');
      const custom = document.getElementById('customDomainInput').value.trim();
      const domain = domainSel.value === 'custom' ? custom : domainSel.value;
      document.getElementById('ownerEmail').value = domain ? `${id}@${domain}` : '';
    }
    function handleDomainChange(sel) {
      const customInp = document.getElementById('customDomainInput');
      if (sel.value === 'custom') {
        customInp.classList.remove('hidden');
        customInp.focus();
      } else {
        customInp.classList.add('hidden');
        updateEmail();
      }
    }

    function searchAddress() {
      const layer = document.getElementById('addrLayerOwner');
      const overlay = document.getElementById('overlay');
      new daum.Postcode({
        oncomplete: function (data) {
          var fullAddr = data.roadAddress ? data.roadAddress : data.jibunAddress;
          document.getElementById('ownerAddress').value = fullAddr;
          layer.style.display = 'none';
          overlay.style.display = 'none';
        },
        width: '100%',
        height: '100%'
      }).embed(layer);
      layer.style.display = 'block';
      overlay.style.display = 'block';
    }


    // ì¹´í…Œê³ ë¦¬ë³„ ì„œë¸Œì¹´í…Œê³ ë¦¬ ë™ì  ì¶œë ¥
    const categoryData = {
      //"ì‹ë‹¹": ["í•œì‹", "ì¤‘ì‹", "ì–‘ì‹", "ì¼ì‹", "ë¶„ì‹", "íŒ¨ìŠ¤íŠ¸í‘¸ë“œ", "ì¹˜í‚¨", "ì¡±ë°œ/ë³´ìŒˆ", "í”¼ì", "ì•¼ì‹", "ë””ì €íŠ¸", "ê¸°íƒ€"],
      "ë³‘ì›": ["ì¢…í•©ë³‘ì›", "ë‚´ê³¼", "ì¹˜ê³¼", "ì†Œì•„ê³¼", "ì •í˜•ì™¸ê³¼", "ì‚°ë¶€ì¸ê³¼", "í•œì˜ì›", "ë™ë¬¼ë³‘ì›", "ê¸°íƒ€"],
      "ì•½êµ­": ["ì¼ë°˜ì•½êµ­", "24ì‹œì•½êµ­", "í•œì•½ë°©", "ê¸°íƒ€"],
      "ì–´ë¦°ì´ì§‘": ["êµ­ê³µë¦½", "ë¯¼ê°„", "ê°€ì •", "ì§ì¥", "ê¸°íƒ€"],
      "í•™ì›": ["ì…ì‹œí•™ì›", "ì˜ì–´", "ìˆ˜í•™", "ìŒì•…", "ë¯¸ìˆ ", "ì»´í“¨í„°", "ì²´ìœ¡", "ë…ì„œì‹¤", "ê¸°íƒ€"],
      "ë§ˆíŠ¸": ["ëŒ€í˜•ë§ˆíŠ¸", "ì¤‘ì†Œë§ˆíŠ¸", "ìŠˆí¼ë§ˆì¼“", "ì‹œì¥", "ê¸°íƒ€"],
      "í¸ì˜ì ": ["CU", "GS25", "ì„¸ë¸ì¼ë ˆë¸", "ì´ë§ˆíŠ¸24", "ë¯¸ë‹ˆìŠ¤í†±", "ê¸°íƒ€"],
      "ìš´ë™": ["í—¬ìŠ¤ì¥", "í•„ë¼í…ŒìŠ¤", "ìš”ê°€", "íƒœê¶Œë„", "ìŠ¤í¬ì¸ ì„¼í„°", "ê¸°íƒ€"],
      "ë¯¸ìš©/ì´ë°œ": ["ë¯¸ìš©ì‹¤", "ì´ë°œì†Œ", "ë„¤ì¼", "í”¼ë¶€ê´€ë¦¬", "ì™ì‹±", "ê¸°íƒ€"],
      "ìŠ¤í„°ë””/ë…ì„œì‹¤": ["ìŠ¤í„°ë””ë£¸", "ë…ì„œì‹¤", "ë„ì„œê´€", "ê¸°íƒ€"],
      "ëª©ìš•": ["ëŒ€ì¤‘ëª©ìš•íƒ•", "ì‚¬ìš°ë‚˜", "ì°œì§ˆë°©", "ìŠ¤íŒŒ", "ê¸°íƒ€"],
      "ì„¸íƒ/ì˜·ìˆ˜ì„ ": ["ì„¸íƒì†Œ", "ì˜·ìˆ˜ì„ ", "ì‹ ë°œìˆ˜ì„ ", "ê¸°íƒ€"],
      "ìˆ™ë°•": ["í˜¸í…”", "ëª¨í…”", "ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤", "íœì…˜", "ê¸°íƒ€"],
      "ì¤‘ê³ /êµ¬ì œ": ["ì¤‘ê³ ê°€ì „", "ì¤‘ê³ ê°€êµ¬", "ì¤‘ê³ ëª…í’ˆ", "ë¦¬ì‚¬ì´í´", "ê¸°íƒ€"],
      "ìë™ì°¨ ì •ë¹„/ìˆ˜ë¦¬ë“±": ["ì¹´ì„¼í„°", "ì •ë¹„ì†Œ", "ìë™ì°¨ìš©í’ˆ", "íƒ€ì´ì–´", "ê¸°íƒ€"],
      "ì£¼ìœ ì†Œ": ["ì§ì˜ì£¼ìœ ì†Œ", "ìê°€ì£¼ìœ ì†Œ", "ì¶©ì „ì†Œ", "ê¸°íƒ€"],
      "ë°˜ë ¤ë™ë¬¼": ["ì• ê²¬ë¯¸ìš©", "ì• ê²¬í˜¸í…”", "ì• ê²¬ì¹´í˜", "ë™ë¬¼ìš©í’ˆ", "í«ì‹œí„°", "ê¸°íƒ€"],
      "ê°€ì „ì œí’ˆ": ["ê°€ì „íŒë§¤", "ê°€ì „ìˆ˜ë¦¬", "íœ´ëŒ€í°", "PC", "ê¸°íƒ€"],
      "ì² ë¬¼ / ìì¬": ["ì² ë¬¼ì ", "ê±´ì¶•ìì¬", "ì¸í…Œë¦¬ì–´ìì¬", "ê¸°íƒ€"],
      "ê°„íŒ / ê´‘ê³ ": ["ê°„íŒì œì‘", "ì¸ì‡„", "í™ë³´ë¬¼", "ê¸°íƒ€"],
      "í†µì‹  / ì¸í„°ë„· / TV": ["SK", "KT", "LG", "ì¸í„°ë„·", "IPTV", "ê¸°íƒ€"],
      "ì•ˆê²½ / ì‚¬ì§„ / ê½ƒì§‘": ["ì•ˆê²½ì ", "ì‚¬ì§„ê´€", "ê½ƒì§‘", "í™”ì›", "ê¸°íƒ€"]
    };
    // ë¹¼ê³  ì‹¶ì€ ì¹´í…Œê³ ë¦¬
    const excluded = ["ì‹ë‹¹", "ì „í†µì‹œì¥", "ê³µì—°"];
    const mainCatSel = document.getElementById("mainCategory");
    mainCatSel.innerHTML = '<option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>';

    Object.keys(categoryData).forEach(key => {
      if (!excluded.includes(key)) {
        mainCatSel.innerHTML += `<option value="${key}">${key}</option>`;
      }
    });

    // [2] ë©”ì¸ ì¹´í…Œê³ ë¦¬ ì„ íƒ ì‹œ ì„œë¸Œì¹´í…Œê³ ë¦¬ ë³€ê²½
    mainCatSel.addEventListener("change", function () {
      const subSel = document.getElementById("subCategory");
      subSel.innerHTML = `<option value="">ì„œë¸Œì¹´í…Œê³ ë¦¬ ì„ íƒ</option>`;
      const val = this.value;
      if (categoryData[val]) {
        categoryData[val].forEach(c =>
          subSel.innerHTML += `<option value="${c}">${c}</option>`
        );
      }
    });

    // --- 1. ì‚¬ì—…ì ì¸ì¦ë§Œ ë‹´ë‹¹! ---
    async function verifyBizNumber() {
      const n1 = document.getElementById('bizNumber1').value.trim();
      const n2 = document.getElementById('bizNumber2').value.trim();
      const n3 = document.getElementById('bizNumber3').value.trim();
      const biz = n1 + n2 + n3;
      const resEl = document.getElementById('bizVerifyResult');
      if (!/^\d{10}$/.test(biz)) {
        resEl.textContent = 'ì˜¬ë°”ë¥¸ ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì´ 10ìë¦¬ ìˆ«ì)';
        resEl.className = 'text-sm text-red-600 text-center';
        return;
      }
      try {
        const r = await fetch('/verify-biz', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ b_no: [biz] })
        });
        const d = await r.json();
        const i = d?.data?.[0];
        if (i && i.b_stt_cd === '01') {
          resEl.textContent = `âœ… ì¸ì¦ ì™„ë£Œ: ${i.b_no}`;
          resEl.className = 'text-sm text-green-600 text-center';
          document.getElementById('businessName').value = i.b_nm || '';
          // âœ… hidden inputì— ì‚¬ì—…ìë²ˆí˜¸ ì„¤ì •
          document.getElementById('businessNumber').value = biz;
        } else {
          resEl.textContent = 'âŒ ë“±ë¡ë˜ì§€ ì•Šì•˜ê±°ë‚˜ íì—…ëœ ì‚¬ì—…ìì…ë‹ˆë‹¤.';
          resEl.className = 'text-sm text-red-600 text-center';
        }
      } catch (err) {
        resEl.textContent = 'ì„œë²„ ì˜¤ë¥˜ë¡œ ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
        resEl.className = 'text-sm text-red-600 text-center';
      }
    }

    // --- 2. íœ´ëŒ€í° ì¸ì¦ (í•¨ìˆ˜ ì™¸ë¶€ì— ìˆì–´ì•¼ í•¨) ---
    document.getElementById('verifyPhoneButton').addEventListener('click', () => {
      const phone = document.getElementById('ownerPhone').value.trim();
      const resEl = document.getElementById('phoneVerifyResult');
      if (!phone) {
        resEl.textContent = 'íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
        resEl.className = 'text-sm text-red-600';
        return;
      }
      resEl.textContent = 'ì¸ì¦ë²ˆí˜¸ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. (ì˜ˆì‹œ: 123456)';
      resEl.className = 'text-sm text-green-600';
    });
    document.getElementById('phoneAuth').addEventListener('blur', function () {
      const code = this.value.trim();
      const resEl = document.getElementById('phoneVerifyResult');
      if (code === '123456') {
        resEl.textContent = 'íœ´ëŒ€ì „í™” ì¸ì¦ ì„±ê³µ!';
        resEl.className = 'text-sm text-green-600';
      } else if (code) {
        resEl.textContent = 'ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
        resEl.className = 'text-sm text-red-600';
      }
    });

    // --- ì „ì—­ ì´ˆê¸°í™” ---
    let map, geocoder;
    kakao.maps.load(() => {
      const container = document.getElementById('map');
      const options = { center: new kakao.maps.LatLng(37.5665, 126.9780), level: 3 }; // ê¸°ë³¸ ì„œìš¸ ì‹œì²­ ì¢Œí‘œ
      map = new kakao.maps.Map(container, options);
      geocoder = new kakao.maps.services.Geocoder();
    });

    // --- ê°€ê²Œ ì£¼ì†Œ ê²€ìƒ‰ í•¨ìˆ˜ ---
    function searchStoreAddress() {
      const layer = document.getElementById('addrLayerStore');
      const overlay = document.getElementById('overlay');

      new daum.Postcode({
        oncomplete: function (data) {
          // âœ… ì…ë ¥ì°½ì— ì£¼ì†Œ ë°˜ì˜
          document.getElementById('postalCode').value = data.zonecode;
          document.getElementById('roadAddress').value = data.roadAddress || data.jibunAddress;

          // âœ… ì§€ë„ ì´ë™ (ì£¼ì†Œ ê²€ìƒ‰ ê²°ê³¼ ì¢Œí‘œë¡œ ì´ë™)
          const addr = data.roadAddress || data.jibunAddress;
          geocoder.addressSearch(addr, function (result, status) {
            if (status === kakao.maps.services.Status.OK) {
              const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
              map.setCenter(coords); // ì§€ë„ ì¤‘ì‹¬ ì´ë™
              new kakao.maps.Marker({ map, position: coords }); // ë§ˆì»¤ ì¶”ê°€
            }
          });

          // âœ… ë ˆì´ì–´ ë‹«ê¸°
          layer.style.display = 'none';
          overlay.style.display = 'none';
        },
        width: '100%',
        height: '100%'
      }).embed(layer);

      layer.style.display = 'block';
      overlay.style.display = 'block';
    }

    // --- 3. ë©”ë‰´ ì…ë ¥ í† ê¸€ (í•¨ìˆ˜ ì™¸ë¶€ì— ìˆì–´ì•¼ í•¨) ---
    document.getElementById('showMenuSectionBtn').onclick = function () {
      document.getElementById('menu-section').classList.remove('hidden');
      this.style.display = 'none';
    };
    document.getElementById('closeMenuSectionBtn').onclick = function () {
      document.getElementById('menu-section').classList.add('hidden');
      document.getElementById('showMenuSectionBtn').style.display = '';
    };

    // --- 4. ë©”ë‰´/ì¹´í…Œê³ ë¦¬ ê¸°ëŠ¥ë„ ì™¸ë¶€ì— ìœ„ì¹˜ ---
    let categoryIdx = 0;
    function createCategoryBox(idx) {
      return `
        <div class="border p-4 rounded-xl mb-4 bg-indigo-50 shadow" data-category-idx="${idx}">
          <div class="flex items-center mb-3">
            <input name="categoryName[]" placeholder="ì¹´í…Œê³ ë¦¬ëª… (ì˜ˆ: ëˆê°€ìŠ¤, ì»¤íŠ¸)" class="input-neo px-3 py-2 w-56 mr-3" required>
            <button type="button" class="removeCategoryBtn px-2 py-1 bg-red-400 text-white rounded">ì¹´í…Œê³ ë¦¬ ì‚­ì œ</button>
          </div>
          <div class="menus-in-category"></div>
          <button type="button" class="addMenuInCategoryBtn bg-green-500 text-white px-2 py-1 rounded mt-2">+ ë©”ë‰´ ì¶”ê°€</button>
        </div>
      `;
    }
    document.getElementById('addCategoryBtn').onclick = function () {
      const container = document.getElementById('menuCategoryContainer');
      container.insertAdjacentHTML('beforeend', createCategoryBox(categoryIdx++));
      bindCategoryEvents();
    };

    // âœ… ë©”ë‰´ ê°œìˆ˜ Hidden input ì—…ë°ì´íŠ¸
    function updateMenuCounts() {
      // 1) ê³¼ê±° menuCount_* ì „ë¶€ ì œê±°
      document.querySelectorAll('input[name^="menuCount_"]').forEach(el => el.remove());
      // 2) í˜„ì¬ DOM ìˆœì„œëŒ€ë¡œ ì¬ìƒì„±
      document.querySelectorAll('[data-category-idx]').forEach((catBox, idx) => {
        const menus = catBox.querySelectorAll('input[name="menuName[]"]');
        const hidden = document.createElement("input");
        hidden.type = "hidden";
        hidden.name = `menuCount_${idx}`;
        hidden.value = menus.length;
        catBox.appendChild(hidden);
      });
    }

    function stampMenuCategories() {
      document.querySelectorAll('[data-category-idx]').forEach(catBox => {
        const catName = catBox.querySelector('input[name="categoryName[]"]')?.value?.trim() || 'ê¸°íƒ€';
        catBox.querySelectorAll('input[name="menuCategory[]"]').forEach(h => h.value = catName);
      });
    }

    // âœ… ë©”ë‰´ ì´ë²¤íŠ¸
    function bindMenuEvents() {
      document.querySelectorAll('.removeMenuBtn').forEach(btn => {
        btn.onclick = function () {
          this.parentElement.remove();
          updateMenuCounts(); // ì‚­ì œ ë°˜ì˜
        }
      });
    }

    // âœ… ì¹´í…Œê³ ë¦¬ ì´ë²¤íŠ¸
    function bindCategoryEvents() {
      document.querySelectorAll('.removeCategoryBtn').forEach(btn => {
        btn.onclick = function () {
          this.closest('[data-category-idx]').remove();
          updateMenuCounts(); // ì¹´í…Œê³ ë¦¬ ì‚­ì œ ë°˜ì˜
        };
      });


      document.querySelectorAll('.addMenuInCategoryBtn').forEach(btn => {
        btn.onclick = function () {
          const catBox = this.closest('[data-category-idx]');
          const catName = catBox.querySelector('input[name="categoryName[]"]')?.value?.trim() || 'ê¸°íƒ€';

          const menuBox = `
      <div class="flex gap-2 mt-2 items-center">
        <input name="menuName[]" placeholder="ë©”ë‰´ëª…"
               class="input-neo px-2 py-1 flex-[2] min-w-0" required>
        <input name="menuPrice[]" type="number" placeholder="ê°€ê²©"
               class="input-neo px-2 py-1 w-28" required>
        <input name="menuImage[]" type="file" accept="image/*"
               class="input-neo px-2 py-1 flex-[3] min-w-0">
        <input type="hidden" name="menuCategory[]" value="${catName}">
        <button type="button"
               class="removeMenuBtn px-3 py-1 bg-red-400 text-white rounded shrink-0">
          ì‚­ì œ
        </button>
      </div>`;
          this.previousElementSibling.insertAdjacentHTML('beforeend', menuBox);
          bindMenuEvents();
          updateMenuCounts();
        }
      });
    }

    // === ì¹´í…Œê³ ë¦¬ëª… ë³€ê²½ â†’ í•˜ìœ„ ë©”ë‰´ menuCategory[] ë™ê¸°í™” (ì „ì—­ 1íšŒ) ===
    document.addEventListener('input', (e) => {
      const inp = e.target.closest('input[name="categoryName[]"]');
      if (!inp) return;
      const box = inp.closest('[data-category-idx]');
      const val = inp.value.trim();
      box.querySelectorAll('input[name="menuCategory[]"]').forEach(h => h.value = val);
    });

    // ë°°ê²½ í´ë¦­í•˜ë©´ ë‹«ê¸°
    document.getElementById('overlay').addEventListener('click', () => {
      document.getElementById('addrLayerOwner').style.display = 'none';
      document.getElementById('addrLayerStore').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    });



    // --- 5. í¼ ì œì¶œ (í•¨ìˆ˜ ì™¸ë¶€ì— ìˆì–´ì•¼ í•¨) ---
    // âœ… ê°€ê²Œ ì´ë¯¸ì§€: ìµœëŒ€ 3ì¥ ì œí•œ + ë©”ì¸ ì´ë¯¸ì§€ ì„ íƒ UI
    (function initStoreImagePicker() {
      const input = document.getElementById("storeImages");
      const preview = document.getElementById("storeImagePreview");
      const mainIdxHidden = document.getElementById("mainImageIndex");

      if (!input || !preview || !mainIdxHidden) return;

      function setFilesToInput(fileList) {
        // input.filesëŠ” ì§ì ‘ ëŒ€ì… ë¶ˆê°€ â†’ DataTransferë¡œ ì¬êµ¬ì„±
        const dt = new DataTransfer();
        Array.from(fileList).forEach(f => dt.items.add(f));
        input.files = dt.files;
      }

      function render() {
        preview.innerHTML = "";
        const files = Array.from(input.files || []);

        // íŒŒì¼ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
        if (files.length === 0) {
          mainIdxHidden.value = "0";
          return;
        }

        files.forEach((file, idx) => {
          const url = URL.createObjectURL(file);

          const card = document.createElement("label");
          card.className =
            "relative rounded-xl overflow-hidden border bg-white shadow-sm cursor-pointer group";

          card.innerHTML = `
          <img src="${url}" alt="preview-${idx}" class="w-full h-28 object-cover">
          <div class="absolute inset-x-0 bottom-0 bg-black/45 text-white text-xs px-2 py-1 flex items-center justify-between">
            <span class="truncate">${file.name}</span>
            <span class="ml-2 shrink-0">ë©”ì¸</span>
          </div>
          <input type="radio" name="mainImagePick" value="${idx}" class="absolute top-2 left-2 w-4 h-4 accent-blue-600">
          <div class="absolute top-2 right-2 px-2 py-1 text-xs rounded bg-white/90 hidden group-hover:block">
            ${idx + 1}ë²ˆ
          </div>
        `;

          // radio ê¸°ë³¸ ì²´í¬: hiddenê°’ ìš°ì„ , ì—†ìœ¼ë©´ 0
          const radio = card.querySelector('input[type="radio"]');
          const current = Number(mainIdxHidden.value || 0);
          radio.checked = (idx === current);

          radio.addEventListener("change", () => {
            mainIdxHidden.value = String(idx);
          });

          preview.appendChild(card);
        });
      }

      input.addEventListener("change", () => {
        const files = Array.from(input.files || []);

        if (files.length > 3) {
          alert("ê°€ê²Œ ì´ë¯¸ì§€ëŠ” ìµœëŒ€ 3ì¥ê¹Œì§€ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì²˜ìŒ 3ì¥ë§Œ ì ìš©í•©ë‹ˆë‹¤.");
          setFilesToInput(files.slice(0, 3));
        }

        // ìƒˆë¡œ ê³ ë¥´ë©´ ë©”ì¸ì€ ê¸°ë³¸ 0ìœ¼ë¡œ ë¦¬ì…‹
        mainIdxHidden.value = "0";
        render();
      });
    })();

    // --- í¼ ì œì¶œ í•¸ë“¤ëŸ¬ ---
    document.getElementById('businessForm')?.addEventListener('submit', async function(e) {
      e.preventDefault();

      try {
        // â˜… ì œì¶œ ì§ì „ ê°’ ë³´ì •
        const main = document.getElementById('mainCategory')?.value?.trim() || '';
        const sub = document.getElementById('subCategory')?.value?.trim() || '';
        const road = document.getElementById('roadAddress')?.value?.trim() || '';
        const detail = document.getElementById('detailAddress')?.value?.trim() || '';

        const catHidden = document.getElementById('businessCategoryCombined'); // name="businessCategory"
        const addrHidden = document.getElementById('addressCombined');          // name="address"
        if (catHidden) catHidden.value = [main, sub].filter(Boolean).join(' / ');
        if (addrHidden) addrHidden.value = [road, detail].filter(Boolean).join(' ');

        // âœ… ì‚¬ì—…ìë²ˆí˜¸ë¥¼ hidden inputì— ì„¤ì • (í¼ ì œì¶œ ì „)
        const biz1 = document.getElementById('bizNumber1')?.value.trim() || '';
        const biz2 = document.getElementById('bizNumber2')?.value.trim() || '';
        const biz3 = document.getElementById('bizNumber3')?.value.trim() || '';
        const fullBizNumber = biz1 + biz2 + biz3;
        if (fullBizNumber) {
          document.getElementById('businessNumber').value = fullBizNumber;
        }

        // ë°°ë‹¬ê°’ ì •ê·œí™” (ì˜ˆë°©)
        const delSel = document.getElementById('deliveryOption');
        if (delSel && delSel.value === 'ë¶ˆê°€ëŠ¥') delSel.value = 'ë¶ˆê°€';

        // ì œì¶œ ì§ì „ ë³´ì •
        document.querySelectorAll('input[name="menuImage[]"]').forEach((inp) => {
          const row = inp.closest('div');
          const name = row.querySelector('input[name="menuName[]"]')?.value.trim();
          const price = row.querySelector('input[name="menuPrice[]"]')?.value.trim();
          if (!name || !price) {
            // ë©”ë‰´ëª…/ê°€ê²©ì´ ì—†ìœ¼ë©´ ì´ ì´ë¯¸ì§€ inputì€ ì œê±°
            inp.remove();
          }
        });

        // ìµœì¢… FormData
        const fd = new FormData(e.target);

        // ì´ë²¤íŠ¸ë¥¼ ë°°ì—´ í‚¤ë¡œ ì¶”ê°€
        ['event1', 'event2'].forEach(id => {
          const v = document.getElementById(id)?.value?.trim();
          if (v) fd.append('events[]', v);
        });

        // âœ… ë””ë²„ê¹…: FormData ë‚´ìš© ì¶œë ¥
        console.log('=== FormData ì „ì†¡ ë‚´ìš© ===');
        for (let [key, value] of fd.entries()) {
          console.log(key, ':', value instanceof File ? `${value.name} (${value.size} bytes)` : value);
        }

        const res = await fetch('/combined/store', { method: 'POST', body: fd });
        console.log('ì„œë²„ ì‘ë‹µ ìƒíƒœ:', res.status, res.statusText);
        
        const data = await res.json();
        console.log('ì„œë²„ ì‘ë‹µ ë°ì´í„°:', data);

        if (data.ok) {
          // âœ… ì‚¬ì—…ìë²ˆí˜¸ ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ IDë¡œ í´ë°±
          const bizNum = data.businessNumber || document.getElementById('businessNumber').value.trim();
          const newId = data.id || data.store_id || data.storeId;

          if (confirm('ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í• ê¹Œìš”?')) {
            // âœ… ì‚¬ì—…ìë²ˆí˜¸ê°€ ìˆìœ¼ë©´ ì‚¬ì—…ìë²ˆí˜¸ë¡œ, ì—†ìœ¼ë©´ IDë¡œ ì´ë™
            if (bizNum && bizNum.length === 10) {
              window.location.href = `/ndetail.html?biz=${bizNum}&type=combined`;
            } else if (newId) {
              window.location.href = `/ndetail.html?id=${newId}&type=combined`;
            } else {
              alert('ë“±ë¡ì€ ì™„ë£Œë˜ì—ˆìœ¼ë‚˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
          }
        } else {
          // âœ… ìƒì„¸í•œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
          const errorMsg = data.message || data.error || 'ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
          alert(`ë“±ë¡ ì‹¤íŒ¨:\n${errorMsg}`);
          console.error('ë“±ë¡ ì‹¤íŒ¨ ìƒì„¸:', data);
        }
      } catch (err) {
        console.error('í¼ ì œì¶œ ì—ëŸ¬:', err);
        alert('ì—ëŸ¬: ' + err.message);
      }
    });

    // --- ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜ë“¤ ---
    function goBack() {
      history.back();
    }

    function goHome() {
      window.location.href = "/";
    }

    function goNext() {
      // ë‹¤ìŒ ë“±ë¡ í˜ì´ì§€ë¡œ ì´ë™
      if (window.location.pathname.includes("foodregister")) {
        window.location.href = "/public2/ncombinedregister.html";
      } else if (window.location.pathname.includes("ncombinedregister")) {
        window.location.href = "/public2/hotblogregister.html";
      } else {
        window.location.href = "/public2/foodregister.html";
      }
    }
  </script>
</body>

</html>